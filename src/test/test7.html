<!DOCTYPE html>
<html>

<head>
    <title>ZScore Test</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="cache-control" content="no-cache, must-revalidate, post-check=0, pre-check=0" />
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="manifest" href="img/manifest.json">
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="css/zscore.css?v=1.0.9">

    <script type="text/javascript" src="js/gsap/minified/gsap.min.js"></script>
    <script type="text/javascript" src="js/util/zsUtil.js?v=1.0.5"></script>
    <script type="text/javascript" src="js/net/zsNet.js?v=1.0.8"></script>
    <script type="text/javascript" src="js/music/zsMusic.js?v=1.0.1"></script>
    <script type="text/javascript" src="js/svg/zsSvg.js?v=1.0.2"></script>
    <script type="text/javascript" src="js/audio/zsGranulator.js?v=1.0.6"></script>
    <script type="text/javascript" src="js/audio/zsSpeech.js?v=1.0.1"></script>
    <script type="text/javascript" src="js/audio/zsAudio.js?v=1.0.2"></script>
    <script type="text/javascript" src="js/zscoreTest.js?v=1.0.1"></script>
</head>

<body>

    <div id="container" class="wrapper"> 
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" id="svgCanvas" viewBox="0 0 812 609" preserveAspectRatio="xMidYMid meet">
            <defs>
                <filter id="shadow">
                   <feDropShadow dx="1.0" dy="2.0" stdDeviation="0.2" flood-color="blue" />
                </filter>
                <filter id="dropshadow" height="130%">
                    <feGaussianBlur in="SourceAlpha" stdDeviation="2"/> <!-- stdDeviation is how much to blur -->
                    <feOffset dx="1" dy="2" result="offsetblur" flood-color="blue"/> <!-- how much to offset -->
                    <feComponentTransfer>
                      <feFuncA type="linear" slope="0.5"/> <!-- slope is the opacity of the shadow -->
                    </feComponentTransfer>
                    <feMerge> 
                      <feMergeNode/> <!-- this contains the offset blurred image -->
                      <feMergeNode in="SourceGraphic"/> <!-- this contains the element that the filter is applied to -->
                    </feMerge>
                </filter>
                <symbol id="crotchet" data-name="crotchet" viewBox="0 0 7.34 21.56"><path id="path17203" d="M6.86,0V16.65a2.68,2.68,0,0,0-2-.69C2.75,16,0,17.74,0,19.71c0,1.18,1,1.85,2.4,1.85,2.26,0,4.94-1.82,4.94-3.73V0Z"/></symbol>
            </defs>
            <!-- top controls -->
            <!-- semaphore -->
            <g id="semaphore">
                <circle id="semc1" cx="42" cy="26" r="12" stroke="black" stroke-width="1" fill="none"/>
                <circle id="semc2" cx="71" cy="26" r="12" stroke="black" stroke-width="1" fill="none"/>
                <circle id="semc3" cx="100" cy="26" r="12" stroke="black" stroke-width="1" fill="none"/>
                <circle id="semc4" cx="129" cy="26" r="12" stroke="black" stroke-width="1" fill="none"/>
            </g>        
            <!-- title -->
            <text id="title" x="50%" y="28" dominant-baseline="middle" text-anchor="middle" font-size="1.5em">Short Title</text> 
            <text id="part" x="50%" y="60" dominant-baseline="middle" text-anchor="middle">Violin1</text> 
            <!-- tempo -->
            <g id="tempo">
                <g id="tempoNote"><use x="95" y="48" width="8" height="22" xlink:href="#crotchet"/></g>
                <text id="tempoEquals" x="105" y="65" dominant-baseline="middle" font-size="1em" text-anchor="start">=</text> 
                <text id="tempoBpm" x="115" y="65" dominant-baseline="middle" font-size="1.5em" text-anchor="start">80</text> 
            </g>

            <!-- staves -->
            <image xlink:href="img/page1.png" preserveAspectRatio="xMidYMid meet" width="752" height="211" x="30" y="80" />
            <image xlink:href="img/page2.png" preserveAspectRatio="xMidYMid meet" width="752" height="211" x="30" y="301" />
            <!-- status -->
            <g id="serverStatus">             
                <rect x="702" y="13" width="80" height="30" fill="lightgreen" style="stroke-width:1;stroke:rgb(46, 231, 61)" rx="3"/>                        
                <text x="742" y="30" dominant-baseline="middle" text-anchor="middle" font-size="0.8em" fill="black" pointer-events="none">Connected</text>
            </g> 
        
            <!-- bottom controls -->
            <g id="controls">
                <g id="btn1" class="btn" filter="url(#dropshadow)">             
                    <rect x="216" y="537" width="80" height="30" fill="white" style="stroke-width:1;stroke:rgb(0,0,0)" rx="10" onclick="step();"/>                        
                    <text x="256" y="554" dominant-baseline="middle" text-anchor="middle" font-size="1em" fill="black" pointer-events="none">Violin1</text>
                </g>
                <g id="btn1" class="btn" filter="url(#dropshadow)">              
                    <rect x="316" y="537" width="80" height="30" fill="white" style="stroke-width:1;stroke:rgb(0,0,0)" rx="10" onclick="play();"/>                        
                    <text x="356" y="554" dominant-baseline="middle" text-anchor="middle" font-size="1em" fill="black" pointer-events="none">Violin2</text>
                </g>
                <g id="btn1" class="btn" filter="url(#dropshadow)">              
                    <rect x="416" y="537" width="80" height="30" fill="white" style="stroke-width:1;stroke:rgb(0,0,0)" rx="10" onclick="incrementTempo();"/>                        
                    <text x="456" y="554" dominant-baseline="middle" text-anchor="middle" font-size="1em" fill="black" pointer-events="none">Viola</text>
                </g>
                <g id="btn1" class="btn" filter="url(#dropshadow)">              
                    <rect x="516" y="537" width="80" height="30" fill="white" style="stroke-width:1;stroke:rgb(0,0,0)" rx="10"/>                        
                    <text x="556" y="554" dominant-baseline="middle" text-anchor="middle" font-size="1em" fill="black" pointer-events="none">Cello</text>
                </g>                                
            </g>
            <line id="topLine" x1="0" y1="0" x2="812" y2="0" stroke="black" />
            <line id="bottomLine" x1="0" y1="609" x2="812" y2="609" stroke="black" />
            <!-- <line id="topCtrlLine1" x1="0" y1="28" x2="812" y2="28" stroke="black" /> --> 
            <!-- <line id="topCtrlLine2" x1="0" y1="60" x2="812" y2="60" stroke="black" />             -->
            <line id="posLine" x1="95" y1="0" x2="95" y2="609" stroke="red" />
            <line id="beatLine" x1="95" y1="0" x2="95" y2="609" stroke="green" />
            <circle id="beatBall" cx="95" cy="110" r="4" stroke="none" fill="blue"/>
        </svg>    
    </div>
    <div id="btnOuterDiv" class="outer">
        <div class="middle">
            <div class="inner">
            <button id="joinBtn" class="myButton" onclick="join();">Join<br/>the performance</button>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        function join() {
            document.getElementById('joinBtn').style.visibility = 'hidden';
            document.getElementById('btnOuterDiv').style.visibility = 'hidden';
            try {
                zscore.load();
            } catch(err) {
                if(zsUtil) {
                    zsUtil.logException(err, "Failed to load ZScore");
                } else {
                    console.log("Failed to load ZScore js, err: " + err);
                }
                // window.location = 'error.html';
            }
        }        
        function step() {
            try {
                zscore.timeStep();
            } catch(err) {
                if(zsUtil) {
                    zsUtil.logException(err, "Failed to load ZScore");
                } else {
                    console.log("Failed to load ZScore js, err: " + err);
                }
            }
        }      
        function play() {
            try {
                zscore.playTopStave();
            } catch(err) {
                if(zsUtil) {
                    zsUtil.logException(err, "Failed to load ZScore");
                } else {
                    console.log("Failed to load ZScore js, err: " + err);
                }
            }
        } 
        function incrementTempo() {
            try {
                zscore.incrementTempo();
            } catch(err) {
                if(zsUtil) {
                    zsUtil.logException(err, "Failed to load ZScore");
                } else {
                    console.log("Failed to load ZScore js, err: " + err);
                }
            }
        }        
    </script>
</body>

</html>