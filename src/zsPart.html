<!DOCTYPE html>
<html>

<head>
    <title>ZScore Test</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="cache-control" content="no-cache, must-revalidate, post-check=0, pre-check=0" />
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <link rel="apple-touch-icon" sizes="180x180" href="img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="img/favicon-16x16.png">
    <link rel="manifest" href="manifest.json">
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" type="text/css" href="css/zscoreWeb.css?v=1.0.9">

    <script type="text/javascript" src="js/gsap/minified/gsap.min.js"></script>
    <script type="text/javascript" src="js/util/zsUtil.js?v=1.0.1"></script>
    <script type="text/javascript" src="js/net/zsNet.js?v=1.0.4"></script>
    <script type="text/javascript" src="js/music/zsMusic.js?v=1.0.1"></script>
    <script type="text/javascript" src="js/svg/zsSvg.js?v=1.0.1"></script>
    <script type="text/javascript" src="js/audio/zsGranulator.js?v=1.0.1"></script>
    <script type="text/javascript" src="js/audio/zsSpeech.js?v=1.0.1"></script>
    <script type="text/javascript" src="js/audio/zsAudio.js?v=1.0.1"></script>
    <script type="text/javascript" src="js/zscoreWeb.js?v=1.0.7"></script>
</head>

<body>

    <div id="container" class="wrapper"> 
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" id="svgCanvas" viewBox="0 0 812 609" preserveAspectRatio="xMidYMid meet">
            <defs>
                <filter id="shadow">
                   <feDropShadow dx="1.0" dy="2.0" stdDeviation="0.2" flood-color="blue" />
                </filter>
                <filter id="dropshadow" height="130%">
                    <feGaussianBlur in="SourceAlpha" stdDeviation="2"/> <!-- stdDeviation is how much to blur -->
                    <feOffset dx="1" dy="2" result="offsetblur" flood-color="blue"/> <!-- how much to offset -->
                    <feComponentTransfer>
                      <feFuncA type="linear" slope="0.5"/> <!-- slope is the opacity of the shadow -->
                    </feComponentTransfer>
                    <feMerge> 
                      <feMergeNode/> <!-- this contains the offset blurred image -->
                      <feMergeNode in="SourceGraphic"/> <!-- this contains the element that the filter is applied to -->
                    </feMerge>
                </filter>
                <symbol id="crotchet" data-name="crotchet" viewBox="0 0 7.34 21.56"><path id="path17203" d="M6.86,0V16.65a2.68,2.68,0,0,0-2-.69C2.75,16,0,17.74,0,19.71c0,1.18,1,1.85,2.4,1.85,2.26,0,4.94-1.82,4.94-3.73V0Z"/></symbol>
            </defs>

            <!-- frame -->
            <line id="topLine" x1="0" y1="0" x2="812" y2="0" stroke="black" />
            <line id="bottomLine" x1="0" y1="609" x2="812" y2="609" stroke="black" />                                

            <!-- title -->
            <g id="header">
                <text id="title" x="50%" y="28" dominant-baseline="middle" text-anchor="middle" font-size="1.5em">ZScore</text> 
                <text id="part" x="50%" y="60" dominant-baseline="middle" text-anchor="middle">Part View</text> 
            </g>
            
            <!-- top controls -->
            <!-- semaphore -->
            <g id="semaphore">
                <circle id="semC1" cx="42" cy="26" r="12" stroke="black" stroke-width="1" fill="none"/>
                <circle id="semC2" cx="71" cy="26" r="12" stroke="black" stroke-width="1" fill="none"/>
                <circle id="semC3" cx="100" cy="26" r="12" stroke="black" stroke-width="1" fill="none"/>
                <circle id="semC4" cx="129" cy="26" r="12" stroke="black" stroke-width="1" fill="none"/>
            </g>        
            <!-- tempo -->
            <g id="tempo">
                <g id="tmpNote"><use x="95" y="48" width="8" height="22" xlink:href="#crotchet"/></g>
                <text id="tmpEquals" x="105" y="65" dominant-baseline="middle" font-size="1em" text-anchor="start">=</text> 
                <text id="tmpBpm" x="115" y="65" dominant-baseline="middle" font-size="1.5em" text-anchor="start">0</text> 
            </g>
            <!-- status -->
            <g id="srvrStatus">       
                <g id="srvrStatBtn" class="srvr-status-svg-btn" filter="url(#dropshadow)">                
                    <rect id="srvrStatusRect" x="702" y="13" width="80" height="30" fill="red" style="stroke-width:1;stroke:red" onclick="join();" rx="5"/>                        
                    <text id="srvrStatusTxt" x="742" y="30" dominant-baseline="middle" text-anchor="middle" font-size="0.8em" fill="white" pointer-events="none">Connect</text>
                </g>
            </g> 
        

            <!-- staves -->
            <g id="staves">
                <g id="stvTop">
                    <image id="stvTopImg" xlink:href="img/blankStave.png" preserveAspectRatio="xMidYMid meet" width="752" height="211" x="30" y="80" />
                    <line id="stvTopStartLine" x1="95" y1="80" x2="95" y2="281" stroke="blue" style="opacity:0.3;stroke-width:2"/>
                    <line id="stvTopPosLine" x1="95" y1="80" x2="95" y2="281" stroke="purple" style="opacity:0.3;stroke-width:2"/>            
                    <circle id="stvTopBeatBall" cx="95" cy="110" r="4" stroke="none" fill="purple" style="opacity:1.0"/>
                    <rect id="stvTopMask" x="-1000" y="79" width="2812" height="203" fill="none" style="opacity:0.5;stroke-width:1;stroke:blue"/>
                </g>
                <g id="stvBot">
                    <image id="stvBotImg" xlink:href="img/blankStave.png" preserveAspectRatio="xMidYMid meet" width="752" height="211" x="30" y="301" />
                    <line id="stvBotStartLine" x1="95" y1="301" x2="95" y2="502" stroke="blue" style="opacity:0.3;stroke-width:2"/>
                    <line id="stvBotPosLine" x1="95" y1="301" x2="95" y2="502" stroke="purple" style="opacity:0.3;stroke-width:2"/>            
                    <circle id="stvBotBeatBall" cx="95" cy="331" r="4" stroke="none" fill="purple" style="opacity:1.0"/>
                    <rect id="stvBotMask" x="-1000" y="300" width="2812" height="203" fill="white" style="opacity:0.4;stroke-width:1;stroke:grey"/>
                </g>
            </g>
            
            <!-- bottom controls -->
            <g id="instControls" style="visibility: hidden;">
                <g id="instbtn1" class="inst-svg-btn" filter="url(#dropshadow)">             
                    <rect id="instBtn1Rect" x="216" y="537" width="80" height="30" fill="white" style="stroke-width:1;stroke:rgb(0,0,0)" rx="10" onclick="onInstrumentControl('inst1');"/>                        
                    <text id="instBtn1Txt" x="256" y="554" dominant-baseline="middle" text-anchor="middle" font-size="1em" fill="black" pointer-events="none">Violin1</text>
                </g>
                <g id="instbtn2" class="inst-svg-btn" filter="url(#dropshadow)">              
                    <rect id="instBtn2Rect" x="316" y="537" width="80" height="30" fill="white" style="stroke-width:1;stroke:rgb(0,0,0)" rx="10" onclick="onInstrumentControl('inst2');"/>                        
                    <text id="instBtn2Txt" x="356" y="554" dominant-baseline="middle" text-anchor="middle" font-size="1em" fill="black" pointer-events="none">Violin2</text>
                </g>
                <g id="instbtn3" class="inst-svg-btn" filter="url(#dropshadow)">              
                    <rect id="instBtn3Rect" x="416" y="537" width="80" height="30" fill="white" style="stroke-width:1;stroke:rgb(0,0,0)" rx="10" onclick="onInstrumentControl('inst3');"/>                        
                    <text id="instBtn3Txt" x="456" y="554" dominant-baseline="middle" text-anchor="middle" font-size="1em" fill="black" pointer-events="none">Viola</text>
                </g>
                <g id="instbtn4" class="inst-svg-btn-dis" filter="none">              
                    <rect id="instBtn4Rect" x="516" y="537" width="80" height="30" fill="lightgrey" style="stroke:none" rx="10" onclick=""/>                        
                    <text id="instBtn4Txt" x="556" y="554" dominant-baseline="middle" text-anchor="middle"  style="visibility: hidden;" font-size="1em" fill="black" pointer-events="none">Cello</text>
                </g>                                
            </g>
           
        </svg>    
    </div>
    <div id="instListOuterDiv" class="outer" style="visibility: hidden;">
        <div class="middle">
                <div class="inst-list">               
                    <div class="inst-list-content">Select instrument: </div>
                    <div><buton id="inst1Btn" class="instListButton" onclick="onInstrumentSelect('Instrument1')">Instrument1</button></div>
                    <div><buton id="inst2Btn" class="instListButton" onclick="onInstrumentSelect('Instrument2')">Instrument2</button></div>
                    <div><buton id="inst3Btn" class="instListButton" onclick="onInstrumentSelect('Instrument3')">Instrument3</button></div>
                    <div><buton id="inst4Btn" class="instListButton" onclick="onInstrumentSelect('Instrument4')">Instrument4</button></div>                                            
                </div>
        </div>
    </div>
    <!-- <div id="joinBtnOuterDiv" class="outer" style="visibility: visible;">
        <div class="middle">
            <div class="inner">         
                <buton id="joinBtn" class="joinButton" onclick="join();">CONNECT</button>
            </div>
        </div>
    </div> -->

    <script type="text/javascript">
        function join() {
            // document.getElementById('joinBtnOuterDiv').style.visibility = 'hidden';
            try {
                zscore.load();
            } catch(err) {
                if(zsUtil) {
                    zsUtil.logException(err, "Failed to load ZScore");
                } else {
                    console.log("Failed to load ZScore js, err: " + err);
                }
                window.location = 'error.html';
            }
        }        
        function onInstrumentSelect(inst) {
            try {
                zscore.onInstrumentSelect(inst);
            } catch(err) {
                if(zsUtil) {
                    zsUtil.logException(err, "Failed onInstrumentSelect: " + inst);
                } else {
                    console.log("Failed onInstrumentSelect: " + inst + ", err: " + err);
                }
            }
        }      
        function onInstrumentControl(inst) {
            try {
                zscore.onInstrumentControl(inst);
            } catch(err) {
                if(zsUtil) {
                    zsUtil.logException(err, "Failed onInstrumentControl: " + inst);
                } else {
                    console.log("Failed onInstrumentControl: " + inst + ", err: " + err);
                }
            }
        }           
    </script>
</body>

</html>