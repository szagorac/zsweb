var zscore=function(e,t,n,i,o,r,a){"use strict";function s(e){this.message=e,this.name="ZScoreException"}function l(e,t,n,i,o,r,a,s){this.xStart=e,this.xEnd=t,this.yStart=n,this.yEnd=i,this.beatStartNum=o,this.beatStartDenom=r,this.beatEndNum=a,this.beatEndDenom=s}function c(e,t,n,i,o){this.id=e,this.no=t,this.part=n,this.imgFileName=i,this.imgFileUrl=o,this.isLoaded=!1,this.img=new Image,this.img.pageId=e,this.img.instrument=n}function d(e,t){this.id=no.idSectionBtnPrefix+t,this.no=e,this.class="sectionListButton",this.onclick="onSectionSelect('"+t+"')"}function f(){this.class="sectionListButtonDisabled",this.onclick=""}function m(e,t){this.onclick="onInstrumentSelect("+e+",'"+t+"')"}function u(){this.onclick=""}function v(){}function p(){if(!io.isInitialised){if(!(e&&t&&n&&i&&o))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");e.setRunMode(Bn),kn("init: "),I(),eo=e.isTouchDevice(),to=e.isSafari(navigator),kn("init: IsTouch Device: "+eo+" isSafari: "+to),io.fontCanvas=a.createElement("canvas"),io.canvasCtx=io.fontCanvas.getContext("2d"),e.listen("resize",r,q),e.listen("orientationchange",r,q),L(),H(),U(),D(),g(),io.isInitialised=!0}}function g(){}function I(){var t=e.getLocalParam(Pi);xn(t)&&(t=e.generateRandomId(),e.storeLocalParam(Pi,t)),io.clientId=t,kn("clientId: "+io.clientId),n.setElementIdText(no.idClientId,io.clientId),C()}function S(){io.movement.partPages={}}function b(){T(io.topStave),T(io.bottomStave)}function P(t){if(!xn(t)&&!xn(t.config)){var n=t.config;e.removeChildren(n.ovrlPitchStaveInfoId)}}function T(t){if(!xn(t)&&!xn(t.config)){var n=t.config;e.setElementIdAttributes(n.positionLineId,n.posLineConf),e.setElementIdAttributes(n.beatBallId,n.posBallConf)}}function y(){io.isInitialised?(kn("onStateBtnClick: zscore initialised"),t.isConnected()||(kn("onStateBtnClick: zscore not connected, reconnecting..."),J())):(kn("onStateBtnClick: initialising"),p())}function x(t){e.arrContains(io.score.parts,t)?(io.part.name=t,ut(t),e.makeInVisible(no.idPartsListOuterDiv)):kn("onPartSelection: unexpected part: "+t)}function h(t){e.arrContains(io.score.sections,t)?(E(t),It(t)):kn("onSectionSelection: unexpected section: "+t)}function E(t){var n=no.idSectionBtnPrefix+t,i=e.getElement(n);xn(i)||k(i)}function k(t){xn(t)||e.setElementAttributes(t,new f)}function A(){var t=e.getElement(no.idOwnedSections);if(!xn(t)){for(var n=io.score.mySections,i="",o="",r=0;r<n.length;r++)i=i+o+n[r],o="; ";e.setText(t,i)}}function B(e,t){xn(e)||xn(t)||xn(io.part.name)||(gt(e,t,io.part.name),Ht())}function C(){var t=io.isClientIdVisible;t?e.makeVisible(no.idClientId):e.makeInVisible(no.idClientId)}function N(){io.isClientIdVisible=!io.isClientIdVisible,C()}function M(e){if(y(),!xn(e)){var t=o.getTransposition(e);xn(t)||(io.transpo=t,Xt(),Ne())}}function w(){z()}function L(){t.init(no.connectionPreference,no.appUrlSse,no.appUrlWebsockets,no.appUrlHttp,$,Y)}function D(){var t=e.getElement(no.metro.idMetronomeRect);xn(t)||(e.listen("click",t,V),O())}function O(){var t=e.getElement(no.metro.idMetroFreqLine),n=e.getElement(no.metro.idMetroFreqRect);if(hn(t)&&hn(n)){var i=e.toInt(t.getAttribute(Yn)),o=e.toInt(n.getAttribute(Qn)),r=Math.round(o/2),a=i-r;io.metro.slider.xMax=a;var s=e.toInt(t.getAttribute(qn)),l=s+r;io.metro.slider.xMin=l;var c=a-l;io.metro.slider.range=c;var d=Math.round((a+l)/2);io.metro.slider.xMid=d}Draggable.create(no.metro.ifMetroFreqSlider,{type:zn,bounds:document.getElementById(no.metro.idMetroFreqLine),onDrag:R})}function R(t){var n=gsap.getProperty(no.metro.ifMetroFreqSlider,zn),o=io.metro.slider.xMid+n,r=o-io.metro.slider.xMin,a=Math.round(100*r/io.metro.slider.range),s=e.mapRange(a,0,100,no.metro.minFreq,no.metro.maxFreq);s<200&&(s=200),i.setBeepFreqenecy(s),kn("onFreqSliderMove: freq: "+s)}function V(e){io.metro.isMetroOn?_():F()}function _(){i.switchMetro(!1),n.setElementIdHref(no.metro.idMetronome,no.metro.ifSymbolMetroOff),e.makeInVisible(no.metro.idMetroSlider),io.metro.isMetroOn=!1}function F(){i.switchMetro(!0),n.setElementIdHref(no.metro.idMetronome,no.metro.ifSymbolMetroOn),e.makeVisible(no.metro.idMetroSlider),io.metro.isMetroOn=!0}function U(){xn(i)?En("initAudio: invalid zsAudio lib"):i.init()}function z(){xn(i)?En("resetAudio: invalid zsAudio lib"):i.reset()}function H(){n.init()}function q(t){if(!e.isObject(this))return null}function Y(e,n){switch(e){case t.OPEN:W(n);break;case t.CLOSED:X(n);break;case t.ERROR:Q(n);break;default:En("Unknown Connection Event State: "+e+" for type: "+n)}}function W(e){kn(e+" connection opened."),G(e)}function X(e){kn(e+" connection closed."),K(e)}function Q(e){kn(e+" connection error."),j(e)}function G(e){io.isConnected=!0,io.connectionType=e,io.reconnectAttmpts=0,Z(no.connectedRectStyle,no.connectedBtnAttrib,no.connectedTxtStyle,Ln),mt()}function K(e){io.isConnected=!1,Z(no.disconnectedRectStyle,no.disconnectedBtnAttrib,no.disconnectedTxtStyle,Rn),J(e)}function j(e){io.isConnected=!1,Z(no.errorRectStyle,no.errorBtnAttrib,no.errorTxtStyle,Vn),J(e)}function Z(t,n,i,o){var r=e.getElement(no.idServerStatusRect);xn(r)||Tn(r,t);var a=e.getElement(no.idServerStatusBtn);xn(a)||yn(a,n);var s=e.getElement(no.idServerStatusTxt);xn(s)||(Tn(s,i),s.textContent=o)}function J(e){t.reconnect(e,!0)}function $(e,t){io.isConnected||G(),xn(e)||(t||w(),hn(e.scoreInfo)&&ee(e.scoreInfo),hn(e.strategyInfo)&&te(e.strategyInfo),hn(e.partInfo)&&_e(e.partInfo),hn(e.pageInfo)&&ye(e.pageInfo),hn(e.mapInfo)&&le(e.mapInfo),hn(e.bpm)&&0!=e.bpm&&se(e.bpm),hn(e.actions)&&bt(e.actions))}function ee(t){if(e.isObject(t)){if(hn(t.partHtmlPage)){var n=oe(t.partHtmlPage),i=e.getPageName();n&&t.partHtmlPage!==i&&e.loadPage(t.partHtmlPage)}if(hn(t.name)&&ie(t.name),hn(t.title)){var o=ne(t.title);o&&S()}hn(t.instruments)&&dt(t.instruments),hn(t.bpm),hn(t.scoreDir)&&re(t.scoreDir)}}function te(e){hn(e.strategies)&&tt(e.strategies)}function ne(e){return io.score.title!==e&&(io.score.title=e,n.setElementIdText(no.idTitle,e),!0)}function ie(t){io.score.noSpaceName=e.replaceEmptySpaces(t,Nn)}function oe(e){var t=io.score.htmlFile;return xn(t)?(io.score.htmlFile=e,!1):t!==e&&(io.score.htmlFile=e,!0)}function re(e){io.scoreDir!==e&&(io.scoreDir=e)}function ae(e){io.tempo!==e&&(io.tempo=e,n.setElementIdText(no.idTempoBpm,e))}function se(t){var n=e.toInt(t);if(!xn(n)){var i=io.tempo,o=n/i;io.tempoModifier=o,ae(n),io.isPlaying?de(o):me()}}function le(t){if(!xn(t.map)&&!xn(t.pageId)){t.pageId;var n=t.staveId,i=t.map,o=io[n];if(!xn(o)){var r=o.config.xLeftMargin,a=JSON.parse(JSON.stringify(i));if(e.isArray(a)){for(var s={},l=0;l<a.length;l++)ce(s,a[l],r);o.beatMap=s,ue(n)}}}}function ce(e,t,n){if(!(xn(e)||xn(t)||xn(t.beatStartNum))){var i=t.beatStartNum,o=t.xStart+n,r=t.xEnd+n,a=new l(o,r,t.yStart,t.yEnd,i,t.beatStartDenom,t.beatEndNum,t.beatEndDenom);e[i]=a}}function de(e){fe(io.topStave.timeline,e),fe(io.bottomStave.timeline,e)}function fe(e,t){if(!xn(e)){var n=e.timeScale(),i=n*t;e.timeScale(i)}}function me(){ve(io.topStave),ve(io.bottomStave)}function ue(e){xn(e)||ve(io[e])}function ve(e){if(!xn(e)){var t=gsap.timeline({onComplete:Se,onCompleteParams:[e.id],paused:!0}),n=e.beatMap;if(!xn(n)){var i=e.config.positionLineId,r=e.config.beatBallId,a=e.config.ballYmax,s=!0;for(var l in n){var c=n[l],d=io.tempo,f=o.getBeatDurationSec(d),m=c.beatStartNum;if(s){var u=no.beatIdPrefix+(m-1),v=c.xStart,p=pe(i,0,v,u,0);t.add(p,Gn);var g=ge(r,0,v,u);t.add(g,Kn),s=!1}v=c.xEnd,u=no.beatIdPrefix+m;var I=no.tweenIdPrefix+u,S=pe(i,f,v,u,m),b=ge(r,f,v,u),P=Ie(r,f/2,a,u);I=S.vars.id;t.addLabel(I,Kn),t.add(S,Kn),t.add(b,Gn),t.add(P,I)}hn(e.currentBeat)&&on(t,e.currentBeat),e.timeline=t}}}function pe(t,n,i,o,r){var a=no.tweenIdPrefix+o;return gsap.to(e.toCssIdQuery(t),{id:a,duration:n,attr:{x1:i,x2:i},ease:"none",onStart:be,onStartParams:[o,r],onComplete:Pe,onCompleteParams:[o,r]})}function ge(t,n,i,o){var r=no.ballTweenIdPrefix+o;return gsap.to(e.toCssIdQuery(t),{id:r,duration:n,attr:{cx:i},ease:"none"})}function Ie(t,n,i,o){var r=no.ballTweenIdPrefix+o;return gsap.to(e.toCssIdQuery(t),{id:r,duration:n,attr:{cy:i,r:2},ease:"power1.out",autoAlpha:.5,repeat:1,yoyo:!0})}function Se(e){An("onTimelineComplete stave: "+e);var t=io[e];hn(t)&&(t.isRunning=!1),hn(t.timeline)&&t.timeline.pause(0)}function be(e,t){var n=i.getCurrentTime();io.audioTlBeatTime=n,An("onBeatStart: beat: "+e+" beatNo: "+t+" beatTime: "+n),Te(t,e)}function Pe(e,t){var n=i.getCurrentTime(),o=n-io.startTimeTl;An("onBeatEnd: beat: "+e+" beatNo: "+t+" elapsedTime: "+o)}function Te(t,n){e.isNumeric(t)&&(e.isNull(n)&&(n=no.beatIdPrefix+t),io.currentBeatId=n,io.currentBeatNo=t)}function ye(e){if(!xn(e.staveId)){var t=e.staveId,n=io[t];xn(n)?En("processPageinfo: Invalid stave for id: {}",t):(hn(e.filename)&&(n.filename=e.filename),hn(e.pageId)&&(n.pageId=e.pageId),hn(e.rndPageId)?n.rndPageId=e.rndPageId:n.rndPageId=null,hn(e.part)&&(n.part=e.part),xe(n),hn(e.transpositionInfo)&&he(e.transpositionInfo,n),Me(n))}}function xe(t){var n=e.getElement(t.config.ovrlPitchStaveInfoId);hn(n)&&e.removeElementChildren(n)}function he(e,t){xn(e)||xn(t)||(Ee(e.rectInfos,t),Ae(e.txtInfos,t))}function Ee(t,n){if(!xn(t)){var i=e.getElement(n.config.ovrlPitchStaveInfoId);if(e.isArray(t))for(var o=0;o<t.length;o++)ke(t[o],i);else ke(t,i)}}function ke(t,i){if(!xn(t)&&!xn(i)){var o=null,r=null,a=null,s=null;if(hn(t.x)&&(o=t.x),hn(t.y)&&(r=t.y),hn(t.width)&&(a=t.width),hn(t.height)&&(s=t.height),!(xn(o)||xn(r)||xn(a)||xn(s))){var l=no.idTranspoInfo+Ce(),c=n.createRectangleElement(l);c.setAttribute("x",o),c.setAttribute("y",r),c.setAttribute("width",a),c.setAttribute("height",s),e.setElementAttributes(c,no.transpoExtRectAttrib),e.addChildToParent(i,c)}}}function Ae(t,n){if(!xn(t)){var i=e.getElement(n.config.ovrlPitchStaveInfoId);if(e.isArray(t))for(var o=0;o<t.length;o++)Be(t[o],i);else Be(t,i)}}function Be(t,i){if(!xn(t)&&!xn(i)){var r=null,a=null,s=null;if(hn(t.x)&&(r=t.x),hn(t.y)&&(a=t.y),hn(t.txt)&&(s=t.txt),!(xn(r)||xn(a)||xn(s))){var l=o.getPitch(s),c=o.PITCH_MOD.NATURAL;if(hn(l)){c=l.mod;var d=o.transpose(l,io.transpo);hn(d)&&(l=d,s=d.pitchName,c=d.mod)}var f=no.idTranspoInfo+Ce(),m=n.createTextElement(f);m.setAttribute(zn,r),m.setAttribute(Hn,a),e.setElementAttributes(m,no.transpoInfoAttrib);var u=no.idTranspoInfo+Ce(),v=n.createTspanElement(u);if(n.setElementText(v,s),e.addChildToParent(m,v),hn(l)&&o.PITCH_MOD.NATURAL!==c&&hn(l.modUnicode)){var p=no.idTranspoInfo+Ce(),g=n.createTspanElement(p);e.setElementAttributes(g,no.transpoPitchModAttrib),v.setAttribute(Wn,-2),n.setElementText(g,l.modUnicode),e.addChildToParent(v,g)}else v.setAttribute(Wn,2);v.setAttribute(Xn,no.transpoLetterDy),e.addChildToParent(i,m)}}}function Ce(){return++io.counter}function Ne(){if(!xn(io.transpo)){var e=io.transpo,t=o.PITCH.C;hn(e)&&(t=e.pitch),xn(t)||(hn(t.pitchName)&&n.setElementIdText(no.idTranspoKey,t.pitchName),hn(t.modUnicode)&&n.setElementIdText(no.idTranspoMod,t.modUnicode))}}function Me(t){if(!xn(t)){var n=t.config;if(!xn(n)){var i=null,o=t.pageId,r=t.filename,a=t.part;hn(t.rndPageId)&&(o=t.rndPageId);var s=$e(o);if(s>0&&hn(r))i=io.movement.imgDir+r;else{var l=De(o,a);xn(l)?(i=Le(t.filename),kn("Created img src: "+i)):i=l.src}var c=e.getElement(n.imgId);c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i),c.setAttribute("href",i);var d=e.getElement(t.config.ovrlPitchStaveInfoId),f=!1;e.hasChildrenElements(d)&&(f=!0),Ot(n,f)}}}function we(t){if(!xn(t)){var n=t.config;if(!xn(n)){var i=t.filename,o=e.getElement(n.imgId);o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",i),o.setAttribute("href",i)}}}function Le(e){return io.scoreDir+e}function De(e,t){var n=Qe(e,t);return xn(n)?null:n.img}function Oe(e,t){var n=Qe(e,t);hn(n)&&(n.isLoaded=!0),io.pageNoToLoad--,0===io.pageNoToLoad&&Ve(),Re(io.pageNoToLoad)}function Re(e){if(e>0){var t=Dn+" "+e;Z(no.errorRectStyle,no.errorBtnAttrib,no.errorTxtStyle,t)}else Z(no.connectedRectStyle,no.connectedBtnAttrib,no.connectedTxtStyle,On)}function Ve(){kn("onPageLoadComplete: ");for(var e=io.movement.parts,t=!0,n=0;n<e.length;n++){var i=e[n],o=Xe(i);for(var r in o)if(o.hasOwnProperty(r)){var a=o[r];a.isLoaded||(kn("onPageLoadComplete: page: "+r+" is not loaded, retying load"),Ye(a.no,i),t=!1)}}t&&(kn("All Pages loaded: "),io.isReady=!0,vt())}function _e(t){if(hn(t.name)&&(io.part.name=t.name),hn(t.pageRanges)){var n=t.pageRanges;if(e.isArray(n))for(var i=0;i<n.length;i++)et(n[i]);else et(n)}hn(t.imgDir)&&(io.part.imgDir=t.imgDir),hn(t.imgPageNameToken)&&(io.part.imgPageNameToken=t.imgPageNameToken),hn(t.imgContPageName)&&(io.part.imgContPageName=t.imgContPageName),hn(t.contPageNo)&&(io.part.contPageNo=t.contPageNo),hn(t.currentSection)&&(io.part.currentSection=t.currentSection),Fe()}function Fe(){var t=io.part.name,i=io.part.currentSection,o="";hn(i)&&(o+=e.capitalizeFirstLetter(i)+" - "),o+=t,n.setElementIdText(no.idInstrument,o)}function Ue(){var e=io.movement.parts;if(!xn(e)){var t=io.movement.firstPage,n=io.movement.lastPage;if(t<0||n<0)En("loadMovementPages: invalid page range");else{io.pageNoToLoad=(n-t+1)*e.length,io.movement.partPages={};for(var i=0;i<e.length;i++)ze(e[i],t,n)}}}function ze(e,t,n){for(var i=t;i<=n;i++)Ye(i,e);He(e),qe(e)}function He(e){var t=je(e);io.pageNoToLoad++,We(t)}function qe(e){var t=Ke(e);io.pageNoToLoad++,We(t)}function Ye(e,t){var n=Ge(e,t);We(n,t)}function We(e){if(!xn(e)){var t=e.imgFileUrl;xn(t)||e.loadImg(t,e.id)}}function Xe(e){if(xn(e))return null;var t=io.movement.partPages;return xn(t)?null:(xn(t[e])&&(t[e]={}),t[e])}function Qe(e,t){var n=Xe(t);return xn(n)?null:n[e]}function Ge(t,n){var i=Je(t),o=Qe(i,n);if(hn(o))return o;var r=io.movement.imgPageNameToken;xn(r)?r=Ze(t,n):(r=e.replace(r,no.partNameToken,n),r=e.replace(r,no.pageNoToken,""+t));var a=io.movement.imgDir+r,s=(o=new c(i,t,n,r,a),Xe(n));return s[i]=o,o}function Ke(t){var n=io.movement.contPageNo,i=Je(n),o=Qe(i,t);if(hn(o))return o;var r=io.movement.imgContPageName;r=xn(r)?Ze(n,t):e.replace(r,no.partNameToken,t);var a=io.movement.imgDir+r,s=(o=new c(i,n,t,r,a),io.movement.partPages),l=s[t];return l[i]=o,o}function je(t){var n=io.movement.blankPageNo,i=Je(n),o=Qe(i,t);if(hn(o))return o;var r=io.movement.imgContPageName;r=xn(r)?Ze(n,t):e.replace(r,no.partNameToken,t);var a=io.movement.imgDir+r,s=(o=new c(i,n,t,r,a),io.movement.partPages),l=s[t];return l[i]=o,o}function Ze(e,t){return io.score.noSpaceName+Nn+t+"_page"+e+".png"}function Je(e){return no.pageIdPrefix+e}function $e(t){if(xn(t))return null;if(e.startsWith(t),no.pageIdPrefix){var n=t.substring(t.indexOf(no.pageIdPrefix)+1);if(hn(n))return e.toInt(n)}return e.toInt(t)}function et(e){if(!(xn(e)||xn(e.start)||xn(e.end))){var t=e.start,n=e.end,i={start:t,end:n};io.part.pageRanges=[],io.part.pageRanges.push(i)}}function tt(t){if(!xn(t))if(e.isArray(t))for(var n=0;n<t.length;n++)nt(t[n]);else nt(t)}function nt(t){if(e.isObject(t))if(xn(t.name))En("processStrategies: invalid strategy name");else{var n=t.name;switch(n){case Zi:rt(t);break;case Ji:ct(t);break;case $i:it(t);break;default:En("processStrategies: Unknown strategy: "+n)}}}function it(e){hn(e.currentMovement)&&ot(e.currentMovement)}function ot(e){if(hn(e.name)&&(io.movement.name=e.name),hn(e.parts)){var t=ft(e.parts);io.movement.parts=t}hn(e.startPage)&&(io.movement.firstPage=e.startPage),hn(e.endPage)&&(io.movement.lastPage=e.endPage),hn(e.imgPageNameToken)&&(io.movement.imgPageNameToken=e.imgPageNameToken),hn(e.imgContPageName)&&(io.movement.imgContPageName=e.imgContPageName),hn(e.contPageNo)&&(io.movement.contPageNo=e.contPageNo),hn(e.imgDir)&&(io.movement.imgDir=e.imgDir),Ue()}function rt(t){var n=!1;if(hn(t.isReady)&&(n=e.toBoolean(t.isReady)),hn(t.sections))if(io.score.sections.length>0&&(io.score.sections=[]),e.isArray(t.sections))for(var i=0;i<t.sections.length;i++)at(t.sections[i]);else at(t.sections);if(hn(t.assignmentType)&&(io.score.assignmentType=t.assignmentType),io.score.ownedSections=[],io.score.mySections=[],hn(t.sectionOwners))for(var o in t.sectionOwners){var r=t.sectionOwners[o];io.score.ownedSections.push(o),io.clientId===r&&io.score.mySections.push(o)}n?lt():st()}function at(e){xn(e)||io.score.sections.push(e)}function st(){var t=io.score.sections;if(!(t.length<1)){var n=e.getElement(no.idSections);if(!xn(n)){for(var i=0;i<t.length;i++){var o=t[i],r=no.idSectionBtnPrefix+o,a=e.getElement(r);if(xn(a)){var s=new d(i+1,o);a=e.createButton(s),e.setText(a,o),e.addChildToParent(n,a)}e.arrContains(io.score.ownedSections,o)&&k(a)}A(),e.makeVisible(no.idSectionsListOuterDiv)}}}function lt(){var t=e.getElement(no.idSections);xn(t)||(e.removeElementChildren(t),e.makeInVisible(no.idSectionsListOuterDiv))}function ct(e){}function dt(t){var n=ft(t);e.arrEquals(io.score.parts,n)||(io.score.parts=n)}function ft(t){var n=[];if(e.isArray(t))for(var i=0;i<t.length;i++){var o=t[i];e.arrContains(no.filterOutParts,o)||n.push(o)}else e.arrContains(no.filterOutParts,t)||n.push(t);return n}function mt(){var e=St();t.sendEvent(Ti,e)}function ut(e){var n=St(),i="C";hn(io.transpo)&&(i=io.transpo),n[Ai]=e,n[qi]=i,t.sendEvent(yi,n)}function vt(){var e=St();e[Ai]=io.part.name,t.sendEvent(xi,e)}function pt(e){var n=St();n[Bi]=e,t.sendEvent(hi,n)}function gt(e,n,i){var o=St();o[Li]=e,o[Di]=n,o[Ai]=i,t.sendEvent(Ei,o)}function It(e){var n=St();n[zi]=e,t.sendEvent(ki,n)}function St(){var e=new v;return e[Hi]=io.clientId,e}function bt(t){var n=null,i=[],o={};if(e.isArray(t))for(var r=0;r<t.length;r++){var a=t[r];hn(a.type)&&(n=a.type),hn(a.targets)&&(i=a.targets),hn(a.params)&&(o=a.params),Pt(n,i,o)}}function Pt(t,n,i){if(e.logDebug("doAction: "+t),!xn(t))switch(t){case"PING":Pn(i);break;case"START":Tt(gn,n,null);break;case"STOP":pn();break;case"SEMAPHORE_ON":cn(i);break;case"SEMAPHORE_OFF":dn(i);break;case"ACTIVATE":Tt(rn,n,i);break;case"BEAT":Tt(tn,n,i);break;case"START_MARK":Tt(Jt,n,i);break;case"INSTRUMENT_SLOTS":qt(i);break;case"RESET_INSTRUMENT_SLOTS":Ht();break;case"RESET_STAVES":Ut();break;case"OVERLAY_ELEMENT":Tt(Bt,n,i);break;case"OVERLAY_LINE":Tt(Et,n,i);break;case"OVERLAY_COLOUR":Tt(yt,n,i);break;case"OVERLAY_TEXT":Tt(Ct,n,i);break;case"VOTE":sn(i);break;default:En("doAction: Unknown actionType: "+t)}}function Tt(t,n,i){if(!xn(t))if(e.isArray(n))for(var o=0;o<n.length;o++)t(n[o],i);else t(target,i)}function yt(e,t){if(!xn(t)&&!xn(e)){var n=io[e],i=t[Oi],o=t[Ui];xt(n,i,o)}}function xt(e,t,n){if(!(xn(e)||xn(t)||xn(n)))switch(t){case"SPEED":case"PRESSURE":case"POSITION":break;case"PITCH":ht(e.config.ovrlPitchId+no.idRectSuffix,n);break;case"DYNAMICS":ht(e.config.ovrlDynId+no.idRectSuffix,n);break;case"TIMBRE":ht(e.config.ovrlTimbreId+no.idRectSuffix,n);break;default:kn("setOverlayColour: unknown overlay type: "+t)}}function ht(t,n){e.setElementIdStyleProperty(t,{fill:n})}function Et(e,t){if(!xn(t)&&!xn(e)){var n=io[e],i=t[Oi],o=t[Vi];kt(n,i,o)}}function kt(e,t,n){if(!(xn(e)||xn(t)||xn(n)))switch(t){case"POSITION":case"SPEED":case"PRESSURE":break;case"PITCH":At(e.config.ovrlPitchId+no.idLineSuffix,n);break;case"DYNAMICS":At(e.config.ovrlDynId+no.idLineSuffix,n);break;case"TIMBRE":At(e.config.ovrlTimbreId+no.idLineSuffix,n);break;default:kn("setOverlayLinePosition: unknown overlay type: "+t)}}function At(t,i){var o=e.getElement(t);n.setLineY(o,i,i)}function Bt(e,t){if(!xn(t)&&!xn(e)){var n=io[e],i=t[Oi],o=t[Ri],r=t[_i],a=t[Fi];Nt(n,i,o,r,a)}}function Ct(e,t){if(!xn(t)&&!xn(e)){var n=io[e],i=t[Oi],o=t[_i],r=t[Yi],a=t[Wi],s=t[Xi];Mt(n,i,r,a,s,o)}}function Nt(e,t,n,i,o){if(!xn(e)&&!xn(t)){var r=e.config;if(!xn(r))switch(An("setOverlayElement: overlayType: "+t),t){case"SPEED":case"PRESSURE":case"POSITION":break;case"PITCH":Rt(r,n,i,o);break;case"DYNAMICS":Lt(r,n,i,o);break;case"TIMBRE":wt(r,n,i,o);break;case"PITCH_STAVE":Dt(r,n,i,o);break;default:kn("setOverlayElement: unknown overlay type: "+t)}}}function Mt(e,t,n,i,o,r){if(!xn(e)&&!xn(t)){var a=e.config;if(!xn(a))switch(An("setOverlayText: overlayType: "+t),t){case"PITCH":Vt(a,n,i,o,r);break;default:kn("setOverlayElement: unknown overlay type: "+t)}}}function wt(e,t,n,i){if(!xn(t)&&!xn(e))switch(t){case"TIMBRE_BOX":Ft(e.ovrlTimbreId+no.idRectSuffix,n,i),Ft(e.ovrlTimbreId+no.idOrdSuffix+no.idLineSuffix,n,i),Ft(e.ovrlTimbreId,n,i),n||Ft(e.ovrlTimbreId+no.idLineSuffix,n,i);break;case"TIMBRE_ORD_LINE":Ft(e.ovrlTimbreId+no.idOrdSuffix+no.idLineSuffix,n,i);break;case"TIMBRE_LINE":Ft(e.ovrlTimbreId+no.idLineSuffix,n,i);break;default:kn("setTimbreOverlay: unknown overlay element: "+t)}}function Lt(e,t,n,i){if(!xn(t)&&!xn(e))switch(t){case"DYNAMICS_BOX":Ft(e.ovrlDynId+no.idRectSuffix,n,i),Ft(e.ovrlDynId+no.idOrdSuffix+no.idLineSuffix,n,i),Ft(e.ovrlDynId,n,i),n||Ft(e.ovrlDynId+no.idLineSuffix,n,i);break;case"DYNAMICS_MID_LINE":Ft(e.ovrlDynId+no.idOrdSuffix+no.idLineSuffix,n,i);break;case"DYNAMICS_LINE":Ft(e.ovrlDynId+no.idLineSuffix,n,i);break;default:kn("setDynamicsOverlay: unknown overlay element: "+t)}}function Dt(e,t,n,i){if(!xn(t)&&!xn(e))switch(t){case"PITCH_STAVE_BOX":Ft(e.ovrlPitchStaveId+no.idRectSuffix,n,i),Ft(e.ovrlPitchStaveId,n,i),n||Ft(e.ovrlPitchStaveId+no.idLineSuffix,n,i);break;case"PITCH_STAVE_MID_LINE":Ft(e.ovrlPitchStaveId+no.idMidSuffix+no.idLineSuffix,n,i);break;default:kn("setPitchOverlay: unknown overlay element: "+t)}}function Ot(e,t){Dt(e,"PITCH_STAVE_BOX",t,1),Dt(e,"PITCH_STAVE_MID_LINE",t,1)}function Rt(e,t,n,i){if(!xn(t)&&!xn(e))switch(t){case"PITCH_BOX":Ft(e.ovrlPitchId+no.idRectSuffix,n,i),Ft(e.ovrlPitchId,n,i),n||Ft(e.ovrlPitchId+no.idLineSuffix,n,i);break;case"PITCH_LINE":Ft(e.ovrlPitchId+no.idLineSuffix,n,i);break;default:kn("setPitchOverlay: unknown overlay element: "+t)}}function Vt(e,t,n,i,o){xn(e)||_t(e.ovrlPitchId,t,n,i,o)}function _t(t,n,i,o,r){var a=e.getElement(t);if(!xn(a)){var s=t+no.idTxtLineSuffix,l=s+"1",c=s+"2",d=s+"3",f=e.getChildElement(a,e.toCssIdQuery(l));xn(f)||(f.style.opacity=0,e.setText(f,n));var m=e.getChildElement(a,e.toCssIdQuery(c));xn(m)||(m.style.opacity=0,e.setText(m,i));var u=e.getChildElement(a,e.toCssIdQuery(d));xn(u)||(u.style.opacity=0,e.setText(u,o));var v=t+no.idTxtSuffix;if(r){if(e.makeVisible(v),no.textSpanIsFadeIn){var p=no.textSpanFadeTimeSec,g=no.textSpanFadeStaggerTimeSec;xn(f)||gsap.to(f,{duration:p,autoAlpha:1,ease:"power1.in"}),xn(m)||gsap.to(m,{delay:g,duration:p,autoAlpha:1,ease:"power1.in"}),xn(u)||gsap.to(u,{delay:2*g,duration:p,autoAlpha:1,ease:"power1.in"})}}else e.makeInVisible(v)}}function Ft(t,n,i){if(!xn(t))if(n){var o=e.toFloat(i);e.isNumeric(o)||(o=1),e.setElementIdStyleProperty(t,{opacity:o}),e.makeVisible(t)}else e.makeInVisible(t)}function Ut(){zt(io.topStave),zt(io.bottomStave)}function zt(e){xn(e)||(e.pageId=ji,e.rndPageId=null,e.filename=Ki,e.beatMap=null,e.timeline=null,e.isActive=!0,e.isPlaying=!1,e.currentBeat=null,T(e),P(e),we(e))}function Ht(){Gt(),Wt()}function qt(e){if(!xn(e)){var t=e[wi];Qt(t),Yt()}}function Yt(){e.makeVisible(no.idInstControls)}function Wt(){e.makeInVisible(no.idInstControls)}function Xt(){e.makeInVisible(no.idTranspoControls)}function Qt(t){if(!xn(t)){var n=e.csvToArr(t);if(!(xn(n)||n.length<=0))for(var i=0;i<4;i++){var o=i+1;i<n.length?Kt(n[i],o):jt(o)}}}function Gt(){for(var e=0;e<4;e++){var t=e+1;Zt(t)}}function Kt(t,i){if(!xn(t)&&!xn(i)){var o=no.idInstSlotTxtPrefix+i,r=no.idInstSlotBtnPrefix+i,a=no.idInstSlotPrefix+i,s=t===io.part.name;e.makeVisible(o),e.makeVisible(r),e.makeVisible(a),e.setElementIdAttributes(a,no.instSlotActiveAttrib),n.setElementIdText(o,t.trim()),e.setElementIdStyleProperty(o,no.instSlotTxtActiveStyle),s?e.setElementIdStyleProperty(r,no.instSlotBtnActiveInstStyle):e.setElementIdStyleProperty(r,no.instSlotBtnActiveStyle);var l=new m(i,t);e.setElementIdAttributes(r,l)}}function jt(t){var i=no.idInstSlotTxtPrefix+t,o=no.idInstSlotBtnPrefix+t,r=no.idInstSlotPrefix+t;e.makeVisible(i),e.makeVisible(o),e.makeVisible(r),e.setElementIdAttributes(r,no.instSlotInActiveAttrib),n.setElementIdText(i,Cn),e.setElementIdStyleProperty(i,no.instSlotTxtInActiveStyle),e.setElementIdStyleProperty(o,no.instSlotBtnInActiveStyle);var a=new u;e.setElementIdAttributes(o,a)}function Zt(t){var n=no.idInstSlotTxtPrefix+t,i=no.idInstSlotBtnPrefix+t,o=no.idInstSlotPrefix+t;e.makeInVisible(n),e.makeInVisible(i),e.makeInVisible(o);var r=new u;e.setElementIdAttributes(i,r)}function Jt(e,t){if(!xn(t)&&!xn(e)){var i=io[e],o=t[Mi];if(!xn(i)&&!xn(o)){var r=i.beatMap;if(!xn(r)){var a=r[o];if(!xn(a)){var s=a.xStart-1,l=$t(i);n.setLineX(l,s,s),en(l,!0)}}}}}function $t(t){return e.getElement(t.config.startLineId)}function en(t,n){n?e.makeElementVisible(t):e.makeElementInVisible(t)}function tn(e,t){if(!xn(t)&&!xn(e)){var n=io[e],i=t[Mi];nn(n,i)}}function nn(e,t){if(!xn(e)&&!xn(t)){var n=i.getCurrentTime();An("setStaveBeat: stave: "+e.id+" beat: "+t+" time: "+n),on(e.timeline,t),e.currentBeat=t}}function on(e,t){if(!xn(e)){var n=no.tweenIdPrefix+no.beatIdPrefix+t,o=e.labels;n in o?(i.beep(),e.seek(n)):An("setTimelineBeat: Invalid beat "+n)}}function rn(e,t){if(!xn(t)&&!xn(e)){var n=io[e],i=t[Ci],o=t[Ni];an(n,i,o)}}function an(t,n,i){if(!(xn(t)||xn(n)||xn(i))){if(n)e.setElementIdStyleProperty(t.config.maskId,no.activeStaveStyle);else{e.setElementIdStyleProperty(t.config.maskId,no.inactiveStaveStyle);var o=$t(t);en(o,!1)}i&&In(t.timeline)}}function sn(e){if(!xn(e)){var t=e[Qi],n=e[Gi];ln(t,n)}}function ln(t,n){var i=n;i<no.meterMaxVotes&&(i=no.meterMaxVotes);var o=no.meterBoxDefaultWidth,r={};if(0===t)r[no.meterBoxSizeDimension]=o,e.setElementIdAttributes(no.audienceMeterUpBoxId,r),e.setElementIdAttributes(no.audienceMeterDownBoxId,r);else if(t>0){t>i&&(t=i);var a=Math.floor(e.mapRange(t,0,i,1,no.meterBoxMaxSize));r[no.meterBoxSizeDimension]=a,e.setElementIdAttributes(no.audienceMeterUpBoxId,r),r[no.meterBoxSizeDimension]=0,e.setElementIdAttributes(no.audienceMeterDownBoxId,r)}else if(t<0){var s=Math.abs(t);s>i&&(s=i);a=Math.floor(e.mapRange(s,0,i,1,no.meterBoxMaxSize));r[no.meterBoxSizeDimension]=0,e.setElementIdAttributes(no.audienceMeterUpBoxId,r),r[no.meterBoxSizeDimension]=a,e.setElementIdAttributes(no.audienceMeterDownBoxId,r)}}function cn(e){xn(e)||mn(e.lightNo,e.colourId)}function dn(e){xn(e)||un(e.lightNo,ri)}function fn(){un(4,ri),un(1,Zn)}function mn(e,t){var n=vn(t);un(e,n)}function un(t,i){if(!xn(t)&&!xn(i))for(var o=e.toInt(t),r=1;r<=o;r++){var a=no.idSemaphorePrefix+r;n.setElementIdColour(a,i)}}function vn(e){var t;switch(e||(e=1),e){case 4:t=Zn;break;case 3:t=Jn;break;case 2:t=$n;break;case 1:default:t=jn}return t}function pn(){Sn(),io.isPlaying=!1,fn(),b()}function gn(e){if(!xn(e)){var t=io[e];if(!xn(t)){var n=t.timeline;xn(n)||(In(n),io.isPlaying=!0)}}}function In(e){if(xn(e))En("startTimeline: invalid timeline");else{var t=e.progress();t>0&&t<1?e.resume():e.play(0)}}function Sn(){bn(io.topStave.timeline),bn(io.bottomStave.timeline),io.bottomStave.isPlaying=!1,io.topStave.isPlaying=!1}function bn(e){xn(e)?En("stopTimeline: invalid timeline"):e.pause()}function Pn(t){e.isObject(t)&&hn(t.sendTimeMs)&&pt(t.sendTimeMs)}function Tn(t,n){e.setElementStyleProperty(t,n)}function yn(t,n){e.setElementAttributes(t,n)}function xn(t){return e.isNull(t)}function hn(t){return e.isNotNull(t)}function En(t){e.logError(t)}function kn(t){e.log(t)}function An(t){e.logDebug(t)}const Bn="dev",Cn="",Nn="_",Mn="AV",wn="FullScore",Ln="Connected",Dn="Loading",On="READY",Rn="Reconnecting",Vn="Error",_n="visible",Fn="hidden",Un="none",zn="x",Hn="y",qn="x1",Yn="x2",Wn="dx",Xn="dy",Qn="width",Gn="<",Kn=">",jn="green",Zn="red",Jn="orange",$n="yellow",ei="white",ti="black",ni="blue",ii="grey",oi="lightgrey",ri=Un,ai=ri,si=ei,li=jn,ci=Zn,di=Jn,fi=ni,mi=ii,ui=jn,vi=Zn,pi=Jn,gi=ei,Ii=ei,Si=ti,bi=6666,Pi="zsClientId",Ti="HELLO",yi="PART_REG",xi="PART_READY",hi="PING",Ei="SELECT_ISLOT",ki="SELECT_SECTION",Ai="part",Bi="serverTime",Ci="isActive",Ni="isPlay",Mi="beatNo",wi="csvInstruments",Li="slotNo",Di="slotInstrument",Oi="overlayType",Ri="overlayElement",Vi="overlayLineY",_i="isEnabled",Fi="opacity",Ui="colour",zi="section",Hi="clientId",qi="transposition",Yi="l1",Wi="l2",Xi="l3",Qi="voteCount",Gi="voterNo",Ki="img/blankStave.png",ji="p0",Zi="BUILDER",Ji="RND",$i="DYNAMIC";var eo=null,to=null,no={connectionPreference:"ws,sse,poll",defaultConnectionType:t.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",partNameToken:"@Part@",pageNoToken:"@PgNo@",instToken:"@Inst@",slotNoToken:"@SlotNo@",pageIdPrefix:"p",meterBoxDefaultWidth:1,meterBoxSizeDimension:"height",meterMaxVotes:10,meterBoxMaxSize:35,tsBaseBeatDenom:8,tsY:0,textSpanFadeTimeSec:1,textSpanFadeStaggerTimeSec:.5,textSpanIsFadeIn:!0,transpoLetterDy:"0.35em",beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",idParts:"parts",idPartsListOuterDiv:"partListOuterDiv",idSections:"sections",idSectionsListOuterDiv:"sectionListOuterDiv",idSectionBtnPrefix:"sectionBtn",idOwnedSections:"ownedSections",idInstrument:"part",idInstControls:"instControls",idTranspoControls:"transpositionListOuterDiv",idInstSlotPrefix:"instSlot",idInstSlotTxtPrefix:"instSlotTxt",idInstSlotBtnPrefix:"instSlotRect",idTempoBpm:"tmpBpm",idSemaphorePrefix:"semC",idLineSuffix:"Line",idBridgeSuffix:"Bridge",idOrdSuffix:"Ord",idMidSuffix:"Mid",idRectSuffix:"Rect",idTxtSuffix:"Txt",idTxtLineSuffix:"TxtLn",idClientIdGroup:"clientIdGroup",idClientId:"clientId",idTranspoKey:"transpoKey",idTranspoMod:"transpoMod",idTranspoInfo:"transpoInfo",blankPageUrl:"img/blankStave.png",audienceMeterUpBoxId:"audienceMeterUpBox",audienceMeterDownBoxId:"audienceMeterDownBox",filterOutParts:[Mn,wn],connectedRectStyle:{fill:li,stroke:ui,"stroke-width":"0px",visibility:_n,opacity:1},disconnectedRectStyle:{fill:ci,stroke:vi,"stroke-width":"1px",visibility:_n,opacity:1},errorRectStyle:{fill:di,stroke:pi,"stroke-width":"1px",visibility:_n,opacity:1},connectedTxtStyle:{fill:gi},disconnectedTxtStyle:{fill:Ii},errorTxtStyle:{fill:Si},activeStaveStyle:{fill:ai,stroke:fi,"stroke-width":"1px",visibility:_n,opacity:.5},inactiveStaveStyle:{fill:si,stroke:mi,"stroke-width":"1px",visibility:_n,opacity:.4},instSlotBtnActiveStyle:{fill:ei,stroke:ti,"stroke-width":"1px",visibility:_n,opacity:1},instSlotBtnActiveInstStyle:{fill:"#d7f2cd",stroke:ti,"stroke-width":"1px",visibility:_n,opacity:1},instSlotBtnInActiveStyle:{fill:oi,stroke:Un,visibility:_n,opacity:1},instSlotTxtActiveStyle:{fill:ti,visibility:_n,opacity:1},instSlotTxtInActiveStyle:{fill:ti,stroke:Un,visibility:Fn,opacity:0},instSlotActiveAttrib:{filter:"url(#dropshadow)"},instSlotInActiveAttrib:{filter:"none"},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},transpoInfoAttrib:{"font-family":"sans-serif","font-weight":"bold","font-size":"0.75em"},transpoPitchModAttrib:{dy:-1,dx:-1.5,"font-family":"sans-serif","font-weight":"bold","font-size":"0.75em"},transpoExtRectAttrib:{fill:ei,stroke:Un,visibility:_n,opacity:1},errorBtnAttrib:{filter:"url(#dropshadow)"},topStave:{gId:"stvTop",imgId:"stvTopImg",startLineId:"stvTopStartLine",positionLineId:"stvTopPosLine",beatBallId:"stvTopBeatBall",maskId:"stvTopMask",ovrlPosId:"ovrlTopPos",ovrlPitchId:"ovrlTopPitch",ovrlPitchStaveId:"ovrlTopPitchStave",ovrlPitchStaveInfoId:"ovrlTopPitchStaveInfo",ovrlSpeedId:"ovrlTopSpeed",ovrlPressId:"ovrlTopPres",ovrlDynId:"ovrlTopDyn",ovrlTimbreId:"ovrlTopTimb",ballYmax:84,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"80",x2:"95",y2:"281"},posBallConf:{cx:"95",cy:"110",r:"4"}},bottomStave:{gId:"stvBot",imgId:"stvBotImg",startLineId:"stvBotStartLine",positionLineId:"stvBotPosLine",beatBallId:"stvBotBeatBall",maskId:"stvBotMask",ovrlPosId:"ovrlBotPos",ovrlPitchId:"ovrlBotPitch",ovrlPitchStaveId:"ovrlBotPitchStave",ovrlPitchStaveInfoId:"ovrlBotPitchStaveInfo",ovrlSpeedId:"ovrlBotSpeed",ovrlPressId:"ovrlBotPres",ovrlDynId:"ovrlBotDyn",ovrlTimbreId:"ovrlBotTimb",ballYmax:305,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"301",x2:"95",y2:"502"},posBallConf:{cx:"95",cy:"331",r:"4"}},metro:{idMetronomeRect:"metroRect",idMetronome:"metro",idMetroSlider:"metroFreqSlider",
idMetroFreqRect:"metroFreq",idMetroFreqLine:"metroFreqLine",ifSymbolMetroOff:"#metronome",ifSymbolMetroOn:"#metronomeOn",ifMetroFreqSlider:"#metroFreq",minFreq:220,maxFreq:2200}},io={clientId:null,isPlaying:!1,isReady:!1,score:{title:"ZScore",noSpaceName:"ZScore",htmlFile:null,instrument:"",parts:[],firstPageNo:1,lastPageNo:2,sections:[],ownedSections:[],mySections:[],assignmentType:null},movement:{name:"Movement",parts:[],imgDir:null,imgPageNameToken:null,imgContPageName:null,contPageNo:bi,blankPageNo:0,firstPage:-1,lastPage:-1,partPages:{}},part:{name:"Part View",imgDir:null,imgPageNameToken:null,imgContPageName:null,blankPageNo:0,contPageNo:bi,currentSection:null,transpo:"C",pageRanges:[{start:1,end:1}]},topStave:{id:"topStave",config:no.topStave,part:null,pageId:ji,rndPageId:null,filename:Ki,beatMap:null,timeline:null,isActive:!0,isPlaying:!1,currentBeat:null,transpos:[]},bottomStave:{id:"bottomStave",config:no.bottomStave,part:null,pageId:ji,rndPageId:null,filename:Ki,beatMap:null,timeline:null,isActive:!1,isPlaying:!1,currentBeat:null,transpos:[]},startTimeTl:0,currentBeatId:"b0",currentBeatNo:0,tempo:0,tempoModifier:1,scoreDir:"/score/",currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,isConnected:!1,isInitialised:!1,connectionType:null,pageNoToLoad:0,metro:{isMetroOn:!1,slider:{xMax:60,xMin:40,xMid:50,range:20}},isClientIdVisible:!1,transpo:o.TRANSPOSITION.C,counter:0,voteCount:0};return c.prototype.loadImg=function(e){this.img.src=e,this.img.onload=function(){kn("pageImgOnLoad: id: "+this.pageId+" part: "+this.instrument),Oe(this.pageId,this.instrument)}},{onStateBtn:function(){y()},onPartSelect:function(e){x(e)},onSectionSelect:function(e){h(e)},onInstrumentSelect:function(e,t){B(e,t)},onClientIdSelect:function(){N()},onTranspoSelect:function(e){M(e)}}}(zsUtil,zsNet,zsSvg,zsWsAudio,zsMusic,window,document);