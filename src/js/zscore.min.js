var zscore=function(e,i,t,n,r,l){"use strict";function a(e){this.message=e,this.name="ZScoreException"}function s(e,i,t){this.value=e,this.isVisible=i,this.sizeMultiplier=t}function o(e,i,t,n,r,l,a,s,o,c){this.id=e,this.isSelected=i,this.isActive=t,this.isVisible=n,this.isPlaying=r,this.isPlayingNext=l,this.isPlayed=a,this.clickCount=s,this.arc=o,this.txt=c,this.tweens=[]}function c(e){this.id=e,this.tweens=[],this.selectedId=null}function u(){ct("onLoad: "),d()}function d(){if(!(e&&i&&t&&n))throw new a("Invalid libraries. Required: zsUtil, zsNet, zsSvg and zsAudio");e.setRunMode(ut),ct("init: "),Ht=e.isTouchDevice(),Qt=e.isSafari(navigator),ct("init: IsTouch Device: "+Ht+" isSafari: "+Qt),Xt.fontCanvas=l.createElement("canvas"),Xt.canvasCtx=Xt.fontCanvas.getContext("2d"),v(),y(),h(),m(),C(),O(),w(),V(),M(),p()}function f(){x(),T(),I(),g()}function v(){i.init(Zt.connectionPreference,Zt.appUrlSse,Zt.appUrlWebsockets,Zt.appUrlHttp,Ui,ji)}function p(){i.getServerState()}function h(){at(n)?ot("initAudio: invalid zsAudio lib"):n.init(Wt,5)}function g(){at(n)?ot("resetAudio: invalid zsAudio lib"):n.reset()}function y(){t.init()}function m(){var i=!1,t=!1,n=!0,r=!1,l=!1,a=!1,u=0,d=new s(dt,!1,1),f=new o(null,i,t,n,r,l,a,u,null,d);Xt.tiles=e.init2DArray(8,8,f);var v=new c(null);Xt.tileCircles=e.initArray(8,v)}function x(){for(var e=0;e<Xt.tiles.length;e++)for(var i=Xt.tiles[e],t=0;t<i.length;t++)S(Xt.tiles[e][t])}function S(i){b(i.id),i.isSelected=!1,i.isActive=!1,i.isVisible=!0,i.isPlaying=!1,i.isPlayingNext=!1,i.isPlayed=!1,i.clickCount=0,i.txt.value=dt,i.txt.isVisible=!1;for(var t=0;t<i.tweens.length;t++){var n=i.tweens[t];at(n)||n.pause(0)}var r=e.getElement(i.id);be(i,r)}function b(i){var t=Zt.tileGroupPrefix+i,n=e.getElement(t);at(n)||(n.style.opacity="1")}function T(){P(Xt.centreShape),P(Xt.innerCircle),P(Xt.outerCircle)}function P(i){i.isVisible=!1,e.isFunction(i.gsapTimeline.pause)&&i.gsapTimeline.pause(0),e.isFunction(i.gsapTimeline.progress)&&i.gsapTimeline.progress(1,!0),e.isFunction(i.gsapExplodeTimeline.pause)&&i.gsapExplodeTimeline.pause(0)}function I(){Si("centreShape")}function C(){E("centreShape",Xt.centreShape,Zt.circleRadii[1],Zt.circleRadii[7],!0),E("innerCircle",Xt.innerCircle,Zt.circleRadii[4],Zt.viewMaxPoint,!1),E("outerCircle",Xt.outerCircle,Zt.circleRadii[7],Zt.viewMaxPoint,!1)}function E(i,t,n,r,l){var a=e.getElement(i);if(at(a))ot("Failed to find shape: "+i);else{ct("initShape: shapeId: "+i),Fi(a,t.isVisible);var s=Zt.shapeTimelineDuration;k(a,t,s,n),s=Zt.shapeExplodeDuration,A(a,t,s,r,l)}}function k(i,t,n,r){var l=gsap.timeline({paused:!0,ease:"power4.inOut",onComplete:ke,onCompleteParams:[t]});t.gsapTimeline=l;var a=Zt.centre.x,s=Zt.centre.y,o=1,c=i.children;if(!at(c)){ct("initShapeTimeline: have : "+c.length+" children");for(var u=0;u<c.length;u++){var d=c[u];e.isEmptyString(d.id)&&(d.id="csh"+u);var f=d.getBBox(),v=f.x,p=f.y,h=Ce(a,s,r),g=e.randomIntFromInterval(0,360)*o;o*=-1;var y=e.randomFloatFromInterval(.1,2),m=h.x-v,x=h.y-p,S=d.id,b=gsap.from(e.toCssIdQuery(S),{x:m,y:x,rotation:g,scale:y});l.add(b,0)}l.totalDuration(n)}}function A(i,t,n,r,l){var a=gsap.timeline({paused:!0,ease:"slow",onComplete:Ae,onCompleteParams:[t]});t.gsapExplodeTimeline=a;var s=Zt.centre.x,o=Zt.centre.y,c=i.children;if(!at(c)){ct("initShapeExplodeTimeline: have : "+c.length+" children");for(var u=0;u<c.length;u++){var d=c[u];e.isEmptyString(d.id)&&(d.id="csh"+u);var f=d.id,v=d.getBBox(),p=v.x,h=v.y,g=v.width,y=v.height,m=null;if(m=l?Ce(s,o,r):Ee(s,o,p,h,g,y,r),at(m))return void ot("initShapeExplodeTimeline: calculated invalid random point");var x=m.x-p,S=m.y-h,b=gsap.to(e.toCssIdQuery(f),{x:x,y:S});a.add(b,0)}a.totalDuration(n)}}function w(){for(var e=Zt.circleRadii,i=Zt.centre,t=Zt.tileAngles,n=10,r=360,l=0;l<e.length;l++){var a=Xt.tileCircles[l];a.id=Zt.tileCircleGroupPrefix+(l+1);var s=Pe(a.id,n,r);a.tweens.push(s),r*=-1;for(var o=e[l],c=1;c<t.length;c++){var u=t[c-1],d=t[c];F(i.x,i.y,o,u,d,l+1,c)}}}function V(){var i=Xt.tiles;if(e.isArray(i)){var n=Zt.centre,r=n.x,l=n.y,a=Zt.circleRadii[Zt.circleRadii.length-1]+1,s=Zt.outerFrameRadius,o=Zt.frameParentId,c=Zt.outerFrameId,u=t.createPathElement(c),d=Zt.frameStyle;lt(u,d);var f=t.createTorusPath(r,l,a,s);st(f)&&u.setAttribute("d",f),e.addChildToParentId(o,u)}else ot("createOuterFrame: invalid tiles")}function M(){var i=Zt.circleRadii[7]+2,n=Zt.centre,r=Zt.stageParentId,l=t.createSvgCircle(n.x,n.y,i,"stage");e.setElementAttributes(l,Zt.stageStyle),e.addChildToParentId(r,l)}function O(){var i=$i();at(i)||(qt=i,e.listen("resize",r,re),e.listen("orientationchange",r,re),z("Welcome to","<span style='color:blueviolet;'>ZScore</span>","awaiting performance start ...",null,!0))}function z(e,i,t,n,r){if(!at(qt)){var l=!1;if(!at(e)){var a=e.trim();Xt.instructions.l1!=a&&(Xt.instructions.l1=a,l=!0)}if(!at(i)){a=i.trim();Xt.instructions.l2!=a&&(Xt.instructions.l2=a,l=!0)}if(!at(t)){a=t.trim();Xt.instructions.l3!=a&&(Xt.instructions.l3=a,l=!0)}at(n)||(Xt.instructions.bckgCol=n),r?l&&Ni():Gi()}}function F(i,n,r,l,a,s,o){var c=Zt.tilePrefix+e.toStr(s)+Zt.elementIdDelimiter+e.toStr(o),u=t.createPathElement(c);if(at(u))ot("createSvgTile: Failed to create tile: "+c);else{var d=Zt.tileCircleGroupPrefix+e.toStr(s),f=Zt.tileGroupPrefix+c,v=t.createGroupElement(f);e.addChildToParentId(d,v),e.listen("mouseenter",v,K),e.listen("mouseleave",v,Y),e.listen("touchend",v,J),e.listen("mouseup",v,_);u=t.createPathElement(c);e.addChildToParentId(f,u);var p=s-1,h=o-1,g=Xt.tiles[p][h];if(at(g))ot("createSvgTile: Invalid tile state");else{g.id=c;var y=t.createArc(i,n,r,l,a);g.arc=y,be(g,u);var m=null;at(g.txt)||(m=g.txt);var x=null;if(s<=1)x=t.createPieTilePath(i,n,y),N(i,n,r,l,a,o,c,f,m);else{var S=Xt.tiles[p-1][h],b=S.arc;x=t.createTorusTilePath(y,b),L(i,n,l,a,o,b,y,c,f,m)}st(x)&&u.setAttribute("d",x)}}}function N(i,n,r,l,a,s,o,c,u){var d=Zt.tileTextPathElementPrefix+o,f=t.createPathElement(d),v=Zt.tileStylePieTextPathElement,p=l+e.round((a-l)/2,1),h=i,g=n-r,y=null;s>4&&s<9?(y=t.createLinePath(h,g,i,n),v=Zt.tileStyleInvertedPieTextPathElement):y=t.createLinePath(i,n,h,g),f.setAttribute("d",y),t.rotateElement(f,p,i,n),u.sizeMultiplier=Zt.tileTextSizeMultiplier.pie,D(u,f,d,c,o,v)}function L(e,i,n,r,l,a,s,o,c,u){var d=a.rX+(s.rX-a.rX)/2,f=t.createArc(e,i,d,n,r),v=t.invertArc(f);l>2&&l<7&&(v=f);var p=Zt.tileTextPathElementPrefix+o,h=t.createArcPath(v),g=t.createPathElement(p);g.setAttribute("d",h);var y=Zt.tileStyleTorusTextPathElement;u.sizeMultiplier=Zt.tileTextSizeMultiplier.torus,D(u,g,p,c,o,y)}function D(i,n,r,a,o,c){lt(n,Zt.tileStyleTextPathDef),e.addFirstChildToParent(Ci(),n);var u=t.createTextElement(Zt.tileTextElementPrefix+o);lt(u,Zt.tileStyleTextElement);var d=t.createTextPathElement(Zt.tileTextElementPathPrefix+o);d.setAttribute("href",e.toCssIdQuery(r)),lt(d,c);var f=t.createTspanElement(Zt.tileTextSpanPrefix+o);lt(f,Zt.tileStyleTextSpan);var v=l.createTextNode(dt);f.appendChild(v),d.appendChild(f),u.appendChild(d),e.addChildToParentId(a,u);var p=dt,h=1;e.isObjectInstanceOf(s,i)||(p=i.value,h=i.sizeMultiplier),G(p,n,f,h)}function G(i,t,n,r){if(!at(n)&&!at(t)){var l=n;if(!at(l)){var a=l.textContent,s=dt;if(e.isString(i)&&dt!==i&&(s=i),a!==s){var o=s,c=o.length;if(c<Zt.tileTextMinLength)for(var u=Zt.tileTextMinLength-c,d=0;d<u;d++)o+=vt;var f=t.getTotalLength(),v=r,p=e.getElement(Zt.testTextElementId);p.textContent=o;var h=10,g=dt+h+"px";p.setAttribute("font-size",g);var y=p.getComputedTextLength();0===y&&(y=f);var m=f/y;h*=m*v,h=Math.floor(h),g=dt+h+"px",ct("setTileText: text: "+s+" pathLen: "+f+" testTextLen: "+y+" ratio: "+m+" fontSize: "+g),l.setAttribute("font-size",g),l.textContent=s}}}}function R(e){return at(e)?null:e.isVisible?Zt.shapeStyleVisible:Zt.shapeStyleInvisible}function U(e){return e.isVisible?st(e.txt)&&!e.txt.isVisible?Zt.tileStyleTextElementInvisible:Zt.tileStyleTextElement:Zt.tileStyleTextElementInvisible}function j(e){return e.isVisible?Zt.textStyleVisible:Zt.textStyleInvisible}function B(e){return at(e)?null:e.isPlaying?Zt.tileStyleOverlayPlaying:e.isPlayingNext?Zt.tileStyleOverlayPlayingNext:e.isSelected?Zt.tileStyleOverlaySelected:null}function W(e){return at(e)?null:e.isPlaying?Zt.tileStylePlaying:e.isPlayingNext?Zt.tileStylePlayingNext:e.isPlayed?Zt.tileStylePlayed:e.isVisible?e.isSelected?Zt.tileStyleSelected:e.isActive?Zt.tileStyleActive:Zt.tileStyleInActive:Zt.tileStyleInvisible}function H(){for(var i=e.initArray(Xt.tiles.length,null),t=0;t<Xt.tiles.length;t++)for(var n=Xt.tiles[t],r=0;r<n.length;r++){var l=Xt.tiles[t][r];if(l.isActive){var a=e.getElement(l.id),s=i[t];at(s)&&(s=Q(t),i[t]=s),q(a,l,s)}}}function Q(i){var t=Z(i);if(at(t))return null;var n=e.arrSortedNonZeroElem(t);return n.length<1?null:[0,n[0],0,Zt.maxColModPerClick]}function q(i,t,n){if(t.isActive){var r=kt,l=t.clickCount;if(!(l<=0)){var a=X(t,n);r=e.modColour(r,a),i.setAttribute(yt,r)}}}function X(i,t){var n=i.clickCount,r=Zt.colModPerClick*n;if(!e.isArray(t)||4!=t.length)return r;r=e.mapRange(n,t[0],t[1],t[2],t[3]);return r}function Z(i){var t=e.initArray(Xt.tiles[0].length,0);if(i<0||i>=Xt.tiles.length)return t;for(var n=Xt.tiles[i],r=0;r<n.length;r++){var l=Xt.tiles[i][r],a=l.clickCount;l.isPlayed&&(a=0),t[r]=a}return t}function _(e){ct("onMouseUp:"),Ht||ie(this)}function J(e){ct("onTouchEnd:"),ie(this)}function K(e){Ht||$(this)}function Y(e){Ht||ee(this)}function $(i){if(!e.isObject(i))return null;var t=i,n=i.id;if(fe(n)?(n=pe(n),t=e.getElement(n)):de(n)&&(n=ve(n),t=e.getElement(n)),!ce(n))return ct("getTileState: invalid tile id: "+n),null;lt(t,Zt.tileStyleOnPonterEntry)}function ee(i){if(e.isObject(i)){var t=ae(i);if(!at(t)){var n=se(t);at(n)?ct("onPointerLeave: invalid selected tile"):be(n,t)}}}function ie(e){n.isReady()||h();var i=se(e);at(i)?ct("processSelectedTile: invalid selected tile"):te(i,e)}function te(t,n){ne(t);var r=t.id,l=e.getElement(r);if(!at(l)){var a=le(r),s=Xt.tileCircles[a.x];if(t.isActive||!t.isVisible){if(!(t.isPlaying||t.isPlayingNext||t.isPlayed)){if(r!==Xt.selectedTileId&&st(Xt.selectedTileId)){var o=oe(Xt.selectedTileId);o.isSelected=!1;var c=e.getElement(Xt.selectedTileId);be(o,c),ye(o,c)}t.isSelected=!t.isSelected,t.isSelected&&(Xt.selectedTileId=r,s.selectedId=r),be(t,l),ye(t,l);var u={};u[ht]=t.id,u[gt]=t.isSelected,i.sendEvent(pt,u)}}else for(var d=s.tweens,f=0;f<d.length;f++){var v=d[f];Yi(v)}}}function ne(i){var t=Xt.speech;t.isPlaySpeechSynthOnClick&&n.isSpeachReady()&&e.isString(t.speechText)&&Qe(t.speechText,t.speechVoice,t.speechIsInterrupt,i)}function re(i){if(!e.isObject(this))return null;Ni()}function le(i){if(at(i))return null;if(!e)return ot("getTileRowCol: invalid zsUtil"),null;var t=e.replace(i,Zt.tilePrefix,dt),n=t.split(Zt.elementIdDelimiter);if(!e.isArray(n)||2!==n.length)return ct("getTileState: invalid tile info: "+t),null;var r=e.toInt(n[0])-1,l=e.toInt(n[1])-1;return e.createPoint(r,l)}function ae(i){if(!e.isObject(i))return null;var t=i.id;return ce(t)?i:(fe(t)?t=pe(t):de(t)&&(t=ve(t)),at(t)?null:e.getElement(t))}function se(i){if(!e.isObject(i))return null;var t=i.id;return fe(t)?t=pe(t):de(t)&&(t=ve(t)),oe(t)}function oe(e){if(!ce(e))return ct("getTileState: invalid tile id: "+e),null;var i=le(e);return at(i)?null:Xt.tiles[i.x][i.y]}function ce(i){return!(at(i)||!e.isString(i))&&e.startsWith(i,Zt.tilePrefix)}function ue(i){return!(at(i)||!e.isString(i))&&e.startsWith(i,Zt.tileCircleGroupPrefix)}function de(i){return!(at(i)||!e.isString(i))&&e.startsWith(i,Zt.tileTextElementPrefix)}function fe(i){return!(at(i)||!e.isString(i))&&e.startsWith(i,Zt.tileGroupPrefix)}function ve(i){if(at(i)||!e.isString(i))return!1;var t=i.substring(Zt.tileTextElementPrefix.length,i.length);return ce(t)?t:null}function pe(i){if(at(i)||!e.isString(i))return!1;var t=i.substring(Zt.tileGroupPrefix.length,i.length);return ce(t)?t:null}function he(i){if(at(i)||!e.isString(i))return!1;var t=i.substring(Zt.tileCircleGroupPrefix.length,i.length),n=e.toInt(t)-1;if(!(n<0||n>=Xt.tileCircles.length))return Xt.tileCircles[n];ot("getCircleGroupIndexFromId: Invalid circle group index: "+n)}function ge(i,t){if(!at(i)&&!at(t)){var n=t.id,r=Zt.tileTextPathElementPrefix+n,l=e.getElement(r);if(!at(l)){var a=Zt.tileTextElementPrefix+n,o=e.getElement(a);if(!at(o)){var c=dt;at(i)||at(i.txt)||(c=i.txt);var u=Zt.tileTextSpanPrefix+n,d=e.getChildElement(o,e.toCssIdQuery(u));if(!at(d)){var f=dt,v=1;e.isObjectInstanceOf(s,c)||(f=c.value,v=c.sizeMultiplier),G(f,l,d,v)}}}}}function ye(i,t){var n=i.id,r=Zt.overlayPrefix+n,l=e.getElement(r),a=B(i);at(a)?at(l)||l.remove():(at(l)&&(l=e.cloneElement(t,r)),lt(l,a),e.addChildToParentId(Zt.overlayParentId,l))}function me(){for(var i=0;i<Xt.tileCircles.length;i++){var t=Xt.tileCircles[i],n=t.selectedId;if(!at(n)){var r=e.getElement(n);if(at(r))ot("setSelectedTilesOverlay: can not find tile for selected id: "+n);else{var l=Zt.selectedPrefix+n,a=e.getElement(l);if(at(a)){var s=Zt.tileStyleSelectedPath;a=e.cloneElement(r,l),lt(a,s),e.addChildToParentId(Zt.overlayParentId,a)}}}}}function xe(){for(var i=0;i<Xt.tileCircles.length;i++){var t=Xt.tileCircles[i],n=t.selectedId;if(!at(n)){var r=Zt.selectedPrefix+n,l=e.getElement(r);at(l)||l.remove()}}}function Se(){xe();for(var e=0;e<Xt.tileCircles.length;e++){var i=Xt.tileCircles[e];i.selectedId=null}}function be(i,t){var n=W(i);lt(t,n);var r=Zt.tileTextElementPrefix+i.id,l=e.getElement(r);if(!at(l)){var a=U(i);lt(l,a)}}function Te(i,t){var n=R(i),r=e.getElement(t);lt(r,n)}function Pe(i,t,n){if(!at(i))return gsap.to(e.toCssIdQuery(i),{duration:t,rotation:n,svgOrigin:dt+Zt.centre.x+ft+Zt.centre.y,onComplete:Oi,onCompleteParams:[i],paused:!0});ot("rotate: Invalid objectId: "+i)}function Ie(i,t,n){if(!at(i))return gsap.to(e.toCssIdQuery(i),{duration:t,autoAlpha:n,onComplete:Oi,onCompleteParams:[i],paused:!0});ot("dissolve: Invalid objectId: "+i)}function Ce(i,t,n){if(!e)return ot("getRandomPointInsideCircle: invalid zsUtil"),null;var r=2*Math.PI*Math.random(),l=Math.sqrt(Math.random()),a=n*l*Math.cos(r)+i,s=n*l*Math.sin(r)+t;return e.createPoint(a,s)}function Ee(i,t,n,r,l,a,s){var o=n-i,c=r-t,u=Math.sqrt(Math.pow(o,2)+Math.pow(c,2)),d=Math.sqrt(Math.pow(l,2)+Math.pow(a,2)),f=s+2*d,v=f/u,p=o*v,h=c*v,g=e.round(n+p,0),y=e.round(r+h,0);return e.createPoint(g,y)}function ke(e){ct("onShapeTimelineComplete: progress: "+e.gsapTimeline.progress())}function Ae(e){ct("onShapeExplodeTimelineComplete: progress: "+e.gsapExplodeTimeline.progress())}function we(i){if(e.isArray(i))for(var t=0;t<i.length;t++)bi(i[t]);else bi(i)}function Ve(i,t,n){if(e.isArray(t))for(var r=0;r<t.length;r++)Ii(i,t[r],n);else Ii(i,t,n)}function Me(i,t,n){if(e.isArray(t))for(var r=0;r<t.length;r++)Oe(i,t[r],n);else Oe(i,t,n)}function Oe(e,i,t){if(!at(i))switch(ct("runAudio: "+e+ft+i),i){case"buffer":ze(e,t);break;case"granulator":Fe(e,t);break;case"speechSynth":We(e,t)}}function ze(i,t){if(e.isString(i))switch(i){case"play":Je(t);break;default:return void ot("runAudioBuffer: Unknown actionId: "+i)}}function Fe(i,t){if(e.isString(i))switch(i){case"play":Ne(t);break;case"stop":Le(t);break;case"config":Be(t);break;case"rampLinear":De(t);break;case"rampSin":Re(t);break;case"volume":Ge(t);break;default:return void ot("runAudioGranulator: Unknown actionId: "+i)}}function Ne(e){at(n)?ot("runAudioPlayGranulator: Invalid zsAudio lib"):n.playGranulator()}function Le(e){at(n)?ot("runAudioPlayGranulator: Invalid zsAudio lib"):n.stopGranulator()}function De(i){if(at(n))ot("runAudioPlayGranulator: Invalid zsAudio lib");else if(e.isObject(i)){var t=null,r=null,l=null;at(i.paramName)||(t=i.paramName),at(i.endValue)||(r=i.endValue),at(i.duration)||(l=i.duration),n.setGranulatorRampLinear(t,r,l)}}function Ge(i){if(at(n))ot("runAudioPlayGranulator: Invalid zsAudio lib");else if(e.isObject(i)){var t=null,r=null;at(i.level)||(t=i.level),at(i.timeMs)||(r=i.timeMs),n.setGranulatorGain(t,r)}}function Re(i){if(at(n))ot("runAudioPlayGranulator: Invalid zsAudio lib");else if(e.isObject(i)){var t=null,r=null,l=null,a=null;at(i.paramName)||(t=i.paramName),at(i.amplitude)||(r=i.amplitude),at(i.frequency)||(l=i.frequency),at(i.duration)||(a=i.duration),n.setGranulatorRampSin(t,r,l,a)}}function Ue(){at(n)?ot("runAudioPlayGranulator: Invalid zsAudio lib"):n.resetGranulator()}function je(){Se()}function Be(i){at(n)?ot("runAudioPlayGranulator: Invalid zsAudio lib"):e.isObject(i)&&n.setGranulatorConfig(i)}function We(i,t){if(e.isString(i))switch(i){case"play":He(t);break;case"stop":qe(t);break;case"config":Xe(t);break;case"state":Ze(t);break;case"rampLinear":_e(t);break;default:return void ot("runSpeechSynth: Unknown actionId: "+i)}}function He(e){if(at(n))ot("runPlaySpeechSynth: Invalid zsAudio lib");else if(at(e))ot("runPlaySpeechSynth: Invalid params");else{var i=dt,t="random",r=!1;at(e.speechText)||(i=e.speechText),at(e.speechVoice)||(t=e.speechVoice),at(e.speechIsInterrupt)||(r=e.speechIsInterrupt);var l=Xt.playingTileId;at(l)&&(l=Xt.selectedTileId);var a=oe(l);Qe(i,t,r,a)}}function Qe(i,t,r,l){if(!at(i)){if(e.contains(i,jt)){var a=null;at(l)||(a=l.txt),i=e.isString(a.value)?e.replace(i,jt,a.value):e.replace(i,jt,dt)}n.speak(i,t,r)}}function qe(e){at(n)?ot("runStopSpeechSynth: Invalid zsAudio lib"):n.stopSpeach()}function Xe(e){at(n)?ot("updateSpeechCofig: Invalid zsAudio lib"):n.setSpeechConfig(e)}function Ze(i){if(e.isObject(i)){var t=Xt.speech;at(i.isPlaySpeechSynthOnClick)||(t.isPlaySpeechSynthOnClick=i.isPlaySpeechSynthOnClick),at(i.speechText)||(t.speechText=i.speechText),at(i.speechVoice)||(t.speechVoice=i.speechVoice),at(i.speechIsInterrupt)||(t.speechIsInterrupt=i.speechIsInterrupt)}else ot("setSpeechState: Invalid params")}function _e(i){if(e.isObject(i)){var t=null;at(i.paramName)||(t=i.paramName);var r=null;at(i.endValue)||(r=i.endValue);var l=null;at(i.duration)||(l=i.duration),n.rumpLinearSpeechParam(t,r,l)}else ot("setSpeechState: Invalid params")}function Je(i){if(at(n))ot("runAudioPlayGranulator: Invalid zsAudio lib");else if(e.isObject(i)){var t=0;at(i.index)||(e.isString(i.index)?t=e.toInt(i.index):e.isNumeric(i.index)&&(t=i.index));var r=null,l=null,a=null;at(i.startTime)||(r=i.startTime),at(i.offset)||(l=i.offset),at(i.duration)||(a=i.duration),n.playAudio(t,r,l,a)}}function Ke(i,t,n){if(e.isArray(t))for(var r=0;r<t.length;r++)Ye(i,t[r],n);else Ye(i,t,n)}function Ye(i,t,n){if(e.isString(i)&&e.isObject(n))switch(ct("rotate: "+t),i){case"start":$e(t,n);break;case"reset":ei(t,n);break;default:return void ot("Unknown rotate actionId: "+i)}}function $e(i,t){var n=0,r=360;at(t.duration)||(n=t.duration),at(t.angle)||(r=t.angle);var l=null;if(ce(i)){var a=Zt.tileGroupPrefix+i,s=e.getElement(i),o=zi(s);e.isArray(o)&&o.length>0?l=o[0]:(l=Pe(a,n,r),o.push(l))}else if(ue(i)){var c=he(i);if(!at(c)){var u=c.tweens;l=u,e.isArray(u)&&(l=u[0])}}Yi(l)}function ei(i,t){if(e.isString(i)){if(ce(i)){var n=e.getElement(i),r=zi(n);if(e.isArray(r)&&r.length>0){var l=r[0];at(l)||l.pause(0)}}Zt.all===i.toUpperCase()&&Xt.tiles}}function ii(i,t,n){if(e.isArray(t))for(var r=0;r<t.length;r++)ti(i,t[r],n);else ti(i,t,n)}function ti(i,t,n){if(e.isString(i)&&e.isObject(n))switch(ct("runAlpha: "+t),i){case"start":ni(t,n);break;default:return void ot("Unknown aplha actionId: "+i)}}function ni(e,i){var t=0;at(i.duration)||(t=i.duration);var n=1;at(i.value)||(n=i.value);var r=null;if(ce(e)){var l=Zt.tileGroupPrefix+e;r=Ie(l,t,n)}else r=Ie(e,t,n);Yi(r)}function ri(i,t,n){if(e.isArray(t))for(var r=0;r<t.length;r++)li(i,t[r],n);else li(i,t,n)}function li(i,t,n){if(e.isString(i))switch(ct("reset: actionId: "+i+ft+t),i){case"all":ai(t,n);break;case"elements":si(t,n);break;default:return void ot("Unknown reset actionId: "+i)}}function ai(i,t){if(e.isString(i))switch(i){case"tiles":x();break;case"shapes":T();break;case"elements":f();break;case"granulator":Ue();break;case"selectedTiles":je();break;default:return void ot("Unknown reset target: "+i)}}function si(e,i){if(ce(e))S(oe(elementId));else switch(e){case"centreShape":return P(Xt.centreShape);case"innerCircle":return P(Xt.innerCircle);case"outerCircle":return P(Xt.outerCircle);case"zoom":return I();default:ct("resetElements: unknown target: "+e)}}function oi(i,t,n){if(e.isArray(t))for(var r=0;r<t.length;r++)ci(i,t[r],n);else ci(i,t,n)}function ci(i,t,n){if(e.isString(i))switch(ct("runActivate: actionId: "+i+ft+t),i){case"display":ui(t,n);break;default:return void ot("Unknown activate actionId: "+i)}}function ui(e,i){if(!at(e))switch(ct("runDisplayAction: target: "+e),e){case"selectedTiles":di(i)}}function di(e){ct("runDisplaySelectedTiles: "),me()}function fi(i,t,n){if(e.isArray(t))for(var r=0;r<t.length;r++)vi(i,t[r],n);else vi(i,t,n)}function vi(i,t,n){if(e.isString(i))switch(ct("runDeActivate: actionId: "+i+ft+t),i){case"display":pi(t,n);break;default:return void ot("Unknown DeActivate actionId: "+i)}}function pi(e,i){if(!at(e))switch(ct("runDeActivateDisplayAction: target: "+e),e){case"selectedTiles":hi(i)}}function hi(e){ct("runRemoveSelectedTiles: "),xe()}function gi(i,t,n){if(e.isArray(t))for(var r=0;r<t.length;r++)yi(i,t[r],n);else yi(i,t,n)}function yi(i,t,n){if(e.isString(i))switch(ct("stop: actionId: "+i+ft+t),i){case"stop":mi(t,n);break;default:return void ot("Unknown stop actionId: "+i)}}function mi(e,i){if(!at(e))switch(ct("runStopAction: target: "+e),e){case"all":xi(i);break;case"granulator":Le(i);break;case"speechSynth":qe(i)}}function xi(e){ct("runStopAll: "),!at(n)&&n.isReady()&&(Le(e),qe(e))}function Si(e){at(e)||bi(e)}function bi(e){var i=Ci();if(at(i))ct("zoom: invalid canvas");else{ct("zoomTarget: "+e);var t=Pi(e);gsap.to(i,{attr:{viewBox:t},ease:"power3.out",duration:Zt.zoomDuration})}}function Ti(e){z(e.line1,e.line2,e.line3,e.colour,e.isVisible)}function Pi(i){switch(e.isString(i)||(i="default"),i){case"centreShape":return"660 660 204 204";case"innerCircle":return"471 471 582 582";case"outerCircleSmall":return"350 350 824 824";case"outerCircle":default:return"0 0 1525 1525"}}function Ii(i,t,n){if(e.isString(t)&&e.isString(i)){ct("runTimeline: "+t);var r=null;switch(t){case"centreShape":r=Xt.centreShape.gsapTimeline;break;case"innerCircle":r=Xt.innerCircle.gsapTimeline;break;case"outerCircle":r=Xt.outerCircle.gsapTimeline;break;case"centreShapeExplode":r=Xt.centreShape.gsapExplodeTimeline;break;case"innerCircleExplode":r=Xt.innerCircle.gsapExplodeTimeline;break;case"outerCircleExplode":r=Xt.outerCircle.gsapExplodeTimeline;break;default:return void ot("runTimeline: invalid target: "+t)}switch(i){case"start":Ei(r,n);break;case"stop":ki(r);break;case"end":Ai(r);break;case"reset":wi(r);break;case"reverse":Mi(r,n);break;case"resume":Vi(r,n);break;default:return void ot("runTimeline: invalid actionId: "+i)}}}function Ci(){return e.getElement("svgCanvas")}function Ei(e,i){if(at(e))ot("startTimeline: invalid timeline");else{if(!at(i)&&!at(i.duration)){var t=i.duration;e.totalDuration(t)}var n=e.progress();n>0?e.restart():e.play()}}function ki(e){at(e)?ot("stopTimeline: invalid timeline"):e.pause()}function Ai(e){at(e)?ot("endTimeline: invalid timeline"):e.pause(1)}function wi(e){at(e)?ot("stopTimeline: invalid timeline"):e.pause(0)}function Vi(e,i){if(at(e))ot("resumeTimeline: invalid timeline");else if(!e.isActive()){var t=e.totalDuration();if(!at(i)&&!at(i.duration))t=i.duration;var n=e.progress();1==n||0==n?(e.totalDuration(t),e.restart()):e.resume()}}function Mi(e,i){if(at(e))ot("reverseTimeline: invalid timeline");else{var t=e.progress();if(t<1&&Ai(e),!at(i)&&!at(i.duration)){var n=i.duration;e.totalDuration(n)}e.reverse()}}function Oi(i){e.getElement(i)}function zi(i){if(!e.isObject(i))return[];if(ce(i.id)){var t=se(i);return t.tweens}return gsap.getTweensOf(i)}function Fi(e,i){if(!at(e)){var t="hidden";i&&(t="visible"),lt(e,{visibility:t})}}function Ni(i){if(!at(qt)){qt.innerHTML=dt;var t=Xt.instructions.l1,n=Zt.textSpanPrefix+"1",r=Xt.instructions.l2,l=Zt.textSpanPrefix+"2",a=Xt.instructions.l3,s=Zt.textSpanPrefix+"3",o=dt;i||(i=dt,e.isEmptyString(t)||(o=Li(t,o),t=e.wrapInSpanElement(t,n),i+=t),e.isEmptyString(r)||(ct("displayInstructions: processing line2 "+r),o=Li(r,o),r=e.wrapInSpanElement(r,l),i=e.addSuffixIfNotThere(i,Zt.textLineBreak),i+=r),e.isEmptyString(a)||(ct("displayInstructions: processing line3 "+a),o=Li(a,o),a=e.wrapInSpanElement(a,s),i=e.addSuffixIfNotThere(i,Zt.textLineBreak),i+=a));var c=Zt.textFontSize,u=et(o,c,qt);qt.style.fontSize=dt+u+"px",qt.style.fontFamily=Zt.textFontFamily,qt.innerHTML=i;var d=e.getChildElement(qt,e.toCssIdQuery(n));at(d)||(d.style.opacity=0);var f=e.getChildElement(qt,e.toCssIdQuery(l));at(f)||(f.style.opacity=0);var v=e.getChildElement(qt,e.toCssIdQuery(s));if(at(v)||(v.style.opacity=0),Xt.instructions.isVisible=!0,Ri(qt,Xt.instructions),Zt.textSpanIsFadeIn){var p=Zt.textSpanFadeTimeSec,h=Zt.textSpanFadeStaggerTimeSec;at(d)||gsap.to(d,{duration:p,autoAlpha:1,ease:"power1.in"}),at(f)||gsap.to(f,{delay:h,duration:p,autoAlpha:1,ease:"power1.in"}),at(v)||gsap.to(v,{delay:2*h,duration:p,autoAlpha:1,ease:"power1.in"})}else at(d)||(d.style.opacity=1),at(f)||(f.style.opacity=1),at(v)||(v.style.opacity=1)}}function Li(i,t){var n=e.removeMarkup(i);return n.length>t.length?n:t}function Di(e){return Zt.textFontType+ft+e+"px "+Zt.textFontFamily}function Gi(){at(qt)||(qt.innerHTML=dt,Xt.instructions.isVisible=!1,Ri(qt,Xt.instructions))}function Ri(i,t){var n=j(t);at(t.bckgCol)||(n.background=t.bckgCol),e.setElementStyleProperty(i,n)}function Ui(i){if(!at(i)&&st(i.data)){var t=e.parseJson(serverData);ji(t,!1)}}function ji(e,i){at(e)||(i||f(),st(e.tiles)&&(i?Wi(e.tiles):Hi(e.tiles)),st(e.centreShape)&&Bi(e.centreShape,Xt.centreShape,"centreShape"),st(e.innerCircle)&&Bi(e.innerCircle,Xt.innerCircle,"innerCircle"),st(e.outerCircle)&&Bi(e.outerCircle,Xt.outerCircle,"outerCircle"),st(e.actions)&&qi(e.actions),st(e.zoomLevel)&&Si(e.zoomLevel),st(e.instructions)&&Ti(e.instructions))}function Bi(e,i,t){at(e)||at(i)||(i.isVisible=e.isVisible,Te(i,t))}function Wi(i){if(e.isArray(i)){for(var t=[],n=0;n<i.length;n++){var r=i[n];if(e.isObject(r)){var l=r.state,a=oe(l.id),s=r.tileText,o=a.txt;a.isActive=l.isActive,a.isVisible=l.isVisible,a.isPlaying=l.isPlaying,a.isPlayingNext=l.isPlayingNext,a.isPlayed=l.isPlayed,a.clickCount=l.clickCount,o.value=s.value,o.isVisible=s.isVisible,t.push(a)}else ot("processSeverTilesStateDelta: invalid server tile")}Qi(t)}}function Hi(i){if(e.isArray(i)&&e.isArray(i[0])){for(var t=[],n=0;n<i.length;n++)for(var r=i[n],l=0;l<r.length;l++){var a=i[n][l],s=Xt.tiles[n][l],o=a.id,c=s.id;if(o===c){var u=a.state,d=a.tileText,f=s.txt;Ji(s,u)&&Ki(f,d)||(s.isActive=u.isActive,s.isVisible=u.isVisible,s.isPlaying=u.isPlaying,s.isPlayingNext=u.isPlayingNext,s.isPlayed=u.isPlayed,s.clickCount=u.clickCount,f.value=d.value,f.isVisible=d.isVisible,t.push(s))}else ot("processSeverTilesState: Server id "+o+"and client id "+c+"not identical")}Qi(t)}}function Qi(i){ct("Have "+i.length+" tile changes");for(var t=0;t<i.length;t++){var n=i[t],r=e.getElement(n.id);!n.isPlayed&&n.isVisible&&n.isActive||!n.isSelected||(n.isSelected=!1),be(n,r),ge(n,r),ye(n,r),n.isPlaying&&(Xt.playingTileId=n.id)}H()}function qi(i){var t=null,n=null,r=[],l={};if(e.isArray(i))for(var a=0;a<i.length;a++){var s=i[a];st(s.id)&&(t=s.id),st(s.actionType)&&(n=s.actionType),st(s.elementIds)&&(r=s.elementIds),st(s.params)&&(l=s.params),Xi(t,n,r,l)}}function Xi(e,i,t,n){if(ct("doAction: "+e+" actionType: "+i),!at(i)&&!at(t))switch(i){case"ACTIVATE":oi(e,t,n);break;case"ANIMATION":break;case"DEACTIVATE":fi(e,t,n);break;case"VISIBLE":break;case"INVISIBLE":Zi(t);break;case"ZOOM":we(t);break;case"TIMELINE":Ve(e,t,n);break;case"ROTATE":Ke(e,t,n);break;case"ALPHA":ii(e,t,n);break;case"AUDIO":Me(e,t,n);break;case"RESET":ri(e,t,n);break;case"STOP":gi(e,t,n);break;default:ot("doAction: Unknown actionType: "+i)}}function Zi(i){if(!at(i))if(e.isArray(i))for(var t=0;t<i.length;t++)_i(i[t]);else _i(i)}function _i(i){if(!at(i)){var t=e.getElement(i);if(ce(i)){var n=se(t);if(at(n))return;n.isVisible=!1,be(n,t)}}}function Ji(e,i){return!at(e)&&!at(i)&&(e.id===i.id&&(e.isVisible===i.isVisible&&e.isActive===i.isActive&&e.isPlaying===i.isPlaying&&e.isPlayingNext===i.isPlayingNext&&e.clickCount===i.clickCount&&e.isPlayed===i.isPlayed))}function Ki(e,i){return!at(e)&&!at(i)&&(e.isVisible===i.isVisible&&e.value===i.value)}function Yi(e){if(!at(e)){var i=e.progress();i>0?e.restart():e.play()}}function $i(){return e.getElement(Zt.instructionTxtElementId)}function et(e,i,t){var n=1;r.innerWidth||l.documentElement.clientWidth||l.body.clientWidth;var a=r.innerHeight||l.documentElement.clientHeight||l.body.clientHeight,s=(Di(n),t.clientWidth),o=s*Zt.textWidthCompressor,c=a*Zt.textAreaMax;n=tt(e,i,o),n=it(s,n,c);var u=Zt.textMaxFontSize;return n>u&&(n=u),n}function it(e,i,t){var n=Di(i),r=i,l=rt(n,e,t);if(l<0)return r;var a=l*Zt.textNumberOfLines,s=t/a;return s<1&&(r*=s),r}function tt(e,i,t){var n=Di(i),r=nt(n,e),l=r.width;if(l<=0||l>t||Math.abs(t-l)<1)return i;var a=t/l,s=i*a;return tt(e,s,t)}function nt(e,i){var t=Xt.fontCanvas,n=Xt.canvasCtx;return n.fillRect(0,0,t.width,t.height),n.textBaseline="top",n.fillStyle=mt,n.font=e,n.measureText(i)}function rt(e,i,t){var n=Xt.fontCanvas,r=Xt.canvasCtx;n.width=i,n.height=t,r.fillRect(0,0,n.width,n.height),r.textBaseline="top",r.fillStyle=mt,r.font=e;var l="gM";r.fillText(l,0,0);for(var a=r.getImageData(0,0,n.width,n.height).data,s=-1,o=-1,c=0;c<n.height;c++)for(var u=0;u<n.width;u++){var d=4*(c*n.width+u);if(0!==a[d]){-1===s&&(s=c);break}if(u===n.width-1&&-1!==s){o=c,c=n.height;break}}var f=(o-s)*Zt.textHeightCompressor;return f}function lt(i,t){e.setElementAttributes(i,t)}function at(i){return e.isNull(i)}function st(i){return e.isNotNull(i)}function ot(i){e.logError(i)}function ct(i){e.log(i)}const ut="DEV",dt="",ft=" ",vt="m",pt="ELEMENT_SELECTED",ht="elementId",gt="selected",yt="fill",mt="#FFFFFF",xt="#000000",St="#CCFFCC",bt="#C0C0C0",Tt="#2F4F4F",Pt="#696969",It="#4B4B4B",Ct="#FFA500",Et="#DC143C",kt=Pt,At=It,wt=It,Vt=It,Mt=mt,Ot=Tt,zt=Tt,Ft=mt,Nt=mt,Lt=xt,Dt=Et,Gt=St,Rt=Ct,Ut=bt,jt="@TILE_TEXT@",Bt="Arial";var Wt=["/audio/violin-tuning.mp3","/audio/UnionRoseE2m.mp3","/audio/UnionRoseE3.mp3","/audio/UnionRoseE4.mp3","/audio/UnionRoseE5.mp3","/audio/UnionRose-m1.mp3"],Ht=null,Qt=null,qt=null,Xt={tiles:[],tileCircles:[],centreShape:{isVisible:!1,gsapTimeline:{},gsapExplodeTimeline:{}},innerCircle:{isVisible:!1,gsapTimeline:{},gsapExplodeTimeline:{}},outerCircle:{isVisible:!1,gsapTimeline:{},gsapExplodeTimeline:{}},instructions:{isVisible:!1,l1:dt,l2:dt,l3:dt,bckgCol:"rgba(225, 225, 225, 0.85)"},selectedTileId:null,playingTileId:null,fontCanvas:null,canvasCtx:null,speech:{isPlaySpeechSynthOnClick:!1,speechText:"I, I clicked on "+jt,speechVoice:"random",speechIsInterrupt:!0}},Zt={connectionPreference:"ws,poll",centre:{x:762,y:762},circleRadii:[55,92,125,194,291,401,552,750],outerFrameRadius:2e3,lineEnd:{x:762,y:12},lineLen:750,lineAngles:[0,45,90,135,180,225,270,315],tileAngles:[0,45,90,135,180,225,270,315,360],viewMinPoint:0,viewMaxPoint:1525,circlePrefix:"c",linePrefix:"l",tilePrefix:"t",overlayPrefix:"o",selectedPrefix:"s",tileCircleGroupPrefix:"ctg",tileGroupPrefix:"g",tileTextElementPrefix:"x",tileTextPathElementPrefix:"px",tileTextElementPathPrefix:"hx",tileTextSpanPrefix:"sp",stageParentId:"stage",overlayParentId:"overlay",stageId:"stageCircle",frameParentId:"frame",outerFrameId:"outerFrame",elementIdDelimiter:"-",svgArcs:[null,null,null,null,null,null,null,null],gridParentId:"grid",gridStyle:{fill:"none",stroke:"aqua","stroke-width":"2px"},stageStyle:{fill:Lt,"stroke-width":"0px","stroke-opacity":"0",visibility:"visible",opacity:1,"pointer-events":"none"},tilesParentId:"tiles",frameStyle:{fill:Nt,"stroke-width":"0px","stroke-opacity":"0",visibility:"visible",opacity:1},tileStyleOverlayPlayingNext:{fill:"none",stroke:Rt,"stroke-width":"1px",visibility:"visible",opacity:1,"pointer-events":"none"},tileStyleOverlayPlaying:{fill:"none",stroke:Gt,"stroke-width":"1px",visibility:"visible",opacity:1,"pointer-events":"none"},tileStyleOverlaySelected:{fill:"none",stroke:Dt,
"stroke-width":"2px",visibility:"visible",opacity:1,"pointer-events":"none"},tileStyleSelectedPath:{fill:"none",stroke:Dt,"stroke-width":"4px",visibility:"visible",opacity:1,"pointer-events":"none"},tileStyleVisible:{fill:Vt,stroke:Ut,"stroke-width":"2px","pointer-events":"all",visibility:"visible",opacity:1},tileStyleActive:{fill:At,stroke:Ut,"stroke-width":"2px","pointer-events":"all",visibility:"visible",opacity:1},tileStyleInActive:{fill:Mt,stroke:Ut,"stroke-width":"2px","pointer-events":"all",visibility:"visible",opacity:1},tileStyleInvisible:{visibility:"hidden"},tileStyleOnPonterEntry:{fill:Ot},tileStyleSelected:{fill:zt,stroke:Ut,"stroke-width":"2px",visibility:"visible",opacity:1},tileStylePlayed:{visibility:"hidden"},tileStylePlaying:{fill:wt,stroke:Ut,"stroke-width":"1px",visibility:"visible",opacity:1},tileStylePlayingNext:{stroke:Ut,"stroke-width":"2px",visibility:"visible",opacity:1},tileStyleTextPathDef:{fill:"none",stroke:"none"},tileStyleTextElement:{visibility:"visible",opacity:1},tileStyleTextElementInvisible:{visibility:"hidden"},tileStyleTorusTextPathElement:{startOffset:"50%","text-anchor":"middle",fill:Ft,stroke:"none"},tileStylePieTextPathElement:{startOffset:"90%","text-anchor":"end",fill:Ft,stroke:"none"},tileStyleInvertedPieTextPathElement:{startOffset:"10%","text-anchor":"start",fill:Ft,stroke:"none"},tileStyleTextSpan:{"font-family":Bt,"dominant-baseline":"middle"},tileTextMinLength:5,tileTextSizeMultiplier:{torus:.8,pie:.7},shapeStyleInvisible:{visibility:"hidden"},shapeStyleVisible:{visibility:"visible"},shapeTimelineDuration:60,shapeExplodeDuration:5,instructionTxtElementId:"instructionTxt",textLineBreak:"<br/>",textStyleInvisible:{visibility:"hidden"},textStyleVisible:{visibility:"visible"},textFontFamily:"Arial",textFontType:"normal",textFontSize:50,textMaxFontSize:70,textMaxLineLen:30,textHeightCompressor:1.1,textWidthCompressor:.9,textAreaMax:.4,textNumberOfLines:3,textSpanPrefix:"is",textSpanIsFadeIn:!0,textSpanFadeTimeSec:1,textSpanFadeStaggerTimeSec:.5,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",zoomDuration:3,all:"ALL",testTextElementId:"testTxt",colModPerClick:-20,maxColModPerClick:-150};return{load:function(){u()},createSvgTile:F,initTiles:m,setTileText:G}}(zsUtil,zsNet,zsSvg,zsAudio,window,document);