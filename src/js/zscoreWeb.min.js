var zscore=function(e,t,i,n,r,a,o){"use strict";function s(e){this.message=e,this.name="ZScoreException"}function l(e,t,i,n,r,a,o,s){this.xStart=e,this.xEnd=t,this.yStart=i,this.yEnd=n,this.beatStartNum=r,this.beatStartDenom=a,this.beatEndNum=o,this.beatEndDenom=s}function c(e,t,i,n){this.id=e,this.no=t,this.imgFileName=i,this.imgFileUrl=n,this.isLoaded=!1,this.img=new Image,this.img.pageId=e}function f(e,t){this.id="partBtn"+e,this.class="partListButton",this.onclick="onPartSelect('"+t+"')"}function d(e,t){this.onclick="onInstrumentSelect("+e+",'"+t+"')"}function u(){this.onclick=""}function v(){}function p(){if(!ji.isInitialised){if(!(e&&t&&i&&n&&r))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");e.setRunMode(_t),Rt("init: "),Hi=e.isTouchDevice(),Fi=e.isSafari(navigator),Rt("init: IsTouch Device: "+Hi+" isSafari: "+Fi),ji.fontCanvas=o.createElement("canvas"),ji.canvasCtx=ji.fontCanvas.getContext("2d"),e.listen("resize",a,E),e.listen("orientationchange",a,E),y(),k(),x(),ji.isInitialised=!0}}function S(){m(ji.topStave),m(ji.bottomStave)}function m(t){if(!wt(t)&&!wt(t.config)){var i=t.config;e.setElementIdAttributes(i.positionLineId,i.posLineConf),e.setElementIdAttributes(i.beatBallId,i.posBallConf)}}function I(){ji.isInitialised?(Rt("onStateBtnClick: zscore initialised"),t.isConnected()||(Rt("onStateBtnClick: zscore not connected, reconnecting..."),R())):(Rt("onStateBtnClick: initialising"),p())}function g(t){e.arrContains(ji.score.parts,t)?(ji.part.name=t,Ee(t),e.makeInVisible(Xi.idPartsListOuterDiv)):Rt("onPartSelection: unexpected part: "+t)}function b(e,t){wt(e)||wt(t)||wt(ji.part.name)||Ae(e,t,ji.part.name)}function P(){T()}function y(){t.init(Xi.connectionPreference,Xi.appUrlSse,Xi.appUrlWebsockets,Xi.appUrlHttp,D,h)}function x(){wt(n)?Ct("initAudio: invalid zsAudio lib"):n.init(zi,0)}function T(){wt(n)?Ct("resetAudio: invalid zsAudio lib"):n.reset()}function k(){i.init()}function E(t){if(!e.isObject(this))return null}function h(e,i){switch(e){case t.OPEN:N(i);break;case t.CLOSED:A(i);break;case t.ERROR:L(i);break;default:Ct("Unknown Connection Event State: "+e+" for type: "+i)}}function N(e){Rt(e+" connection opened."),B(e)}function A(e){Rt(e+" connection closed."),w(e)}function L(e){Rt(e+" connection error."),O(e)}function B(e){ji.isConnected=!0,ji.connectionType=e,ji.reconnectAttmpts=0,C(Xi.connectedRectStyle,Xi.connectedBtnAttrib,Xi.connectedTxtStyle,Ht)}function w(e){ji.isConnected=!1,C(Xi.disconnectedRectStyle,Xi.disconnectedBtnAttrib,Xi.disconnectedTxtStyle,jt),R(e)}function O(e){ji.isConnected=!1,C(Xi.errorRectStyle,Xi.errorBtnAttrib,Xi.errorTxtStyle,Gt),R(e)}function C(t,i,n,r){var a=e.getElement(Xi.idServerStatusRect);wt(a)||Lt(a,t);var o=e.getElement(Xi.idServerStatusBtn);wt(o)||Bt(o,i);var s=e.getElement(Xi.idServerStatusTxt);wt(s)||(Lt(s,n),s.textContent=r)}function R(e){t.reconnect(e,!0)}function D(e,t){ji.isConnected||B(),wt(e)||(t||P(),Ot(e.scoreInfo)&&_(e.scoreInfo),Ot(e.partInfo)&&ce(e.partInfo),Ot(e.pageInfo)&&te(e.pageInfo),Ot(e.mapInfo)&&z(e.mapInfo),Ot(e.bpm)&&0!=e.bpm&&Y(e.bpm),Ot(e.actions)&&Le(e.actions))}function _(t){e.isObject(t)&&(Ot(t.title)&&M(t.title),Ot(t.instruments)&&xe(t.instruments),Ot(t.bpm)&&U(t.bpm),Ot(t.scoreDir)&&V(t.scoreDir))}function M(t){ji.score.title!==t&&(ji.score.title=t,ji.score.noSpaceTitle=e.replaceEmptySpaces(t,Vt),i.setElementText(Xi.idTitle,t))}function V(e){ji.scoreDir!==e&&(ji.scoreDir=e)}function U(e){ji.tempo!==e&&(ji.tempo=e,i.setElementText(Xi.idTempoBpm,e))}function Y(t){var i=e.toInt(t);if(!wt(i)){var n=ji.tempo,r=i/n;ji.tempoModifier=r,U(i),ji.isPlaying?F(r):j()}}function z(t){if(!wt(t.map)&&!wt(t.pageId)){t.pageId;var i=t.staveId,n=t.map,r=ji[i];if(!wt(r)){var a=r.config.xLeftMargin,o=JSON.parse(JSON.stringify(n));if(e.isArray(o)){for(var s={},l=0;l<o.length;l++)H(s,o[l],a);r.beatMap=s,G(i)}}}}function H(e,t,i){if(!(wt(e)||wt(t)||wt(t.beatStartNum))){var n=t.beatStartNum,r=t.xStart+i,a=t.xEnd+i,o=new l(r,a,t.yStart,t.yEnd,n,t.beatStartDenom,t.beatEndNum,t.beatEndDenom);e[n]=o}}function F(e){X(ji.topStave.timeline,e),X(ji.bottomStave.timeline,e)}function X(e,t){if(!wt(e)){var i=e.timeScale(),n=i*t;e.timeScale(n)}}function j(){Q(ji.topStave),Q(ji.bottomStave)}function G(e){wt(e)||Q(ji[e])}function Q(e){if(!wt(e)){var t=gsap.timeline({onComplete:J,onCompleteParams:[e.id],paused:!0}),i=e.beatMap;if(!wt(i)){var n=e.config.positionLineId,a=e.config.beatBallId,o=e.config.ballYmax,s=!0;for(var l in i){var c=i[l],f=ji.tempo,d=r.getBeatDurationSec(f),u=c.beatStartNum;if(s){var v=Xi.beatIdPrefix+(u-1),p=c.xStart,S=W(n,0,p,v,0);t.add(S,qt);var m=Z(a,0,p,v);t.add(m,Jt),s=!1}p=c.xEnd,v=Xi.beatIdPrefix+u;var I=Xi.tweenIdPrefix+v,g=W(n,d,p,v,u),b=Z(a,d,p,v),P=q(a,d/2,o,v);I=g.vars.id;t.addLabel(I,Jt),t.add(g,Jt),t.add(b,qt),t.add(P,I)}Ot(e.currentBeat)&&ut(t,e.currentBeat),e.timeline=t}}}function W(t,i,n,r,a){var o=Xi.tweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{x1:n,x2:n},ease:"none",onStart:K,onStartParams:[r,a],onComplete:$,onCompleteParams:[r,a]})}function Z(t,i,n,r){var a=Xi.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:a,duration:i,attr:{cx:n},ease:"none"})}function q(t,i,n,r){var a=Xi.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:a,duration:i,attr:{cy:n,r:2},ease:"power1.out",autoAlpha:.5,repeat:1,yoyo:!0})}function J(e){Dt("onTimelineComplete stave: "+e);var t=ji[e];Ot(t)&&(t.isRunning=!1),Ot(t.timeline)&&t.timeline.pause(0)}function K(e,t){var i=n.getCurrentTime();ji.audioTlBeatTime=i,Dt("onBeatStart: beat: "+e+" beatNo: "+t+" beatTime: "+i),ee(t,e)}function $(e,t){var i=n.getCurrentTime(),r=i-ji.startTimeTl;Dt("onBeatEnd: beat: "+e+" beatNo: "+t+" elapsedTime: "+r)}function ee(t,i){e.isNumeric(t)&&(e.isNull(i)&&(i=Xi.beatIdPrefix+t),ji.currentBeatId=i,ji.currentBeatNo=t)}function te(e){if(!wt(e.staveId)){var t=e.staveId,i=ji[t];wt(i)?Ct("processPageinfo: Invalid stave for id: {}",t):(Ot(e.filename)&&(i.filename=e.filename),Ot(e.pageId)&&(i.pageId=e.pageId),Ot(e.rndPageId)?i.rndPageId=e.rndPageId:i.rndPageId=null,ie(i))}}function ie(t){if(!wt(t)){var i=t.config;if(!wt(i)){var n=null,r=t.pageId;Ot(t.rndPageId)&&(r=t.rndPageId);var a=ae(r);n=wt(a)?re(t.fileName):a.src;var o=e.getElement(i.imgId);o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),o.setAttribute("href",n)}}}function ne(t){if(!wt(t)){var i=t.config;if(!wt(i)){var n=t.fileName,r=e.getElement(i.imgId);r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),r.setAttribute("href",n)}}}function re(e){return ji.scoreDir+ji.score.noSpaceTitle+Ut+e}function ae(e){var t=ji.part.pages[e];return wt(t)?null:t.img}function oe(e){var t=ji.part.pages[e];Ot(t)&&(t.isLoaded=!0),ji.pageNoToLoad--,0===ji.pageNoToLoad&&le(),se(ji.pageNoToLoad)}function se(e){if(e>0){var t=Ft+" "+e;C(Xi.errorRectStyle,Xi.errorBtnAttrib,Xi.errorTxtStyle,t)}else C(Xi.connectedRectStyle,Xi.connectedBtnAttrib,Xi.connectedTxtStyle,Xt)}function le(){Rt("onPageLoadComplete: ");var e=ji.part.pages,t=!0;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n.isLoaded||(Rt("onPageLoadComplete: page: "+i+" is not loaded, retying load"),pe(n.no),t=!1)}t&&(Rt("All Pages loaded: "),ji.isReady=!0,he())}function ce(t){if(Ot(t.name)&&(ji.part.name=t.name,i.setElementText(Xi.idInstrument,t.name)),Ot(t.pageRanges)){var n=t.pageRanges;if(e.isArray(n))for(var r=0;r<n.length;r++)ye(n[r]);else ye(n)}Ot(t.imgDir)&&(ji.part.imgDir=t.imgDir),Ot(t.imgPageNameToken)&&(ji.part.imgPageNameToken=t.imgPageNameToken),Ot(t.imgContPageName)&&(ji.part.imgContPageName=t.imgContPageName),Ot(t.contPageNo)&&(ji.part.contPageNo=t.contPageNo),fe()}function fe(){var t=ji.part,i=t.pageRanges;if(e.isArray(i)){for(var n=0;n<i.length;n++)ve(i[n]);de(),ue()}}function de(){var e=ge();ji.pageNoToLoad++,Se(e)}function ue(){var e=Ie();ji.pageNoToLoad++,Se(e)}function ve(t){if(e.isObject(t)){var i=1,n=1;Ot(t.start)&&(i=e.toInt(t.start)),Ot(t.end)&&(n=e.toInt(t.end));var r=ji.pageNoToLoad+(n-i+1);ji.pageNoToLoad=r;for(var a=i;a<=n;a++)pe(a)}}function pe(e){var t=me(e);Se(t)}function Se(e){if(!wt(e)){var t=e.imgFileUrl;wt(t)||e.loadImg(t,e.id)}}function me(t){var i=Pe(t),n=ji.part.pages[i];if(Ot(n))return n;var r=ji.part.imgPageNameToken;r=wt(r)?be(t):e.replace(r,Xi.pageNoToken,""+t);var a=ji.part.imgDir+r;n=new c(i,t,r,a);return ji.part.pages[i]=n,n}function Ie(){var e=ji.part.contPageNo,t=Pe(e),i=ji.part.pages[t];if(Ot(i))return i;var n=ji.part.imgContPageName,r=ji.part.imgDir+n;i=new c(t,e,n,r);return ji.part.pages[t]=i,i}function ge(){var e=ji.part.blankPageNo,t=Pe(e),i=ji.part.pages[t];if(Ot(i))return i;var n=Xi.blankPageUrl,r=Xi.blankPageUrl;i=new c(t,e,n,r);return ji.part.pages[t]=i,i}function be(e){return ji.score.noSpaceTitle+Vt+instrumentName+"_page"+e+".png"}function Pe(e){return Xi.pageIdPrefix+e}function ye(e){if(!(wt(e)||wt(e.start)||wt(e.end))){var t=e.start,i=e.end,n={start:t,end:i};ji.part.pageRanges=[],ji.part.pageRanges.push(n)}}function xe(t){var i=[];if(e.isArray(t))for(var n=0;n<t.length;n++){var r=t[n];e.arrContains(Xi.filterOutParts,r)||i.push(r)}else e.arrContains(Xi.filterOutParts,r)||i.push(t);e.arrEquals(ji.score.parts,i)||(ji.score.parts=i),Te(i)?Ee(ji.part.name):ke(i)}function Te(t){if(wt(ji.part.name)||!e.isArray(t))return!1;for(var i=ji.part.name,n=0;n<t.length;n++)if(i===t[n])return!0;return!1}function ke(t){var i=e.getElement(Xi.idParts);if(!wt(i)){e.removeElementChildren(i);for(var n=0;n<t.length;n++){var r=t[n];if(!e.arrContains(Xi.filterOutParts,r)){var a=new f(n+1,r),o=e.createDiv(),s=e.createButton(a);e.setText(s,r),e.addChildToParent(o,s),e.addChildToParent(i,o)}}e.makeVisible(Xi.idPartsListOuterDiv)}}function Ee(e){var i=new v;i[Ei]=e,t.sendEvent(yi,i)}function he(){var e=new v;e[Ei]=ji.part.name,t.sendEvent(xi,e)}function Ne(e){var i=new v;i[hi]=e,t.sendEvent(Ti,i)}function Ae(e,i,n){var r=new v;r[wi]=e,r[Oi]=i,r[Ei]=n,t.sendEvent(ki,r)}function Le(t){var i=null,n=[],r={};if(e.isArray(t))for(var a=0;a<t.length;a++){var o=t[a];Ot(o.type)&&(i=o.type),Ot(o.targets)&&(n=o.targets),Ot(o.params)&&(r=o.params),Be(i,n,r)}}function Be(t,i,n){if(e.logDebug("doAction: "+t),!wt(t))switch(t){case"PING":At(n);break;case"START":Tt(i);break;case"STOP":xt();break;case"SEMAPHORE_ON":mt(n);break;case"SEMAPHORE_OFF":It(n);break;case"ACTIVATE":vt(i,n);break;case"BEAT":ct(i,n);break;case"START_MARK":at(i,n);break;case"INSTRUMENT_SLOTS":Je(n);break;case"RESET_INSTRUMENT_SLOTS":qe();break;case"RESET_STAVES":We();break;case"OVERLAY_ELEMENT":Ue(i,n);break;case"OVERLAY_LINE":De(i,n);break;case"OVERLAY_COLOUR":we(Oe,i,n);break;default:Ct("doAction: Unknown actionType: "+t)}}function we(t,i,n){if(!wt(t))if(e.isArray(i))for(var r=0;r<i.length;r++)t(i[r],n);else t(target,n)}function Oe(e,t){if(!wt(t)&&!wt(e)){var i=ji[e],n=t[Ci],r=t[Vi];Ce(i,n,r)}}function Ce(e,t,i){if(!(wt(e)||wt(t)||wt(i)))switch(t){case"POSITION":Re(e.config.ovrlPosId+Xi.idRectSuffix,i);break;case"PITCH":Re(e.config.ovrlPitchId+Xi.idRectSuffix,i);break;case"SPEED":Re(e.config.ovrlSpeedId+Xi.idRectSuffix,i);break;case"PRESSURE":Re(e.config.ovrlPressId+Xi.idRectSuffix,i);break;case"DYNAMICS":Re(e.config.ovrlDynId+Xi.idRectSuffix,i);break;default:Rt("setOverlayColour: unknown overlay type: "+t)}}function Re(t,i){e.setElementIdStyleProperty(t,{fill:i})}function De(t,i){if(!wt(i)&&!wt(t))if(e.isArray(t))for(var n=0;n<t.length;n++)_e(t[n],i);else _e(t,i)}function _e(e,t){var i=ji[e],n=t[Ci],r=t[Di];Me(i,n,r)}function Me(e,t,i){if(!(wt(e)||wt(t)||wt(i)))switch(t){case"POSITION":Ve(e.config.ovrlPosId+Xi.idLineSuffix,i);break;case"PITCH":Ve(e.config.ovrlPitchId+Xi.idLineSuffix,i);break;case"SPEED":Ve(e.config.ovrlSpeedId+Xi.idLineSuffix,i);break;case"PRESSURE":Ve(e.config.ovrlPressId+Xi.idLineSuffix,i);break;case"DYNAMICS":Ve(e.config.ovrlDynId+Xi.idLineSuffix,i);break;default:Rt("setOverlayElement: unknown overlay type: "+t)}}function Ve(t,n){var r=e.getElement(t);i.setLineY(r,n,n)}function Ue(t,i){if(!wt(i)&&!wt(t))if(e.isArray(t))for(var n=0;n<t.length;n++)Ye(t[n],i);else Ye(t,i)}function Ye(e,t){var i=ji[e],n=t[Ci],r=t[Ri],a=t[_i],o=t[Mi];ze(i,n,r,a,o)}function ze(e,t,i,n,r){if(!wt(e)&&!wt(t)){var a=e.config;if(!wt(a))switch(Dt("setOverlayElement: overlayType: "+t),t){case"POSITION":Ge(a,i,n,r);break;case"PITCH":je(a,i,n,r);break;case"SPEED":Xe(a,i,n,r);break;case"PRESSURE":Fe(a,i,n,r);break;case"DYNAMICS":He(a,i,n,r);break;default:Rt("setOverlayElement: unknown overlay type: "+t)}}}function He(e,t,i,n){if(!wt(t)&&!wt(e))switch(t){case"DYNAMICS_BOX":Qe(e.ovrlDynId+Xi.idRectSuffix,i,n),Qe(e.ovrlDynId+Xi.idOrdSuffix+Xi.idLineSuffix,i,n),Qe(e.ovrlDynId,i,n),i||Qe(e.ovrlDynId+Xi.idLineSuffix,i,n);break;case"DYNAMICS_MID_LINE":Qe(e.ovrlDynId+Xi.idOrdSuffix+Xi.idLineSuffix,i,n);break;case"DYNAMICS_LINE":Qe(e.ovrlDynId+Xi.idLineSuffix,i,n);break;default:Rt("setOverlayElement: unknown overlay type: "+t)}}function Fe(e,t,i,n){if(!wt(t)&&!wt(e))switch(t){case"PRESSURE_BOX":Qe(e.ovrlPressId+Xi.idRectSuffix,i,n),Qe(e.ovrlPressId+Xi.idOrdSuffix+Xi.idLineSuffix,i,n),Qe(e.ovrlPressId,i,n),i||Qe(e.ovrlPressId+Xi.idLineSuffix,i,n);break;case"PRESSURE_MID_LINE":Qe(e.ovrlPressId+Xi.idOrdSuffix+Xi.idLineSuffix,i,n);break;case"PRESSURE_LINE":Qe(e.ovrlPressId+Xi.idLineSuffix,i,n);break;default:Rt("setOverlayElement: unknown overlay type: "+t)}}function Xe(e,t,i,n){if(!wt(t)&&!wt(e))switch(t){case"SPEED_BOX":Qe(e.ovrlSpeedId+Xi.idRectSuffix,i,n),Qe(e.ovrlSpeedId+Xi.idOrdSuffix+Xi.idLineSuffix,i,n),Qe(e.ovrlSpeedId,i,n),i||Qe(e.ovrlSpeedId+Xi.idLineSuffix,i,n);break;case"SPEED_MID_LINE":Qe(e.ovrlSpeedId+Xi.idOrdSuffix+Xi.idLineSuffix,i,n);break;case"SPEED_LINE":Qe(e.ovrlSpeedId+Xi.idLineSuffix,i,n);break;default:Rt("setOverlayElement: unknown overlay type: "+t)}}function je(e,t,i,n){if(!wt(t)&&!wt(e))switch(t){case"PITCH_BOX":Qe(e.ovrlPitchId+Xi.idRectSuffix,i,n),Qe(e.ovrlPitchId,i,n),i||Qe(e.ovrlPitchId+Xi.idLineSuffix,i,n);break;case"PITCH_LINE":Qe(e.ovrlPitchId+Xi.idLineSuffix,i,n);break;default:Rt("setOverlayElement: unknown overlay type: "+t)}}function Ge(e,t,i,n){if(!wt(t)&&!wt(e))switch(t){case"POSITION_BOX":Qe(e.ovrlPosId+Xi.idRectSuffix,i,n),Qe(e.ovrlPosId+Xi.idOrdSuffix+Xi.idLineSuffix,i,n),Qe(e.ovrlPosId+Xi.idBridgeSuffix+Xi.idLineSuffix,i,n),Qe(e.ovrlPosId,i,n),i||Qe(e.ovrlPosId+Xi.idLineSuffix,i,n);break;case"POSITION_LINE":Qe(e.ovrlPosId+Xi.idLineSuffix,i,n);break;case"POSITION_BRIDGE_LINE":Qe(e.ovrlPosId+Xi.idBridgeSuffix+Xi.idLineSuffix,i,n);break;case"POSITION_ORD_LINE":Qe(e.ovrlPosId+Xi.idOrdSuffix+Xi.idLineSuffix,i,n);break;default:Rt("setOverlayElement: unknown overlay type: "+t)}}function Qe(t,i,n){if(!wt(t))if(i){var r=e.toFloat(n);e.isNumeric(r)||(r=1),e.setElementIdStyleProperty(t,{opacity:r}),e.makeVisible(t)}else e.makeInVisible(t)}function We(){Ze(ji.topStave),Ze(ji.bottomStave)}function Ze(e){wt(e)||(e.pageId=Yi,e.rndPageId=null,e.filename=Ui,e.beatMap=null,e.timeline=null,e.isActive=!0,e.isPlaying=!1,e.currentBeat=null,m(e),ne(e))}function qe(){tt(),$e()}function Je(e){if(!wt(e)){var t=e[Bi];et(t),Ke()}}function Ke(){e.makeVisible(Xi.idInstControls)}function $e(){e.makeInVisible(Xi.idInstControls)}function et(t){if(!wt(t)){var i=e.csvToArr(t);if(!(wt(i)||i.length<=0)){var n=ji.score.parts;if(!(wt(n)||n.length<=0))for(var r=0;r<n.length;r++){var a=r+1;r<i.length?it(i[r],a):nt(a)}}}}function tt(){var e=ji.score.parts;if(!(wt(e)||e.length<=0))for(var t=0;t<e.length;t++){var i=t+1;rt(i)}}function it(t,n){if(!wt(t)&&!wt(n)){var r=Xi.idInstSlotTxtPrefix+n,a=Xi.idInstSlotBtnPrefix+n,o=Xi.idInstSlotPrefix+n,s=t===ji.part.name;e.makeVisible(r),e.makeVisible(a),e.makeVisible(o),e.setElementIdAttributes(o,Xi.instSlotActiveAttrib),i.setElementText(r,t.trim()),e.setElementIdStyleProperty(r,Xi.instSlotTxtActiveStyle),s?e.setElementIdStyleProperty(a,Xi.instSlotBtnActiveInstStyle):e.setElementIdStyleProperty(a,Xi.instSlotBtnActiveStyle);var l=new d(n,t);e.setElementIdAttributes(a,l)}}function nt(t){var n=Xi.idInstSlotTxtPrefix+t,r=Xi.idInstSlotBtnPrefix+t,a=Xi.idInstSlotPrefix+t;e.makeVisible(n),e.makeVisible(r),e.makeVisible(a),e.setElementIdAttributes(a,Xi.instSlotInActiveAttrib),i.setElementText(n,Mt),e.setElementIdStyleProperty(n,Xi.instSlotTxtInActiveStyle),e.setElementIdStyleProperty(r,Xi.instSlotBtnInActiveStyle);var o=new u;e.setElementIdAttributes(r,o)}function rt(t){var i=Xi.idInstSlotTxtPrefix+t,n=Xi.idInstSlotBtnPrefix+t,r=Xi.idInstSlotPrefix+t;e.makeInVisible(i),e.makeInVisible(n),e.makeInVisible(r);var a=new u;e.setElementIdAttributes(n,a)}function at(t,i){if(!wt(i)&&!wt(t))if(e.isArray(t))for(var n=0;n<t.length;n++)ot(t[n],i);else ot(t,i)}function ot(e,t){if(!wt(t)){var n=ji[e],r=t[Li];if(!wt(n)&&!wt(r)){var a=n.beatMap;if(!wt(a)){var o=a[r];if(!wt(o)){var s=o.xStart-1,l=st(n);i.setLineX(l,s,s),lt(l,!0)}}}}}function st(t){return e.getElement(t.config.startLineId)}function lt(t,i){i?e.makeElementVisible(t):e.makeElementInVisible(t)}function ct(t,i){if(!wt(i)&&!wt(t))if(e.isArray(t))for(var n=0;n<t.length;n++)ft(t[n],i);else ft(t,i)}function ft(e,t){var i=ji[e],n=t[Li];dt(i,n)}function dt(e,t){if(!wt(e)&&!wt(t)){var i=n.getCurrentTime();Dt("setStaveBeat: stave: "+e.id+" beat: "+t+" time: "+i),ut(e.timeline,t),e.currentBeat=t}}function ut(e,t){if(!wt(e)){var i=Xi.tweenIdPrefix+Xi.beatIdPrefix+t,n=e.labels;i in n?e.seek(i):Dt("setTimelineBeat: Invalid beat "+i)}}function vt(t,i){if(!wt(i)&&!wt(t))if(e.isArray(t))for(var n=0;n<t.length;n++)pt(t[n],i);else pt(t,i)}function pt(e,t){var i=ji[e],n=t[Ni],r=t[Ai];St(i,n,r)}function St(t,i,n){if(!(wt(t)||wt(i)||wt(n))){if(i)e.setElementIdStyleProperty(t.config.maskId,Xi.activeStaveStyle);else{e.setElementIdStyleProperty(t.config.maskId,Xi.inactiveStaveStyle);var r=st(t);lt(r,!1)}n&&Et(t.timeline)}}function mt(e){wt(e)||bt(e.lightNo,e.colourId)}function It(e){wt(e)||Pt(e.lightNo,si)}function gt(){Pt(4,si),Pt(1,$t)}function bt(e,t){var i=yt(t);Pt(e,i)}function Pt(t,n){if(!wt(t)&&!wt(n))for(var r=e.toInt(t),a=1;a<=r;a++){var o=Xi.idSemaphorePrefix+a;i.setElementColour(o,n)}}function yt(e){var t;switch(e||(e=1),e){case 4:t=$t;break;case 3:t=ei;break;case 2:t=ti;break;case 1:default:t=Kt}return t}function xt(){ht(),ji.isPlaying=!1,gt(),S()}function Tt(t){if(e.isArray(t))for(var i=0;i<t.length;i++)kt(t[i]);else kt(t)}function kt(e){if(!wt(e)){var t=ji[e];if(!wt(t)){var i=t.timeline;wt(i)||(Et(i),ji.isPlaying=!0)}}}function Et(e){if(wt(e))Ct("startTimeline: invalid timeline");else{var t=e.progress();t>0&&t<1?e.resume():e.play(0)}}function ht(){Nt(ji.topStave.timeline),Nt(ji.bottomStave.timeline),ji.bottomStave.isPlaying=!1,ji.topStave.isPlaying=!1}function Nt(e){wt(e)?Ct("stopTimeline: invalid timeline"):e.pause()}function At(t){e.isObject(t)&&Ot(t.sendTimeMs)&&Ne(t.sendTimeMs)}function Lt(t,i){e.setElementStyleProperty(t,i)}function Bt(t,i){e.setElementAttributes(t,i)}function wt(t){return e.isNull(t)}function Ot(t){return e.isNotNull(t)}function Ct(t){e.logError(t)}function Rt(t){e.log(t)}function Dt(t){e.logDebug(t)}const _t="dev",Mt="",Vt="_",Ut="/",Yt="AV",zt="FullScore",Ht="Connected",Ft="Loading",Xt="READY",jt="Reconnecting",Gt="Error",Qt="visible",Wt="hidden",Zt="none",qt="<",Jt=">",Kt="green",$t="red",ei="orange",ti="yellow",ii="white",ni="black",ri="blue",ai="grey",oi="lightgrey",si=Zt,li=si,ci=ii,fi=Kt,di=$t,ui=ei,vi=ri,pi=ai,Si=Kt,mi=$t,Ii=ei,gi=ii,bi=ii,Pi=ni,yi="PART_REG",xi="PART_READY",Ti="PING",ki="SELECT_ISLOT",Ei="part",hi="serverTime",Ni="isActive",Ai="isPlay",Li="beatNo",Bi="csvInstruments",wi="slotNo",Oi="slotInstrument",Ci="overlayType",Ri="overlayElement",Di="overlayLineY",_i="isEnabled",Mi="opacity",Vi="colour",Ui="img/blankStave.png",Yi="p0";var zi=["/audio/violin-tuning.mp3"],Hi=null,Fi=null,Xi={connectionPreference:"ws,sse,poll",defaultConnectionType:t.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",pageNoToken:"@PgNo@",instToken:"@Inst@",slotNoToken:"@SlotNo@",pageIdPrefix:"p",tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",idParts:"parts",idPartsListOuterDiv:"partListOuterDiv",idInstrument:"part",idInstControls:"instControls",idInstSlotPrefix:"instSlot",idInstSlotTxtPrefix:"instSlotTxt",idInstSlotBtnPrefix:"instSlotRect",idTempoBpm:"tmpBpm",idSemaphorePrefix:"semC",idLineSuffix:"Line",idBridgeSuffix:"Bridge",idOrdSuffix:"Ord",idRectSuffix:"Rect",blankPageUrl:"img/blankStave.png",filterOutParts:[Yt,zt],connectedRectStyle:{fill:fi,stroke:Si,"stroke-width":"0px",visibility:Qt,opacity:1},disconnectedRectStyle:{fill:di,stroke:mi,"stroke-width":"1px",visibility:Qt,opacity:1},errorRectStyle:{fill:ui,stroke:Ii,"stroke-width":"1px",visibility:Qt,opacity:1},connectedTxtStyle:{fill:gi},disconnectedTxtStyle:{fill:bi},errorTxtStyle:{fill:Pi},activeStaveStyle:{fill:li,stroke:vi,"stroke-width":"1px",visibility:Qt,opacity:.5},inactiveStaveStyle:{fill:ci,stroke:pi,"stroke-width":"1px",visibility:Qt,opacity:.4},instSlotBtnActiveStyle:{fill:ii,stroke:ni,"stroke-width":"1px",visibility:Qt,opacity:1},instSlotBtnActiveInstStyle:{fill:"#d7f2cd",stroke:ni,"stroke-width":"1px",visibility:Qt,opacity:1},instSlotBtnInActiveStyle:{fill:oi,stroke:Zt,visibility:Qt,opacity:1},instSlotTxtActiveStyle:{fill:ni,visibility:Qt,opacity:1},instSlotTxtInActiveStyle:{fill:ni,stroke:Zt,visibility:Wt,opacity:0},instSlotActiveAttrib:{filter:"url(#dropshadow)"},instSlotInActiveAttrib:{filter:"none"},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},errorBtnAttrib:{filter:"url(#dropshadow)"},topStave:{gId:"stvTop",imgId:"stvTopImg",startLineId:"stvTopStartLine",positionLineId:"stvTopPosLine",beatBallId:"stvTopBeatBall",maskId:"stvTopMask",ovrlPosId:"ovrlTopPos",ovrlPitchId:"ovrlTopPitch",ovrlSpeedId:"ovrlTopSpeed",ovrlPressId:"ovrlTopPres",ovrlDynId:"ovrlTopDyn",ballYmax:84,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"80",x2:"95",y2:"281"},posBallConf:{cx:"95",cy:"110",r:"4"}},bottomStave:{gId:"stvBot",imgId:"stvBotImg",startLineId:"stvBotStartLine",positionLineId:"stvBotPosLine",beatBallId:"stvBotBeatBall",maskId:"stvBotMask",ovrlPosId:"ovrlBotPos",ovrlPitchId:"ovrlBotPitch",ovrlSpeedId:"ovrlBotSpeed",ovrlPressId:"ovrlBotPres",ovrlDynId:"ovrlBotDyn",ballYmax:305,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"301",x2:"95",y2:"502"},posBallConf:{cx:"95",cy:"331",r:"4"}}},ji={isPlaying:!1,isReady:!1,score:{title:"ZScore",noSpaceTitle:"ZScore",instrument:"Part View",parts:["Part View"],firstPageNo:1,lastPageNo:2},part:{name:"Part View",imgDir:null,imgPageNameToken:null,imgContPageName:null,blankPageNo:0,contPageNo:6666,pageRanges:[{start:1,end:1}],pages:{}},topStave:{id:"topStave",config:Xi.topStave,pageId:Yi,rndPageId:null,filename:Ui,beatMap:null,timeline:null,isActive:!0,isPlaying:!1,currentBeat:null},bottomStave:{id:"bottomStave",config:Xi.bottomStave,pageId:Yi,rndPageId:null,filename:Ui,beatMap:null,timeline:null,isActive:!1,isPlaying:!1,currentBeat:null},startTimeTl:0,currentBeatId:"b0",currentBeatNo:0,tempo:0,tempoModifier:1,scoreDir:"/score/",currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,isConnected:!1,isInitialised:!1,connectionType:null,pageNoToLoad:0};return c.prototype.loadImg=function(e){this.img.src=e,this.img.onload=function(){Rt("pageImgOnLoad: id: "+this.pageId),oe(this.pageId)}},{onStateBtn:function(){I()},onPartSelect:function(e){g(e)},onInstrumentSelect:function(e,t){b(e,t)}}}(zsUtil,zsNet,zsSvg,zsAudio,zsMusic,window,document);