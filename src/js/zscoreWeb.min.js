var zscore=function(t,e,n,i,r,o,s){"use strict";function c(t){this.message=t,this.name="ZScoreException"}function a(t,e){this.id="partBtn"+t,this.class="partListButton",this.onclick="onPartSelect('"+e+"')"}function l(){}function u(){if(!ht.isInitialised){if(!(t&&e&&n&&i&&r))throw new c("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");t.setRunMode(Y),K("init: "),yt=t.isTouchDevice(),Bt=t.isSafari(navigator),K("init: IsTouch Device: "+yt+" isSafari: "+Bt),ht.fontCanvas=s.createElement("canvas"),ht.canvasCtx=ht.fontCanvas.getContext("2d"),t.listen("resize",o,y),t.listen("orientationchange",o,y),v(),b(),S(),ht.isInitialised=!0}}function d(){ht.isInitialised?(K("onStateBtnClick: zscore initialised"),e.isConnected()||(K("onStateBtnClick: zscore not connected, reconnecting..."),P())):(K("onStateBtnClick: initialising"),u())}function f(e){t.arrContains(ht.parts,e)?(ht.instrument=e,L(e),t.makeInVisible(wt.idPartsListOuterDiv)):K("onPartSelection: unexpected part: "+e)}function p(t){}function m(){T()}function v(){e.init(wt.connectionPreference,wt.appUrlSse,wt.appUrlWebsockets,wt.appUrlHttp,A,B)}function S(){H(i)?F("initAudio: invalid zsAudio lib"):i.init(bt,0)}function T(){H(i)?F("resetAudio: invalid zsAudio lib"):i.reset()}function b(){n.init()}function y(e){if(!t.isObject(this))return null}function B(t,n){switch(t){case e.OPEN:h(n);break;case e.CLOSED:w(n);break;case e.ERROR:x(n);break;default:F("Unknown Connection Event State: "+t+" for type: "+n)}}function h(t){K(t+" connection opened."),E(t)}function w(t){K(t+" connection closed."),g(t)}function x(t){K(t+" connection error."),k(t)}function E(t){ht.isConnected=!0,ht.connectionType=t,ht.reconnectAttmpts=0,C(wt.connectedRectStyle,wt.connectedBtnAttrib,wt.connectedTxtStyle,Q)}function g(t){ht.isConnected=!1,C(wt.disconnectedRectStyle,wt.disconnectedBtnAttrib,wt.disconnectedTxtStyle,X),P(t)}function k(t){ht.isConnected=!1,C(wt.errorRectStyle,wt.errorBtnAttrib,wt.errorTxtStyle,$),P(t)}function C(e,n,i,r){var o=t.getElement(wt.idServerStatusRect);H(o)||W(o,e);var s=t.getElement(wt.idServerStatusBtn);H(s)||q(s,n);var c=t.getElement(wt.idServerStatusTxt);H(c)||(W(c,i),c.textContent=r)}function P(t){e.reconnect(t,!0)}function A(t,e){ht.isConnected||E(),H(t)||(e||m(),Z(t.scoreInfo)&&I(t.scoreInfo),Z(t.part)&&O(t.part),Z(t.actions)&&V(t.actions))}function I(e){t.isObject(e)&&(Z(e.title)&&R(e.title),Z(e.instruments)&&D(e.instruments),Z(e.bpm)&&z(e.bpm))}function R(t){ht.title!==t&&(ht.title=t,n.setElementText(wt.idTitle,t))}function z(t){ht.tempo!==t&&(ht.tempo=t,n.setElementText(wt.idTempoBpm,t))}function O(t){ht.instrument=t,n.setElementText(wt.idInstrument,t)}function D(e){var n=[];t.isArray(e)?n=e:n.push(e),t.arrEquals(ht.parts,n)||(ht.parts=n),U(n)?L(ht.instrument):N(n)}function U(e){if(H(ht.instrument)||!t.isArray(e))return!1;for(var n=ht.instrument,i=0;i<e.length;i++)if(n===e[i])return!0;return!1}function N(e){var n=t.getElement(wt.idParts);if(!H(n)){t.removeElementChildren(n);for(var i=0;i<e.length;i++){var r=e[i];if(!t.arrContains(wt.filterOutParts,r)){var o=new a(i+1,r),s=t.createDiv(),c=t.createButton(o);t.setText(c,r),t.addChildToParent(s,c),t.addChildToParent(n,s)}}t.makeVisible(wt.idPartsListOuterDiv)}}function L(t){var n=new l;n[St]=t,e.sendEvent(mt,n)}function M(t){var n=new l;n[Tt]=t,e.sendEvent(vt,n)}function V(e){var n=null,i=[],r={};if(t.isArray(e))for(var o=0;o<e.length;o++){var s=e[o];Z(s.type)&&(n=s.type),Z(s.targets)&&(i=s.targets),Z(s.params)&&(r=s.params),j(n,i,r)}}function j(t,e,n){if(K("doAction: "+t),!H(t))switch(t){case"PING":G(n);break;default:F("doAction: Unknown actionType: "+t)}}function G(e){t.isObject(e)&&Z(e.sendTimeMs)&&M(e.sendTimeMs)}function W(e,n){t.setElementStyleProperty(e,n)}function q(e,n){t.setElementAttributes(e,n)}function H(e){return t.isNull(e)}function Z(e){return t.isNotNull(e)}function F(e){t.logError(e)}function K(e){t.log(e)}const Y="DEV",_="AV",J="FullScore",Q="Connected",X="Reconnecting",$="Error",tt="green",et="red",nt="orange",it="white",rt="black",ot=tt,st=et,ct=nt,at=tt,lt=et,ut=nt,dt=it,ft=it,pt=rt,mt="PART_REG",vt="PING",St="part",Tt="serverTime";var bt=["/audio/violin-tuning.mp3"],yt=null,Bt=null,ht={isRunning:!1,tsBaseBeatMaps:{},startTimeTl:0,currentBeatId:"b0",tempo:0,topStaveTimeline:{},bottomStaveTimeline:{},lastTimelineBeatNo:0,currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,parts:[],instrument:"Part View",title:"ZScore",isConnected:!1,isInitialised:!1,connectionType:null},wt={connectionPreference:"ws,sse,poll",defaultConnectionType:e.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",idParts:"parts",idPartsListOuterDiv:"partListOuterDiv",idInstrument:"part",idTempoBpm:"tmpBpm",filterOutParts:[_,J],connectedRectStyle:{fill:ot,stroke:at,"stroke-width":"0px",visibility:"visible",opacity:1},disconnectedRectStyle:{fill:st,stroke:lt,"stroke-width":"1px",visibility:"visible",opacity:1},errorRectStyle:{fill:ct,stroke:ut,"stroke-width":"1px",visibility:"visible",opacity:1},connectedTxtStyle:{fill:dt},disconnectedTxtStyle:{fill:ft},errorTxtStyle:{fill:pt},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},errorBtnAttrib:{filter:"url(#dropshadow)"}};return{onStateBtn:function(){d()},onPartSelect:function(t){f(t)},onInstrumentSelect:function(t){p(t)}}}(zsUtil,zsNet,zsSvg,zsAudio,zsMusic,window,document);