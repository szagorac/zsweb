var zscore=function(e,t,i,n,a,r,o){"use strict";function s(e){this.message=e,this.name="ZScoreException"}function l(e,t,i,n,a,r,o,s){this.xStart=e,this.xEnd=t,this.yStart=i,this.yEnd=n,this.beatStartNum=a,this.beatStartDenom=r,this.beatEndNum=o,this.beatEndDenom=s}function c(e,t,i,n){this.id=e,this.no=t,this.imgFileName=i,this.imgFileUrl=n,this.isLoaded=!1,this.img=new Image,this.img.pageId=e}function f(e,t){this.id="partBtn"+e,this.class="partListButton",this.onclick="onPartSelect('"+t+"')"}function d(e,t){this.onclick="onInstrumentSelect("+e+",'"+t+"')"}function u(){this.onclick=""}function v(){}function p(){if(!Ui.isInitialised){if(!(e&&t&&i&&n&&a))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");e.setRunMode(At),Lt("init: "),_i=e.isTouchDevice(),Mi=e.isSafari(navigator),Lt("init: IsTouch Device: "+_i+" isSafari: "+Mi),Ui.fontCanvas=o.createElement("canvas"),Ui.canvasCtx=Ui.fontCanvas.getContext("2d"),e.listen("resize",r,E),e.listen("orientationchange",r,E),y(),k(),x(),Ui.isInitialised=!0}}function S(){m(Ui.topStave),m(Ui.bottomStave)}function m(t){if(!Et(t)&&!Et(t.config)){var i=t.config;e.setElementIdAttributes(i.positionLineId,i.posLineConf),e.setElementIdAttributes(i.beatBallId,i.posBallConf)}}function I(){Ui.isInitialised?(Lt("onStateBtnClick: zscore initialised"),t.isConnected()||(Lt("onStateBtnClick: zscore not connected, reconnecting..."),R())):(Lt("onStateBtnClick: initialising"),p())}function g(t){e.arrContains(Ui.score.parts,t)?(Ui.part.name=t,Ee(t),e.makeInVisible(Vi.idPartsListOuterDiv)):Lt("onPartSelection: unexpected part: "+t)}function b(e,t){Et(e)||Et(t)||Et(Ui.part.name)||Le(e,t,Ui.part.name)}function P(){T()}function y(){t.init(Vi.connectionPreference,Vi.appUrlSse,Vi.appUrlWebsockets,Vi.appUrlHttp,D,h)}function x(){Et(n)?Nt("initAudio: invalid zsAudio lib"):n.init(Di,0)}function T(){Et(n)?Nt("resetAudio: invalid zsAudio lib"):n.reset()}function k(){i.init()}function E(t){if(!e.isObject(this))return null}function h(e,i){switch(e){case t.OPEN:N(i);break;case t.CLOSED:L(i);break;case t.ERROR:B(i);break;default:Nt("Unknown Connection Event State: "+e+" for type: "+i)}}function N(e){Lt(e+" connection opened."),A(e)}function L(e){Lt(e+" connection closed."),w(e)}function B(e){Lt(e+" connection error."),O(e)}function A(e){Ui.isConnected=!0,Ui.connectionType=e,Ui.reconnectAttmpts=0,C(Vi.connectedRectStyle,Vi.connectedBtnAttrib,Vi.connectedTxtStyle,_t)}function w(e){Ui.isConnected=!1,C(Vi.disconnectedRectStyle,Vi.disconnectedBtnAttrib,Vi.disconnectedTxtStyle,Ut),R(e)}function O(e){Ui.isConnected=!1,C(Vi.errorRectStyle,Vi.errorBtnAttrib,Vi.errorTxtStyle,Yt),R(e)}function C(t,i,n,a){var r=e.getElement(Vi.idServerStatusRect);Et(r)||Tt(r,t);var o=e.getElement(Vi.idServerStatusBtn);Et(o)||kt(o,i);var s=e.getElement(Vi.idServerStatusTxt);Et(s)||(Tt(s,n),s.textContent=a)}function R(e){t.reconnect(e,!0)}function D(e,t){Ui.isConnected||A(),Et(e)||(t||P(),ht(e.scoreInfo)&&_(e.scoreInfo),ht(e.partInfo)&&ce(e.partInfo),ht(e.pageInfo)&&te(e.pageInfo),ht(e.mapInfo)&&z(e.mapInfo),ht(e.bpm)&&0!=e.bpm&&Y(e.bpm),ht(e.actions)&&Be(e.actions))}function _(t){e.isObject(t)&&(ht(t.title)&&M(t.title),ht(t.instruments)&&xe(t.instruments),ht(t.bpm)&&U(t.bpm),ht(t.scoreDir)&&V(t.scoreDir))}function M(t){Ui.score.title!==t&&(Ui.score.title=t,Ui.score.noSpaceTitle=e.replaceEmptySpaces(t,Ot),i.setElementText(Vi.idTitle,t))}function V(e){Ui.scoreDir!==e&&(Ui.scoreDir=e)}function U(e){Ui.tempo!==e&&(Ui.tempo=e,i.setElementText(Vi.idTempoBpm,e))}function Y(t){var i=e.toInt(t);if(!Et(i)){var n=Ui.tempo,a=i/n;Ui.tempoModifier=a,U(i),Ui.isPlaying?F(a):j()}}function z(t){if(!Et(t.map)&&!Et(t.pageId)){t.pageId;var i=t.staveId,n=t.map,a=Ui[i];if(!Et(a)){var r=a.config.xLeftMargin,o=JSON.parse(JSON.stringify(n));if(e.isArray(o)){for(var s={},l=0;l<o.length;l++)H(s,o[l],r);a.beatMap=s,G(i)}}}}function H(e,t,i){if(!(Et(e)||Et(t)||Et(t.beatStartNum))){var n=t.beatStartNum,a=t.xStart+i,r=t.xEnd+i,o=new l(a,r,t.yStart,t.yEnd,n,t.beatStartDenom,t.beatEndNum,t.beatEndDenom);e[n]=o}}function F(e){X(Ui.topStave.timeline,e),X(Ui.bottomStave.timeline,e)}function X(e,t){if(!Et(e)){var i=e.timeScale(),n=i*t;e.timeScale(n)}}function j(){Q(Ui.topStave),Q(Ui.bottomStave)}function G(e){Et(e)||Q(Ui[e])}function Q(e){if(!Et(e)){var t=gsap.timeline({onComplete:J,onCompleteParams:[e.id],paused:!0}),i=e.beatMap;if(!Et(i)){var n=e.config.positionLineId,r=e.config.beatBallId,o=e.config.ballYmax,s=!0;for(var l in i){var c=i[l],f=Ui.tempo,d=a.getBeatDurationSec(f),u=c.beatStartNum;if(s){var v=Vi.beatIdPrefix+(u-1),p=c.xStart,S=W(n,0,p,v,0);t.add(S,Xt);var m=Z(r,0,p,v);t.add(m,jt),s=!1}p=c.xEnd,v=Vi.beatIdPrefix+u;var I=Vi.tweenIdPrefix+v,g=W(n,d,p,v,u),b=Z(r,d,p,v),P=q(r,d/2,o,v);I=g.vars.id;t.addLabel(I,jt),t.add(g,jt),t.add(b,Xt),t.add(P,I)}ht(e.currentBeat)&&lt(t,e.currentBeat),e.timeline=t}}}function W(t,i,n,a,r){var o=Vi.tweenIdPrefix+a;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{x1:n,x2:n},ease:"none",onStart:K,onStartParams:[a,r],onComplete:$,onCompleteParams:[a,r]})}function Z(t,i,n,a){var r=Vi.ballTweenIdPrefix+a;return gsap.to(e.toCssIdQuery(t),{id:r,duration:i,attr:{cx:n},ease:"none"})}function q(t,i,n,a){var r=Vi.ballTweenIdPrefix+a;return gsap.to(e.toCssIdQuery(t),{id:r,duration:i,attr:{cy:n,r:2},ease:"power1.out",autoAlpha:.5,repeat:1,yoyo:!0})}function J(e){Bt("onTimelineComplete stave: "+e);var t=Ui[e];ht(t)&&(t.isRunning=!1),ht(t.timeline)&&t.timeline.pause(0)}function K(e,t){var i=n.getCurrentTime();Ui.audioTlBeatTime=i,Bt("onBeatStart: beat: "+e+" beatNo: "+t+" beatTime: "+i),ee(t,e)}function $(e,t){var i=n.getCurrentTime(),a=i-Ui.startTimeTl;Bt("onBeatEnd: beat: "+e+" beatNo: "+t+" elapsedTime: "+a)}function ee(t,i){e.isNumeric(t)&&(e.isNull(i)&&(i=Vi.beatIdPrefix+t),Ui.currentBeatId=i,Ui.currentBeatNo=t)}function te(e){if(!Et(e.staveId)){var t=e.staveId,i=Ui[t];Et(i)?Nt("processPageinfo: Invalid stave for id: {}",t):(ht(e.filename)&&(i.filename=e.filename),ht(e.pageId)&&(i.pageId=e.pageId),ht(e.rndPageId)?i.rndPageId=e.rndPageId:i.rndPageId=null,ie(i))}}function ie(t){if(!Et(t)){var i=t.config;if(!Et(i)){var n=null,a=t.pageId;ht(t.rndPageId)&&(a=t.rndPageId);var r=re(a);n=Et(r)?ae(t.fileName):r.src;var o=e.getElement(i.imgId);o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),o.setAttribute("href",n)}}}function ne(t){if(!Et(t)){var i=t.config;if(!Et(i)){var n=t.fileName,a=e.getElement(i.imgId);a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),a.setAttribute("href",n)}}}function ae(e){return Ui.scoreDir+Ui.score.noSpaceTitle+Ct+e}function re(e){var t=Ui.part.pages[e];return Et(t)?null:t.img}function oe(e){var t=Ui.part.pages[e];ht(t)&&(t.isLoaded=!0),Ui.pageNoToLoad--,0===Ui.pageNoToLoad&&le(),se(Ui.pageNoToLoad)}function se(e){if(e>0){var t=Mt+" "+e;C(Vi.errorRectStyle,Vi.errorBtnAttrib,Vi.errorTxtStyle,t)}else C(Vi.connectedRectStyle,Vi.connectedBtnAttrib,Vi.connectedTxtStyle,Vt)}function le(){Lt("onPageLoadComplete: ");var e=Ui.part.pages,t=!0;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n.isLoaded||(Lt("onPageLoadComplete: page: "+i+" is not loaded, retying load"),pe(n.no),t=!1)}t&&(Lt("All Pages loaded: "),Ui.isReady=!0,he())}function ce(t){if(ht(t.name)&&(Ui.part.name=t.name,i.setElementText(Vi.idInstrument,t.name)),ht(t.pageRanges)){var n=t.pageRanges;if(e.isArray(n))for(var a=0;a<n.length;a++)ye(n[a]);else ye(n)}ht(t.imgDir)&&(Ui.part.imgDir=t.imgDir),ht(t.imgPageNameToken)&&(Ui.part.imgPageNameToken=t.imgPageNameToken),ht(t.imgContPageName)&&(Ui.part.imgContPageName=t.imgContPageName),ht(t.contPageNo)&&(Ui.part.contPageNo=t.contPageNo),fe()}function fe(){var t=Ui.part,i=t.pageRanges;if(e.isArray(i)){for(var n=0;n<i.length;n++)ve(i[n]);de(),ue()}}function de(){var e=ge();Ui.pageNoToLoad++,Se(e)}function ue(){var e=Ie();Ui.pageNoToLoad++,Se(e)}function ve(t){if(e.isObject(t)){var i=1,n=1;ht(t.start)&&(i=e.toInt(t.start)),ht(t.end)&&(n=e.toInt(t.end));var a=Ui.pageNoToLoad+(n-i+1);Ui.pageNoToLoad=a;for(var r=i;r<=n;r++)pe(r)}}function pe(e){var t=me(e);Se(t)}function Se(e){if(!Et(e)){var t=e.imgFileUrl;Et(t)||e.loadImg(t,e.id)}}function me(t){var i=Pe(t),n=Ui.part.pages[i];if(ht(n))return n;var a=Ui.part.imgPageNameToken;a=Et(a)?be(t):e.replace(a,Vi.pageNoToken,""+t);var r=Ui.part.imgDir+a;n=new c(i,t,a,r);return Ui.part.pages[i]=n,n}function Ie(){var e=Ui.part.contPageNo,t=Pe(e),i=Ui.part.pages[t];if(ht(i))return i;var n=Ui.part.imgContPageName,a=Ui.part.imgDir+n;i=new c(t,e,n,a);return Ui.part.pages[t]=i,i}function ge(){var e=Ui.part.blankPageNo,t=Pe(e),i=Ui.part.pages[t];if(ht(i))return i;var n=Vi.blankPageUrl,a=Vi.blankPageUrl;i=new c(t,e,n,a);return Ui.part.pages[t]=i,i}function be(e){return Ui.score.noSpaceTitle+Ot+instrumentName+"_page"+e+".png"}function Pe(e){return Vi.pageIdPrefix+e}function ye(e){if(!(Et(e)||Et(e.start)||Et(e.end))){var t=e.start,i=e.end,n={start:t,end:i};Ui.part.pageRanges=[],Ui.part.pageRanges.push(n)}}function xe(t){var i=[];if(e.isArray(t))for(var n=0;n<t.length;n++){var a=t[n];e.arrContains(Vi.filterOutParts,a)||i.push(a)}else e.arrContains(Vi.filterOutParts,a)||i.push(t);e.arrEquals(Ui.score.parts,i)||(Ui.score.parts=i),Te(i)?Ee(Ui.part.name):ke(i)}function Te(t){if(Et(Ui.part.name)||!e.isArray(t))return!1;for(var i=Ui.part.name,n=0;n<t.length;n++)if(i===t[n])return!0;return!1}function ke(t){var i=e.getElement(Vi.idParts);if(!Et(i)){e.removeElementChildren(i);for(var n=0;n<t.length;n++){var a=t[n];if(!e.arrContains(Vi.filterOutParts,a)){var r=new f(n+1,a),o=e.createDiv(),s=e.createButton(r);e.setText(s,a),e.addChildToParent(o,s),e.addChildToParent(i,o)}}e.makeVisible(Vi.idPartsListOuterDiv)}}function Ee(e){var i=new v;i[bi]=e,t.sendEvent(Si,i)}function he(){var e=new v;e[bi]=Ui.part.name,t.sendEvent(mi,e)}function Ne(e){var i=new v;i[Pi]=e,t.sendEvent(Ii,i)}function Le(e,i,n){var a=new v;a[Ei]=e,a[hi]=i,a[bi]=n,t.sendEvent(gi,a)}function Be(t){var i=null,n=[],a={};if(e.isArray(t))for(var r=0;r<t.length;r++){var o=t[r];ht(o.type)&&(i=o.type),ht(o.targets)&&(n=o.targets),ht(o.params)&&(a=o.params),Ae(i,n,a)}}function Ae(t,i,n){if(e.logDebug("doAction: "+t),!Et(t))switch(t){case"PING":xt(n);break;case"START":we(gt,i,null);break;case"STOP":It();break;case"SEMAPHORE_ON":dt(n);break;case"SEMAPHORE_OFF":ut(n);break;case"ACTIVATE":we(ct,i,n);break;case"BEAT":we(ot,i,n);break;case"START_MARK":we(nt,i,n);break;case"INSTRUMENT_SLOTS":Ze(n);break;case"RESET_INSTRUMENT_SLOTS":We();break;case"RESET_STAVES":Ge();break;case"OVERLAY_ELEMENT":we(Ve,i,n);break;case"OVERLAY_LINE":we(De,i,n);break;case"OVERLAY_COLOUR":we(Oe,i,n);break;default:Nt("doAction: Unknown actionType: "+t)}}function we(t,i,n){if(!Et(t))if(e.isArray(i))for(var a=0;a<i.length;a++)t(i[a],n);else t(target,n)}function Oe(e,t){if(!Et(t)&&!Et(e)){var i=Ui[e],n=t[Ni],a=t[Oi];Ce(i,n,a)}}function Ce(e,t,i){if(!(Et(e)||Et(t)||Et(i)))switch(t){case"POSITION":Re(e.config.ovrlPosId+Vi.idRectSuffix,i);break;case"PITCH":Re(e.config.ovrlPitchId+Vi.idRectSuffix,i);break;case"SPEED":Re(e.config.ovrlSpeedId+Vi.idRectSuffix,i);break;case"PRESSURE":Re(e.config.ovrlPressId+Vi.idRectSuffix,i);break;case"DYNAMICS":Re(e.config.ovrlDynId+Vi.idRectSuffix,i);break;default:Lt("setOverlayColour: unknown overlay type: "+t)}}function Re(t,i){e.setElementIdStyleProperty(t,{fill:i})}function De(e,t){if(!Et(t)&&!Et(e)){var i=Ui[e],n=t[Ni],a=t[Bi];_e(i,n,a)}}function _e(e,t,i){if(!(Et(e)||Et(t)||Et(i)))switch(t){case"POSITION":Me(e.config.ovrlPosId+Vi.idLineSuffix,i);break;case"PITCH":Me(e.config.ovrlPitchId+Vi.idLineSuffix,i);break;case"SPEED":Me(e.config.ovrlSpeedId+Vi.idLineSuffix,i);break;case"PRESSURE":Me(e.config.ovrlPressId+Vi.idLineSuffix,i);break;case"DYNAMICS":Me(e.config.ovrlDynId+Vi.idLineSuffix,i);break;default:Lt("setOverlayElement: unknown overlay type: "+t)}}function Me(t,n){var a=e.getElement(t);i.setLineY(a,n,n)}function Ve(e,t){if(!Et(t)&&!Et(e)){var i=Ui[e],n=t[Ni],a=t[Li],r=t[Ai],o=t[wi];Ue(i,n,a,r,o)}}function Ue(e,t,i,n,a){if(!Et(e)&&!Et(t)){var r=e.config;if(!Et(r))switch(Bt("setOverlayElement: overlayType: "+t),t){case"POSITION":Xe(r,i,n,a);break;case"PITCH":Fe(r,i,n,a);break;case"SPEED":He(r,i,n,a);break;case"PRESSURE":ze(r,i,n,a);break;case"DYNAMICS":Ye(r,i,n,a);break;default:Lt("setOverlayElement: unknown overlay type: "+t)}}}function Ye(e,t,i,n){if(!Et(t)&&!Et(e))switch(t){case"DYNAMICS_BOX":je(e.ovrlDynId+Vi.idRectSuffix,i,n),je(e.ovrlDynId+Vi.idOrdSuffix+Vi.idLineSuffix,i,n),je(e.ovrlDynId,i,n),i||je(e.ovrlDynId+Vi.idLineSuffix,i,n);break;case"DYNAMICS_MID_LINE":je(e.ovrlDynId+Vi.idOrdSuffix+Vi.idLineSuffix,i,n);break;case"DYNAMICS_LINE":je(e.ovrlDynId+Vi.idLineSuffix,i,n);break;default:Lt("setOverlayElement: unknown overlay type: "+t)}}function ze(e,t,i,n){if(!Et(t)&&!Et(e))switch(t){case"PRESSURE_BOX":je(e.ovrlPressId+Vi.idRectSuffix,i,n),je(e.ovrlPressId+Vi.idOrdSuffix+Vi.idLineSuffix,i,n),je(e.ovrlPressId,i,n),i||je(e.ovrlPressId+Vi.idLineSuffix,i,n);break;case"PRESSURE_MID_LINE":je(e.ovrlPressId+Vi.idOrdSuffix+Vi.idLineSuffix,i,n);break;case"PRESSURE_LINE":je(e.ovrlPressId+Vi.idLineSuffix,i,n);break;default:Lt("setOverlayElement: unknown overlay type: "+t)}}function He(e,t,i,n){if(!Et(t)&&!Et(e))switch(t){case"SPEED_BOX":je(e.ovrlSpeedId+Vi.idRectSuffix,i,n),je(e.ovrlSpeedId+Vi.idOrdSuffix+Vi.idLineSuffix,i,n),je(e.ovrlSpeedId,i,n),i||je(e.ovrlSpeedId+Vi.idLineSuffix,i,n);break;case"SPEED_MID_LINE":je(e.ovrlSpeedId+Vi.idOrdSuffix+Vi.idLineSuffix,i,n);break;case"SPEED_LINE":je(e.ovrlSpeedId+Vi.idLineSuffix,i,n);break;default:Lt("setOverlayElement: unknown overlay type: "+t)}}function Fe(e,t,i,n){if(!Et(t)&&!Et(e))switch(t){case"PITCH_BOX":je(e.ovrlPitchId+Vi.idRectSuffix,i,n),je(e.ovrlPitchId,i,n),i||je(e.ovrlPitchId+Vi.idLineSuffix,i,n);break;case"PITCH_LINE":je(e.ovrlPitchId+Vi.idLineSuffix,i,n);break;default:Lt("setOverlayElement: unknown overlay type: "+t)}}function Xe(e,t,i,n){if(!Et(t)&&!Et(e))switch(t){case"POSITION_BOX":je(e.ovrlPosId+Vi.idRectSuffix,i,n),je(e.ovrlPosId+Vi.idOrdSuffix+Vi.idLineSuffix,i,n),je(e.ovrlPosId+Vi.idBridgeSuffix+Vi.idLineSuffix,i,n),je(e.ovrlPosId,i,n),i||je(e.ovrlPosId+Vi.idLineSuffix,i,n);break;case"POSITION_LINE":je(e.ovrlPosId+Vi.idLineSuffix,i,n);break;case"POSITION_BRIDGE_LINE":je(e.ovrlPosId+Vi.idBridgeSuffix+Vi.idLineSuffix,i,n);break;case"POSITION_ORD_LINE":je(e.ovrlPosId+Vi.idOrdSuffix+Vi.idLineSuffix,i,n);break;default:Lt("setOverlayElement: unknown overlay type: "+t)}}function je(t,i,n){if(!Et(t))if(i){var a=e.toFloat(n);e.isNumeric(a)||(a=1),e.setElementIdStyleProperty(t,{opacity:a}),e.makeVisible(t)}else e.makeInVisible(t)}function Ge(){Qe(Ui.topStave),Qe(Ui.bottomStave)}function Qe(e){Et(e)||(e.pageId=Ri,e.rndPageId=null,e.filename=Ci,e.beatMap=null,e.timeline=null,e.isActive=!0,e.isPlaying=!1,e.currentBeat=null,m(e),ne(e))}function We(){$e(),Je()}function Ze(e){if(!Et(e)){var t=e[ki];Ke(t),qe()}}function qe(){e.makeVisible(Vi.idInstControls)}function Je(){e.makeInVisible(Vi.idInstControls)}function Ke(t){if(!Et(t)){var i=e.csvToArr(t);if(!(Et(i)||i.length<=0)){var n=Ui.score.parts;if(!(Et(n)||n.length<=0))for(var a=0;a<n.length;a++){var r=a+1;a<i.length?et(i[a],r):tt(r)}}}}function $e(){var e=Ui.score.parts;if(!(Et(e)||e.length<=0))for(var t=0;t<e.length;t++){var i=t+1;it(i)}}function et(t,n){if(!Et(t)&&!Et(n)){var a=Vi.idInstSlotTxtPrefix+n,r=Vi.idInstSlotBtnPrefix+n,o=Vi.idInstSlotPrefix+n,s=t===Ui.part.name;e.makeVisible(a),e.makeVisible(r),e.makeVisible(o),e.setElementIdAttributes(o,Vi.instSlotActiveAttrib),i.setElementText(a,t.trim()),e.setElementIdStyleProperty(a,Vi.instSlotTxtActiveStyle),s?e.setElementIdStyleProperty(r,Vi.instSlotBtnActiveInstStyle):e.setElementIdStyleProperty(r,Vi.instSlotBtnActiveStyle);var l=new d(n,t);e.setElementIdAttributes(r,l)}}function tt(t){var n=Vi.idInstSlotTxtPrefix+t,a=Vi.idInstSlotBtnPrefix+t,r=Vi.idInstSlotPrefix+t;e.makeVisible(n),e.makeVisible(a),e.makeVisible(r),e.setElementIdAttributes(r,Vi.instSlotInActiveAttrib),i.setElementText(n,wt),e.setElementIdStyleProperty(n,Vi.instSlotTxtInActiveStyle),e.setElementIdStyleProperty(a,Vi.instSlotBtnInActiveStyle);var o=new u;e.setElementIdAttributes(a,o)}function it(t){var i=Vi.idInstSlotTxtPrefix+t,n=Vi.idInstSlotBtnPrefix+t,a=Vi.idInstSlotPrefix+t;e.makeInVisible(i),e.makeInVisible(n),e.makeInVisible(a);var r=new u;e.setElementIdAttributes(n,r)}function nt(e,t){if(!Et(t)&&!Et(e)){var n=Ui[e],a=t[Ti];if(!Et(n)&&!Et(a)){var r=n.beatMap;if(!Et(r)){var o=r[a];if(!Et(o)){var s=o.xStart-1,l=at(n);i.setLineX(l,s,s),rt(l,!0)}}}}}function at(t){return e.getElement(t.config.startLineId)}function rt(t,i){i?e.makeElementVisible(t):e.makeElementInVisible(t)}function ot(e,t){if(!Et(t)&&!Et(e)){var i=Ui[e],n=t[Ti];st(i,n)}}function st(e,t){if(!Et(e)&&!Et(t)){var i=n.getCurrentTime();Bt("setStaveBeat: stave: "+e.id+" beat: "+t+" time: "+i),lt(e.timeline,t),e.currentBeat=t}}function lt(e,t){if(!Et(e)){var i=Vi.tweenIdPrefix+Vi.beatIdPrefix+t,n=e.labels;i in n?e.seek(i):Bt("setTimelineBeat: Invalid beat "+i)}}function ct(e,t){if(!Et(t)&&!Et(e)){var i=Ui[e],n=t[yi],a=t[xi];ft(i,n,a)}}function ft(t,i,n){if(!(Et(t)||Et(i)||Et(n))){if(i)e.setElementIdStyleProperty(t.config.maskId,Vi.activeStaveStyle);else{e.setElementIdStyleProperty(t.config.maskId,Vi.inactiveStaveStyle);var a=at(t);rt(a,!1)}n&&bt(t.timeline)}}function dt(e){Et(e)||pt(e.lightNo,e.colourId)}function ut(e){Et(e)||St(e.lightNo,ti)}function vt(){St(4,ti),St(1,Qt)}function pt(e,t){var i=mt(t);St(e,i)}function St(t,n){if(!Et(t)&&!Et(n))for(var a=e.toInt(t),r=1;r<=a;r++){var o=Vi.idSemaphorePrefix+r;i.setElementColour(o,n)}}function mt(e){var t;switch(e||(e=1),e){case 4:t=Qt;break;case 3:t=Wt;break;case 2:t=Zt;break;case 1:default:t=Gt}return t}function It(){Pt(),Ui.isPlaying=!1,vt(),S()}function gt(e){if(!Et(e)){var t=Ui[e];if(!Et(t)){var i=t.timeline;Et(i)||(bt(i),Ui.isPlaying=!0)}}}function bt(e){if(Et(e))Nt("startTimeline: invalid timeline");else{var t=e.progress();t>0&&t<1?e.resume():e.play(0)}}function Pt(){yt(Ui.topStave.timeline),yt(Ui.bottomStave.timeline),Ui.bottomStave.isPlaying=!1,Ui.topStave.isPlaying=!1}function yt(e){Et(e)?Nt("stopTimeline: invalid timeline"):e.pause()}function xt(t){e.isObject(t)&&ht(t.sendTimeMs)&&Ne(t.sendTimeMs)}function Tt(t,i){e.setElementStyleProperty(t,i)}function kt(t,i){e.setElementAttributes(t,i)}function Et(t){return e.isNull(t)}function ht(t){return e.isNotNull(t)}function Nt(t){e.logError(t)}function Lt(t){e.log(t)}function Bt(t){e.logDebug(t)}const At="dev",wt="",Ot="_",Ct="/",Rt="AV",Dt="FullScore",_t="Connected",Mt="Loading",Vt="READY",Ut="Reconnecting",Yt="Error",zt="visible",Ht="hidden",Ft="none",Xt="<",jt=">",Gt="green",Qt="red",Wt="orange",Zt="yellow",qt="white",Jt="black",Kt="blue",$t="grey",ei="lightgrey",ti=Ft,ii=ti,ni=qt,ai=Gt,ri=Qt,oi=Wt,si=Kt,li=$t,ci=Gt,fi=Qt,di=Wt,ui=qt,vi=qt,pi=Jt,Si="PART_REG",mi="PART_READY",Ii="PING",gi="SELECT_ISLOT",bi="part",Pi="serverTime",yi="isActive",xi="isPlay",Ti="beatNo",ki="csvInstruments",Ei="slotNo",hi="slotInstrument",Ni="overlayType",Li="overlayElement",Bi="overlayLineY",Ai="isEnabled",wi="opacity",Oi="colour",Ci="img/blankStave.png",Ri="p0";var Di=["/audio/violin-tuning.mp3"],_i=null,Mi=null,Vi={connectionPreference:"ws,sse,poll",defaultConnectionType:t.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",pageNoToken:"@PgNo@",instToken:"@Inst@",slotNoToken:"@SlotNo@",pageIdPrefix:"p",tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",idParts:"parts",idPartsListOuterDiv:"partListOuterDiv",idInstrument:"part",idInstControls:"instControls",idInstSlotPrefix:"instSlot",idInstSlotTxtPrefix:"instSlotTxt",idInstSlotBtnPrefix:"instSlotRect",idTempoBpm:"tmpBpm",idSemaphorePrefix:"semC",idLineSuffix:"Line",idBridgeSuffix:"Bridge",idOrdSuffix:"Ord",idRectSuffix:"Rect",blankPageUrl:"img/blankStave.png",filterOutParts:[Rt,Dt],connectedRectStyle:{fill:ai,stroke:ci,"stroke-width":"0px",visibility:zt,opacity:1},disconnectedRectStyle:{fill:ri,stroke:fi,"stroke-width":"1px",visibility:zt,opacity:1},errorRectStyle:{fill:oi,stroke:di,"stroke-width":"1px",visibility:zt,opacity:1},connectedTxtStyle:{fill:ui},disconnectedTxtStyle:{fill:vi},errorTxtStyle:{fill:pi},activeStaveStyle:{fill:ii,stroke:si,"stroke-width":"1px",visibility:zt,opacity:.5},inactiveStaveStyle:{fill:ni,stroke:li,"stroke-width":"1px",visibility:zt,opacity:.4},instSlotBtnActiveStyle:{fill:qt,stroke:Jt,"stroke-width":"1px",visibility:zt,opacity:1},instSlotBtnActiveInstStyle:{fill:"#d7f2cd",stroke:Jt,"stroke-width":"1px",visibility:zt,opacity:1},instSlotBtnInActiveStyle:{fill:ei,stroke:Ft,visibility:zt,opacity:1},instSlotTxtActiveStyle:{fill:Jt,visibility:zt,opacity:1},instSlotTxtInActiveStyle:{fill:Jt,stroke:Ft,visibility:Ht,opacity:0},instSlotActiveAttrib:{filter:"url(#dropshadow)"},instSlotInActiveAttrib:{filter:"none"},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},errorBtnAttrib:{filter:"url(#dropshadow)"},topStave:{gId:"stvTop",imgId:"stvTopImg",startLineId:"stvTopStartLine",positionLineId:"stvTopPosLine",beatBallId:"stvTopBeatBall",maskId:"stvTopMask",ovrlPosId:"ovrlTopPos",ovrlPitchId:"ovrlTopPitch",ovrlSpeedId:"ovrlTopSpeed",ovrlPressId:"ovrlTopPres",ovrlDynId:"ovrlTopDyn",ballYmax:84,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"80",x2:"95",y2:"281"},posBallConf:{cx:"95",cy:"110",r:"4"}},bottomStave:{gId:"stvBot",imgId:"stvBotImg",startLineId:"stvBotStartLine",positionLineId:"stvBotPosLine",beatBallId:"stvBotBeatBall",maskId:"stvBotMask",ovrlPosId:"ovrlBotPos",ovrlPitchId:"ovrlBotPitch",ovrlSpeedId:"ovrlBotSpeed",ovrlPressId:"ovrlBotPres",ovrlDynId:"ovrlBotDyn",ballYmax:305,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"301",x2:"95",y2:"502"},posBallConf:{cx:"95",cy:"331",r:"4"}}},Ui={isPlaying:!1,isReady:!1,score:{title:"ZScore",noSpaceTitle:"ZScore",instrument:"Part View",parts:["Part View"],firstPageNo:1,lastPageNo:2},part:{name:"Part View",imgDir:null,imgPageNameToken:null,imgContPageName:null,blankPageNo:0,contPageNo:6666,pageRanges:[{start:1,end:1}],pages:{}},topStave:{id:"topStave",config:Vi.topStave,pageId:Ri,rndPageId:null,filename:Ci,beatMap:null,timeline:null,isActive:!0,isPlaying:!1,currentBeat:null},bottomStave:{id:"bottomStave",config:Vi.bottomStave,pageId:Ri,rndPageId:null,filename:Ci,beatMap:null,timeline:null,isActive:!1,isPlaying:!1,currentBeat:null},startTimeTl:0,currentBeatId:"b0",currentBeatNo:0,tempo:0,tempoModifier:1,scoreDir:"/score/",currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,isConnected:!1,isInitialised:!1,connectionType:null,pageNoToLoad:0};return c.prototype.loadImg=function(e){this.img.src=e,this.img.onload=function(){Lt("pageImgOnLoad: id: "+this.pageId),oe(this.pageId)}},{onStateBtn:function(){I()},onPartSelect:function(e){g(e)},onInstrumentSelect:function(e,t){b(e,t)}}}(zsUtil,zsNet,zsSvg,zsAudio,zsMusic,window,document);