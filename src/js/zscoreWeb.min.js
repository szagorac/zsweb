var zscore=function(e,t,n,i,a,r,o){"use strict";function s(e){this.message=e,this.name="ZScoreException"}function u(e,t,n,i,a,r,o,s){this.xStart=e,this.xEnd=t,this.yStart=n,this.yEnd=i,this.beatStartNum=a,this.beatStartDenom=r,this.beatEndNum=o,this.beatEndDenom=s}function c(){ke("onLoad: "),l()}function l(){if(!(e&&t&&n&&i&&a))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");e.setRunMode(Ie),ke("init: "),Ae=e.isTouchDevice(),Ne=e.isSafari(navigator),ke("init: IsTouch Device: "+Ae+" isSafari: "+Ne),xe.fontCanvas=o.createElement("canvas"),xe.canvasCtx=xe.fontCanvas.getContext("2d"),e.listen("resize",r,R),e.listen("orientationchange",r,R),D(),z(),P(),v(),E(),p(),f()}function f(){gsap.ticker.add(d)}function f(){gsap.ticker.add(d)}function d(e,t,n){xe.currentTickTimeSec=e,xe.isRunning&&m()&&T()}function m(){return 0!==xe.nextBeatTickTimeSec&&xe.currentTickTimeSec>=xe.nextBeatTickTimeSec}function T(){xe.tickBeatNo++,xe.audioTickBeatTime=i.getCurrentTime();var e=xe.audioTickBeatTime-xe.audioTlBeatTime;ke("Ticker beat: "+xe.tickBeatNo+" tickTime: "+xe.audioTickBeatTime+" delta: "+e);var t=xe.tempo.bpm,n=a.getBeatDurationSec(t);xe.nextBeatTickTimeSec=xe.currentTickTimeSec+n}function v(){xe.tempo=new a.ZsTempo(80,a.NoteDuration.QUARTER)}function b(){ke("onTimelineComplete"),xe.isRunning=!1}function p(){var e=gsap.timeline({onComplete:b,paused:!0}),t=xe.tsBaseBeatMaps,n=xe.tsBaseBeatTweens,i="posLine",r="beatBall",o="beatLine",s=(a.NoteDuration.QUARTER,!0);for(var u in t){var c=t[u],l=xe.tempo.bpm,f=a.getBeatDurationSec(l);if(s){var d=ye.beatIdPrefix+0,m=c.xStart,T=S(i,0,m,d,0);e.add(T,"<");var v=k(o,0,m,d,0);v.resume(),s=!1}var p=84,I=(m=c.xEnd,c.beatStartNum),w=(d=ye.beatIdPrefix+I,ye.tweenIdPrefix+d),h=S(i,f,m,d,I),A=g(r,f,m,d),N=B(r,f/2,p,d);w=h.vars.id;e.addLabel(w,">"),e.add(h,">"),e.add(A,"<"),e.add(N,w);var x=k(o,f,m,d,I);n[I]=x,xe.lastTimelineBeatNo=I}xe.topStaveTimeline=e}function B(t,n,i,a){var r=ye.ballTweenIdPrefix+a;return ke("creating ball tween: "+r),gsap.to(e.toCssIdQuery(t),{duration:n,attr:{cy:i,r:2},ease:"power1.out",autoAlpha:.5,repeat:1,yoyo:!0})}function g(t,n,i,a){var r=ye.ballTweenIdPrefix+a;return ke("creating ball tween: "+r),gsap.to(e.toCssIdQuery(t),{duration:n,attr:{cx:i},ease:"none"})}function S(t,n,i,a,r){var o=ye.tweenIdPrefix+a;return ke("creating tween: "+o),gsap.to(e.toCssIdQuery(t),{id:o,duration:n,attr:{x1:i,x2:i},ease:"none",onStart:h,onStartParams:[a,r],onComplete:A,onCompleteParams:[a,r]})}function k(t,n,i,a,r){var o=ye.beatTweenIdPrefix+a;return ke("creating BB tween: "+o),gsap.to(e.toCssIdQuery(t),{id:o,duration:n,attr:{x1:i,x2:i},ease:"none",paused:!0,onStart:N,onStartParams:[a,r],onComplete:x,onCompleteParams:[a,r]})}function I(t){if(e.isNumeric(t)){var n=xe.tempo.bpm;xe.tempo.bpm=t,w(n,t)}}function w(t,n){var i=n/t,r=xe.topStaveTimeline,o=r.timeScale(),s=o*i;r.timeScale(s);var u=a.getBeatDurationSec(n);ke("####  new duration: "+u+" new ratio: "+i+" newTimeScale: "+s);var c=xe.currentBbBeatNo,l=xe.tsBaseBeatTweens[c];for(var f in e.isNull(l)||l.duration(u),xe.tsBaseBeatTweens)if(f>c){l=xe.tsBaseBeatTweens[f];l.duration(u)}}function h(e,t){var n=i.getCurrentTime();xe.audioTlBeatTime=n,ke("onBeatStart: beat: "+e+" beatNo: "+t+" beatTime: "+n),y(t,e)}function A(e,t){var n=i.getCurrentTime(),a=n-xe.startTimeTl;ke("onBeatEnd: beat: "+e+" beatNo: "+t+" elapsedTime: "+a)}function N(e,t){ke("onBbBeatStart: beat: "+e+" beatNo: "+t),xe.currentBbBeatNo=t,21===t&&I(xe.tempo.bpm+20)}function x(t,n){var a=i.getCurrentTime(),r=a-xe.startTimeTl;ke("onBbBeatEnd: beat: "+t+" beatNo: "+n+" elapsedTime: "+r);var o=n+2,s=xe.tsBaseBeatTweens[o];e.isObject(s)&&s.resume()}function y(t,n){e.isNumeric(t)&&(e.isNull(n)&&(n=ye.beatIdPrefix+t),xe.currentBeatId=n,xe.currentBeatNo=t)}function E(){for(var e=0;e<ye.tsX.length-1;e++){var t=ye.tsX[e],n=ye.tsBaseBeats[e],i=ye.tsX[e+1],a=ye.tsBaseBeats[e+1],r=new u(t,i,ye.tsY,ye.tsY,n,ye.tsBaseBeatDenom,a,ye.tsBaseBeatDenom);xe.tsBaseBeatMaps[n]=r}}function C(){U()}function D(){t.init(ye.connectionPreference,ye.appUrlSse,ye.appUrlWebsockets,ye.appUrlHttp,le,fe)}function P(){Be(i)?Se("initAudio: invalid zsAudio lib"):i.init(he,5)}function U(){Be(i)?Se("resetAudio: invalid zsAudio lib"):i.reset()}function z(){n.init()}function R(t){if(!e.isObject(this))return null}function O(t,n,i){if(e.isArray(n))for(var a=0;a<n.length;a++)ie(t,n[a],i);else ie(t,n,i)}function M(t,n,i){if(e.isArray(n))for(var a=0;a<n.length;a++)L(t,n[a],i);else L(t,n,i)}function L(e,t,n){Be(t)||ke("runAudio: "+e+we+t)}function Q(t,n,i){if(e.isArray(n))for(var a=0;a<n.length;a++)V(t,n[a],i);else V(t,n,i)}function V(t,n,i){if(e.isString(t)&&e.isObject(i))switch(ke("rotate: "+n),t){case"start":j(n,i);break;case"reset":X(n,i);break;default:return void Se("Unknown rotate actionId: "+t)}}function j(e,t){Be(t.duration)||t.duration,Be(t.angle)||t.angle;var n=null;pe(n)}function X(t,n){e.isString(t)}function Y(t,n,i){if(e.isArray(n))for(var a=0;a<n.length;a++)Z(t,n[a],i);else Z(t,n,i)}function Z(t,n,i){if(e.isString(t)&&e.isObject(i))switch(ke("runAlpha: "+n),t){case"start":H(n,i);break;default:return void Se("Unknown aplha actionId: "+t)}}function H(e,t){Be(t.duration)||t.duration;Be(t.value)||t.value;for(var n=[],i=0;i<n.length;i++)ke("runAlphaStart: tween: "+e),pe(n[i])}function q(t,n,i){if(e.isArray(n))for(var a=0;a<n.length;a++)J(t,n[a],i);else J(t,n,i)}function J(t,n,i){if(e.isString(t))switch(ke("reset: actionId: "+t+we+n),t){case"all":W(n,i);break;case"elements":F(n,i);break;default:return void Se("Unknown reset actionId: "+t)}}function W(t,n){e.isString(t)&&Se("Unknown reset target: "+t)}function F(e,t){isTileId(e)?resetTileState(getTileIdState(elementId)):ke("resetElements: unknown target: "+e)}function G(t,n,i){if(e.isArray(n))for(var a=0;a<n.length;a++)K(t,n[a],i);else K(t,n,i)}function K(t,n,i){e.isString(t)&&(ke("runActivate: actionId: "+t+we+n),Se("Unknown activate actionId: "+t))}function $(t,n,i){if(e.isArray(n))for(var a=0;a<n.length;a++)_(t,n[a],i);else _(t,n,i)}function _(t,n,i){e.isString(t)&&(ke("runDeActivate: actionId: "+t+we+n),Se("Unknown DeActivate actionId: "+t))}function ee(t,n,i){if(e.isArray(n))for(var a=0;a<n.length;a++)te(t,n[a],i);else te(t,n,i)}function te(t,n,i){if(e.isString(t))switch(ke("stop: actionId: "+t+we+n),t){case"stop":ne(n,i);break;default:return void Se("Unknown stop actionId: "+t)}}function ne(e,t){Be(e)||ke("runStopAction: target: "+e)}function ie(t,n,i){if(e.isString(n)&&e.isString(t)){ke("runTimeline: "+n);var a=null;switch(n){case"centreShape":a=xe.centreShape.gsapTimeline;break;default:return void Se("runTimeline: invalid target: "+n)}switch(t){case"start":ae(a,i);break;case"stop":re(a);break;case"end":oe(a);break;case"reset":se(a);break;case"reverse":ce(a,i);break;case"resume":ue(a,i);break;default:return void Se("runTimeline: invalid actionId: "+t)}}}function ae(e,t){if(Be(e))Se("startTimeline: invalid timeline");else{if(!Be(t)&&!Be(t.duration)){var n=t.duration;e.totalDuration(n)}var i=e.progress();i>0?e.restart():e.play()}}function re(e){Be(e)?Se("stopTimeline: invalid timeline"):e.pause()}function oe(e){Be(e)?Se("endTimeline: invalid timeline"):e.pause(1)}function se(e){Be(e)?Se("stopTimeline: invalid timeline"):e.pause(0)}function ue(e,t){if(Be(e))Se("resumeTimeline: invalid timeline");else if(!e.isActive()){var n=e.totalDuration();if(!Be(t)&&!Be(t.duration))n=t.duration;var i=e.progress();1==i||0==i?(e.totalDuration(n),e.restart()):e.resume()}}function ce(e,t){if(Be(e))Se("reverseTimeline: invalid timeline");else{var n=e.progress();if(n<1&&oe(e),!Be(t)&&!Be(t.duration)){var i=t.duration;e.totalDuration(i)}e.reverse()}}function le(t){if(!Be(t)&&ge(t.data)){var n=e.parseJson(serverData);fe(n,!1)}}function fe(e,t){Be(e)||(t||C(),ge(e.actions)&&de(e.actions))}function de(t){var n=null,i=null,a=[],r={};if(e.isArray(t))for(var o=0;o<t.length;o++){var s=t[o];ge(s.id)&&(n=s.id),ge(s.actionType)&&(i=s.actionType),ge(s.elementIds)&&(a=s.elementIds),ge(s.params)&&(r=s.params),me(n,i,a,r)}}function me(e,t,n,i){if(ke("doAction: "+e+" actionType: "+t),!Be(t)&&!Be(n))switch(t){case"ACTIVATE":G(e,n,i);break;case"ANIMATION":break;case"DEACTIVATE":$(e,n,i);break;case"VISIBLE":break;case"INVISIBLE":Te(n);break;case"ZOOM":be(n);break;case"TIMELINE":O(e,n,i);break;case"ROTATE":Q(e,n,i);break;case"ALPHA":Y(e,n,i);break;case"AUDIO":M(e,n,i);break;case"RESET":q(e,n,i);break;case"STOP":ee(e,n,i);break;default:Se("doAction: Unknown actionType: "+t)}}function Te(t){if(!Be(t))if(e.isArray(t))for(var n=0;n<t.length;n++)ve(t[n]);else ve(t)}function ve(t){if(!Be(t)){var n=e.getElement(t);if(isTileId(t)){var i=getTileState(n);if(Be(i))return;i.isVisible=!1,setTileStyle(i,n)}}}function be(e){}function pe(e){if(!Be(e)){var t=e.progress();t>0?e.restart():e.play()}}function Be(t){return e.isNull(t)}function ge(t){return e.isNotNull(t)}function Se(t){e.logError(t)}function ke(t){e.log(t)}const Ie="DEV",we=" ";var he=["/audio/violin-tuning.mp3"],Ae=null,Ne=null,xe={isRunning:!1,tsBaseBeatMaps:{},tsBaseBeatTweens:{},currentBeatNo:0,currentBbBeatNo:0,startTimeTl:0,startTimeBb:0,tickBeatNo:0,currentBeatId:"b0",tempo:{},topStaveTimeline:{},bottomStaveTimeline:{},lastTimelineBeatNo:0,currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0},ye={tsX:[61.5,99.5,139.5,179.5,219.5,259.5,299.5,339.5,379.5,419.5,459.5,499.5,539.5,579.5,619.5,659.5,699.5,739.5],tsBaseBeats:[1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35],tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw"};return{load:function(){c()},onInstrumentSelect:function(e){ke("onInstrumentSelect: "+e)},onInstrumentControl:function(e){ke("onInstrumentControl: "+e)}}}(zsUtil,zsNet,zsSvg,zsAudio,zsMusic,window,document);