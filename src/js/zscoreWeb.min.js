var zscore=function(e,t,i,n,r,o,a){"use strict";function s(e){this.message=e,this.name="ZScoreException"}function l(e,t,i,n,r,o,a,s){this.xStart=e,this.xEnd=t,this.yStart=i,this.yEnd=n,this.beatStartNum=r,this.beatStartDenom=o,this.beatEndNum=a,this.beatEndDenom=s}function c(e,t,i,n){this.id=e,this.no=t,this.imgFileName=i,this.imgFileUrl=n,this.isLoaded=!1,this.img=new Image,this.img.pageId=e}function d(e,t){this.id="partBtn"+e,this.class="partListButton",this.onclick="onPartSelect('"+t+"')"}function f(e,t){this.onclick="onInstrumentSelect("+e+",'"+t+"')"}function u(){this.onclick=""}function m(){}function v(){if(!Ji.isInitialised){if(!(e&&t&&i&&n&&r))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");e.setRunMode(Ft),Dt("init: "),Wi=e.isTouchDevice(),Qi=e.isSafari(navigator),Dt("init: IsTouch Device: "+Wi+" isSafari: "+Qi),Ji.fontCanvas=a.createElement("canvas"),Ji.canvasCtx=Ji.fontCanvas.getContext("2d"),e.listen("resize",o,w),e.listen("orientationchange",o,w),x(),O(),B(),T(),Ji.isInitialised=!0}}function p(){Ji.part.pages={}}function S(){g(Ji.topStave),g(Ji.bottomStave)}function g(t){if(!Rt(t)&&!Rt(t.config)){var i=t.config;e.setElementIdAttributes(i.positionLineId,i.posLineConf),e.setElementIdAttributes(i.beatBallId,i.posBallConf)}}function I(){Ji.isInitialised?(Dt("onStateBtnClick: zscore initialised"),t.isConnected()||(Dt("onStateBtnClick: zscore not connected, reconnecting..."),q())):(Dt("onStateBtnClick: initialising"),v())}function b(t){e.arrContains(Ji.score.parts,t)?(Ji.part.name=t,Re(t),e.makeInVisible(Zi.idPartsListOuterDiv)):Dt("onPartSelection: unexpected part: "+t)}function P(e,t){Rt(e)||Rt(t)||Rt(Ji.part.name)||De(e,t,Ji.part.name)}function y(){A()}function x(){t.init(Zi.connectionPreference,Zi.appUrlSse,Zi.appUrlWebsockets,Zi.appUrlHttp,Y,R)}function T(){var t=e.getElement(Zi.metro.idMetronomeRect);Rt(t)||(e.listen("click",t,h),E())}function E(){var t=e.getElement(Zi.metro.idMetroFreqLine),i=e.getElement(Zi.metro.idMetroFreqRect);if(Ct(t)&&Ct(i)){var n=e.toInt(t.getAttribute(ei)),r=e.toInt(i.getAttribute(ti)),o=Math.round(r/2),a=n-o;Ji.metro.slider.xMax=a;var s=e.toInt(t.getAttribute($t)),l=s+o;Ji.metro.slider.xMin=l;var c=a-l;Ji.metro.slider.range=c;var d=Math.round((a+l)/2);Ji.metro.slider.xMid=d}Draggable.create(Zi.metro.ifMetroFreqSlider,{type:Kt,bounds:document.getElementById(Zi.metro.idMetroFreqLine),onDrag:k})}function k(t){var i=gsap.getProperty(Zi.metro.ifMetroFreqSlider,Kt),r=Ji.metro.slider.xMid+i,o=r-Ji.metro.slider.xMin,a=Math.round(100*o/Ji.metro.slider.range),s=e.mapRange(a,0,100,Zi.metro.minFreq,Zi.metro.maxFreq);s<200&&(s=200),n.setBeepFreqenecy(s),Dt("onFreqSliderMove: freq: "+s)}function h(e){Ji.metro.isMetroOn?N():L()}function N(){n.switchMetro(!1),i.setElementIdHref(Zi.metro.idMetronome,Zi.metro.ifSymbolMetroOff),e.makeInVisible(Zi.metro.idMetroSlider),Ji.metro.isMetroOn=!1}function L(){n.switchMetro(!0),i.setElementIdHref(Zi.metro.idMetronome,Zi.metro.ifSymbolMetroOn),e.makeVisible(Zi.metro.idMetroSlider),Ji.metro.isMetroOn=!0}function B(){Rt(n)?Mt("initAudio: invalid zsAudio lib"):n.init()}function A(){Rt(n)?Mt("resetAudio: invalid zsAudio lib"):n.reset()}function O(){i.init()}function w(t){if(!e.isObject(this))return null}function R(e,i){switch(e){case t.OPEN:C(i);break;case t.CLOSED:M(i);break;case t.ERROR:D(i);break;default:Mt("Unknown Connection Event State: "+e+" for type: "+i)}}function C(e){Dt(e+" connection opened."),_(e)}function M(e){Dt(e+" connection closed."),F(e)}function D(e){Dt(e+" connection error."),V(e)}function _(e){Ji.isConnected=!0,Ji.connectionType=e,Ji.reconnectAttmpts=0,U(Zi.connectedRectStyle,Zi.connectedBtnAttrib,Zi.connectedTxtStyle,Ht)}function F(e){Ji.isConnected=!1,U(Zi.disconnectedRectStyle,Zi.disconnectedBtnAttrib,Zi.disconnectedTxtStyle,Gt),q(e)}function V(e){Ji.isConnected=!1,U(Zi.errorRectStyle,Zi.errorBtnAttrib,Zi.errorTxtStyle,Wt),q(e)}function U(t,i,n,r){var o=e.getElement(Zi.idServerStatusRect);Rt(o)||Ot(o,t);var a=e.getElement(Zi.idServerStatusBtn);Rt(a)||wt(a,i);var s=e.getElement(Zi.idServerStatusTxt);Rt(s)||(Ot(s,n),s.textContent=r)}function q(e){t.reconnect(e,!0)}function Y(e,t){Ji.isConnected||_(),Rt(e)||(t||y(),Ct(e.scoreInfo)&&z(e.scoreInfo),Ct(e.partInfo)&&ge(e.partInfo),Ct(e.pageInfo)&&ce(e.pageInfo),Ct(e.mapInfo)&&Q(e.mapInfo),Ct(e.bpm)&&0!=e.bpm&&W(e.bpm),Ct(e.actions)&&_e(e.actions))}function z(t){if(e.isObject(t)){if(Ct(t.partHtmlPage)){var i=X(t.partHtmlPage),n=e.getPageName();i&&t.partHtmlPage!==n&&e.loadPage(t.partHtmlPage)}if(Ct(t.title)){var r=H(t.title);r&&p()}Ct(t.instruments)&&Ae(t.instruments),Ct(t.bpm)&&G(t.bpm),Ct(t.scoreDir)&&j(t.scoreDir)}}function H(t){return Ji.score.title!==t&&(Ji.score.title=t,Ji.score.noSpaceTitle=e.replaceEmptySpaces(t,Ut),i.setElementIdText(Zi.idTitle,t),!0)}function X(e){var t=Ji.score.htmlFile;return Rt(t)?(Ji.score.htmlFile=e,!1):t!==e&&(Ji.score.htmlFile=e,!0)}function j(e){Ji.scoreDir!==e&&(Ji.scoreDir=e)}function G(e){Ji.tempo!==e&&(Ji.tempo=e,i.setElementIdText(Zi.idTempoBpm,e))}function W(t){var i=e.toInt(t);if(!Rt(i)){var n=Ji.tempo,r=i/n;Ji.tempoModifier=r,G(i),Ji.isPlaying?J(r):$()}}function Q(t){if(!Rt(t.map)&&!Rt(t.pageId)){t.pageId;var i=t.staveId,n=t.map,r=Ji[i];if(!Rt(r)){var o=r.config.xLeftMargin,a=JSON.parse(JSON.stringify(n));if(e.isArray(a)){for(var s={},l=0;l<a.length;l++)Z(s,a[l],o);r.beatMap=s,ee(i)}}}}function Z(e,t,i){if(!(Rt(e)||Rt(t)||Rt(t.beatStartNum))){var n=t.beatStartNum,r=t.xStart+i,o=t.xEnd+i,a=new l(r,o,t.yStart,t.yEnd,n,t.beatStartDenom,t.beatEndNum,t.beatEndDenom);e[n]=a}}function J(e){K(Ji.topStave.timeline,e),K(Ji.bottomStave.timeline,e)}function K(e,t){if(!Rt(e)){var i=e.timeScale(),n=i*t;e.timeScale(n)}}function $(){te(Ji.topStave),te(Ji.bottomStave)}function ee(e){Rt(e)||te(Ji[e])}function te(e){if(!Rt(e)){var t=gsap.timeline({onComplete:oe,onCompleteParams:[e.id],paused:!0}),i=e.beatMap;if(!Rt(i)){var n=e.config.positionLineId,o=e.config.beatBallId,a=e.config.ballYmax,s=!0;for(var l in i){var c=i[l],d=Ji.tempo,f=r.getBeatDurationSec(d),u=c.beatStartNum;if(s){var m=Zi.beatIdPrefix+(u-1),v=c.xStart,p=ie(n,0,v,m,0);t.add(p,ii);var S=ne(o,0,v,m);t.add(S,ni),s=!1}v=c.xEnd,m=Zi.beatIdPrefix+u;var g=Zi.tweenIdPrefix+m,I=ie(n,f,v,m,u),b=ne(o,f,v,m),P=re(o,f/2,a,m);g=I.vars.id;t.addLabel(g,ni),t.add(I,ni),t.add(b,ii),t.add(P,g)}Ct(e.currentBeat)&&St(t,e.currentBeat),e.timeline=t}}}function ie(t,i,n,r,o){var a=Zi.tweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:a,duration:i,attr:{x1:n,x2:n},ease:"none",onStart:ae,onStartParams:[r,o],onComplete:se,onCompleteParams:[r,o]})}function ne(t,i,n,r){var o=Zi.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cx:n},ease:"none"})}function re(t,i,n,r){var o=Zi.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cy:n,r:2},ease:"power1.out",autoAlpha:.5,repeat:1,yoyo:!0})}function oe(e){_t("onTimelineComplete stave: "+e);var t=Ji[e];Ct(t)&&(t.isRunning=!1),Ct(t.timeline)&&t.timeline.pause(0)}function ae(e,t){var i=n.getCurrentTime();Ji.audioTlBeatTime=i,_t("onBeatStart: beat: "+e+" beatNo: "+t+" beatTime: "+i),le(t,e)}function se(e,t){var i=n.getCurrentTime(),r=i-Ji.startTimeTl;_t("onBeatEnd: beat: "+e+" beatNo: "+t+" elapsedTime: "+r)}function le(t,i){e.isNumeric(t)&&(e.isNull(i)&&(i=Zi.beatIdPrefix+t),Ji.currentBeatId=i,Ji.currentBeatNo=t)}function ce(e){if(!Rt(e.staveId)){var t=e.staveId,i=Ji[t];Rt(i)?Mt("processPageinfo: Invalid stave for id: {}",t):(Ct(e.filename)&&(i.filename=e.filename),Ct(e.pageId)&&(i.pageId=e.pageId),Ct(e.rndPageId)?i.rndPageId=e.rndPageId:i.rndPageId=null,de(i))}}function de(t){if(!Rt(t)){var i=t.config;if(!Rt(i)){var n=null,r=t.pageId;Ct(t.rndPageId)&&(r=t.rndPageId);var o=me(r);n=Rt(o)?ue(t.fileName):o.src;var a=e.getElement(i.imgId);a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),a.setAttribute("href",n)}}}function fe(t){if(!Rt(t)){var i=t.config;if(!Rt(i)){var n=t.fileName,r=e.getElement(i.imgId);r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),r.setAttribute("href",n)}}}function ue(e){return Ji.scoreDir+Ji.score.noSpaceTitle+qt+e}function me(e){var t=Ji.part.pages[e];return Rt(t)?null:t.img}function ve(e){var t=Ji.part.pages[e];Ct(t)&&(t.isLoaded=!0),Ji.pageNoToLoad--,0===Ji.pageNoToLoad&&Se(),pe(Ji.pageNoToLoad)}function pe(e){if(e>0){var t=Xt+" "+e;U(Zi.errorRectStyle,Zi.errorBtnAttrib,Zi.errorTxtStyle,t)}else U(Zi.connectedRectStyle,Zi.connectedBtnAttrib,Zi.connectedTxtStyle,jt)}function Se(){Dt("onPageLoadComplete: ");var e=Ji.part.pages,t=!0;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n.isLoaded||(Dt("onPageLoadComplete: page: "+i+" is not loaded, retying load"),xe(n.no),t=!1)}t&&(Dt("All Pages loaded: "),Ji.isReady=!0,Ce())}function ge(t){if(Ct(t.name)&&(Ji.part.name=t.name,i.setElementIdText(Zi.idInstrument,t.name)),Ct(t.pageRanges)){var n=t.pageRanges;if(e.isArray(n))for(var r=0;r<n.length;r++)Be(n[r]);else Be(n)}Ct(t.imgDir)&&(Ji.part.imgDir=t.imgDir),Ct(t.imgPageNameToken)&&(Ji.part.imgPageNameToken=t.imgPageNameToken),Ct(t.imgContPageName)&&(Ji.part.imgContPageName=t.imgContPageName),Ct(t.contPageNo)&&(Ji.part.contPageNo=t.contPageNo),Ie()}function Ie(){var t=Ji.part,i=t.pageRanges;if(e.isArray(i)){for(var n=0;n<i.length;n++)ye(i[n]);be(),Pe()}}function be(){var e=he();Ji.pageNoToLoad++,Te(e)}function Pe(){var e=ke();Ji.pageNoToLoad++,Te(e)}function ye(t){if(e.isObject(t)){var i=1,n=1;Ct(t.start)&&(i=e.toInt(t.start)),Ct(t.end)&&(n=e.toInt(t.end));var r=Ji.pageNoToLoad+(n-i+1);Ji.pageNoToLoad=r;for(var o=i;o<=n;o++)xe(o)}}function xe(e){var t=Ee(e);Te(t)}function Te(e){if(!Rt(e)){var t=e.imgFileUrl;Rt(t)||e.loadImg(t,e.id)}}function Ee(t){var i=Le(t),n=Ji.part.pages[i];if(Ct(n))return n;var r=Ji.part.imgPageNameToken;r=Rt(r)?Ne(t):e.replace(r,Zi.pageNoToken,""+t);var o=Ji.part.imgDir+r;n=new c(i,t,r,o);return Ji.part.pages[i]=n,n}function ke(){var e=Ji.part.contPageNo,t=Le(e),i=Ji.part.pages[t];if(Ct(i))return i;var n=Ji.part.imgContPageName,r=Ji.part.imgDir+n;i=new c(t,e,n,r);return Ji.part.pages[t]=i,i}function he(){var e=Ji.part.blankPageNo,t=Le(e),i=Ji.part.pages[t];if(Ct(i))return i;var n=Zi.blankPageUrl,r=Zi.blankPageUrl;i=new c(t,e,n,r);return Ji.part.pages[t]=i,i}function Ne(e){return Ji.score.noSpaceTitle+Ut+instrumentName+"_page"+e+".png"}function Le(e){return Zi.pageIdPrefix+e}function Be(e){if(!(Rt(e)||Rt(e.start)||Rt(e.end))){var t=e.start,i=e.end,n={start:t,end:i};Ji.part.pageRanges=[],Ji.part.pageRanges.push(n)}}function Ae(t){var i=[];if(e.isArray(t))for(var n=0;n<t.length;n++){var r=t[n];e.arrContains(Zi.filterOutParts,r)||i.push(r)}else e.arrContains(Zi.filterOutParts,r)||i.push(t);e.arrEquals(Ji.score.parts,i)||(Ji.score.parts=i),Oe(i)?Re(Ji.part.name):we(i)}function Oe(t){if(Rt(Ji.part.name)||!e.isArray(t))return!1;for(var i=Ji.part.name,n=0;n<t.length;n++)if(i===t[n])return!0;return!1}function we(t){var i=e.getElement(Zi.idParts);if(!Rt(i)){e.removeElementChildren(i);for(var n=0;n<t.length;n++){var r=t[n];if(!e.arrContains(Zi.filterOutParts,r)){var o=new d(n+1,r),a=e.createDiv(),s=e.createButton(o);e.setText(s,r),e.addChildToParent(a,s),e.addChildToParent(i,a)}}e.makeVisible(Zi.idPartsListOuterDiv)}}function Re(e){var i=new m;i[wi]=e,t.sendEvent(Li,i)}function Ce(){var e=new m;e[wi]=Ji.part.name,t.sendEvent(Bi,e)}function Me(e){var i=new m;i[Ri]=e,t.sendEvent(Ai,i)}function De(e,i,n){var r=new m;r[Fi]=e,r[Vi]=i,r[wi]=n,t.sendEvent(Oi,r)}function _e(t){var i=null,n=[],r={};if(e.isArray(t))for(var o=0;o<t.length;o++){var a=t[o];Ct(a.type)&&(i=a.type),Ct(a.targets)&&(n=a.targets),Ct(a.params)&&(r=a.params),Fe(i,n,r)}}function Fe(t,i,n){if(e.logDebug("doAction: "+t),!Rt(t))switch(t){case"PING":At(n);break;case"START":Ve(ht,i,null);break;case"STOP":kt();break;case"SEMAPHORE_ON":bt(n);break;case"SEMAPHORE_OFF":Pt(n);break;case"ACTIVATE":Ve(gt,i,n);break;case"BEAT":Ve(vt,i,n);break;case"START_MARK":Ve(ft,i,n);break;case"INSTRUMENT_SLOTS":nt(n);break;case"RESET_INSTRUMENT_SLOTS":it();break;case"RESET_STAVES":et();break;case"OVERLAY_ELEMENT":Ve(je,i,n);break;case"OVERLAY_LINE":Ve(ze,i,n);break;case"OVERLAY_COLOUR":Ve(Ue,i,n);break;default:Mt("doAction: Unknown actionType: "+t)}}function Ve(t,i,n){if(!Rt(t))if(e.isArray(i))for(var r=0;r<i.length;r++)t(i[r],n);else t(target,n)}function Ue(e,t){if(!Rt(t)&&!Rt(e)){var i=Ji[e],n=t[Ui],r=t[Xi];qe(i,n,r)}}function qe(e,t,i){if(!(Rt(e)||Rt(t)||Rt(i)))switch(t){case"POSITION":Ye(e.config.ovrlPosId+Zi.idRectSuffix,i);break;case"PITCH":Ye(e.config.ovrlPitchId+Zi.idRectSuffix,i);break;case"SPEED":Ye(e.config.ovrlSpeedId+Zi.idRectSuffix,i);break;case"PRESSURE":Ye(e.config.ovrlPressId+Zi.idRectSuffix,i);break;case"DYNAMICS":Ye(e.config.ovrlDynId+Zi.idRectSuffix,i);break;default:Dt("setOverlayColour: unknown overlay type: "+t)}}function Ye(t,i){e.setElementIdStyleProperty(t,{fill:i})}function ze(e,t){if(!Rt(t)&&!Rt(e)){var i=Ji[e],n=t[Ui],r=t[Yi];He(i,n,r)}}function He(e,t,i){if(!(Rt(e)||Rt(t)||Rt(i)))switch(t){case"POSITION":Xe(e.config.ovrlPosId+Zi.idLineSuffix,i);break;case"PITCH":Xe(e.config.ovrlPitchId+Zi.idLineSuffix,i);break;case"SPEED":Xe(e.config.ovrlSpeedId+Zi.idLineSuffix,i);break;case"PRESSURE":Xe(e.config.ovrlPressId+Zi.idLineSuffix,i);break;case"DYNAMICS":Xe(e.config.ovrlDynId+Zi.idLineSuffix,i);break;default:Dt("setOverlayElement: unknown overlay type: "+t)}}function Xe(t,n){var r=e.getElement(t);i.setLineY(r,n,n)}function je(e,t){if(!Rt(t)&&!Rt(e)){var i=Ji[e],n=t[Ui],r=t[qi],o=t[zi],a=t[Hi];Ge(i,n,r,o,a)}}function Ge(e,t,i,n,r){if(!Rt(e)&&!Rt(t)){var o=e.config;if(!Rt(o))switch(_t("setOverlayElement: overlayType: "+t),t){case"POSITION":Ke(o,i,n,r);break;case"PITCH":Je(o,i,n,r);break;case"SPEED":Ze(o,i,n,r);break;case"PRESSURE":Qe(o,i,n,r);break;case"DYNAMICS":We(o,i,n,r);break;default:Dt("setOverlayElement: unknown overlay type: "+t)}}}function We(e,t,i,n){if(!Rt(t)&&!Rt(e))switch(t){case"DYNAMICS_BOX":$e(e.ovrlDynId+Zi.idRectSuffix,i,n),$e(e.ovrlDynId+Zi.idOrdSuffix+Zi.idLineSuffix,i,n),$e(e.ovrlDynId,i,n),i||$e(e.ovrlDynId+Zi.idLineSuffix,i,n);break;case"DYNAMICS_MID_LINE":$e(e.ovrlDynId+Zi.idOrdSuffix+Zi.idLineSuffix,i,n);break;case"DYNAMICS_LINE":$e(e.ovrlDynId+Zi.idLineSuffix,i,n);break;default:Dt("setOverlayElement: unknown overlay type: "+t)}}function Qe(e,t,i,n){if(!Rt(t)&&!Rt(e))switch(t){case"PRESSURE_BOX":$e(e.ovrlPressId+Zi.idRectSuffix,i,n),$e(e.ovrlPressId+Zi.idOrdSuffix+Zi.idLineSuffix,i,n),$e(e.ovrlPressId,i,n),i||$e(e.ovrlPressId+Zi.idLineSuffix,i,n);break;case"PRESSURE_MID_LINE":$e(e.ovrlPressId+Zi.idOrdSuffix+Zi.idLineSuffix,i,n);break;case"PRESSURE_LINE":$e(e.ovrlPressId+Zi.idLineSuffix,i,n);break;default:Dt("setOverlayElement: unknown overlay type: "+t)}}function Ze(e,t,i,n){if(!Rt(t)&&!Rt(e))switch(t){case"SPEED_BOX":$e(e.ovrlSpeedId+Zi.idRectSuffix,i,n),$e(e.ovrlSpeedId+Zi.idOrdSuffix+Zi.idLineSuffix,i,n),$e(e.ovrlSpeedId,i,n),i||$e(e.ovrlSpeedId+Zi.idLineSuffix,i,n);break;case"SPEED_MID_LINE":$e(e.ovrlSpeedId+Zi.idOrdSuffix+Zi.idLineSuffix,i,n);break;case"SPEED_LINE":$e(e.ovrlSpeedId+Zi.idLineSuffix,i,n);break;default:Dt("setOverlayElement: unknown overlay type: "+t)}}function Je(e,t,i,n){if(!Rt(t)&&!Rt(e))switch(t){case"PITCH_BOX":$e(e.ovrlPitchId+Zi.idRectSuffix,i,n),$e(e.ovrlPitchId,i,n),i||$e(e.ovrlPitchId+Zi.idLineSuffix,i,n);break;case"PITCH_LINE":$e(e.ovrlPitchId+Zi.idLineSuffix,i,n);break;default:Dt("setOverlayElement: unknown overlay type: "+t)}}function Ke(e,t,i,n){if(!Rt(t)&&!Rt(e))switch(t){case"POSITION_BOX":$e(e.ovrlPosId+Zi.idRectSuffix,i,n),$e(e.ovrlPosId+Zi.idOrdSuffix+Zi.idLineSuffix,i,n),$e(e.ovrlPosId+Zi.idBridgeSuffix+Zi.idLineSuffix,i,n),$e(e.ovrlPosId,i,n),i||$e(e.ovrlPosId+Zi.idLineSuffix,i,n);break;case"POSITION_LINE":$e(e.ovrlPosId+Zi.idLineSuffix,i,n);break;case"POSITION_BRIDGE_LINE":$e(e.ovrlPosId+Zi.idBridgeSuffix+Zi.idLineSuffix,i,n);break;case"POSITION_ORD_LINE":$e(e.ovrlPosId+Zi.idOrdSuffix+Zi.idLineSuffix,i,n);break;default:Dt("setOverlayElement: unknown overlay type: "+t)}}function $e(t,i,n){if(!Rt(t))if(i){var r=e.toFloat(n);e.isNumeric(r)||(r=1),e.setElementIdStyleProperty(t,{opacity:r}),e.makeVisible(t)}else e.makeInVisible(t)}function et(){tt(Ji.topStave),tt(Ji.bottomStave)}function tt(e){Rt(e)||(e.pageId=Gi,e.rndPageId=null,e.filename=ji,e.beatMap=null,e.timeline=null,e.isActive=!0,e.isPlaying=!1,e.currentBeat=null,g(e),fe(e))}function it(){st(),ot()}function nt(e){if(!Rt(e)){var t=e[_i];at(t),rt()}}function rt(){e.makeVisible(Zi.idInstControls)}function ot(){e.makeInVisible(Zi.idInstControls)}function at(t){if(!Rt(t)){var i=e.csvToArr(t);if(!(Rt(i)||i.length<=0)){var n=Ji.score.parts;if(!(Rt(n)||n.length<=0))for(var r=0;r<n.length;r++){var o=r+1;r<i.length?lt(i[r],o):ct(o)}}}}function st(){var e=Ji.score.parts;if(!(Rt(e)||e.length<=0))for(var t=0;t<e.length;t++){var i=t+1;dt(i)}}function lt(t,n){if(!Rt(t)&&!Rt(n)){var r=Zi.idInstSlotTxtPrefix+n,o=Zi.idInstSlotBtnPrefix+n,a=Zi.idInstSlotPrefix+n,s=t===Ji.part.name;e.makeVisible(r),e.makeVisible(o),e.makeVisible(a),e.setElementIdAttributes(a,Zi.instSlotActiveAttrib),i.setElementIdText(r,t.trim()),e.setElementIdStyleProperty(r,Zi.instSlotTxtActiveStyle),s?e.setElementIdStyleProperty(o,Zi.instSlotBtnActiveInstStyle):e.setElementIdStyleProperty(o,Zi.instSlotBtnActiveStyle);var l=new f(n,t);e.setElementIdAttributes(o,l)}}function ct(t){var n=Zi.idInstSlotTxtPrefix+t,r=Zi.idInstSlotBtnPrefix+t,o=Zi.idInstSlotPrefix+t;e.makeVisible(n),e.makeVisible(r),e.makeVisible(o),e.setElementIdAttributes(o,Zi.instSlotInActiveAttrib),i.setElementIdText(n,Vt),e.setElementIdStyleProperty(n,Zi.instSlotTxtInActiveStyle),e.setElementIdStyleProperty(r,Zi.instSlotBtnInActiveStyle);var a=new u;e.setElementIdAttributes(r,a)}function dt(t){var i=Zi.idInstSlotTxtPrefix+t,n=Zi.idInstSlotBtnPrefix+t,r=Zi.idInstSlotPrefix+t;e.makeInVisible(i),e.makeInVisible(n),e.makeInVisible(r);var o=new u;e.setElementIdAttributes(n,o)}function ft(e,t){if(!Rt(t)&&!Rt(e)){var n=Ji[e],r=t[Di];if(!Rt(n)&&!Rt(r)){var o=n.beatMap;if(!Rt(o)){var a=o[r];if(!Rt(a)){var s=a.xStart-1,l=ut(n);i.setLineX(l,s,s),mt(l,!0)}}}}}function ut(t){return e.getElement(t.config.startLineId)}function mt(t,i){i?e.makeElementVisible(t):e.makeElementInVisible(t)}function vt(e,t){if(!Rt(t)&&!Rt(e)){var i=Ji[e],n=t[Di];pt(i,n)}}function pt(e,t){if(!Rt(e)&&!Rt(t)){var i=n.getCurrentTime();_t("setStaveBeat: stave: "+e.id+" beat: "+t+" time: "+i),St(e.timeline,t),e.currentBeat=t}}function St(e,t){if(!Rt(e)){var i=Zi.tweenIdPrefix+Zi.beatIdPrefix+t,r=e.labels;i in r?(n.beep(),e.seek(i)):_t("setTimelineBeat: Invalid beat "+i)}}function gt(e,t){if(!Rt(t)&&!Rt(e)){var i=Ji[e],n=t[Ci],r=t[Mi];It(i,n,r)}}function It(t,i,n){if(!(Rt(t)||Rt(i)||Rt(n))){if(i)e.setElementIdStyleProperty(t.config.maskId,Zi.activeStaveStyle);else{e.setElementIdStyleProperty(t.config.maskId,Zi.inactiveStaveStyle);var r=ut(t);mt(r,!1)}n&&Nt(t.timeline)}}function bt(e){Rt(e)||xt(e.lightNo,e.colourId)}function Pt(e){Rt(e)||Tt(e.lightNo,mi)}function yt(){Tt(4,mi),Tt(1,oi)}function xt(e,t){var i=Et(t);Tt(e,i)}function Tt(t,n){if(!Rt(t)&&!Rt(n))for(var r=e.toInt(t),o=1;o<=r;o++){var a=Zi.idSemaphorePrefix+o;i.setElementIdColour(a,n)}}function Et(e){var t;switch(e||(e=1),e){case 4:t=oi;break;case 3:t=ai;break;case 2:t=si;break;case 1:default:t=ri}return t}function kt(){Lt(),Ji.isPlaying=!1,yt(),S()}function ht(e){if(!Rt(e)){var t=Ji[e];if(!Rt(t)){var i=t.timeline;Rt(i)||(Nt(i),Ji.isPlaying=!0)}}}function Nt(e){if(Rt(e))Mt("startTimeline: invalid timeline");else{var t=e.progress();t>0&&t<1?e.resume():e.play(0)}}function Lt(){Bt(Ji.topStave.timeline),Bt(Ji.bottomStave.timeline),Ji.bottomStave.isPlaying=!1,Ji.topStave.isPlaying=!1}function Bt(e){Rt(e)?Mt("stopTimeline: invalid timeline"):e.pause()}function At(t){e.isObject(t)&&Ct(t.sendTimeMs)&&Me(t.sendTimeMs)}function Ot(t,i){e.setElementStyleProperty(t,i)}function wt(t,i){e.setElementAttributes(t,i)}function Rt(t){return e.isNull(t)}function Ct(t){return e.isNotNull(t)}function Mt(t){e.logError(t)}function Dt(t){e.log(t)}function _t(t){e.logDebug(t)}const Ft="dev",Vt="",Ut="_",qt="/",Yt="AV",zt="FullScore",Ht="Connected",Xt="Loading",jt="READY",Gt="Reconnecting",Wt="Error",Qt="visible",Zt="hidden",Jt="none",Kt="x",$t="x1",ei="x2",ti="width",ii="<",ni=">",ri="green",oi="red",ai="orange",si="yellow",li="white",ci="black",di="blue",fi="grey",ui="lightgrey",mi=Jt,vi=mi,pi=li,Si=ri,gi=oi,Ii=ai,bi=di,Pi=fi,yi=ri,xi=oi,Ti=ai,Ei=li,ki=li,hi=ci,Ni=6666,Li="PART_REG",Bi="PART_READY",Ai="PING",Oi="SELECT_ISLOT",wi="part",Ri="serverTime",Ci="isActive",Mi="isPlay",Di="beatNo",_i="csvInstruments",Fi="slotNo",Vi="slotInstrument",Ui="overlayType",qi="overlayElement",Yi="overlayLineY",zi="isEnabled",Hi="opacity",Xi="colour",ji="img/blankStave.png",Gi="p0";var Wi=null,Qi=null,Zi={connectionPreference:"ws,sse,poll",defaultConnectionType:t.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",pageNoToken:"@PgNo@",instToken:"@Inst@",slotNoToken:"@SlotNo@",pageIdPrefix:"p",tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",idParts:"parts",idPartsListOuterDiv:"partListOuterDiv",idInstrument:"part",idInstControls:"instControls",idInstSlotPrefix:"instSlot",idInstSlotTxtPrefix:"instSlotTxt",idInstSlotBtnPrefix:"instSlotRect",idTempoBpm:"tmpBpm",idSemaphorePrefix:"semC",idLineSuffix:"Line",idBridgeSuffix:"Bridge",idOrdSuffix:"Ord",idRectSuffix:"Rect",blankPageUrl:"img/blankStave.png",filterOutParts:[Yt,zt],connectedRectStyle:{fill:Si,stroke:yi,"stroke-width":"0px",visibility:Qt,opacity:1},disconnectedRectStyle:{fill:gi,stroke:xi,"stroke-width":"1px",visibility:Qt,opacity:1},errorRectStyle:{fill:Ii,stroke:Ti,"stroke-width":"1px",visibility:Qt,opacity:1},connectedTxtStyle:{fill:Ei},disconnectedTxtStyle:{fill:ki},errorTxtStyle:{fill:hi},activeStaveStyle:{fill:vi,stroke:bi,"stroke-width":"1px",visibility:Qt,opacity:.5},inactiveStaveStyle:{fill:pi,stroke:Pi,"stroke-width":"1px",visibility:Qt,opacity:.4},instSlotBtnActiveStyle:{fill:li,stroke:ci,"stroke-width":"1px",visibility:Qt,opacity:1},instSlotBtnActiveInstStyle:{fill:"#d7f2cd",stroke:ci,"stroke-width":"1px",visibility:Qt,opacity:1},instSlotBtnInActiveStyle:{fill:ui,stroke:Jt,visibility:Qt,opacity:1},instSlotTxtActiveStyle:{fill:ci,visibility:Qt,opacity:1},instSlotTxtInActiveStyle:{fill:ci,stroke:Jt,visibility:Zt,opacity:0},instSlotActiveAttrib:{filter:"url(#dropshadow)"},instSlotInActiveAttrib:{filter:"none"},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},errorBtnAttrib:{filter:"url(#dropshadow)"},topStave:{gId:"stvTop",imgId:"stvTopImg",startLineId:"stvTopStartLine",positionLineId:"stvTopPosLine",beatBallId:"stvTopBeatBall",maskId:"stvTopMask",ovrlPosId:"ovrlTopPos",ovrlPitchId:"ovrlTopPitch",ovrlSpeedId:"ovrlTopSpeed",ovrlPressId:"ovrlTopPres",ovrlDynId:"ovrlTopDyn",ballYmax:84,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"80",x2:"95",y2:"281"},posBallConf:{cx:"95",cy:"110",r:"4"}},bottomStave:{gId:"stvBot",imgId:"stvBotImg",startLineId:"stvBotStartLine",positionLineId:"stvBotPosLine",beatBallId:"stvBotBeatBall",maskId:"stvBotMask",ovrlPosId:"ovrlBotPos",ovrlPitchId:"ovrlBotPitch",ovrlSpeedId:"ovrlBotSpeed",ovrlPressId:"ovrlBotPres",ovrlDynId:"ovrlBotDyn",ballYmax:305,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"301",x2:"95",y2:"502"},posBallConf:{cx:"95",cy:"331",r:"4"}},metro:{idMetronomeRect:"metroRect",idMetronome:"metro",idMetroSlider:"metroFreqSlider",idMetroFreqRect:"metroFreq",idMetroFreqLine:"metroFreqLine",ifSymbolMetroOff:"#metronome",ifSymbolMetroOn:"#metronomeOn",ifMetroFreqSlider:"#metroFreq",minFreq:220,maxFreq:2200}},Ji={isPlaying:!1,isReady:!1,score:{title:"ZScore",noSpaceTitle:"ZScore",htmlFile:null,instrument:"Part View",parts:["Part View"],firstPageNo:1,lastPageNo:2},part:{name:"Part View",imgDir:null,imgPageNameToken:null,imgContPageName:null,blankPageNo:0,contPageNo:Ni,pageRanges:[{start:1,end:1}],pages:{}},topStave:{id:"topStave",config:Zi.topStave,pageId:Gi,rndPageId:null,filename:ji,beatMap:null,timeline:null,isActive:!0,isPlaying:!1,currentBeat:null},bottomStave:{id:"bottomStave",config:Zi.bottomStave,pageId:Gi,rndPageId:null,filename:ji,beatMap:null,timeline:null,isActive:!1,isPlaying:!1,currentBeat:null},startTimeTl:0,currentBeatId:"b0",currentBeatNo:0,tempo:0,tempoModifier:1,scoreDir:"/score/",currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,isConnected:!1,isInitialised:!1,connectionType:null,pageNoToLoad:0,metro:{isMetroOn:!1,slider:{xMax:60,xMin:40,xMid:50,range:20}}};return c.prototype.loadImg=function(e){this.img.src=e,this.img.onload=function(){Dt("pageImgOnLoad: id: "+this.pageId),ve(this.pageId)}},{onStateBtn:function(){I()},onPartSelect:function(e){b(e)},onInstrumentSelect:function(e,t){P(e,t)}}}(zsUtil,zsNet,zsSvg,zsWsAudio,zsMusic,window,document);