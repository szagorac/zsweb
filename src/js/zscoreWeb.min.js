var zscore=function(t,e,n,i,r,o,c){"use strict";function s(t){this.message=t,this.name="ZScoreException"}function a(t,e){this.id="partBtn"+t,this.class="partListButton",this.onclick="onPartSelect('"+e+"')"}function l(){}function u(){if(!mt.isInitialised){if(!(t&&e&&n&&i&&r))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");t.setRunMode(F),Z("init: "),vt=t.isTouchDevice(),St=t.isSafari(navigator),Z("init: IsTouch Device: "+vt+" isSafari: "+St),mt.fontCanvas=c.createElement("canvas"),mt.canvasCtx=mt.fontCanvas.getContext("2d"),t.listen("resize",o,y),t.listen("orientationchange",o,y),S(),b(),m(),mt.isInitialised=!0}}function d(){mt.isInitialised?(Z("onStateBtnClick: zscore initialised"),e.isConnected()||(Z("onStateBtnClick: zscore not connected, reconnecting..."),g())):(Z("onStateBtnClick: initialising"),u())}function f(e){t.arrContains(mt.parts,e)?(mt.instrument=e,N(e),t.makeInVisible(Tt.idPartsListOuterDiv)):Z("onPartSelection: unexpected part: "+e)}function p(t){}function v(){T()}function S(){e.init(Tt.connectionPreference,Tt.appUrlSse,Tt.appUrlWebsockets,Tt.appUrlHttp,A,B)}function m(){j(i)?H("initAudio: invalid zsAudio lib"):i.init(pt,0)}function T(){j(i)?H("resetAudio: invalid zsAudio lib"):i.reset()}function b(){n.init()}function y(e){if(!t.isObject(this))return null}function B(t,n){switch(t){case e.OPEN:h(n);break;case e.CLOSED:x(n);break;case e.ERROR:w(n);break;default:H("Unknown Connection Event State: "+t+" for type: "+n)}}function h(t){Z(t+" connection opened."),E(t)}function x(t){Z(t+" connection closed."),k(t)}function w(t){Z(t+" connection error."),C(t)}function E(t){mt.isConnected=!0,mt.connectionType=t,mt.reconnectAttmpts=0,P(Tt.connectedRectStyle,Tt.connectedBtnAttrib,Tt.connectedTxtStyle,Y)}function k(t){mt.isConnected=!1,P(Tt.disconnectedRectStyle,Tt.disconnectedBtnAttrib,Tt.disconnectedTxtStyle,_),g(t)}function C(t){mt.isConnected=!1,P(Tt.errorRectStyle,Tt.errorBtnAttrib,Tt.errorTxtStyle,J),g(t)}function P(e,n,i,r){var o=t.getElement(Tt.idServerStatusRect);j(o)||V(o,e);var c=t.getElement(Tt.idServerStatusBtn);j(c)||W(c,n);var s=t.getElement(Tt.idServerStatusTxt);j(s)||(V(s,i),s.textContent=r)}function g(t){e.reconnect(t,!0)}function A(t,e){mt.isConnected||E(),j(t)||(e||v(),q(t.scoreInfo)&&I(t.scoreInfo),q(t.actions)&&L(t.actions))}function I(e){t.isObject(e)&&(q(e.title)&&R(e.title),q(e.instruments)&&O(e.instruments),q(e.bpm)&&z(e.bpm))}function R(t){mt.title!==t&&(mt.title=t,n.setElementText(Tt.idTitle,t))}function z(t){mt.tempo!==t&&(mt.tempo=t,n.setElementText(Tt.idTempoBpm,t))}function O(e){var n=[];t.isArray(e)?n=e:n.push(e),t.arrEquals(mt.parts,n)||(mt.parts=n),D(n)?N(mt.instrument):U(n)}function D(e){if(j(mt.instrument)||!t.isArray(e))return!1;for(var n=mt.instrument,i=0;i<e.length;i++)if(n===e[i])return!0;return!1}function U(e){var n=t.getElement(Tt.idParts);if(!j(n)){t.removeElementChildren(n);for(var i=0;i<e.length;i++){var r=e[i];if(!t.arrContains(Tt.filterOutParts,r)){var o=new a(i+1,r),c=t.createDiv(),s=t.createButton(o);t.setText(s,r),t.addChildToParent(c,s),t.addChildToParent(n,c)}}t.makeVisible(Tt.idPartsListOuterDiv)}}function N(t){var n=new l;n[ft]=t,e.sendEvent(dt,n)}function L(e){var n=null,i=null,r=[],o={};if(t.isArray(e))for(var c=0;c<e.length;c++){var s=e[c];q(s.id)&&(n=s.id),q(s.actionType)&&(i=s.actionType),q(s.elementIds)&&(r=s.elementIds),q(s.params)&&(o=s.params),M(n,i,r,o)}}function M(t,e,n,i){if(Z("doAction: "+t+" actionType: "+e),!j(e)&&!j(n))switch(e){case"TIMELINE":break;default:H("doAction: Unknown actionType: "+e)}}function V(e,n){t.setElementStyleProperty(e,n)}function W(e,n){t.setElementAttributes(e,n)}function j(e){return t.isNull(e)}function q(e){return t.isNotNull(e)}function H(e){t.logError(e)}function Z(e){t.log(e)}const F="DEV",G="AV",K="FullScore",Y="Connected",_="Reconnecting",J="Error",Q="green",X="red",$="orange",tt="white",et="black",nt=Q,it=X,rt=$,ot=Q,ct=X,st=$,at=tt,lt=tt,ut=et,dt="PART_REG",ft="part";var pt=["/audio/violin-tuning.mp3"],vt=null,St=null,mt={isRunning:!1,tsBaseBeatMaps:{},startTimeTl:0,currentBeatId:"b0",tempo:0,topStaveTimeline:{},bottomStaveTimeline:{},lastTimelineBeatNo:0,currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,parts:[],instrument:"Part View",title:"ZScore",isConnected:!1,isInitialised:!1,connectionType:null},Tt={connectionPreference:"ws,sse,poll",defaultConnectionType:e.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",idParts:"parts",idPartsListOuterDiv:"partListOuterDiv",idPartPrefix:"part",idTempoBpm:"tmpBpm",filterOutParts:[G,K],connectedRectStyle:{fill:nt,stroke:ot,"stroke-width":"0px",visibility:"visible",opacity:1},disconnectedRectStyle:{fill:it,stroke:ct,"stroke-width":"1px",visibility:"visible",opacity:1},errorRectStyle:{fill:rt,stroke:st,"stroke-width":"1px",visibility:"visible",opacity:1},connectedTxtStyle:{fill:at},disconnectedTxtStyle:{fill:lt},errorTxtStyle:{fill:ut},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},errorBtnAttrib:{filter:"url(#dropshadow)"}};return{onStateBtn:function(){d()},onPartSelect:function(t){f(t)},onInstrumentSelect:function(t){p(t)}}}(zsUtil,zsNet,zsSvg,zsAudio,zsMusic,window,document);