var zscore=function(t,e,n,i,r,o,s){"use strict";function c(t){this.message=t,this.name="ZScoreException"}function a(t,e){this.id="partBtn"+t,this.class="partListButton",this.onclick="onPartSelect('"+e+"')"}function l(){}function u(){if(!Tt.isInitialised){if(!(t&&e&&n&&i&&r))throw new c("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");t.setRunMode(G),F("init: "),vt=t.isTouchDevice(),St=t.isSafari(navigator),F("init: IsTouch Device: "+vt+" isSafari: "+St),Tt.fontCanvas=s.createElement("canvas"),Tt.canvasCtx=Tt.fontCanvas.getContext("2d"),t.listen("resize",o,y),t.listen("orientationchange",o,y),v(),b(),S(),Tt.isInitialised=!0}}function d(){Tt.isInitialised?(F("onStateBtnClick: zscore initialised"),e.isConnected()||(F("onStateBtnClick: zscore not connected, reconnecting..."),P())):(F("onStateBtnClick: initialising"),u())}function f(e){t.arrContains(Tt.parts,e)?(Tt.instrument=e,L(e),t.makeInVisible(bt.idPartsListOuterDiv)):F("onPartSelection: unexpected part: "+e)}function p(t){}function m(){T()}function v(){e.init(bt.connectionPreference,bt.appUrlSse,bt.appUrlWebsockets,bt.appUrlHttp,A,B)}function S(){q(i)?Z("initAudio: invalid zsAudio lib"):i.init(mt,0)}function T(){q(i)?Z("resetAudio: invalid zsAudio lib"):i.reset()}function b(){n.init()}function y(e){if(!t.isObject(this))return null}function B(t,n){switch(t){case e.OPEN:h(n);break;case e.CLOSED:x(n);break;case e.ERROR:E(n);break;default:Z("Unknown Connection Event State: "+t+" for type: "+n)}}function h(t){F(t+" connection opened."),w(t)}function x(t){F(t+" connection closed."),k(t)}function E(t){F(t+" connection error."),C(t)}function w(t){Tt.isConnected=!0,Tt.connectionType=t,Tt.reconnectAttmpts=0,g(bt.connectedRectStyle,bt.connectedBtnAttrib,bt.connectedTxtStyle,_)}function k(t){Tt.isConnected=!1,g(bt.disconnectedRectStyle,bt.disconnectedBtnAttrib,bt.disconnectedTxtStyle,J),P(t)}function C(t){Tt.isConnected=!1,g(bt.errorRectStyle,bt.errorBtnAttrib,bt.errorTxtStyle,Q),P(t)}function g(e,n,i,r){var o=t.getElement(bt.idServerStatusRect);q(o)||W(o,e);var s=t.getElement(bt.idServerStatusBtn);q(s)||j(s,n);var c=t.getElement(bt.idServerStatusTxt);q(c)||(W(c,i),c.textContent=r)}function P(t){e.reconnect(t,!0)}function A(t,e){Tt.isConnected||w(),q(t)||(e||m(),H(t.scoreInfo)&&I(t.scoreInfo),H(t.part)&&O(t.part),H(t.actions)&&M(t.actions))}function I(e){t.isObject(e)&&(H(e.title)&&R(e.title),H(e.instruments)&&D(e.instruments),H(e.bpm)&&z(e.bpm))}function R(t){Tt.title!==t&&(Tt.title=t,n.setElementText(bt.idTitle,t))}function z(t){Tt.tempo!==t&&(Tt.tempo=t,n.setElementText(bt.idTempoBpm,t))}function O(t){Tt.instrument=t,n.setElementText(bt.idInstrument,t)}function D(e){var n=[];t.isArray(e)?n=e:n.push(e),t.arrEquals(Tt.parts,n)||(Tt.parts=n),U(n)?L(Tt.instrument):N(n)}function U(e){if(q(Tt.instrument)||!t.isArray(e))return!1;for(var n=Tt.instrument,i=0;i<e.length;i++)if(n===e[i])return!0;return!1}function N(e){var n=t.getElement(bt.idParts);if(!q(n)){t.removeElementChildren(n);for(var i=0;i<e.length;i++){var r=e[i];if(!t.arrContains(bt.filterOutParts,r)){var o=new a(i+1,r),s=t.createDiv(),c=t.createButton(o);t.setText(c,r),t.addChildToParent(s,c),t.addChildToParent(n,s)}}t.makeVisible(bt.idPartsListOuterDiv)}}function L(t){var n=new l;n[pt]=t,e.sendEvent(ft,n)}function M(e){var n=null,i=null,r=[],o={};if(t.isArray(e))for(var s=0;s<e.length;s++){var c=e[s];H(c.id)&&(n=c.id),H(c.actionType)&&(i=c.actionType),H(c.elementIds)&&(r=c.elementIds),H(c.params)&&(o=c.params),V(n,i,r,o)}}function V(t,e,n,i){if(F("doAction: "+t+" actionType: "+e),!q(e)&&!q(n))switch(e){case"TIMELINE":break;default:Z("doAction: Unknown actionType: "+e)}}function W(e,n){t.setElementStyleProperty(e,n)}function j(e,n){t.setElementAttributes(e,n)}function q(e){return t.isNull(e)}function H(e){return t.isNotNull(e)}function Z(e){t.logError(e)}function F(e){t.log(e)}const G="DEV",K="AV",Y="FullScore",_="Connected",J="Reconnecting",Q="Error",X="green",$="red",tt="orange",et="white",nt="black",it=X,rt=$,ot=tt,st=X,ct=$,at=tt,lt=et,ut=et,dt=nt,ft="PART_REG",pt="part";var mt=["/audio/violin-tuning.mp3"],vt=null,St=null,Tt={isRunning:!1,tsBaseBeatMaps:{},startTimeTl:0,currentBeatId:"b0",tempo:0,topStaveTimeline:{},bottomStaveTimeline:{},lastTimelineBeatNo:0,currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,parts:[],instrument:"Part View",title:"ZScore",isConnected:!1,isInitialised:!1,connectionType:null},bt={connectionPreference:"ws,sse,poll",defaultConnectionType:e.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",idParts:"parts",idPartsListOuterDiv:"partListOuterDiv",idInstrument:"part",idTempoBpm:"tmpBpm",filterOutParts:[K,Y],connectedRectStyle:{fill:it,stroke:st,"stroke-width":"0px",visibility:"visible",opacity:1},disconnectedRectStyle:{fill:rt,stroke:ct,"stroke-width":"1px",visibility:"visible",opacity:1},errorRectStyle:{fill:ot,stroke:at,"stroke-width":"1px",visibility:"visible",opacity:1},connectedTxtStyle:{fill:lt},disconnectedTxtStyle:{fill:ut},errorTxtStyle:{fill:dt},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},errorBtnAttrib:{filter:"url(#dropshadow)"}};return{onStateBtn:function(){d()},onPartSelect:function(t){f(t)},onInstrumentSelect:function(t){p(t)}}}(zsUtil,zsNet,zsSvg,zsAudio,zsMusic,window,document);