var zscore=function(t,e,n,i,o,c,r){"use strict";function s(t){this.message=t,this.name="ZScoreException"}function l(){O("onLoad: "),a(),nt.isConnected||I()}function a(){if(!nt.isInitialised){if(!(t&&e&&n&&i&&o))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");t.setRunMode(D),O("init: "),tt=t.isTouchDevice(),et=t.isSafari(navigator),O("init: IsTouch Device: "+tt+" isSafari: "+et),nt.fontCanvas=r.createElement("canvas"),nt.canvasCtx=nt.fontCanvas.getContext("2d"),t.listen("resize",c,v),t.listen("orientationchange",c,v),d(),S(),f(),nt.isInitialised=!0}}function u(){p()}function d(){e.init(it.connectionPreference,it.appUrlSse,it.appUrlWebsockets,it.appUrlHttp,E,T)}function f(){U(i)?N("initAudio: invalid zsAudio lib"):i.init(_,0)}function p(){U(i)?N("resetAudio: invalid zsAudio lib"):i.reset()}function S(){n.init()}function v(e){if(!t.isObject(this))return null}function T(t,n){switch(t){case e.OPEN:m(n);break;case e.CLOSED:b(n);break;case e.ERROR:y(n);break;default:N("Unknown Connection Event State: "+t+" for type: "+n)}}function m(t){O(t+" connection opened."),x(t)}function b(t){O(t+" connection closed."),w(t)}function y(t){O(t+" connection error."),A(t)}function x(t){nt.isConnected=!0,nt.connectionType=t,nt.reconnectAttmpts=0,C(it.connectedRectStyle,it.connectedBtnAttrib,it.connectedTxtStyle,L)}function w(t){nt.isConnected=!1,C(it.disconnectedRectStyle,it.disconnectedBtnAttrib,it.disconnectedTxtStyle,W),I(t)}function A(t){nt.isConnected=!1,C(it.idServerStatusRect,it.errorBtnAttrib,it.disconnectedTxtStyle,j),I(t)}function C(e,n,i,o){var c=t.getElement(it.idServerStatusRect);U(c)||R(c,e);var r=t.getElement(it.idServerStatusBtn);U(r)||z(r,n);var s=t.getElement(it.idServerStatusTxt);U(s)||(R(s,i),s.textContent=o)}function I(t){nt.reconnectAttmpts++;var n=B();O("reconnect: scheduling reconnect in: "+n+" ms"),setTimeout(function(){e.reconnect(t)},n)}function B(){var t=it.reconnectTimeMultiplierMs*nt.reconnectAttmpts;return t>it.reconnectMaxTimeMs&&(t=it.reconnectMaxTimeMs),t}function E(t,e){nt.isConnected||x(),U(t)||(e||u(),P(t.scoreInfo)&&g(t.scoreInfo),P(t.actions)&&k(t.actions))}function g(e){if(t.isObject(e)&&P(e.title)){var n=e.title;h(n)}}function h(e){var n=t.getElement(it.idTitle);U(n)||(n.textContent=e)}function k(e){var n=null,i=null,o=[],c={};if(t.isArray(e))for(var r=0;r<e.length;r++){var s=e[r];P(s.id)&&(n=s.id),P(s.actionType)&&(i=s.actionType),P(s.elementIds)&&(o=s.elementIds),P(s.params)&&(c=s.params),M(n,i,o,c)}}function M(t,e,n,i){if(O("doAction: "+t+" actionType: "+e),!U(e)&&!U(n))switch(e){case"TIMELINE":break;default:N("doAction: Unknown actionType: "+e)}}function R(e,n){t.setElementStyleProperty(e,n)}function z(e,n){t.setElementAttributes(e,n)}function U(e){return t.isNull(e)}function P(e){return t.isNotNull(e)}function N(e){t.logError(e)}function O(e){t.log(e)}const D="DEV",L="Connected",W="Connect",j="Error",H="green",V="red",Z="orange",q="white",K=H,Y=V,F=Z,G=H,J=V,Q=Z,X=q,$=q;var _=["/audio/violin-tuning.mp3"],tt=null,et=null,nt={isRunning:!1,tsBaseBeatMaps:{},startTimeTl:0,currentBeatId:"b0",tempo:{},topStaveTimeline:{},bottomStaveTimeline:{},lastTimelineBeatNo:0,currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,instrument:"Part View",title:"ZScore",isConnected:!1,isInitialised:!1,reconnectAttmpts:0,connectionType:null},it={connectionPreference:"ws,sse,poll",defaultConnectionType:e.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",reconnectTimeMultiplierMs:10,reconnectMaxTimeMs:5e3,tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",connectedRectStyle:{fill:K,stroke:G,"stroke-width":"0px",visibility:"visible",opacity:1},disconnectedRectStyle:{fill:Y,stroke:J,"stroke-width":"1px",visibility:"visible",opacity:1},errorRectStyle:{fill:F,stroke:Q,"stroke-width":"1px",visibility:"visible",opacity:1},connectedTxtStyle:{fill:X},disconnectedTxtStyle:{fill:$},errorTxtStyle:{fill:$},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},errorBtnAttrib:{filter:"url(#dropshadow)"}};return{load:function(){l()},onInstrumentSelect:function(t){O("onInstrumentSelect: "+t)},onInstrumentControl:function(t){O("onInstrumentControl: "+t)}}}(zsUtil,zsNet,zsSvg,zsAudio,zsMusic,window,document);