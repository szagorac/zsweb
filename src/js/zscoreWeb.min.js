var zscore=function(e,t,i,n,r,o,a){"use strict";function s(e){this.message=e,this.name="ZScoreException"}function l(e,t,i,n,r,o,a,s){this.xStart=e,this.xEnd=t,this.yStart=i,this.yEnd=n,this.beatStartNum=r,this.beatStartDenom=o,this.beatEndNum=a,this.beatEndDenom=s}function c(e,t,i,n){this.id=e,this.no=t,this.imgFileName=i,this.imgFileUrl=n,this.isLoaded=!1,this.img=new Image,this.img.pageId=e}function d(e,t){this.id="partBtn"+e,this.class="partListButton",this.onclick="onPartSelect('"+t+"')"}function f(e,t){this.onclick="onInstrumentSelect("+e+",'"+t+"')"}function u(){this.onclick=""}function v(){}function m(){if(!Wi.isInitialised){if(!(e&&t&&i&&n&&r))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");e.setRunMode(Dt),Ct("init: "),Xi=e.isTouchDevice(),ji=e.isSafari(navigator),Ct("init: IsTouch Device: "+Xi+" isSafari: "+ji),Wi.fontCanvas=a.createElement("canvas"),Wi.canvasCtx=Wi.fontCanvas.getContext("2d"),e.listen("resize",o,O),e.listen("orientationchange",o,O),y(),A(),L(),x(),Wi.isInitialised=!0}}function S(){p(Wi.topStave),p(Wi.bottomStave)}function p(t){if(!Ot(t)&&!Ot(t.config)){var i=t.config;e.setElementIdAttributes(i.positionLineId,i.posLineConf),e.setElementIdAttributes(i.beatBallId,i.posBallConf)}}function I(){Wi.isInitialised?(Ct("onStateBtnClick: zscore initialised"),t.isConnected()||(Ct("onStateBtnClick: zscore not connected, reconnecting..."),U())):(Ct("onStateBtnClick: initialising"),m())}function g(t){e.arrContains(Wi.score.parts,t)?(Wi.part.name=t,Oe(t),e.makeInVisible(Gi.idPartsListOuterDiv)):Ct("onPartSelection: unexpected part: "+t)}function b(e,t){Ot(e)||Ot(t)||Ot(Wi.part.name)||Ce(e,t,Wi.part.name)}function P(){B()}function y(){t.init(Gi.connectionPreference,Gi.appUrlSse,Gi.appUrlWebsockets,Gi.appUrlHttp,q,w)}function x(){var t=e.getElement(Gi.metro.idMetronomeRect);Ot(t)||(e.listen("click",t,k),T())}function T(){var t=e.getElement(Gi.metro.idMetroFreqLine),i=e.getElement(Gi.metro.idMetroFreqRect);if(wt(t)&&wt(i)){var n=e.toInt(t.getAttribute(Kt)),r=e.toInt(i.getAttribute($t)),o=Math.round(r/2),a=n-o;Wi.metro.slider.xMax=a;var s=e.toInt(t.getAttribute(Jt)),l=s+o;Wi.metro.slider.xMin=l;var c=a-l;Wi.metro.slider.range=c;var d=Math.round((a+l)/2);Wi.metro.slider.xMid=d}Draggable.create(Gi.metro.ifMetroFreqSlider,{type:Zt,bounds:document.getElementById(Gi.metro.idMetroFreqLine),onDrag:E})}function E(t){var i=gsap.getProperty(Gi.metro.ifMetroFreqSlider,Zt),r=Wi.metro.slider.xMid+i,o=r-Wi.metro.slider.xMin,a=Math.round(100*o/Wi.metro.slider.range),s=e.mapRange(a,0,100,Gi.metro.minFreq,Gi.metro.maxFreq);s<200&&(s=200),n.setBeepFreqenecy(s),Ct("onFreqSliderMove: freq: "+s)}function k(e){Wi.metro.isMetroOn?h():N()}function h(){n.switchMetro(!1),i.setElementIdHref(Gi.metro.idMetronome,Gi.metro.ifSymbolMetroOff),e.makeInVisible(Gi.metro.idMetroSlider),Wi.metro.isMetroOn=!1}function N(){n.switchMetro(!0),i.setElementIdHref(Gi.metro.idMetronome,Gi.metro.ifSymbolMetroOn),e.makeVisible(Gi.metro.idMetroSlider),Wi.metro.isMetroOn=!0}function L(){Ot(n)?Rt("initAudio: invalid zsAudio lib"):n.init()}function B(){Ot(n)?Rt("resetAudio: invalid zsAudio lib"):n.reset()}function A(){i.init()}function O(t){if(!e.isObject(this))return null}function w(e,i){switch(e){case t.OPEN:R(i);break;case t.CLOSED:C(i);break;case t.ERROR:M(i);break;default:Rt("Unknown Connection Event State: "+e+" for type: "+i)}}function R(e){Ct(e+" connection opened."),D(e)}function C(e){Ct(e+" connection closed."),_(e)}function M(e){Ct(e+" connection error."),V(e)}function D(e){Wi.isConnected=!0,Wi.connectionType=e,Wi.reconnectAttmpts=0,F(Gi.connectedRectStyle,Gi.connectedBtnAttrib,Gi.connectedTxtStyle,Yt)}function _(e){Wi.isConnected=!1,F(Gi.disconnectedRectStyle,Gi.disconnectedBtnAttrib,Gi.disconnectedTxtStyle,Xt),U(e)}function V(e){Wi.isConnected=!1,F(Gi.errorRectStyle,Gi.errorBtnAttrib,Gi.errorTxtStyle,jt),U(e)}function F(t,i,n,r){var o=e.getElement(Gi.idServerStatusRect);Ot(o)||Bt(o,t);var a=e.getElement(Gi.idServerStatusBtn);Ot(a)||At(a,i);var s=e.getElement(Gi.idServerStatusTxt);Ot(s)||(Bt(s,n),s.textContent=r)}function U(e){t.reconnect(e,!0)}function q(e,t){Wi.isConnected||D(),Ot(e)||(t||P(),wt(e.scoreInfo)&&Y(e.scoreInfo),wt(e.partInfo)&&Se(e.partInfo),wt(e.pageInfo)&&se(e.pageInfo),wt(e.mapInfo)&&G(e.mapInfo),wt(e.bpm)&&0!=e.bpm&&j(e.bpm),wt(e.actions)&&Me(e.actions))}function Y(t){e.isObject(t)&&(wt(t.title)&&z(t.title),wt(t.instruments)&&Le(t.instruments),wt(t.bpm)&&X(t.bpm),wt(t.scoreDir)&&H(t.scoreDir))}function z(t){Wi.score.title!==t&&(Wi.score.title=t,Wi.score.noSpaceTitle=e.replaceEmptySpaces(t,Vt),i.setElementText(Gi.idTitle,t))}function H(e){Wi.scoreDir!==e&&(Wi.scoreDir=e)}function X(e){Wi.tempo!==e&&(Wi.tempo=e,i.setElementText(Gi.idTempoBpm,e))}function j(t){var i=e.toInt(t);if(!Ot(i)){var n=Wi.tempo,r=i/n;Wi.tempoModifier=r,X(i),Wi.isPlaying?Q(r):J()}}function G(t){if(!Ot(t.map)&&!Ot(t.pageId)){t.pageId;var i=t.staveId,n=t.map,r=Wi[i];if(!Ot(r)){var o=r.config.xLeftMargin,a=JSON.parse(JSON.stringify(n));if(e.isArray(a)){for(var s={},l=0;l<a.length;l++)W(s,a[l],o);r.beatMap=s,K(i)}}}}function W(e,t,i){if(!(Ot(e)||Ot(t)||Ot(t.beatStartNum))){var n=t.beatStartNum,r=t.xStart+i,o=t.xEnd+i,a=new l(r,o,t.yStart,t.yEnd,n,t.beatStartDenom,t.beatEndNum,t.beatEndDenom);e[n]=a}}function Q(e){Z(Wi.topStave.timeline,e),Z(Wi.bottomStave.timeline,e)}function Z(e,t){if(!Ot(e)){var i=e.timeScale(),n=i*t;e.timeScale(n)}}function J(){$(Wi.topStave),$(Wi.bottomStave)}function K(e){Ot(e)||$(Wi[e])}function $(e){if(!Ot(e)){var t=gsap.timeline({onComplete:ne,onCompleteParams:[e.id],paused:!0}),i=e.beatMap;if(!Ot(i)){var n=e.config.positionLineId,o=e.config.beatBallId,a=e.config.ballYmax,s=!0;for(var l in i){var c=i[l],d=Wi.tempo,f=r.getBeatDurationSec(d),u=c.beatStartNum;if(s){var v=Gi.beatIdPrefix+(u-1),m=c.xStart,S=ee(n,0,m,v,0);t.add(S,ei);var p=te(o,0,m,v);t.add(p,ti),s=!1}m=c.xEnd,v=Gi.beatIdPrefix+u;var I=Gi.tweenIdPrefix+v,g=ee(n,f,m,v,u),b=te(o,f,m,v),P=ie(o,f/2,a,v);I=g.vars.id;t.addLabel(I,ti),t.add(g,ti),t.add(b,ei),t.add(P,I)}wt(e.currentBeat)&&mt(t,e.currentBeat),e.timeline=t}}}function ee(t,i,n,r,o){var a=Gi.tweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:a,duration:i,attr:{x1:n,x2:n},ease:"none",onStart:re,onStartParams:[r,o],onComplete:oe,onCompleteParams:[r,o]})}function te(t,i,n,r){var o=Gi.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cx:n},ease:"none"})}function ie(t,i,n,r){var o=Gi.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cy:n,r:2},ease:"power1.out",autoAlpha:.5,repeat:1,yoyo:!0})}function ne(e){Mt("onTimelineComplete stave: "+e);var t=Wi[e];wt(t)&&(t.isRunning=!1),wt(t.timeline)&&t.timeline.pause(0)}function re(e,t){var i=n.getCurrentTime();Wi.audioTlBeatTime=i,Mt("onBeatStart: beat: "+e+" beatNo: "+t+" beatTime: "+i),ae(t,e)}function oe(e,t){var i=n.getCurrentTime(),r=i-Wi.startTimeTl;Mt("onBeatEnd: beat: "+e+" beatNo: "+t+" elapsedTime: "+r)}function ae(t,i){e.isNumeric(t)&&(e.isNull(i)&&(i=Gi.beatIdPrefix+t),Wi.currentBeatId=i,Wi.currentBeatNo=t)}function se(e){if(!Ot(e.staveId)){var t=e.staveId,i=Wi[t];Ot(i)?Rt("processPageinfo: Invalid stave for id: {}",t):(wt(e.filename)&&(i.filename=e.filename),wt(e.pageId)&&(i.pageId=e.pageId),wt(e.rndPageId)?i.rndPageId=e.rndPageId:i.rndPageId=null,le(i))}}function le(t){if(!Ot(t)){var i=t.config;if(!Ot(i)){var n=null,r=t.pageId;wt(t.rndPageId)&&(r=t.rndPageId);var o=fe(r);n=Ot(o)?de(t.fileName):o.src;var a=e.getElement(i.imgId);a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),a.setAttribute("href",n)}}}function ce(t){if(!Ot(t)){var i=t.config;if(!Ot(i)){var n=t.fileName,r=e.getElement(i.imgId);r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),r.setAttribute("href",n)}}}function de(e){return Wi.scoreDir+Wi.score.noSpaceTitle+Ft+e}function fe(e){var t=Wi.part.pages[e];return Ot(t)?null:t.img}function ue(e){var t=Wi.part.pages[e];wt(t)&&(t.isLoaded=!0),Wi.pageNoToLoad--,0===Wi.pageNoToLoad&&me(),ve(Wi.pageNoToLoad)}function ve(e){if(e>0){var t=zt+" "+e;F(Gi.errorRectStyle,Gi.errorBtnAttrib,Gi.errorTxtStyle,t)}else F(Gi.connectedRectStyle,Gi.connectedBtnAttrib,Gi.connectedTxtStyle,Ht)}function me(){Ct("onPageLoadComplete: ");var e=Wi.part.pages,t=!0;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n.isLoaded||(Ct("onPageLoadComplete: page: "+i+" is not loaded, retying load"),Pe(n.no),t=!1)}t&&(Ct("All Pages loaded: "),Wi.isReady=!0,we())}function Se(t){if(wt(t.name)&&(Wi.part.name=t.name,i.setElementText(Gi.idInstrument,t.name)),wt(t.pageRanges)){var n=t.pageRanges;if(e.isArray(n))for(var r=0;r<n.length;r++)Ne(n[r]);else Ne(n)}wt(t.imgDir)&&(Wi.part.imgDir=t.imgDir),wt(t.imgPageNameToken)&&(Wi.part.imgPageNameToken=t.imgPageNameToken),wt(t.imgContPageName)&&(Wi.part.imgContPageName=t.imgContPageName),wt(t.contPageNo)&&(Wi.part.contPageNo=t.contPageNo),pe()}function pe(){var t=Wi.part,i=t.pageRanges;if(e.isArray(i)){for(var n=0;n<i.length;n++)be(i[n]);Ie(),ge()}}function Ie(){var e=Ee();Wi.pageNoToLoad++,ye(e)}function ge(){var e=Te();Wi.pageNoToLoad++,ye(e)}function be(t){if(e.isObject(t)){var i=1,n=1;wt(t.start)&&(i=e.toInt(t.start)),wt(t.end)&&(n=e.toInt(t.end));var r=Wi.pageNoToLoad+(n-i+1);Wi.pageNoToLoad=r;for(var o=i;o<=n;o++)Pe(o)}}function Pe(e){var t=xe(e);ye(t)}function ye(e){if(!Ot(e)){var t=e.imgFileUrl;Ot(t)||e.loadImg(t,e.id)}}function xe(t){var i=he(t),n=Wi.part.pages[i];if(wt(n))return n;var r=Wi.part.imgPageNameToken;r=Ot(r)?ke(t):e.replace(r,Gi.pageNoToken,""+t);var o=Wi.part.imgDir+r;n=new c(i,t,r,o);return Wi.part.pages[i]=n,n}function Te(){var e=Wi.part.contPageNo,t=he(e),i=Wi.part.pages[t];if(wt(i))return i;var n=Wi.part.imgContPageName,r=Wi.part.imgDir+n;i=new c(t,e,n,r);return Wi.part.pages[t]=i,i}function Ee(){var e=Wi.part.blankPageNo,t=he(e),i=Wi.part.pages[t];if(wt(i))return i;var n=Gi.blankPageUrl,r=Gi.blankPageUrl;i=new c(t,e,n,r);return Wi.part.pages[t]=i,i}function ke(e){return Wi.score.noSpaceTitle+Vt+instrumentName+"_page"+e+".png"}function he(e){return Gi.pageIdPrefix+e}function Ne(e){if(!(Ot(e)||Ot(e.start)||Ot(e.end))){var t=e.start,i=e.end,n={start:t,end:i};Wi.part.pageRanges=[],Wi.part.pageRanges.push(n)}}function Le(t){var i=[];if(e.isArray(t))for(var n=0;n<t.length;n++){var r=t[n];e.arrContains(Gi.filterOutParts,r)||i.push(r)}else e.arrContains(Gi.filterOutParts,r)||i.push(t);e.arrEquals(Wi.score.parts,i)||(Wi.score.parts=i),Be(i)?Oe(Wi.part.name):Ae(i)}function Be(t){if(Ot(Wi.part.name)||!e.isArray(t))return!1;for(var i=Wi.part.name,n=0;n<t.length;n++)if(i===t[n])return!0;return!1}function Ae(t){var i=e.getElement(Gi.idParts);if(!Ot(i)){e.removeElementChildren(i);for(var n=0;n<t.length;n++){var r=t[n];if(!e.arrContains(Gi.filterOutParts,r)){var o=new d(n+1,r),a=e.createDiv(),s=e.createButton(o);e.setText(s,r),e.addChildToParent(a,s),e.addChildToParent(i,a)}}e.makeVisible(Gi.idPartsListOuterDiv)}}function Oe(e){var i=new v;i[Bi]=e,t.sendEvent(ki,i)}function we(){var e=new v;e[Bi]=Wi.part.name,t.sendEvent(hi,e)}function Re(e){var i=new v;i[Ai]=e,t.sendEvent(Ni,i)}function Ce(e,i,n){var r=new v;r[Mi]=e,r[Di]=i,r[Bi]=n,t.sendEvent(Li,r)}function Me(t){var i=null,n=[],r={};if(e.isArray(t))for(var o=0;o<t.length;o++){var a=t[o];wt(a.type)&&(i=a.type),wt(a.targets)&&(n=a.targets),wt(a.params)&&(r=a.params),De(i,n,r)}}function De(t,i,n){if(e.logDebug("doAction: "+t),!Ot(t))switch(t){case"PING":Lt(n);break;case"START":_e(Et,i,null);break;case"STOP":Tt();break;case"SEMAPHORE_ON":It(n);break;case"SEMAPHORE_OFF":gt(n);break;case"ACTIVATE":_e(St,i,n);break;case"BEAT":_e(ut,i,n);break;case"START_MARK":_e(ct,i,n);break;case"INSTRUMENT_SLOTS":tt(n);break;case"RESET_INSTRUMENT_SLOTS":et();break;case"RESET_STAVES":Ke();break;case"OVERLAY_ELEMENT":_e(He,i,n);break;case"OVERLAY_LINE":_e(qe,i,n);break;case"OVERLAY_COLOUR":_e(Ve,i,n);break;default:Rt("doAction: Unknown actionType: "+t)}}function _e(t,i,n){if(!Ot(t))if(e.isArray(i))for(var r=0;r<i.length;r++)t(i[r],n);else t(target,n)}function Ve(e,t){if(!Ot(t)&&!Ot(e)){var i=Wi[e],n=t[_i],r=t[Yi];Fe(i,n,r)}}function Fe(e,t,i){if(!(Ot(e)||Ot(t)||Ot(i)))switch(t){case"POSITION":Ue(e.config.ovrlPosId+Gi.idRectSuffix,i);break;case"PITCH":Ue(e.config.ovrlPitchId+Gi.idRectSuffix,i);break;case"SPEED":Ue(e.config.ovrlSpeedId+Gi.idRectSuffix,i);break;case"PRESSURE":Ue(e.config.ovrlPressId+Gi.idRectSuffix,i);break;case"DYNAMICS":Ue(e.config.ovrlDynId+Gi.idRectSuffix,i);break;default:Ct("setOverlayColour: unknown overlay type: "+t)}}function Ue(t,i){e.setElementIdStyleProperty(t,{fill:i})}function qe(e,t){if(!Ot(t)&&!Ot(e)){var i=Wi[e],n=t[_i],r=t[Fi];Ye(i,n,r)}}function Ye(e,t,i){if(!(Ot(e)||Ot(t)||Ot(i)))switch(t){case"POSITION":ze(e.config.ovrlPosId+Gi.idLineSuffix,i);break;case"PITCH":ze(e.config.ovrlPitchId+Gi.idLineSuffix,i);break;case"SPEED":ze(e.config.ovrlSpeedId+Gi.idLineSuffix,i);break;case"PRESSURE":ze(e.config.ovrlPressId+Gi.idLineSuffix,i);break;case"DYNAMICS":ze(e.config.ovrlDynId+Gi.idLineSuffix,i);break;default:Ct("setOverlayElement: unknown overlay type: "+t)}}function ze(t,n){var r=e.getElement(t);i.setLineY(r,n,n)}function He(e,t){if(!Ot(t)&&!Ot(e)){var i=Wi[e],n=t[_i],r=t[Vi],o=t[Ui],a=t[qi];Xe(i,n,r,o,a)}}function Xe(e,t,i,n,r){if(!Ot(e)&&!Ot(t)){var o=e.config;if(!Ot(o))switch(Mt("setOverlayElement: overlayType: "+t),t){case"POSITION":Ze(o,i,n,r);break;case"PITCH":Qe(o,i,n,r);break;case"SPEED":We(o,i,n,r);break;case"PRESSURE":Ge(o,i,n,r);break;case"DYNAMICS":je(o,i,n,r);break;default:Ct("setOverlayElement: unknown overlay type: "+t)}}}function je(e,t,i,n){if(!Ot(t)&&!Ot(e))switch(t){case"DYNAMICS_BOX":Je(e.ovrlDynId+Gi.idRectSuffix,i,n),Je(e.ovrlDynId+Gi.idOrdSuffix+Gi.idLineSuffix,i,n),Je(e.ovrlDynId,i,n),i||Je(e.ovrlDynId+Gi.idLineSuffix,i,n);break;case"DYNAMICS_MID_LINE":Je(e.ovrlDynId+Gi.idOrdSuffix+Gi.idLineSuffix,i,n);break;case"DYNAMICS_LINE":Je(e.ovrlDynId+Gi.idLineSuffix,i,n);break;default:Ct("setOverlayElement: unknown overlay type: "+t)}}function Ge(e,t,i,n){if(!Ot(t)&&!Ot(e))switch(t){case"PRESSURE_BOX":Je(e.ovrlPressId+Gi.idRectSuffix,i,n),Je(e.ovrlPressId+Gi.idOrdSuffix+Gi.idLineSuffix,i,n),Je(e.ovrlPressId,i,n),i||Je(e.ovrlPressId+Gi.idLineSuffix,i,n);break;case"PRESSURE_MID_LINE":Je(e.ovrlPressId+Gi.idOrdSuffix+Gi.idLineSuffix,i,n);break;case"PRESSURE_LINE":Je(e.ovrlPressId+Gi.idLineSuffix,i,n);break;default:Ct("setOverlayElement: unknown overlay type: "+t)}}function We(e,t,i,n){if(!Ot(t)&&!Ot(e))switch(t){case"SPEED_BOX":Je(e.ovrlSpeedId+Gi.idRectSuffix,i,n),Je(e.ovrlSpeedId+Gi.idOrdSuffix+Gi.idLineSuffix,i,n),Je(e.ovrlSpeedId,i,n),i||Je(e.ovrlSpeedId+Gi.idLineSuffix,i,n);break;case"SPEED_MID_LINE":Je(e.ovrlSpeedId+Gi.idOrdSuffix+Gi.idLineSuffix,i,n);break;case"SPEED_LINE":Je(e.ovrlSpeedId+Gi.idLineSuffix,i,n);break;default:Ct("setOverlayElement: unknown overlay type: "+t)}}function Qe(e,t,i,n){if(!Ot(t)&&!Ot(e))switch(t){case"PITCH_BOX":Je(e.ovrlPitchId+Gi.idRectSuffix,i,n),Je(e.ovrlPitchId,i,n),i||Je(e.ovrlPitchId+Gi.idLineSuffix,i,n);break;case"PITCH_LINE":Je(e.ovrlPitchId+Gi.idLineSuffix,i,n);break;default:Ct("setOverlayElement: unknown overlay type: "+t)}}function Ze(e,t,i,n){if(!Ot(t)&&!Ot(e))switch(t){case"POSITION_BOX":Je(e.ovrlPosId+Gi.idRectSuffix,i,n),Je(e.ovrlPosId+Gi.idOrdSuffix+Gi.idLineSuffix,i,n),Je(e.ovrlPosId+Gi.idBridgeSuffix+Gi.idLineSuffix,i,n),Je(e.ovrlPosId,i,n),i||Je(e.ovrlPosId+Gi.idLineSuffix,i,n);break;case"POSITION_LINE":Je(e.ovrlPosId+Gi.idLineSuffix,i,n);break;case"POSITION_BRIDGE_LINE":Je(e.ovrlPosId+Gi.idBridgeSuffix+Gi.idLineSuffix,i,n);break;case"POSITION_ORD_LINE":Je(e.ovrlPosId+Gi.idOrdSuffix+Gi.idLineSuffix,i,n);break;default:Ct("setOverlayElement: unknown overlay type: "+t)}}function Je(t,i,n){if(!Ot(t))if(i){var r=e.toFloat(n);e.isNumeric(r)||(r=1),e.setElementIdStyleProperty(t,{opacity:r}),e.makeVisible(t)}else e.makeInVisible(t)}function Ke(){$e(Wi.topStave),$e(Wi.bottomStave)}function $e(e){Ot(e)||(e.pageId=Hi,e.rndPageId=null,e.filename=zi,e.beatMap=null,e.timeline=null,e.isActive=!0,e.isPlaying=!1,e.currentBeat=null,p(e),ce(e))}function et(){ot(),nt()}function tt(e){if(!Ot(e)){var t=e[Ci];rt(t),it()}}function it(){e.makeVisible(Gi.idInstControls)}function nt(){e.makeInVisible(Gi.idInstControls)}function rt(t){if(!Ot(t)){var i=e.csvToArr(t);if(!(Ot(i)||i.length<=0)){var n=Wi.score.parts;if(!(Ot(n)||n.length<=0))for(var r=0;r<n.length;r++){var o=r+1;r<i.length?at(i[r],o):st(o)}}}}function ot(){var e=Wi.score.parts;if(!(Ot(e)||e.length<=0))for(var t=0;t<e.length;t++){var i=t+1;lt(i)}}function at(t,n){if(!Ot(t)&&!Ot(n)){var r=Gi.idInstSlotTxtPrefix+n,o=Gi.idInstSlotBtnPrefix+n,a=Gi.idInstSlotPrefix+n,s=t===Wi.part.name;e.makeVisible(r),e.makeVisible(o),e.makeVisible(a),e.setElementIdAttributes(a,Gi.instSlotActiveAttrib),i.setElementText(r,t.trim()),e.setElementIdStyleProperty(r,Gi.instSlotTxtActiveStyle),s?e.setElementIdStyleProperty(o,Gi.instSlotBtnActiveInstStyle):e.setElementIdStyleProperty(o,Gi.instSlotBtnActiveStyle);var l=new f(n,t);e.setElementIdAttributes(o,l)}}function st(t){var n=Gi.idInstSlotTxtPrefix+t,r=Gi.idInstSlotBtnPrefix+t,o=Gi.idInstSlotPrefix+t;e.makeVisible(n),e.makeVisible(r),e.makeVisible(o),e.setElementIdAttributes(o,Gi.instSlotInActiveAttrib),i.setElementText(n,_t),e.setElementIdStyleProperty(n,Gi.instSlotTxtInActiveStyle),e.setElementIdStyleProperty(r,Gi.instSlotBtnInActiveStyle);var a=new u;e.setElementIdAttributes(r,a)}function lt(t){var i=Gi.idInstSlotTxtPrefix+t,n=Gi.idInstSlotBtnPrefix+t,r=Gi.idInstSlotPrefix+t;e.makeInVisible(i),e.makeInVisible(n),e.makeInVisible(r);var o=new u;e.setElementIdAttributes(n,o)}function ct(e,t){if(!Ot(t)&&!Ot(e)){var n=Wi[e],r=t[Ri];if(!Ot(n)&&!Ot(r)){var o=n.beatMap;if(!Ot(o)){var a=o[r];if(!Ot(a)){var s=a.xStart-1,l=dt(n);i.setLineX(l,s,s),ft(l,!0)}}}}}function dt(t){return e.getElement(t.config.startLineId)}function ft(t,i){i?e.makeElementVisible(t):e.makeElementInVisible(t)}function ut(e,t){if(!Ot(t)&&!Ot(e)){var i=Wi[e],n=t[Ri];vt(i,n)}}function vt(e,t){if(!Ot(e)&&!Ot(t)){var i=n.getCurrentTime();Mt("setStaveBeat: stave: "+e.id+" beat: "+t+" time: "+i),mt(e.timeline,t),e.currentBeat=t}}function mt(e,t){if(!Ot(e)){var i=Gi.tweenIdPrefix+Gi.beatIdPrefix+t,r=e.labels;i in r?(n.beep(),e.seek(i)):Mt("setTimelineBeat: Invalid beat "+i)}}function St(e,t){if(!Ot(t)&&!Ot(e)){var i=Wi[e],n=t[Oi],r=t[wi];pt(i,n,r)}}function pt(t,i,n){if(!(Ot(t)||Ot(i)||Ot(n))){if(i)e.setElementIdStyleProperty(t.config.maskId,Gi.activeStaveStyle);else{e.setElementIdStyleProperty(t.config.maskId,Gi.inactiveStaveStyle);var r=dt(t);ft(r,!1)}n&&kt(t.timeline)}}function It(e){Ot(e)||Pt(e.lightNo,e.colourId)}function gt(e){Ot(e)||yt(e.lightNo,fi)}function bt(){yt(4,fi),yt(1,ni)}function Pt(e,t){var i=xt(t);yt(e,i)}function yt(t,n){if(!Ot(t)&&!Ot(n))for(var r=e.toInt(t),o=1;o<=r;o++){var a=Gi.idSemaphorePrefix+o;i.setElementColour(a,n)}}function xt(e){var t;switch(e||(e=1),e){case 4:t=ni;break;case 3:t=ri;break;case 2:t=oi;break;case 1:default:t=ii}return t}function Tt(){ht(),Wi.isPlaying=!1,bt(),S()}function Et(e){if(!Ot(e)){var t=Wi[e];if(!Ot(t)){var i=t.timeline;Ot(i)||(kt(i),Wi.isPlaying=!0)}}}function kt(e){if(Ot(e))Rt("startTimeline: invalid timeline");else{var t=e.progress();t>0&&t<1?e.resume():e.play(0)}}function ht(){Nt(Wi.topStave.timeline),Nt(Wi.bottomStave.timeline),Wi.bottomStave.isPlaying=!1,Wi.topStave.isPlaying=!1}function Nt(e){Ot(e)?Rt("stopTimeline: invalid timeline"):e.pause()}function Lt(t){e.isObject(t)&&wt(t.sendTimeMs)&&Re(t.sendTimeMs)}function Bt(t,i){e.setElementStyleProperty(t,i)}function At(t,i){e.setElementAttributes(t,i)}function Ot(t){return e.isNull(t)}function wt(t){return e.isNotNull(t)}function Rt(t){e.logError(t)}function Ct(t){e.log(t)}function Mt(t){e.logDebug(t)}const Dt="dev",_t="",Vt="_",Ft="/",Ut="AV",qt="FullScore",Yt="Connected",zt="Loading",Ht="READY",Xt="Reconnecting",jt="Error",Gt="visible",Wt="hidden",Qt="none",Zt="x",Jt="x1",Kt="x2",$t="width",ei="<",ti=">",ii="green",ni="red",ri="orange",oi="yellow",ai="white",si="black",li="blue",ci="grey",di="lightgrey",fi=Qt,ui=fi,vi=ai,mi=ii,Si=ni,pi=ri,Ii=li,gi=ci,bi=ii,Pi=ni,yi=ri,xi=ai,Ti=ai,Ei=si,ki="PART_REG",hi="PART_READY",Ni="PING",Li="SELECT_ISLOT",Bi="part",Ai="serverTime",Oi="isActive",wi="isPlay",Ri="beatNo",Ci="csvInstruments",Mi="slotNo",Di="slotInstrument",_i="overlayType",Vi="overlayElement",Fi="overlayLineY",Ui="isEnabled",qi="opacity",Yi="colour",zi="img/blankStave.png",Hi="p0";var Xi=null,ji=null,Gi={connectionPreference:"ws,sse,poll",defaultConnectionType:t.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",pageNoToken:"@PgNo@",instToken:"@Inst@",slotNoToken:"@SlotNo@",pageIdPrefix:"p",tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",idParts:"parts",idPartsListOuterDiv:"partListOuterDiv",idInstrument:"part",idInstControls:"instControls",idInstSlotPrefix:"instSlot",idInstSlotTxtPrefix:"instSlotTxt",idInstSlotBtnPrefix:"instSlotRect",idTempoBpm:"tmpBpm",idSemaphorePrefix:"semC",idLineSuffix:"Line",idBridgeSuffix:"Bridge",idOrdSuffix:"Ord",idRectSuffix:"Rect",blankPageUrl:"img/blankStave.png",filterOutParts:[Ut,qt],connectedRectStyle:{fill:mi,stroke:bi,"stroke-width":"0px",visibility:Gt,opacity:1},disconnectedRectStyle:{fill:Si,stroke:Pi,"stroke-width":"1px",visibility:Gt,opacity:1},errorRectStyle:{fill:pi,stroke:yi,"stroke-width":"1px",visibility:Gt,opacity:1},connectedTxtStyle:{fill:xi},disconnectedTxtStyle:{fill:Ti},errorTxtStyle:{fill:Ei},activeStaveStyle:{fill:ui,stroke:Ii,"stroke-width":"1px",visibility:Gt,opacity:.5},inactiveStaveStyle:{fill:vi,stroke:gi,"stroke-width":"1px",visibility:Gt,opacity:.4},instSlotBtnActiveStyle:{fill:ai,stroke:si,"stroke-width":"1px",visibility:Gt,opacity:1},instSlotBtnActiveInstStyle:{fill:"#d7f2cd",stroke:si,"stroke-width":"1px",visibility:Gt,opacity:1},instSlotBtnInActiveStyle:{fill:di,stroke:Qt,visibility:Gt,opacity:1},instSlotTxtActiveStyle:{fill:si,visibility:Gt,opacity:1},instSlotTxtInActiveStyle:{fill:si,stroke:Qt,visibility:Wt,opacity:0},instSlotActiveAttrib:{filter:"url(#dropshadow)"},instSlotInActiveAttrib:{filter:"none"},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},errorBtnAttrib:{filter:"url(#dropshadow)"},topStave:{gId:"stvTop",imgId:"stvTopImg",startLineId:"stvTopStartLine",positionLineId:"stvTopPosLine",beatBallId:"stvTopBeatBall",maskId:"stvTopMask",ovrlPosId:"ovrlTopPos",ovrlPitchId:"ovrlTopPitch",ovrlSpeedId:"ovrlTopSpeed",ovrlPressId:"ovrlTopPres",ovrlDynId:"ovrlTopDyn",ballYmax:84,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"80",x2:"95",y2:"281"},posBallConf:{cx:"95",cy:"110",r:"4"}},bottomStave:{gId:"stvBot",imgId:"stvBotImg",startLineId:"stvBotStartLine",positionLineId:"stvBotPosLine",beatBallId:"stvBotBeatBall",maskId:"stvBotMask",ovrlPosId:"ovrlBotPos",ovrlPitchId:"ovrlBotPitch",ovrlSpeedId:"ovrlBotSpeed",ovrlPressId:"ovrlBotPres",ovrlDynId:"ovrlBotDyn",ballYmax:305,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"301",x2:"95",y2:"502"},posBallConf:{cx:"95",cy:"331",r:"4"}},metro:{idMetronomeRect:"metroRect",idMetronome:"metro",idMetroSlider:"metroFreqSlider",idMetroFreqRect:"metroFreq",idMetroFreqLine:"metroFreqLine",ifSymbolMetroOff:"#metronome",ifSymbolMetroOn:"#metronomeOn",ifMetroFreqSlider:"#metroFreq",minFreq:220,maxFreq:2200}},Wi={isPlaying:!1,isReady:!1,score:{title:"ZScore",noSpaceTitle:"ZScore",instrument:"Part View",parts:["Part View"],firstPageNo:1,lastPageNo:2},part:{name:"Part View",imgDir:null,imgPageNameToken:null,imgContPageName:null,blankPageNo:0,contPageNo:6666,pageRanges:[{start:1,end:1}],pages:{}},topStave:{id:"topStave",config:Gi.topStave,pageId:Hi,rndPageId:null,filename:zi,beatMap:null,timeline:null,isActive:!0,isPlaying:!1,currentBeat:null},bottomStave:{id:"bottomStave",config:Gi.bottomStave,pageId:Hi,rndPageId:null,filename:zi,beatMap:null,timeline:null,isActive:!1,isPlaying:!1,currentBeat:null},startTimeTl:0,currentBeatId:"b0",currentBeatNo:0,tempo:0,tempoModifier:1,scoreDir:"/score/",currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,isConnected:!1,isInitialised:!1,connectionType:null,pageNoToLoad:0,metro:{isMetroOn:!1,slider:{xMax:60,xMin:40,xMid:50,range:20}}};return c.prototype.loadImg=function(e){this.img.src=e,this.img.onload=function(){Ct("pageImgOnLoad: id: "+this.pageId),ue(this.pageId)}},{onStateBtn:function(){I()},onPartSelect:function(e){g(e)},onInstrumentSelect:function(e,t){b(e,t)}}}(zsUtil,zsNet,zsSvg,zsWsAudio,zsMusic,window,document);