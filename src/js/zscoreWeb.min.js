var zscore=function(t,e,n,i,r,o,s){"use strict";function c(t){this.message=t,this.name="ZScoreException"}function a(t,e){this.id="partBtn"+t,this.class="partListButton",this.onclick="onPartSelect('"+e+"')"}function l(){}function u(){if(!xt.isInitialised){if(!(t&&e&&n&&i&&r))throw new c("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");t.setRunMode(J),_("init: "),Bt=t.isTouchDevice(),It=t.isSafari(navigator),_("init: IsTouch Device: "+Bt+" isSafari: "+It),xt.fontCanvas=s.createElement("canvas"),xt.canvasCtx=xt.fontCanvas.getContext("2d"),t.listen("resize",o,g),t.listen("orientationchange",o,g),v(),b(),S(),xt.isInitialised=!0}}function d(){xt.isInitialised?(_("onStateBtnClick: zscore initialised"),e.isConnected()||(_("onStateBtnClick: zscore not connected, reconnecting..."),E())):(_("onStateBtnClick: initialising"),u())}function f(e){t.arrContains(xt.score.parts,e)?(xt.score.instrument=e,V(e),t.makeInVisible(wt.idPartsListOuterDiv)):_("onPartSelection: unexpected part: "+e)}function p(t){}function m(){T()}function v(){e.init(wt.connectionPreference,wt.appUrlSse,wt.appUrlWebsockets,wt.appUrlHttp,C,y)}function S(){F(i)?Y("initAudio: invalid zsAudio lib"):i.init(yt,0)}function T(){F(i)?Y("resetAudio: invalid zsAudio lib"):i.reset()}function b(){n.init()}function g(e){if(!t.isObject(this))return null}function y(t,n){switch(t){case e.OPEN:B(n);break;case e.CLOSED:I(n);break;case e.ERROR:w(n);break;default:Y("Unknown Connection Event State: "+t+" for type: "+n)}}function B(t){_(t+" connection opened."),x(t)}function I(t){_(t+" connection closed."),P(t)}function w(t){_(t+" connection error."),h(t)}function x(t){xt.isConnected=!0,xt.connectionType=t,xt.reconnectAttmpts=0,k(wt.connectedRectStyle,wt.connectedBtnAttrib,wt.connectedTxtStyle,$)}function P(t){xt.isConnected=!1,k(wt.disconnectedRectStyle,wt.disconnectedBtnAttrib,wt.disconnectedTxtStyle,tt),E(t)}function h(t){xt.isConnected=!1,k(wt.errorRectStyle,wt.errorBtnAttrib,wt.errorTxtStyle,et),E(t)}function k(e,n,i,r){var o=t.getElement(wt.idServerStatusRect);F(o)||H(o,e);var s=t.getElement(wt.idServerStatusBtn);F(s)||Z(s,n);var c=t.getElement(wt.idServerStatusTxt);F(c)||(H(c,i),c.textContent=r)}function E(t){e.reconnect(t,!0)}function C(t,e){xt.isConnected||x(),F(t)||(e||m(),K(t.scoreInfo)&&A(t.scoreInfo),K(t.partInfo)&&N(t.partInfo),K(t.pageInfo)&&O(t.pageInfo),K(t.actions)&&G(t.actions))}function A(e){t.isObject(e)&&(K(e.title)&&R(e.title),K(e.instruments)&&U(e.instruments),K(e.bpm)&&D(e.bpm),K(e.scoreDir)&&z(e.scoreDir))}function R(t){xt.score.title!==t&&(xt.score.title=t,n.setElementText(wt.idTitle,t))}function z(t){xt.scoreDir!==t&&(xt.scoreDir=t)}function D(t){xt.tempo!==t&&(xt.tempo=t,n.setElementText(wt.idTempoBpm,t))}function O(t){if(!F(t.staveId)){t.staveId;xt.score.instrument=part,n.setElementText(wt.idInstrument,part)}}function N(t){K(t.name)&&(xt.score.instrument=t.name,n.setElementText(wt.idInstrument,t.name))}function U(e){var n=[];t.isArray(e)?n=e:n.push(e),t.arrEquals(xt.score.parts,n)||(xt.score.parts=n),M(n)?V(xt.score.instrument):L(n)}function M(e){if(F(xt.score.instrument)||!t.isArray(e))return!1;for(var n=xt.score.instrument,i=0;i<e.length;i++)if(n===e[i])return!0;return!1}function L(e){var n=t.getElement(wt.idParts);if(!F(n)){t.removeElementChildren(n);for(var i=0;i<e.length;i++){var r=e[i];if(!t.arrContains(wt.filterOutParts,r)){var o=new a(i+1,r),s=t.createDiv(),c=t.createButton(o);t.setText(c,r),t.addChildToParent(s,c),t.addChildToParent(n,s)}}t.makeVisible(wt.idPartsListOuterDiv)}}function V(t){var n=new l;n[bt]=t,e.sendEvent(St,n)}function j(t){var n=new l;n[gt]=t,e.sendEvent(Tt,n)}function G(e){var n=null,i=[],r={};if(t.isArray(e))for(var o=0;o<e.length;o++){var s=e[o];K(s.type)&&(n=s.type),K(s.targets)&&(i=s.targets),K(s.params)&&(r=s.params),W(n,i,r)}}function W(t,e,n){if(_("doAction: "+t),!F(t))switch(t){case"PING":q(n);break;default:Y("doAction: Unknown actionType: "+t)}}function q(e){t.isObject(e)&&K(e.sendTimeMs)&&j(e.sendTimeMs)}function H(e,n){t.setElementStyleProperty(e,n)}function Z(e,n){t.setElementAttributes(e,n)}function F(e){return t.isNull(e)}function K(e){return t.isNotNull(e)}function Y(e){t.logError(e)}function _(e){t.log(e)}const J="DEV",Q="AV",X="FullScore",$="Connected",tt="Reconnecting",et="Error",nt="green",it="red",rt="orange",ot="white",st="black",ct=nt,at=it,lt=rt,ut=nt,dt=it,ft=rt,pt=ot,mt=ot,vt=st,St="PART_REG",Tt="PING",bt="part",gt="serverTime";var yt=["/audio/violin-tuning.mp3"],Bt=null,It=null,wt={connectionPreference:"ws,sse,poll",defaultConnectionType:e.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",idParts:"parts",idPartsListOuterDiv:"partListOuterDiv",idInstrument:"part",idTempoBpm:"tmpBpm",filterOutParts:[Q,X],connectedRectStyle:{fill:ct,stroke:ut,"stroke-width":"0px",visibility:"visible",opacity:1},disconnectedRectStyle:{fill:at,stroke:dt,"stroke-width":"1px",visibility:"visible",opacity:1},errorRectStyle:{fill:lt,stroke:ft,"stroke-width":"1px",visibility:"visible",opacity:1},connectedTxtStyle:{fill:pt},disconnectedTxtStyle:{fill:mt},errorTxtStyle:{fill:vt},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},errorBtnAttrib:{filter:"url(#dropshadow)"}},xt={isRunning:!1,score:{title:"ZScore",instrument:"Part View",parts:["Part View"],firstPageNo:1,lastPageNo:2},topStave:{pageId:"0",filename:"img/blankStave.png",timeSpaceMap:{}},bottomStave:{pageId:"0",filename:"img/blankStave.png",timeSpaceMap:{}},tsBaseBeatMaps:{},startTimeTl:0,currentBeatId:"b0",tempo:0,scoreDir:"/score/",topStaveTimeline:{},bottomStaveTimeline:{},lastTimelineBeatNo:0,currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,isConnected:!1,isInitialised:!1,connectionType:null};return{onStateBtn:function(){d()},onPartSelect:function(t){f(t)},onInstrumentSelect:function(t){p(t)}}}(zsUtil,zsNet,zsSvg,zsAudio,zsMusic,window,document);