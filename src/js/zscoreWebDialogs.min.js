var zscore=function(e,t,i,n,r,o,a){"use strict";function s(e){this.message=e,this.name="ZScoreException"}function l(e,t,i,n,r,o,a,s){this.xStart=e,this.xEnd=t,this.yStart=i,this.yEnd=n,this.beatStartNum=r,this.beatStartDenom=o,this.beatEndNum=a,this.beatEndDenom=s}function c(e,t,i,n){this.id=e,this.no=t,this.imgFileName=i,this.imgFileUrl=n,this.isLoaded=!1,this.img=new Image,this.img.pageId=e}function f(e,t){this.id="sectionBtn"+e,this.class="sectionListButton",this.onclick="onSectionSelect('"+t+"')"}function d(e,t){this.onclick="onInstrumentSelect("+e+",'"+t+"')"}function u(){this.onclick=""}function v(){}function m(){if(!gn.isInitialised){if(!(e&&t&&i&&n&&r))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");e.setRunMode(Zt),Wt("init: "),S(),mn=e.isTouchDevice(),Sn=e.isSafari(navigator),Wt("init: IsTouch Device: "+mn+" isSafari: "+Sn),gn.fontCanvas=a.createElement("canvas"),gn.canvasCtx=gn.fontCanvas.getContext("2d"),e.listen("resize",o,M),e.listen("orientationchange",o,M),k(),C(),R(),h(),gn.isInitialised=!0}}function S(){var t=e.getLocalParam(Ui);Xt(t)&&(t=e.generateRandomId(),e.storeLocalParam(Ui,t)),gn.clientId=t,Wt("clientId: "+gn.clientId)}function p(){gn.part.pages={}}function g(){I(gn.topStave),I(gn.bottomStave)}function I(t){if(!Xt(t)&&!Xt(t.config)){var i=t.config;e.setElementIdAttributes(i.positionLineId,i.posLineConf),e.setElementIdAttributes(i.beatBallId,i.posBallConf)}}function b(){gn.isInitialised?(Wt("onStateBtnClick: zscore initialised"),t.isConnected()||(Wt("onStateBtnClick: zscore not connected, reconnecting..."),H())):(Wt("onStateBtnClick: initialising"),m())}function y(t){e.arrContains(gn.score.parts,t)?(gn.part.name=t,Ye(t),e.makeInVisible(pn.idPartsListOuterDiv)):Wt("onPartSelection: unexpected part: "+t)}function P(t){e.arrContains(gn.score.sections,t)?(x(t),Ge(t)):Wt("onSectionSelection: unexpected section: "+t)}function x(e){}function E(e,t){Xt(e)||Xt(t)||Xt(gn.part.name)||je(e,t,gn.part.name)}function T(){w()}function k(){t.init(pn.connectionPreference,pn.appUrlSse,pn.appUrlWebsockets,pn.appUrlHttp,X,D)}function h(){var t=e.getElement(pn.metro.idMetronomeRect);Xt(t)||(e.listen("click",t,B),L())}function L(){var t=e.getElement(pn.metro.idMetroFreqLine),i=e.getElement(pn.metro.idMetroFreqRect);if(jt(t)&&jt(i)){var n=e.toInt(t.getAttribute(ui)),r=e.toInt(i.getAttribute(vi)),o=Math.round(r/2),a=n-o;gn.metro.slider.xMax=a;var s=e.toInt(t.getAttribute(di)),l=s+o;gn.metro.slider.xMin=l;var c=a-l;gn.metro.slider.range=c;var f=Math.round((a+l)/2);gn.metro.slider.xMid=f}Draggable.create(pn.metro.ifMetroFreqSlider,{type:fi,bounds:document.getElementById(pn.metro.idMetroFreqLine),onDrag:N})}function N(t){var i=gsap.getProperty(pn.metro.ifMetroFreqSlider,fi),r=gn.metro.slider.xMid+i,o=r-gn.metro.slider.xMin,a=Math.round(100*o/gn.metro.slider.range),s=e.mapRange(a,0,100,pn.metro.minFreq,pn.metro.maxFreq);s<200&&(s=200),n.setBeepFreqenecy(s),Wt("onFreqSliderMove: freq: "+s)}function B(e){gn.metro.isMetroOn?A():O()}function A(){n.switchMetro(!1),i.setElementIdHref(pn.metro.idMetronome,pn.metro.ifSymbolMetroOff),e.makeInVisible(pn.metro.idMetroSlider),gn.metro.isMetroOn=!1}function O(){n.switchMetro(!0),i.setElementIdHref(pn.metro.idMetronome,pn.metro.ifSymbolMetroOn),e.makeVisible(pn.metro.idMetroSlider),gn.metro.isMetroOn=!0}function R(){Xt(n)?Gt("initAudio: invalid zsAudio lib"):n.init()}function w(){Xt(n)?Gt("resetAudio: invalid zsAudio lib"):n.reset()}function C(){i.init()}function M(t){if(!e.isObject(this))return null}function D(e,i){switch(e){case t.OPEN:_(i);break;case t.CLOSED:F(i);break;case t.ERROR:V(i);break;default:Gt("Unknown Connection Event State: "+e+" for type: "+i)}}function _(e){Wt(e+" connection opened."),U(e)}function F(e){Wt(e+" connection closed."),q(e)}function V(e){Wt(e+" connection error."),z(e)}function U(e){gn.isConnected=!0,gn.connectionType=e,gn.reconnectAttmpts=0,Y(pn.connectedRectStyle,pn.connectedBtnAttrib,pn.connectedTxtStyle,ii),ze()}function q(e){gn.isConnected=!1,Y(pn.disconnectedRectStyle,pn.disconnectedBtnAttrib,pn.disconnectedTxtStyle,oi),H(e)}function z(e){gn.isConnected=!1,Y(pn.errorRectStyle,pn.errorBtnAttrib,pn.errorTxtStyle,ai),H(e)}function Y(t,i,n,r){var o=e.getElement(pn.idServerStatusRect);Xt(o)||Yt(o,t);var a=e.getElement(pn.idServerStatusBtn);Xt(a)||Ht(a,i);var s=e.getElement(pn.idServerStatusTxt);Xt(s)||(Yt(s,n),s.textContent=r)}function H(e){t.reconnect(e,!0)}function X(e,t){gn.isConnected||U(),Xt(e)||(t||T(),jt(e.scoreInfo)&&j(e.scoreInfo),jt(e.partInfo)&&ye(e.partInfo),jt(e.pageInfo)&&ue(e.pageInfo),jt(e.mapInfo)&&K(e.mapInfo),jt(e.bpm)&&0!=e.bpm&&J(e.bpm),jt(e.actions)&&Qe(e.actions))}function j(t){if(e.isObject(t)){if(jt(t.partHtmlPage)){var i=W(t.partHtmlPage),n=e.getPageName();i&&t.partHtmlPage!==n&&e.loadPage(t.partHtmlPage)}if(jt(t.title)){var r=G(t.title);r&&p()}jt(t.strategies)&&we(t.strategies),jt(t.instruments)&&Ue(t.instruments),jt(t.bpm)&&Z(t.bpm),jt(t.scoreDir)&&Q(t.scoreDir)}}function G(t){return gn.score.title!==t&&(gn.score.title=t,gn.score.noSpaceTitle=e.replaceEmptySpaces(t,Kt),i.setElementText(pn.idTitle,t),!0)}function W(e){var t=gn.score.htmlFile;return Xt(t)?(gn.score.htmlFile=e,!1):t!==e&&(gn.score.htmlFile=e,!0)}function Q(e){gn.scoreDir!==e&&(gn.scoreDir=e)}function Z(e){gn.tempo!==e&&(gn.tempo=e,i.setElementText(pn.idTempoBpm,e))}function J(t){var i=e.toInt(t);if(!Xt(i)){var n=gn.tempo,r=i/n;gn.tempoModifier=r,Z(i),gn.isPlaying?ee(r):ie()}}function K(t){if(!Xt(t.map)&&!Xt(t.pageId)){t.pageId;var i=t.staveId,n=t.map,r=gn[i];if(!Xt(r)){var o=r.config.xLeftMargin,a=JSON.parse(JSON.stringify(n));if(e.isArray(a)){for(var s={},l=0;l<a.length;l++)$(s,a[l],o);r.beatMap=s,ne(i)}}}}function $(e,t,i){if(!(Xt(e)||Xt(t)||Xt(t.beatStartNum))){var n=t.beatStartNum,r=t.xStart+i,o=t.xEnd+i,a=new l(r,o,t.yStart,t.yEnd,n,t.beatStartDenom,t.beatEndNum,t.beatEndDenom);e[n]=a}}function ee(e){te(gn.topStave.timeline,e),te(gn.bottomStave.timeline,e)}function te(e,t){if(!Xt(e)){var i=e.timeScale(),n=i*t;e.timeScale(n)}}function ie(){re(gn.topStave),re(gn.bottomStave)}function ne(e){Xt(e)||re(gn[e])}function re(e){if(!Xt(e)){var t=gsap.timeline({onComplete:le,onCompleteParams:[e.id],paused:!0}),i=e.beatMap;if(!Xt(i)){var n=e.config.positionLineId,o=e.config.beatBallId,a=e.config.ballYmax,s=!0;for(var l in i){var c=i[l],f=gn.tempo,d=r.getBeatDurationSec(f),u=c.beatStartNum;if(s){var v=pn.beatIdPrefix+(u-1),m=c.xStart,S=oe(n,0,m,v,0);t.add(S,mi);var p=ae(o,0,m,v);t.add(p,Si),s=!1}m=c.xEnd,v=pn.beatIdPrefix+u;var g=pn.tweenIdPrefix+v,I=oe(n,d,m,v,u),b=ae(o,d,m,v),y=se(o,d/2,a,v);g=I.vars.id;t.addLabel(g,Si),t.add(I,Si),t.add(b,mi),t.add(y,g)}jt(e.currentBeat)&&Nt(t,e.currentBeat),e.timeline=t}}}function oe(t,i,n,r,o){var a=pn.tweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:a,duration:i,attr:{x1:n,x2:n},ease:"none",onStart:ce,onStartParams:[r,o],onComplete:fe,onCompleteParams:[r,o]})}function ae(t,i,n,r){var o=pn.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cx:n},ease:"none"})}function se(t,i,n,r){var o=pn.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cy:n,r:2},ease:"power1.out",autoAlpha:.5,repeat:1,yoyo:!0})}function le(e){Qt("onTimelineComplete stave: "+e);var t=gn[e];jt(t)&&(t.isRunning=!1),jt(t.timeline)&&t.timeline.pause(0)}function ce(e,t){var i=n.getCurrentTime();gn.audioTlBeatTime=i,Qt("onBeatStart: beat: "+e+" beatNo: "+t+" beatTime: "+i),de(t,e)}function fe(e,t){var i=n.getCurrentTime(),r=i-gn.startTimeTl;Qt("onBeatEnd: beat: "+e+" beatNo: "+t+" elapsedTime: "+r)}function de(t,i){e.isNumeric(t)&&(e.isNull(i)&&(i=pn.beatIdPrefix+t),gn.currentBeatId=i,gn.currentBeatNo=t)}function ue(e){if(!Xt(e.staveId)){var t=e.staveId,i=gn[t];Xt(i)?Gt("processPageinfo: Invalid stave for id: {}",t):(jt(e.filename)&&(i.filename=e.filename),jt(e.pageId)&&(i.pageId=e.pageId),jt(e.rndPageId)?i.rndPageId=e.rndPageId:i.rndPageId=null,ve(i))}}function ve(t){if(!Xt(t)){var i=t.config;if(!Xt(i)){var n=null,r=t.pageId;jt(t.rndPageId)&&(r=t.rndPageId);var o=pe(r);n=Xt(o)?Se(t.fileName):o.src;var a=e.getElement(i.imgId);a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),a.setAttribute("href",n)}}}function me(t){if(!Xt(t)){var i=t.config;if(!Xt(i)){var n=t.fileName,r=e.getElement(i.imgId);r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),r.setAttribute("href",n)}}}function Se(e){return gn.scoreDir+gn.score.noSpaceTitle+$t+e}function pe(e){var t=gn.part.pages[e];return Xt(t)?null:t.img}function ge(e){var t=gn.part.pages[e];jt(t)&&(t.isLoaded=!0),gn.pageNoToLoad--,0===gn.pageNoToLoad&&be(),Ie(gn.pageNoToLoad)}function Ie(e){if(e>0){var t=ni+" "+e;Y(pn.errorRectStyle,pn.errorBtnAttrib,pn.errorTxtStyle,t)}else Y(pn.connectedRectStyle,pn.connectedBtnAttrib,pn.connectedTxtStyle,ri)}function be(){Wt("onPageLoadComplete: ");var e=gn.part.pages,t=!0;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n.isLoaded||(Wt("onPageLoadComplete: page: "+i+" is not loaded, retying load"),ke(n.no),t=!1)}t&&(Wt("All Pages loaded: "),gn.isReady=!0,He())}function ye(t){if(jt(t.name)&&(gn.part.name=t.name,i.setElementText(pn.idInstrument,t.name)),jt(t.pageRanges)){var n=t.pageRanges;if(e.isArray(n))for(var r=0;r<n.length;r++)Re(n[r]);else Re(n)}jt(t.imgDir)&&(gn.part.imgDir=t.imgDir),jt(t.imgPageNameToken)&&(gn.part.imgPageNameToken=t.imgPageNameToken),jt(t.imgContPageName)&&(gn.part.imgContPageName=t.imgContPageName),jt(t.contPageNo)&&(gn.part.contPageNo=t.contPageNo),Pe()}function Pe(){var t=gn.part,i=t.pageRanges;if(e.isArray(i)){for(var n=0;n<i.length;n++)Te(i[n]);xe(),Ee()}}function xe(){var e=Be();gn.pageNoToLoad++,he(e)}function Ee(){var e=Ne();gn.pageNoToLoad++,he(e)}function Te(t){if(e.isObject(t)){var i=1,n=1;jt(t.start)&&(i=e.toInt(t.start)),jt(t.end)&&(n=e.toInt(t.end));var r=gn.pageNoToLoad+(n-i+1);gn.pageNoToLoad=r;for(var o=i;o<=n;o++)ke(o)}}function ke(e){var t=Le(e);he(t)}function he(e){if(!Xt(e)){var t=e.imgFileUrl;Xt(t)||e.loadImg(t,e.id)}}function Le(t){var i=Oe(t),n=gn.part.pages[i];if(jt(n))return n;var r=gn.part.imgPageNameToken;r=Xt(r)?Ae(t):e.replace(r,pn.pageNoToken,""+t);var o=gn.part.imgDir+r;n=new c(i,t,r,o);return gn.part.pages[i]=n,n}function Ne(){var e=gn.part.contPageNo,t=Oe(e),i=gn.part.pages[t];if(jt(i))return i;var n=gn.part.imgContPageName,r=gn.part.imgDir+n;i=new c(t,e,n,r);return gn.part.pages[t]=i,i}function Be(){var e=gn.part.blankPageNo,t=Oe(e),i=gn.part.pages[t];if(jt(i))return i;var n=pn.blankPageUrl,r=pn.blankPageUrl;i=new c(t,e,n,r);return gn.part.pages[t]=i,i}function Ae(e){return gn.score.noSpaceTitle+Kt+instrumentName+"_page"+e+".png"}function Oe(e){return pn.pageIdPrefix+e}function Re(e){if(!(Xt(e)||Xt(e.start)||Xt(e.end))){var t=e.start,i=e.end,n={start:t,end:i};gn.part.pageRanges=[],gn.part.pageRanges.push(n)}}function we(t){if(!Xt(t))if(e.isArray(t))for(var i=0;i<t.length;i++)Ce(t[i]);else Ce(t)}function Ce(t){if(e.isObject(t))if(Xt(t.name))Gt("processStrategies: invalid strategy name");else{var i=t.name;switch(i){case un:Me(t);break;case vn:Ve(t);break;default:Gt("processStrategies: Unknown strategy: "+i)}}}function Me(t){var i=!1;if(jt(t.isReady)&&(i=e.toBoolean(t.isReady)),jt(t.sections))if(gn.score.sections.length>0&&(gn.score.sections=[]),e.isArray(t.sections))for(var n=0;n<t.sections.length;n++)De(t.sections[n]);else De(t.sections);jt(t.assignmentType)&&(gn.score.assignmentType=t.assignmentType),i?Fe():_e()}function De(e){Xt(e)||gn.score.sections.push(e)}function _e(){var t=gn.score.sections;if(!(t.length<1)){var i=e.getElement(pn.idSections);if(!Xt(i)){e.removeElementChildren(i);for(var n=0;n<t.length;n++){var r=t[n];if(!e.arrContains(pn.filterOutParts,r)){var o=new f(n+1,r),a=(e.createDiv(),e.createButton(o));e.setText(a,r),e.addChildToParent(i,a)}}e.makeVisible(pn.idSectionsListOuterDiv)}}}function Fe(){var t=e.getElement(pn.idSections);Xt(t)||(e.removeElementChildren(t),e.makeInVisible(pn.idSectionsListOuterDiv))}function Ve(e){}function Ue(t){var i=[];if(e.isArray(t))for(var n=0;n<t.length;n++){var r=t[n];e.arrContains(pn.filterOutParts,r)||i.push(r)}else e.arrContains(pn.filterOutParts,r)||i.push(t);e.arrEquals(gn.score.parts,i)||(gn.score.parts=i),qe(i)&&Ye(gn.part.name)}function qe(t){if(Xt(gn.part.name)||!e.isArray(t))return!1;for(var i=gn.part.name,n=0;n<t.length;n++)if(i===t[n])return!0;return!1}function ze(){var e=We();t.sendEvent(qi,e)}function Ye(e){var i=We();i[Gi]=e,t.sendEvent(zi,i)}function He(){var e=We();e[Gi]=gn.part.name,t.sendEvent(Yi,e)}function Xe(e){var i=We();i[Wi]=e,t.sendEvent(Hi,i)}function je(e,i,n){var r=We();r[$i]=e,r[en]=i,r[Gi]=n,t.sendEvent(Xi,r)}function Ge(e){var i=We();i[ln]=e,t.sendEvent(ji,i)}function We(){var e=new v;return e[cn]=gn.clientId,e}function Qe(t){var i=null,n=[],r={};if(e.isArray(t))for(var o=0;o<t.length;o++){var a=t[o];jt(a.type)&&(i=a.type),jt(a.targets)&&(n=a.targets),jt(a.params)&&(r=a.params),Ze(i,n,r)}}function Ze(t,i,n){if(e.logDebug("doAction: "+t),!Xt(t))switch(t){case"PING":zt(n);break;case"START":Je(Ft,i,null);break;case"STOP":_t();break;case"SEMAPHORE_ON":Ot(n);break;case"SEMAPHORE_OFF":Rt(n);break;case"ACTIVATE":Je(Bt,i,n);break;case"BEAT":Je(ht,i,n);break;case"START_MARK":Je(Et,i,n);break;case"INSTRUMENT_SLOTS":St(n);break;case"RESET_INSTRUMENT_SLOTS":mt();break;case"RESET_STAVES":ut();break;case"OVERLAY_ELEMENT":Je(rt,i,n);break;case"OVERLAY_LINE":Je(tt,i,n);break;case"OVERLAY_COLOUR":Je(Ke,i,n);break;default:Gt("doAction: Unknown actionType: "+t)}}function Je(t,i,n){if(!Xt(t))if(e.isArray(i))for(var r=0;r<i.length;r++)t(i[r],n);else t(target,n)}function Ke(e,t){if(!Xt(t)&&!Xt(e)){var i=gn[e],n=t[tn],r=t[sn];$e(i,n,r)}}function $e(e,t,i){if(!(Xt(e)||Xt(t)||Xt(i)))switch(t){case"POSITION":et(e.config.ovrlPosId+pn.idRectSuffix,i);break;case"PITCH":et(e.config.ovrlPitchId+pn.idRectSuffix,i);break;case"SPEED":et(e.config.ovrlSpeedId+pn.idRectSuffix,i);break;case"PRESSURE":et(e.config.ovrlPressId+pn.idRectSuffix,i);break;case"DYNAMICS":et(e.config.ovrlDynId+pn.idRectSuffix,i);break;default:Wt("setOverlayColour: unknown overlay type: "+t)}}function et(t,i){e.setElementIdStyleProperty(t,{fill:i})}function tt(e,t){if(!Xt(t)&&!Xt(e)){var i=gn[e],n=t[tn],r=t[rn];it(i,n,r)}}function it(e,t,i){if(!(Xt(e)||Xt(t)||Xt(i)))switch(t){case"POSITION":nt(e.config.ovrlPosId+pn.idLineSuffix,i);break;case"PITCH":nt(e.config.ovrlPitchId+pn.idLineSuffix,i);break;case"SPEED":nt(e.config.ovrlSpeedId+pn.idLineSuffix,i);break;case"PRESSURE":nt(e.config.ovrlPressId+pn.idLineSuffix,i);break;case"DYNAMICS":nt(e.config.ovrlDynId+pn.idLineSuffix,i);break;default:Wt("setOverlayElement: unknown overlay type: "+t)}}function nt(t,n){var r=e.getElement(t);i.setLineY(r,n,n)}function rt(e,t){if(!Xt(t)&&!Xt(e)){var i=gn[e],n=t[tn],r=t[nn],o=t[on],a=t[an];ot(i,n,r,o,a)}}function ot(e,t,i,n,r){if(!Xt(e)&&!Xt(t)){var o=e.config;if(!Xt(o))switch(Qt("setOverlayElement: overlayType: "+t),t){case"POSITION":ft(o,i,n,r);break;case"PITCH":ct(o,i,n,r);break;case"SPEED":lt(o,i,n,r);break;case"PRESSURE":st(o,i,n,r);break;case"DYNAMICS":at(o,i,n,r);break;default:Wt("setOverlayElement: unknown overlay type: "+t)}}}function at(e,t,i,n){if(!Xt(t)&&!Xt(e))switch(t){case"DYNAMICS_BOX":dt(e.ovrlDynId+pn.idRectSuffix,i,n),dt(e.ovrlDynId+pn.idOrdSuffix+pn.idLineSuffix,i,n),dt(e.ovrlDynId,i,n),i||dt(e.ovrlDynId+pn.idLineSuffix,i,n);break;case"DYNAMICS_MID_LINE":dt(e.ovrlDynId+pn.idOrdSuffix+pn.idLineSuffix,i,n);break;case"DYNAMICS_LINE":dt(e.ovrlDynId+pn.idLineSuffix,i,n);break;default:Wt("setOverlayElement: unknown overlay type: "+t)}}function st(e,t,i,n){if(!Xt(t)&&!Xt(e))switch(t){case"PRESSURE_BOX":dt(e.ovrlPressId+pn.idRectSuffix,i,n),dt(e.ovrlPressId+pn.idOrdSuffix+pn.idLineSuffix,i,n),dt(e.ovrlPressId,i,n),i||dt(e.ovrlPressId+pn.idLineSuffix,i,n);break;case"PRESSURE_MID_LINE":dt(e.ovrlPressId+pn.idOrdSuffix+pn.idLineSuffix,i,n);break;case"PRESSURE_LINE":dt(e.ovrlPressId+pn.idLineSuffix,i,n);break;default:Wt("setOverlayElement: unknown overlay type: "+t)}}function lt(e,t,i,n){if(!Xt(t)&&!Xt(e))switch(t){case"SPEED_BOX":dt(e.ovrlSpeedId+pn.idRectSuffix,i,n),dt(e.ovrlSpeedId+pn.idOrdSuffix+pn.idLineSuffix,i,n),dt(e.ovrlSpeedId,i,n),i||dt(e.ovrlSpeedId+pn.idLineSuffix,i,n);break;case"SPEED_MID_LINE":dt(e.ovrlSpeedId+pn.idOrdSuffix+pn.idLineSuffix,i,n);break;case"SPEED_LINE":dt(e.ovrlSpeedId+pn.idLineSuffix,i,n);break;default:Wt("setOverlayElement: unknown overlay type: "+t)}}function ct(e,t,i,n){if(!Xt(t)&&!Xt(e))switch(t){case"PITCH_BOX":dt(e.ovrlPitchId+pn.idRectSuffix,i,n),dt(e.ovrlPitchId,i,n),i||dt(e.ovrlPitchId+pn.idLineSuffix,i,n);break;case"PITCH_LINE":dt(e.ovrlPitchId+pn.idLineSuffix,i,n);break;default:Wt("setOverlayElement: unknown overlay type: "+t)}}function ft(e,t,i,n){if(!Xt(t)&&!Xt(e))switch(t){case"POSITION_BOX":dt(e.ovrlPosId+pn.idRectSuffix,i,n),dt(e.ovrlPosId+pn.idOrdSuffix+pn.idLineSuffix,i,n),dt(e.ovrlPosId+pn.idBridgeSuffix+pn.idLineSuffix,i,n),dt(e.ovrlPosId,i,n),i||dt(e.ovrlPosId+pn.idLineSuffix,i,n);break;case"POSITION_LINE":dt(e.ovrlPosId+pn.idLineSuffix,i,n);break;case"POSITION_BRIDGE_LINE":dt(e.ovrlPosId+pn.idBridgeSuffix+pn.idLineSuffix,i,n);break;case"POSITION_ORD_LINE":dt(e.ovrlPosId+pn.idOrdSuffix+pn.idLineSuffix,i,n);break;default:Wt("setOverlayElement: unknown overlay type: "+t)}}function dt(t,i,n){if(!Xt(t))if(i){var r=e.toFloat(n);e.isNumeric(r)||(r=1),e.setElementIdStyleProperty(t,{opacity:r}),e.makeVisible(t)}else e.makeInVisible(t)}function ut(){vt(gn.topStave),vt(gn.bottomStave)}function vt(e){Xt(e)||(e.pageId=dn,e.rndPageId=null,e.filename=fn,e.beatMap=null,e.timeline=null,e.isActive=!0,e.isPlaying=!1,e.currentBeat=null,I(e),me(e))}function mt(){bt(),gt()}function St(e){if(!Xt(e)){var t=e[Ki];It(t),pt()}}function pt(){e.makeVisible(pn.idInstControls)}function gt(){e.makeInVisible(pn.idInstControls)}function It(t){if(!Xt(t)){var i=e.csvToArr(t);if(!(Xt(i)||i.length<=0)){var n=gn.score.parts;if(!(Xt(n)||n.length<=0))for(var r=0;r<n.length;r++){var o=r+1;r<i.length?yt(i[r],o):Pt(o)}}}}function bt(){var e=gn.score.parts;if(!(Xt(e)||e.length<=0))for(var t=0;t<e.length;t++){var i=t+1;xt(i)}}function yt(t,n){if(!Xt(t)&&!Xt(n)){var r=pn.idInstSlotTxtPrefix+n,o=pn.idInstSlotBtnPrefix+n,a=pn.idInstSlotPrefix+n,s=t===gn.part.name;e.makeVisible(r),e.makeVisible(o),e.makeVisible(a),e.setElementIdAttributes(a,pn.instSlotActiveAttrib),i.setElementText(r,t.trim()),e.setElementIdStyleProperty(r,pn.instSlotTxtActiveStyle),s?e.setElementIdStyleProperty(o,pn.instSlotBtnActiveInstStyle):e.setElementIdStyleProperty(o,pn.instSlotBtnActiveStyle);var l=new d(n,t);e.setElementIdAttributes(o,l)}}function Pt(t){var n=pn.idInstSlotTxtPrefix+t,r=pn.idInstSlotBtnPrefix+t,o=pn.idInstSlotPrefix+t;e.makeVisible(n),e.makeVisible(r),e.makeVisible(o),e.setElementIdAttributes(o,pn.instSlotInActiveAttrib),i.setElementText(n,Jt),e.setElementIdStyleProperty(n,pn.instSlotTxtInActiveStyle),e.setElementIdStyleProperty(r,pn.instSlotBtnInActiveStyle);var a=new u;e.setElementIdAttributes(r,a)}function xt(t){var i=pn.idInstSlotTxtPrefix+t,n=pn.idInstSlotBtnPrefix+t,r=pn.idInstSlotPrefix+t;e.makeInVisible(i),e.makeInVisible(n),e.makeInVisible(r);var o=new u;e.setElementIdAttributes(n,o)}function Et(e,t){if(!Xt(t)&&!Xt(e)){var n=gn[e],r=t[Ji];if(!Xt(n)&&!Xt(r)){var o=n.beatMap;if(!Xt(o)){var a=o[r];if(!Xt(a)){var s=a.xStart-1,l=Tt(n);i.setLineX(l,s,s),kt(l,!0)}}}}}function Tt(t){return e.getElement(t.config.startLineId)}function kt(t,i){i?e.makeElementVisible(t):e.makeElementInVisible(t)}function ht(e,t){if(!Xt(t)&&!Xt(e)){var i=gn[e],n=t[Ji];Lt(i,n)}}function Lt(e,t){if(!Xt(e)&&!Xt(t)){var i=n.getCurrentTime();Qt("setStaveBeat: stave: "+e.id+" beat: "+t+" time: "+i),Nt(e.timeline,t),e.currentBeat=t}}function Nt(e,t){if(!Xt(e)){var i=pn.tweenIdPrefix+pn.beatIdPrefix+t,r=e.labels;i in r?(n.beep(),e.seek(i)):Qt("setTimelineBeat: Invalid beat "+i)}}function Bt(e,t){if(!Xt(t)&&!Xt(e)){var i=gn[e],n=t[Qi],r=t[Zi];At(i,n,r)}}function At(t,i,n){if(!(Xt(t)||Xt(i)||Xt(n))){if(i)e.setElementIdStyleProperty(t.config.maskId,pn.activeStaveStyle);else{e.setElementIdStyleProperty(t.config.maskId,pn.inactiveStaveStyle);var r=Tt(t);kt(r,!1)}n&&Vt(t.timeline)}}function Ot(e){Xt(e)||Ct(e.lightNo,e.colourId)}function Rt(e){Xt(e)||Mt(e.lightNo,ki)}function wt(){Mt(4,ki),Mt(1,gi)}function Ct(e,t){var i=Dt(t);Mt(e,i)}function Mt(t,n){if(!Xt(t)&&!Xt(n))for(var r=e.toInt(t),o=1;o<=r;o++){var a=pn.idSemaphorePrefix+o;i.setElementColour(a,n)}}function Dt(e){var t;switch(e||(e=1),e){case 4:t=gi;break;case 3:t=Ii;break;case 2:t=bi;break;case 1:default:t=pi}return t}function _t(){Ut(),gn.isPlaying=!1,wt(),g()}function Ft(e){if(!Xt(e)){var t=gn[e];if(!Xt(t)){var i=t.timeline;Xt(i)||(Vt(i),gn.isPlaying=!0)}}}function Vt(e){if(Xt(e))Gt("startTimeline: invalid timeline");else{var t=e.progress();t>0&&t<1?e.resume():e.play(0)}}function Ut(){qt(gn.topStave.timeline),qt(gn.bottomStave.timeline),gn.bottomStave.isPlaying=!1,gn.topStave.isPlaying=!1}function qt(e){Xt(e)?Gt("stopTimeline: invalid timeline"):e.pause()}function zt(t){e.isObject(t)&&jt(t.sendTimeMs)&&Xe(t.sendTimeMs)}function Yt(t,i){e.setElementStyleProperty(t,i)}function Ht(t,i){e.setElementAttributes(t,i)}function Xt(t){return e.isNull(t)}function jt(t){return e.isNotNull(t)}function Gt(t){e.logError(t)}function Wt(t){e.log(t)}function Qt(t){e.logDebug(t)}const Zt="dev",Jt="",Kt="_",$t="/",ei="AV",ti="FullScore",ii="Connected",ni="Loading",ri="READY",oi="Reconnecting",ai="Error",si="visible",li="hidden",ci="none",fi="x",di="x1",ui="x2",vi="width",mi="<",Si=">",pi="green",gi="red",Ii="orange",bi="yellow",yi="white",Pi="black",xi="blue",Ei="grey",Ti="lightgrey",ki=ci,hi=ki,Li=yi,Ni=pi,Bi=gi,Ai=Ii,Oi=xi,Ri=Ei,wi=pi,Ci=gi,Mi=Ii,Di=yi,_i=yi,Fi=Pi,Vi=6666,Ui="zsClientId",qi="HELLO",zi="PART_REG",Yi="PART_READY",Hi="PING",Xi="SELECT_ISLOT",ji="SELECT_SECTION",Gi="part",Wi="serverTime",Qi="isActive",Zi="isPlay",Ji="beatNo",Ki="csvInstruments",$i="slotNo",en="slotInstrument",tn="overlayType",nn="overlayElement",rn="overlayLineY",on="isEnabled",an="opacity",sn="colour",ln="section",cn="clientId",fn="img/blankStave.png",dn="p0",un="BUILDER",vn="RND";var mn=null,Sn=null,pn={connectionPreference:"ws,sse,poll",defaultConnectionType:t.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",pageNoToken:"@PgNo@",instToken:"@Inst@",slotNoToken:"@SlotNo@",pageIdPrefix:"p",tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",idParts:"parts",idPartsListOuterDiv:"partListOuterDiv",idSections:"sections",idSectionsListOuterDiv:"sectionListOuterDiv",idInstrument:"part",idInstControls:"instControls",idInstSlotPrefix:"instSlot",idInstSlotTxtPrefix:"instSlotTxt",idInstSlotBtnPrefix:"instSlotRect",idTempoBpm:"tmpBpm",idSemaphorePrefix:"semC",idLineSuffix:"Line",idBridgeSuffix:"Bridge",idOrdSuffix:"Ord",idRectSuffix:"Rect",blankPageUrl:"img/blankStave.png",filterOutParts:[ei,ti],connectedRectStyle:{fill:Ni,stroke:wi,"stroke-width":"0px",visibility:si,opacity:1},disconnectedRectStyle:{fill:Bi,stroke:Ci,"stroke-width":"1px",visibility:si,opacity:1},errorRectStyle:{fill:Ai,stroke:Mi,"stroke-width":"1px",visibility:si,opacity:1},connectedTxtStyle:{fill:Di},disconnectedTxtStyle:{fill:_i},errorTxtStyle:{fill:Fi},activeStaveStyle:{fill:hi,stroke:Oi,"stroke-width":"1px",visibility:si,opacity:.5},inactiveStaveStyle:{fill:Li,stroke:Ri,"stroke-width":"1px",visibility:si,opacity:.4},instSlotBtnActiveStyle:{fill:yi,stroke:Pi,"stroke-width":"1px",visibility:si,opacity:1},instSlotBtnActiveInstStyle:{fill:"#d7f2cd",stroke:Pi,"stroke-width":"1px",visibility:si,opacity:1},instSlotBtnInActiveStyle:{fill:Ti,stroke:ci,visibility:si,opacity:1},instSlotTxtActiveStyle:{fill:Pi,visibility:si,opacity:1},instSlotTxtInActiveStyle:{fill:Pi,stroke:ci,visibility:li,opacity:0},instSlotActiveAttrib:{filter:"url(#dropshadow)"},instSlotInActiveAttrib:{filter:"none"},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},errorBtnAttrib:{filter:"url(#dropshadow)"},topStave:{gId:"stvTop",imgId:"stvTopImg",startLineId:"stvTopStartLine",positionLineId:"stvTopPosLine",beatBallId:"stvTopBeatBall",maskId:"stvTopMask",ovrlPosId:"ovrlTopPos",ovrlPitchId:"ovrlTopPitch",ovrlSpeedId:"ovrlTopSpeed",ovrlPressId:"ovrlTopPres",ovrlDynId:"ovrlTopDyn",ballYmax:84,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"80",x2:"95",y2:"281"},posBallConf:{cx:"95",cy:"110",r:"4"}},bottomStave:{gId:"stvBot",imgId:"stvBotImg",startLineId:"stvBotStartLine",positionLineId:"stvBotPosLine",beatBallId:"stvBotBeatBall",maskId:"stvBotMask",ovrlPosId:"ovrlBotPos",ovrlPitchId:"ovrlBotPitch",ovrlSpeedId:"ovrlBotSpeed",ovrlPressId:"ovrlBotPres",ovrlDynId:"ovrlBotDyn",ballYmax:305,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"301",x2:"95",y2:"502"},posBallConf:{cx:"95",cy:"331",r:"4"}},metro:{idMetronomeRect:"metroRect",idMetronome:"metro",idMetroSlider:"metroFreqSlider",idMetroFreqRect:"metroFreq",idMetroFreqLine:"metroFreqLine",ifSymbolMetroOff:"#metronome",ifSymbolMetroOn:"#metronomeOn",ifMetroFreqSlider:"#metroFreq",minFreq:220,maxFreq:2200}},gn={clientId:null,isPlaying:!1,isReady:!1,score:{title:"ZScore",noSpaceTitle:"ZScore",htmlFile:null,instrument:"Part View",parts:["Part View"],firstPageNo:1,lastPageNo:2,sections:[],assignmentType:null},part:{name:"Part View",imgDir:null,imgPageNameToken:null,imgContPageName:null,blankPageNo:0,contPageNo:Vi,pageRanges:[{start:1,end:1}],pages:{}},topStave:{id:"topStave",config:pn.topStave,pageId:dn,rndPageId:null,filename:fn,beatMap:null,timeline:null,isActive:!0,isPlaying:!1,currentBeat:null},bottomStave:{id:"bottomStave",config:pn.bottomStave,pageId:dn,rndPageId:null,filename:fn,beatMap:null,timeline:null,isActive:!1,isPlaying:!1,currentBeat:null},startTimeTl:0,currentBeatId:"b0",currentBeatNo:0,tempo:0,tempoModifier:1,scoreDir:"/score/",currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,isConnected:!1,isInitialised:!1,connectionType:null,pageNoToLoad:0,metro:{isMetroOn:!1,slider:{xMax:60,xMin:40,xMid:50,range:20}}};return c.prototype.loadImg=function(e){this.img.src=e,this.img.onload=function(){Wt("pageImgOnLoad: id: "+this.pageId),ge(this.pageId)}},{onStateBtn:function(){b()},onPartSelect:function(e){y(e)},onSectionSelect:function(e){P(e)},onInstrumentSelect:function(e,t){E(e,t)}}}(zsUtil,zsNet,zsSvg,zsWsAudio,zsMusic,window,document);