var zscore=function(e,t,i,n,r,o,a){"use strict";function s(e){this.message=e,this.name="ZScoreException"}function l(e,t,i,n,r,o,a,s){this.xStart=e,this.xEnd=t,this.yStart=i,this.yEnd=n,this.beatStartNum=r,this.beatStartDenom=o,this.beatEndNum=a,this.beatEndDenom=s}function c(e,t,i,n){this.id=e,this.no=t,this.imgFileName=i,this.imgFileUrl=n,this.isLoaded=!1,this.img=new Image,this.img.pageId=e}function d(e,t){this.id=kn.idSectionBtnPrefix+t,this.no=e,this.class="sectionListButton",this.onclick="onSectionSelect('"+t+"')"}function f(){this.class="sectionListButtonDisabled",this.onclick=""}function u(e,t){this.onclick="onInstrumentSelect("+e+",'"+t+"')"}function v(){this.onclick=""}function m(){}function S(){if(!hn.isInitialised){if(!(e&&t&&i&&n&&r))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");e.setRunMode(oi),ni("init: "),p(),Tn=e.isTouchDevice(),En=e.isSafari(navigator),ni("init: IsTouch Device: "+Tn+" isSafari: "+En),hn.fontCanvas=a.createElement("canvas"),hn.canvasCtx=hn.fontCanvas.getContext("2d"),e.listen("resize",o,U),e.listen("orientationchange",o,U),O(),F(),_(),w(),hn.isInitialised=!0}}function p(){var t=e.getLocalParam(Qi);ei(t)&&(t=e.generateRandomId(),e.storeLocalParam(Qi,t)),hn.clientId=t,ni("clientId: "+hn.clientId),i.setElementText(kn.idClientId,hn.clientId),L()}function I(){hn.part.pages={}}function g(){b(hn.topStave),b(hn.bottomStave)}function b(t){if(!ei(t)&&!ei(t.config)){var i=t.config;e.setElementIdAttributes(i.positionLineId,i.posLineConf),e.setElementIdAttributes(i.beatBallId,i.posBallConf)}}function P(){hn.isInitialised?(ni("onStateBtnClick: zscore initialised"),t.isConnected()||(ni("onStateBtnClick: zscore not connected, reconnecting..."),Q())):(ni("onStateBtnClick: initialising"),S())}function y(t){e.arrContains(hn.score.parts,t)?(hn.part.name=t,Ze(t),e.makeInVisible(kn.idPartsListOuterDiv)):ni("onPartSelection: unexpected part: "+t)}function x(t){e.arrContains(hn.score.sections,t)?(T(t),et(t)):ni("onSectionSelection: unexpected section: "+t)}function T(t){var i=kn.idSectionBtnPrefix+t,n=e.getElement(i);ei(n)||E(n)}function E(t){ei(t)||e.setElementAttributes(t,new f)}function k(){var t=e.getElement(kn.idOwnedSections);if(!ei(t)){for(var i=hn.score.mySections,n="",r="",o=0;o<i.length;o++)n=n+r+i[o],r="; ";e.setText(t,n)}}function h(e,t){ei(e)||ei(t)||ei(hn.part.name)||($e(e,t,hn.part.name),Tt())}function L(){var t=hn.isClientIdVisible;t?e.makeVisible(kn.idClientId):e.makeInVisible(kn.idClientId)}function B(){hn.isClientIdVisible=!hn.isClientIdVisible,L()}function N(){V()}function O(){t.init(kn.connectionPreference,kn.appUrlSse,kn.appUrlWebsockets,kn.appUrlHttp,Z,q)}function w(){var t=e.getElement(kn.metro.idMetronomeRect);ei(t)||(e.listen("click",t,C),A())}function A(){var t=e.getElement(kn.metro.idMetroFreqLine),i=e.getElement(kn.metro.idMetroFreqRect);if(ti(t)&&ti(i)){var n=e.toInt(t.getAttribute(yi)),r=e.toInt(i.getAttribute(xi)),o=Math.round(r/2),a=n-o;hn.metro.slider.xMax=a;var s=e.toInt(t.getAttribute(Pi)),l=s+o;hn.metro.slider.xMin=l;var c=a-l;hn.metro.slider.range=c;var d=Math.round((a+l)/2);hn.metro.slider.xMid=d}Draggable.create(kn.metro.ifMetroFreqSlider,{type:bi,bounds:document.getElementById(kn.metro.idMetroFreqLine),onDrag:R})}function R(t){var i=gsap.getProperty(kn.metro.ifMetroFreqSlider,bi),r=hn.metro.slider.xMid+i,o=r-hn.metro.slider.xMin,a=Math.round(100*o/hn.metro.slider.range),s=e.mapRange(a,0,100,kn.metro.minFreq,kn.metro.maxFreq);s<200&&(s=200),n.setBeepFreqenecy(s),ni("onFreqSliderMove: freq: "+s)}function C(e){hn.metro.isMetroOn?M():D()}function M(){n.switchMetro(!1),i.setElementIdHref(kn.metro.idMetronome,kn.metro.ifSymbolMetroOff),e.makeInVisible(kn.metro.idMetroSlider),hn.metro.isMetroOn=!1}function D(){n.switchMetro(!0),i.setElementIdHref(kn.metro.idMetronome,kn.metro.ifSymbolMetroOn),e.makeVisible(kn.metro.idMetroSlider),hn.metro.isMetroOn=!0}function _(){ei(n)?ii("initAudio: invalid zsAudio lib"):n.init()}function V(){ei(n)?ii("resetAudio: invalid zsAudio lib"):n.reset()}function F(){i.init()}function U(t){if(!e.isObject(this))return null}function q(e,i){switch(e){case t.OPEN:H(i);break;case t.CLOSED:z(i);break;case t.ERROR:Y(i);break;default:ii("Unknown Connection Event State: "+e+" for type: "+i)}}function H(e){ni(e+" connection opened."),X(e)}function z(e){ni(e+" connection closed."),G(e)}function Y(e){ni(e+" connection error."),j(e)}function X(e){hn.isConnected=!0,hn.connectionType=e,hn.reconnectAttmpts=0,W(kn.connectedRectStyle,kn.connectedBtnAttrib,kn.connectedTxtStyle,fi),Qe()}function G(e){hn.isConnected=!1,W(kn.disconnectedRectStyle,kn.disconnectedBtnAttrib,kn.disconnectedTxtStyle,mi),Q(e)}function j(e){hn.isConnected=!1,W(kn.errorRectStyle,kn.errorBtnAttrib,kn.errorTxtStyle,Si),Q(e)}function W(t,i,n,r){var o=e.getElement(kn.idServerStatusRect);ei(o)||Kt(o,t);var a=e.getElement(kn.idServerStatusBtn);ei(a)||$t(a,i);var s=e.getElement(kn.idServerStatusTxt);ei(s)||(Kt(s,n),s.textContent=r)}function Q(e){t.reconnect(e,!0)}function Z(e,t){hn.isConnected||X(),ei(e)||(t||N(),ti(e.scoreInfo)&&J(e.scoreInfo),ti(e.strategyInfo)&&K(e.strategyInfo),ti(e.partInfo)&&he(e.partInfo),ti(e.pageInfo)&&ge(e.pageInfo),ti(e.mapInfo)&&re(e.mapInfo),ti(e.bpm)&&0!=e.bpm&&ne(e.bpm),ti(e.actions)&&it(e.actions))}function J(t){if(e.isObject(t)){if(ti(t.partHtmlPage)){var i=ee(t.partHtmlPage),n=e.getPageName();i&&t.partHtmlPage!==n&&e.loadPage(t.partHtmlPage)}if(ti(t.title)){var r=$(t.title);r&&I()}ti(t.instruments)&&je(t.instruments),ti(t.bpm)&&ie(t.bpm),ti(t.scoreDir)&&te(t.scoreDir)}}function K(e){ti(e.strategies)&&Ue(e.strategies)}function $(t){return hn.score.title!==t&&(hn.score.title=t,hn.score.noSpaceTitle=e.replaceEmptySpaces(t,si),i.setElementText(kn.idTitle,t),!0)}function ee(e){var t=hn.score.htmlFile;return ei(t)?(hn.score.htmlFile=e,!1):t!==e&&(hn.score.htmlFile=e,!0)}function te(e){hn.scoreDir!==e&&(hn.scoreDir=e)}function ie(e){hn.tempo!==e&&(hn.tempo=e,i.setElementText(kn.idTempoBpm,e))}function ne(t){var i=e.toInt(t);if(!ei(i)){var n=hn.tempo,r=i/n;hn.tempoModifier=r,ie(i),hn.isPlaying?ae(r):le()}}function re(t){if(!ei(t.map)&&!ei(t.pageId)){t.pageId;var i=t.staveId,n=t.map,r=hn[i];if(!ei(r)){var o=r.config.xLeftMargin,a=JSON.parse(JSON.stringify(n));if(e.isArray(a)){for(var s={},l=0;l<a.length;l++)oe(s,a[l],o);r.beatMap=s,ce(i)}}}}function oe(e,t,i){if(!(ei(e)||ei(t)||ei(t.beatStartNum))){var n=t.beatStartNum,r=t.xStart+i,o=t.xEnd+i,a=new l(r,o,t.yStart,t.yEnd,n,t.beatStartDenom,t.beatEndNum,t.beatEndDenom);e[n]=a}}function ae(e){se(hn.topStave.timeline,e),se(hn.bottomStave.timeline,e)}function se(e,t){if(!ei(e)){var i=e.timeScale(),n=i*t;e.timeScale(n)}}function le(){de(hn.topStave),de(hn.bottomStave)}function ce(e){ei(e)||de(hn[e])}function de(e){if(!ei(e)){var t=gsap.timeline({onComplete:me,onCompleteParams:[e.id],paused:!0}),i=e.beatMap;if(!ei(i)){var n=e.config.positionLineId,o=e.config.beatBallId,a=e.config.ballYmax,s=!0;for(var l in i){var c=i[l],d=hn.tempo,f=r.getBeatDurationSec(d),u=c.beatStartNum;if(s){var v=kn.beatIdPrefix+(u-1),m=c.xStart,S=fe(n,0,m,v,0);t.add(S,Ti);var p=ue(o,0,m,v);t.add(p,Ei),s=!1}m=c.xEnd,v=kn.beatIdPrefix+u;var I=kn.tweenIdPrefix+v,g=fe(n,f,m,v,u),b=ue(o,f,m,v),P=ve(o,f/2,a,v);I=g.vars.id;t.addLabel(I,Ei),t.add(g,Ei),t.add(b,Ti),t.add(P,I)}ti(e.currentBeat)&&_t(t,e.currentBeat),e.timeline=t}}}function fe(t,i,n,r,o){var a=kn.tweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:a,duration:i,attr:{x1:n,x2:n},ease:"none",onStart:Se,onStartParams:[r,o],onComplete:pe,onCompleteParams:[r,o]})}function ue(t,i,n,r){var o=kn.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cx:n},ease:"none"})}function ve(t,i,n,r){var o=kn.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cy:n,r:2},ease:"power1.out",autoAlpha:.5,repeat:1,yoyo:!0})}function me(e){ri("onTimelineComplete stave: "+e);var t=hn[e];ti(t)&&(t.isRunning=!1),ti(t.timeline)&&t.timeline.pause(0)}function Se(e,t){var i=n.getCurrentTime();hn.audioTlBeatTime=i,ri("onBeatStart: beat: "+e+" beatNo: "+t+" beatTime: "+i),Ie(t,e)}function pe(e,t){var i=n.getCurrentTime(),r=i-hn.startTimeTl;ri("onBeatEnd: beat: "+e+" beatNo: "+t+" elapsedTime: "+r)}function Ie(t,i){e.isNumeric(t)&&(e.isNull(i)&&(i=kn.beatIdPrefix+t),hn.currentBeatId=i,hn.currentBeatNo=t)}function ge(e){if(!ei(e.staveId)){var t=e.staveId,i=hn[t];ei(i)?ii("processPageinfo: Invalid stave for id: {}",t):(ti(e.filename)&&(i.filename=e.filename),ti(e.pageId)&&(i.pageId=e.pageId),ti(e.rndPageId)?i.rndPageId=e.rndPageId:i.rndPageId=null,be(i))}}function be(t){if(!ei(t)){var i=t.config;if(!ei(i)){var n=null,r=t.pageId;ti(t.rndPageId)&&(r=t.rndPageId);var o=xe(r);n=ei(o)?ye(t.fileName):o.src;var a=e.getElement(i.imgId);a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),a.setAttribute("href",n)}}}function Pe(t){if(!ei(t)){var i=t.config;if(!ei(i)){var n=t.fileName,r=e.getElement(i.imgId);r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),r.setAttribute("href",n)}}}function ye(e){return hn.scoreDir+hn.score.noSpaceTitle+li+e}function xe(e){var t=hn.part.pages[e];return ei(t)?null:t.img}function Te(e){var t=hn.part.pages[e];ti(t)&&(t.isLoaded=!0),hn.pageNoToLoad--,0===hn.pageNoToLoad&&ke(),Ee(hn.pageNoToLoad)}function Ee(e){if(e>0){var t=ui+" "+e;W(kn.errorRectStyle,kn.errorBtnAttrib,kn.errorTxtStyle,t)}else W(kn.connectedRectStyle,kn.connectedBtnAttrib,kn.connectedTxtStyle,vi)}function ke(){ni("onPageLoadComplete: ");var e=hn.part.pages,t=!0;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n.isLoaded||(ni("onPageLoadComplete: page: "+i+" is not loaded, retying load"),Ae(n.no),t=!1)}t&&(ni("All Pages loaded: "),hn.isReady=!0,Je())}function he(t){if(ti(t.name)&&(hn.part.name=t.name),ti(t.pageRanges)){var i=t.pageRanges;if(e.isArray(i))for(var n=0;n<i.length;n++)Fe(i[n]);else Fe(i)}ti(t.imgDir)&&(hn.part.imgDir=t.imgDir),ti(t.imgPageNameToken)&&(hn.part.imgPageNameToken=t.imgPageNameToken),ti(t.imgContPageName)&&(hn.part.imgContPageName=t.imgContPageName),ti(t.contPageNo)&&(hn.part.contPageNo=t.contPageNo),ti(t.currentSection)&&(hn.part.currentSection=t.currentSection),Be(),Le()}function Le(){var t=hn.part.name,n=hn.part.currentSection,r="";ti(n)&&(r+=e.capitalizeFirstLetter(n)+" - "),r+=t,i.setElementText(kn.idInstrument,r)}function Be(){var t=hn.part,i=t.pageRanges;if(e.isArray(i)){hn.part.pages=[];for(var n=0;n<i.length;n++)we(i[n]);Ne(),Oe()}}function Ne(){var e=De();hn.pageNoToLoad++,Re(e)}function Oe(){var e=Me();hn.pageNoToLoad++,Re(e)}function we(t){if(e.isObject(t)){var i=1,n=1;ti(t.start)&&(i=e.toInt(t.start)),ti(t.end)&&(n=e.toInt(t.end));var r=hn.pageNoToLoad+(n-i+1);hn.pageNoToLoad=r;for(var o=i;o<=n;o++)Ae(o)}}function Ae(e){var t=Ce(e);Re(t)}function Re(e){if(!ei(e)){var t=e.imgFileUrl;ei(t)||e.loadImg(t,e.id)}}function Ce(t){var i=Ve(t),n=hn.part.pages[i];if(ti(n))return n;var r=hn.part.imgPageNameToken;r=ei(r)?_e(t):e.replace(r,kn.pageNoToken,""+t);var o=hn.part.imgDir+r;n=new c(i,t,r,o);return hn.part.pages[i]=n,n}function Me(){var e=hn.part.contPageNo,t=Ve(e),i=hn.part.pages[t];if(ti(i))return i;var n=hn.part.imgContPageName,r=hn.part.imgDir+n;i=new c(t,e,n,r);return hn.part.pages[t]=i,i}function De(){var e=hn.part.blankPageNo,t=Ve(e),i=hn.part.pages[t];if(ti(i))return i;var n=kn.blankPageUrl,r=kn.blankPageUrl;i=new c(t,e,n,r);return hn.part.pages[t]=i,i}function _e(e){return hn.score.noSpaceTitle+si+instrumentName+"_page"+e+".png"}function Ve(e){return kn.pageIdPrefix+e}function Fe(e){if(!(ei(e)||ei(e.start)||ei(e.end))){var t=e.start,i=e.end,n={start:t,end:i};hn.part.pageRanges=[],hn.part.pageRanges.push(n)}}function Ue(t){if(!ei(t))if(e.isArray(t))for(var i=0;i<t.length;i++)qe(t[i]);else qe(t)}function qe(t){if(e.isObject(t))if(ei(t.name))ii("processStrategies: invalid strategy name");else{var i=t.name;switch(i){case yn:He(t);break;case xn:Ge(t);break;default:ii("processStrategies: Unknown strategy: "+i)}}}function He(t){var i=!1;if(ti(t.isReady)&&(i=e.toBoolean(t.isReady)),ti(t.sections))if(hn.score.sections.length>0&&(hn.score.sections=[]),e.isArray(t.sections))for(var n=0;n<t.sections.length;n++)ze(t.sections[n]);else ze(t.sections);if(ti(t.assignmentType)&&(hn.score.assignmentType=t.assignmentType),hn.score.ownedSections=[],hn.score.mySections=[],ti(t.sectionOwners))for(var r in t.sectionOwners){var o=t.sectionOwners[r];hn.score.ownedSections.push(r),hn.clientId===o&&hn.score.mySections.push(r)}i?Xe():Ye()}function ze(e){ei(e)||hn.score.sections.push(e)}function Ye(){var t=hn.score.sections;if(!(t.length<1)){var i=e.getElement(kn.idSections);if(!ei(i)){for(var n=0;n<t.length;n++){var r=t[n],o=kn.idSectionBtnPrefix+r,a=e.getElement(o);if(ei(a)){var s=new d(n+1,r);a=e.createButton(s),e.setText(a,r),e.addChildToParent(i,a)}e.arrContains(hn.score.ownedSections,r)&&E(a)}k(),e.makeVisible(kn.idSectionsListOuterDiv)}}}function Xe(){var t=e.getElement(kn.idSections);ei(t)||(e.removeElementChildren(t),e.makeInVisible(kn.idSectionsListOuterDiv))}function Ge(e){}function je(t){var i=[];if(e.isArray(t))for(var n=0;n<t.length;n++){var r=t[n];e.arrContains(kn.filterOutParts,r)||i.push(r)}else e.arrContains(kn.filterOutParts,r)||i.push(t);e.arrEquals(hn.score.parts,i)||(hn.score.parts=i),We(i)&&Ze(hn.part.name)}function We(t){if(ei(hn.part.name)||!e.isArray(t))return!1;for(var i=hn.part.name,n=0;n<t.length;n++)if(i===t[n])return!0;return!1}function Qe(){var e=tt();t.sendEvent(Zi,e)}function Ze(e){var i=tt();i[nn]=e,t.sendEvent(Ji,i)}function Je(){var e=tt();e[nn]=hn.part.name,t.sendEvent(Ki,e)}function Ke(e){var i=tt();i[rn]=e,t.sendEvent($i,i)}function $e(e,i,n){var r=tt();r[cn]=e,r[dn]=i,r[nn]=n,t.sendEvent(en,r)}function et(e){var i=tt();i[In]=e,t.sendEvent(tn,i)}function tt(){var e=new m;return e[gn]=hn.clientId,e}function it(t){var i=null,n=[],r={};if(e.isArray(t))for(var o=0;o<t.length;o++){var a=t[o];ti(a.type)&&(i=a.type),ti(a.targets)&&(n=a.targets),ti(a.params)&&(r=a.params),nt(i,n,r)}}function nt(t,i,n){if(e.logDebug("doAction: "+t),!ei(t))switch(t){case"PING":Jt(n);break;case"START":rt(jt,i,null);break;case"STOP":Gt();break;case"SEMAPHORE_ON":Ut(n);break;case"SEMAPHORE_OFF":qt(n);break;case"ACTIVATE":rt(Vt,i,n);break;case"BEAT":rt(Mt,i,n);break;case"START_MARK":rt(At,i,n);break;case"INSTRUMENT_SLOTS":Et(n);break;case"RESET_INSTRUMENT_SLOTS":Tt();break;case"RESET_STAVES":yt();break;case"OVERLAY_ELEMENT":rt(ft,i,n);break;case"OVERLAY_LINE":rt(lt,i,n);break;case"OVERLAY_COLOUR":rt(ot,i,n);break;default:ii("doAction: Unknown actionType: "+t)}}function rt(t,i,n){if(!ei(t))if(e.isArray(i))for(var r=0;r<i.length;r++)t(i[r],n);else t(target,n)}function ot(e,t){if(!ei(t)&&!ei(e)){var i=hn[e],n=t[fn],r=t[pn];at(i,n,r)}}function at(e,t,i){if(!(ei(e)||ei(t)||ei(i)))switch(t){case"POSITION":st(e.config.ovrlPosId+kn.idRectSuffix,i);break;case"PITCH":st(e.config.ovrlPitchId+kn.idRectSuffix,i);break;case"SPEED":st(e.config.ovrlSpeedId+kn.idRectSuffix,i);break;case"PRESSURE":st(e.config.ovrlPressId+kn.idRectSuffix,i);break;case"DYNAMICS":st(e.config.ovrlDynId+kn.idRectSuffix,i);break;case"TIMBRE":st(e.config.ovrlTimbreId+kn.idRectSuffix,i);break;default:ni("setOverlayColour: unknown overlay type: "+t)}}function st(t,i){e.setElementIdStyleProperty(t,{fill:i})}function lt(e,t){if(!ei(t)&&!ei(e)){var i=hn[e],n=t[fn],r=t[vn];ct(i,n,r)}}function ct(e,t,i){if(!(ei(e)||ei(t)||ei(i)))switch(t){case"POSITION":dt(e.config.ovrlPosId+kn.idLineSuffix,i);break;case"PITCH":dt(e.config.ovrlPitchId+kn.idLineSuffix,i);break;case"SPEED":dt(e.config.ovrlSpeedId+kn.idLineSuffix,i);break;case"PRESSURE":dt(e.config.ovrlPressId+kn.idLineSuffix,i);break;case"DYNAMICS":dt(e.config.ovrlDynId+kn.idLineSuffix,i);break;case"TIMBRE":dt(e.config.ovrlTimbreId+kn.idLineSuffix,i);break;default:ni("setOverlayLinePosition: unknown overlay type: "+t)}}function dt(t,n){var r=e.getElement(t);i.setLineY(r,n,n)}function ft(e,t){if(!ei(t)&&!ei(e)){var i=hn[e],n=t[fn],r=t[un],o=t[mn],a=t[Sn];ut(i,n,r,o,a)}}function ut(e,t,i,n,r){if(!ei(e)&&!ei(t)){var o=e.config;if(!ei(o))switch(ri("setOverlayElement: overlayType: "+t),t){case"POSITION":bt(o,i,n,r);break;case"PITCH":gt(o,i,n,r);break;case"SPEED":pt(o,i,n,r);break;case"PRESSURE":St(o,i,n,r);break;case"DYNAMICS":mt(o,i,n,r);break;case"TIMBRE":vt(o,i,n,r);break;case"PITCH_STAVE":It(o,i,n,r);break;default:ni("setOverlayElement: unknown overlay type: "+t)}}}function vt(e,t,i,n){if(!ei(t)&&!ei(e))switch(t){case"TIMBRE_BOX":Pt(e.ovrlTimbreId+kn.idRectSuffix,i,n),Pt(e.ovrlTimbreId+kn.idOrdSuffix+kn.idLineSuffix,i,n),Pt(e.ovrlTimbreId,i,n),i||Pt(e.ovrlTimbreId+kn.idLineSuffix,i,n);break;case"TIMBRE_ORD_LINE":Pt(e.ovrlTimbreId+kn.idOrdSuffix+kn.idLineSuffix,i,n);break;case"TIMBRE_LINE":Pt(e.ovrlTimbreId+kn.idLineSuffix,i,n);break;default:ni("setTimbreOverlay: unknown overlay element: "+t)}}function mt(e,t,i,n){if(!ei(t)&&!ei(e))switch(t){case"DYNAMICS_BOX":Pt(e.ovrlDynId+kn.idRectSuffix,i,n),Pt(e.ovrlDynId+kn.idOrdSuffix+kn.idLineSuffix,i,n),Pt(e.ovrlDynId,i,n),i||Pt(e.ovrlDynId+kn.idLineSuffix,i,n);break;case"DYNAMICS_MID_LINE":Pt(e.ovrlDynId+kn.idOrdSuffix+kn.idLineSuffix,i,n);break;case"DYNAMICS_LINE":Pt(e.ovrlDynId+kn.idLineSuffix,i,n);break;default:ni("setDynamicsOverlay: unknown overlay element: "+t)}}function St(e,t,i,n){if(!ei(t)&&!ei(e))switch(t){case"PRESSURE_BOX":Pt(e.ovrlPressId+kn.idRectSuffix,i,n),Pt(e.ovrlPressId+kn.idOrdSuffix+kn.idLineSuffix,i,n),Pt(e.ovrlPressId,i,n),i||Pt(e.ovrlPressId+kn.idLineSuffix,i,n);break;case"PRESSURE_MID_LINE":Pt(e.ovrlPressId+kn.idOrdSuffix+kn.idLineSuffix,i,n);break;case"PRESSURE_LINE":Pt(e.ovrlPressId+kn.idLineSuffix,i,n);break;default:ni("setPressOverlay: unknown overlay element: "+t)}}function pt(e,t,i,n){if(!ei(t)&&!ei(e))switch(t){case"SPEED_BOX":Pt(e.ovrlSpeedId+kn.idRectSuffix,i,n),Pt(e.ovrlSpeedId+kn.idOrdSuffix+kn.idLineSuffix,i,n),Pt(e.ovrlSpeedId,i,n),i||Pt(e.ovrlSpeedId+kn.idLineSuffix,i,n);break;case"SPEED_MID_LINE":Pt(e.ovrlSpeedId+kn.idOrdSuffix+kn.idLineSuffix,i,n);break;case"SPEED_LINE":Pt(e.ovrlSpeedId+kn.idLineSuffix,i,n);break;default:ni("setSpeedOverlay: unknown overlay element: "+t)}}function It(e,t,i,n){if(!ei(t)&&!ei(e))switch(t){case"PITCH_STAVE_BOX":Pt(e.ovrlPitchStaveId+kn.idRectSuffix,i,n),Pt(e.ovrlPitchStaveId,i,n),i||Pt(e.ovrlPitchStaveId+kn.idLineSuffix,i,n);break;case"PITCH_STAVE_MID_LINE":Pt(e.ovrlPitchStaveId+kn.idMidSuffix+kn.idLineSuffix,i,n);break;default:ni("setPitchOverlay: unknown overlay element: "+t)}}function gt(e,t,i,n){if(!ei(t)&&!ei(e))switch(t){case"PITCH_BOX":Pt(e.ovrlPitchId+kn.idRectSuffix,i,n),Pt(e.ovrlPitchId,i,n),i||Pt(e.ovrlPitchId+kn.idLineSuffix,i,n);break;case"PITCH_LINE":Pt(e.ovrlPitchId+kn.idLineSuffix,i,n);break;default:ni("setPitchOverlay: unknown overlay element: "+t)}}function bt(e,t,i,n){if(!ei(t)&&!ei(e))switch(t){case"POSITION_BOX":Pt(e.ovrlPosId+kn.idRectSuffix,i,n),Pt(e.ovrlPosId+kn.idOrdSuffix+kn.idLineSuffix,i,n),Pt(e.ovrlPosId+kn.idBridgeSuffix+kn.idLineSuffix,i,n),Pt(e.ovrlPosId,i,n),i||Pt(e.ovrlPosId+kn.idLineSuffix,i,n);break;case"POSITION_LINE":Pt(e.ovrlPosId+kn.idLineSuffix,i,n);break;case"POSITION_BRIDGE_LINE":Pt(e.ovrlPosId+kn.idBridgeSuffix+kn.idLineSuffix,i,n);break;case"POSITION_ORD_LINE":Pt(e.ovrlPosId+kn.idOrdSuffix+kn.idLineSuffix,i,n);break;default:ni("setPositionOverlay: unknown overlay element: "+t)}}function Pt(t,i,n){if(!ei(t))if(i){var r=e.toFloat(n);e.isNumeric(r)||(r=1),e.setElementIdStyleProperty(t,{opacity:r}),e.makeVisible(t)}else e.makeInVisible(t)}function yt(){xt(hn.topStave),xt(hn.bottomStave)}function xt(e){ei(e)||(e.pageId=Pn,e.rndPageId=null,e.filename=bn,e.beatMap=null,e.timeline=null,e.isActive=!0,e.isPlaying=!1,e.currentBeat=null,b(e),Pe(e))}function Tt(){Bt(),ht()}function Et(e){if(!ei(e)){var t=e[ln];Lt(t),kt()}}function kt(){e.makeVisible(kn.idInstControls)}function ht(){e.makeInVisible(kn.idInstControls)}function Lt(t){if(!ei(t)){var i=e.csvToArr(t);if(!(ei(i)||i.length<=0)){var n=hn.score.parts;if(!(ei(n)||n.length<=0))for(var r=0;r<n.length;r++){var o=r+1;r<i.length?Nt(i[r],o):Ot(o)}}}}function Bt(){var e=hn.score.parts;if(!(ei(e)||e.length<=0))for(var t=0;t<e.length;t++){var i=t+1;wt(i)}}function Nt(t,n){if(!ei(t)&&!ei(n)){var r=kn.idInstSlotTxtPrefix+n,o=kn.idInstSlotBtnPrefix+n,a=kn.idInstSlotPrefix+n,s=t===hn.part.name;e.makeVisible(r),e.makeVisible(o),e.makeVisible(a),e.setElementIdAttributes(a,kn.instSlotActiveAttrib),i.setElementText(r,t.trim()),e.setElementIdStyleProperty(r,kn.instSlotTxtActiveStyle),s?e.setElementIdStyleProperty(o,kn.instSlotBtnActiveInstStyle):e.setElementIdStyleProperty(o,kn.instSlotBtnActiveStyle);var l=new u(n,t);e.setElementIdAttributes(o,l)}}function Ot(t){var n=kn.idInstSlotTxtPrefix+t,r=kn.idInstSlotBtnPrefix+t,o=kn.idInstSlotPrefix+t;e.makeVisible(n),e.makeVisible(r),e.makeVisible(o),e.setElementIdAttributes(o,kn.instSlotInActiveAttrib),i.setElementText(n,ai),e.setElementIdStyleProperty(n,kn.instSlotTxtInActiveStyle),e.setElementIdStyleProperty(r,kn.instSlotBtnInActiveStyle);var a=new v;e.setElementIdAttributes(r,a)}function wt(t){var i=kn.idInstSlotTxtPrefix+t,n=kn.idInstSlotBtnPrefix+t,r=kn.idInstSlotPrefix+t;e.makeInVisible(i),e.makeInVisible(n),e.makeInVisible(r);var o=new v;e.setElementIdAttributes(n,o)}function At(e,t){if(!ei(t)&&!ei(e)){var n=hn[e],r=t[sn];if(!ei(n)&&!ei(r)){var o=n.beatMap;if(!ei(o)){var a=o[r];if(!ei(a)){var s=a.xStart-1,l=Rt(n);i.setLineX(l,s,s),Ct(l,!0)}}}}}function Rt(t){return e.getElement(t.config.startLineId)}function Ct(t,i){i?e.makeElementVisible(t):e.makeElementInVisible(t)}function Mt(e,t){if(!ei(t)&&!ei(e)){var i=hn[e],n=t[sn];Dt(i,n)}}function Dt(e,t){if(!ei(e)&&!ei(t)){var i=n.getCurrentTime();ri("setStaveBeat: stave: "+e.id+" beat: "+t+" time: "+i),_t(e.timeline,t),e.currentBeat=t}}function _t(e,t){if(!ei(e)){var i=kn.tweenIdPrefix+kn.beatIdPrefix+t,r=e.labels;i in r?(n.beep(),e.seek(i)):ri("setTimelineBeat: Invalid beat "+i)}}function Vt(e,t){if(!ei(t)&&!ei(e)){var i=hn[e],n=t[on],r=t[an];Ft(i,n,r)}}function Ft(t,i,n){if(!(ei(t)||ei(i)||ei(n))){if(i)e.setElementIdStyleProperty(t.config.maskId,kn.activeStaveStyle);else{e.setElementIdStyleProperty(t.config.maskId,kn.inactiveStaveStyle);var r=Rt(t);Ct(r,!1)}n&&Wt(t.timeline)}}function Ut(e){ei(e)||zt(e.lightNo,e.colourId)}function qt(e){ei(e)||Yt(e.lightNo,Ci)}function Ht(){Yt(4,Ci),Yt(1,hi)}function zt(e,t){var i=Xt(t);Yt(e,i)}function Yt(t,n){if(!ei(t)&&!ei(n))for(var r=e.toInt(t),o=1;o<=r;o++){var a=kn.idSemaphorePrefix+o;i.setElementColour(a,n)}}function Xt(e){var t;switch(e||(e=1),e){case 4:t=hi;break;case 3:t=Li;break;case 2:t=Bi;break;case 1:default:t=ki}return t}function Gt(){Qt(),hn.isPlaying=!1,Ht(),g()}function jt(e){if(!ei(e)){var t=hn[e];if(!ei(t)){var i=t.timeline;ei(i)||(Wt(i),hn.isPlaying=!0)}}}function Wt(e){if(ei(e))ii("startTimeline: invalid timeline");else{var t=e.progress();t>0&&t<1?e.resume():e.play(0)}}function Qt(){Zt(hn.topStave.timeline),Zt(hn.bottomStave.timeline),hn.bottomStave.isPlaying=!1,hn.topStave.isPlaying=!1}function Zt(e){ei(e)?ii("stopTimeline: invalid timeline"):e.pause()}function Jt(t){e.isObject(t)&&ti(t.sendTimeMs)&&Ke(t.sendTimeMs)}function Kt(t,i){e.setElementStyleProperty(t,i)}function $t(t,i){e.setElementAttributes(t,i)}function ei(t){return e.isNull(t)}function ti(t){return e.isNotNull(t)}function ii(t){e.logError(t)}function ni(t){e.log(t)}function ri(t){e.logDebug(t)}const oi="dev",ai="",si="_",li="/",ci="AV",di="FullScore",fi="Connected",ui="Loading",vi="READY",mi="Reconnecting",Si="Error",pi="visible",Ii="hidden",gi="none",bi="x",Pi="x1",yi="x2",xi="width",Ti="<",Ei=">",ki="green",hi="red",Li="orange",Bi="yellow",Ni="white",Oi="black",wi="blue",Ai="grey",Ri="lightgrey",Ci=gi,Mi=Ci,Di=Ni,_i=ki,Vi=hi,Fi=Li,Ui=wi,qi=Ai,Hi=ki,zi=hi,Yi=Li,Xi=Ni,Gi=Ni,ji=Oi,Wi=6666,Qi="zsClientId",Zi="HELLO",Ji="PART_REG",Ki="PART_READY",$i="PING",en="SELECT_ISLOT",tn="SELECT_SECTION",nn="part",rn="serverTime",on="isActive",an="isPlay",sn="beatNo",ln="csvInstruments",cn="slotNo",dn="slotInstrument",fn="overlayType",un="overlayElement",vn="overlayLineY",mn="isEnabled",Sn="opacity",pn="colour",In="section",gn="clientId",bn="img/blankStave.png",Pn="p0",yn="BUILDER",xn="RND";var Tn=null,En=null,kn={connectionPreference:"ws,sse,poll",defaultConnectionType:t.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",pageNoToken:"@PgNo@",instToken:"@Inst@",slotNoToken:"@SlotNo@",pageIdPrefix:"p",tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",idParts:"parts",idPartsListOuterDiv:"partListOuterDiv",idSections:"sections",idSectionsListOuterDiv:"sectionListOuterDiv",idSectionBtnPrefix:"sectionBtn",idOwnedSections:"ownedSections",idInstrument:"part",idInstControls:"instControls",idInstSlotPrefix:"instSlot",idInstSlotTxtPrefix:"instSlotTxt",idInstSlotBtnPrefix:"instSlotRect",idTempoBpm:"tmpBpm",idSemaphorePrefix:"semC",idLineSuffix:"Line",idBridgeSuffix:"Bridge",idOrdSuffix:"Ord",idMidSuffix:"Mid",idRectSuffix:"Rect",idClientIdGroup:"clientIdGroup",idClientId:"clientId",blankPageUrl:"img/blankStave.png",filterOutParts:[ci,di],connectedRectStyle:{fill:_i,stroke:Hi,"stroke-width":"0px",visibility:pi,opacity:1},disconnectedRectStyle:{fill:Vi,stroke:zi,"stroke-width":"1px",visibility:pi,opacity:1},errorRectStyle:{fill:Fi,stroke:Yi,"stroke-width":"1px",visibility:pi,opacity:1},connectedTxtStyle:{fill:Xi},disconnectedTxtStyle:{fill:Gi},errorTxtStyle:{fill:ji},activeStaveStyle:{fill:Mi,stroke:Ui,"stroke-width":"1px",visibility:pi,opacity:.5},inactiveStaveStyle:{fill:Di,stroke:qi,"stroke-width":"1px",visibility:pi,opacity:.4},instSlotBtnActiveStyle:{fill:Ni,stroke:Oi,"stroke-width":"1px",visibility:pi,opacity:1},instSlotBtnActiveInstStyle:{fill:"#d7f2cd",stroke:Oi,"stroke-width":"1px",visibility:pi,opacity:1},instSlotBtnInActiveStyle:{fill:Ri,stroke:gi,visibility:pi,opacity:1},instSlotTxtActiveStyle:{fill:Oi,visibility:pi,opacity:1},instSlotTxtInActiveStyle:{fill:Oi,stroke:gi,visibility:Ii,opacity:0},instSlotActiveAttrib:{filter:"url(#dropshadow)"},instSlotInActiveAttrib:{filter:"none"},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},errorBtnAttrib:{filter:"url(#dropshadow)"},topStave:{gId:"stvTop",imgId:"stvTopImg",startLineId:"stvTopStartLine",positionLineId:"stvTopPosLine",beatBallId:"stvTopBeatBall",maskId:"stvTopMask",ovrlPosId:"ovrlTopPos",ovrlPitchId:"ovrlTopPitch",ovrlPitchStaveId:"ovrlTopPitchStave",ovrlSpeedId:"ovrlTopSpeed",ovrlPressId:"ovrlTopPres",ovrlDynId:"ovrlTopDyn",ovrlTimbreId:"ovrlTopTimb",ballYmax:84,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"80",x2:"95",y2:"281"},posBallConf:{cx:"95",cy:"110",r:"4"}},bottomStave:{gId:"stvBot",imgId:"stvBotImg",startLineId:"stvBotStartLine",positionLineId:"stvBotPosLine",beatBallId:"stvBotBeatBall",maskId:"stvBotMask",ovrlPosId:"ovrlBotPos",ovrlPitchId:"ovrlBotPitch",ovrlPitchStaveId:"ovrlBotPitchStave",ovrlSpeedId:"ovrlBotSpeed",ovrlPressId:"ovrlBotPres",ovrlDynId:"ovrlBotDyn",ovrlTimbreId:"ovrlBotTimb",ballYmax:305,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"301",x2:"95",y2:"502"},posBallConf:{cx:"95",cy:"331",r:"4"}},metro:{idMetronomeRect:"metroRect",idMetronome:"metro",idMetroSlider:"metroFreqSlider",idMetroFreqRect:"metroFreq",idMetroFreqLine:"metroFreqLine",ifSymbolMetroOff:"#metronome",ifSymbolMetroOn:"#metronomeOn",ifMetroFreqSlider:"#metroFreq",minFreq:220,maxFreq:2200}},hn={clientId:null,isPlaying:!1,isReady:!1,score:{title:"ZScore",noSpaceTitle:"ZScore",htmlFile:null,instrument:"Part View",parts:["Part View"],firstPageNo:1,lastPageNo:2,sections:[],ownedSections:[],mySections:[],assignmentType:null},part:{name:"Part View",imgDir:null,imgPageNameToken:null,imgContPageName:null,blankPageNo:0,contPageNo:Wi,currentSection:null,pageRanges:[{start:1,end:1}],pages:{}},topStave:{id:"topStave",config:kn.topStave,pageId:Pn,rndPageId:null,filename:bn,beatMap:null,timeline:null,isActive:!0,isPlaying:!1,currentBeat:null},bottomStave:{id:"bottomStave",config:kn.bottomStave,pageId:Pn,rndPageId:null,filename:bn,beatMap:null,timeline:null,isActive:!1,isPlaying:!1,currentBeat:null},startTimeTl:0,currentBeatId:"b0",currentBeatNo:0,tempo:0,tempoModifier:1,scoreDir:"/score/",currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,isConnected:!1,isInitialised:!1,connectionType:null,pageNoToLoad:0,metro:{isMetroOn:!1,slider:{xMax:60,xMin:40,xMid:50,range:20}},isClientIdVisible:!1};return c.prototype.loadImg=function(e){this.img.src=e,this.img.onload=function(){ni("pageImgOnLoad: id: "+this.pageId),Te(this.pageId)}},{onStateBtn:function(){P()},onPartSelect:function(e){y(e)},onSectionSelect:function(e){x(e)},onInstrumentSelect:function(e,t){h(e,t)},onClientIdSelect:function(){B()}}}(zsUtil,zsNet,zsSvg,zsWsAudio,zsMusic,window,document);