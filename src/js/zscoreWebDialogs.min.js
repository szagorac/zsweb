var zscore=function(e,t,i,n,r,o,a){"use strict";function s(e){this.message=e,this.name="ZScoreException"}function l(e,t,i,n,r,o,a,s){this.xStart=e,this.xEnd=t,this.yStart=i,this.yEnd=n,this.beatStartNum=r,this.beatStartDenom=o,this.beatEndNum=a,this.beatEndDenom=s}function c(e,t,i,n){this.id=e,this.no=t,this.imgFileName=i,this.imgFileUrl=n,this.isLoaded=!1,this.img=new Image,this.img.pageId=e}function d(e,t){this.id=Ln.idSectionBtnPrefix+t,this.no=e,this.class="sectionListButton",this.onclick="onSectionSelect('"+t+"')"}function f(){this.class="sectionListButtonDisabled",this.onclick=""}function u(e,t){this.onclick="onInstrumentSelect("+e+",'"+t+"')"}function m(){this.onclick=""}function v(){}function p(){if(!wn.isInitialised){if(!(e&&t&&i&&n&&r))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");e.setRunMode(di),li("init: "),I(),Bn=e.isTouchDevice(),Nn=e.isSafari(navigator),li("init: IsTouch Device: "+Bn+" isSafari: "+Nn),wn.fontCanvas=a.createElement("canvas"),wn.canvasCtx=wn.fontCanvas.getContext("2d"),e.listen("resize",o,q),e.listen("orientationchange",o,q),w(),H(),F(),M(),S(),wn.isInitialised=!0}}function S(){}function I(){var t=e.getLocalParam(en);oi(t)&&(t=e.generateRandomId(),e.storeLocalParam(en,t)),wn.clientId=t,li("clientId: "+wn.clientId),i.setElementIdText(Ln.idClientId,wn.clientId),C()}function g(){wn.part.pages={}}function b(){T(wn.topStave),T(wn.bottomStave)}function T(t){if(!oi(t)&&!oi(t.config)){var i=t.config;e.setElementIdAttributes(i.positionLineId,i.posLineConf),e.setElementIdAttributes(i.beatBallId,i.posBallConf)}}function y(){wn.isInitialised?(li("onStateBtnClick: zscore initialised"),t.isConnected()||(li("onStateBtnClick: zscore not connected, reconnecting..."),Z())):(li("onStateBtnClick: initialising"),p())}function P(t){e.arrContains(wn.score.parts,t)?(wn.part.name=t,it(t),e.makeInVisible(Ln.idPartsListOuterDiv)):li("onPartSelection: unexpected part: "+t)}function x(t){e.arrContains(wn.score.sections,t)?(E(t),at(t)):li("onSectionSelection: unexpected section: "+t)}function E(t){var i=Ln.idSectionBtnPrefix+t,n=e.getElement(i);oi(n)||h(n)}function h(t){oi(t)||e.setElementAttributes(t,new f)}function k(){var t=e.getElement(Ln.idOwnedSections);if(!oi(t)){for(var i=wn.score.mySections,n="",r="",o=0;o<i.length;o++)n=n+r+i[o],r="; ";e.setText(t,n)}}function A(e,t){oi(e)||oi(t)||oi(wn.part.name)||(ot(e,t,wn.part.name),At())}function C(){var t=wn.isClientIdVisible;t?e.makeVisible(Ln.idClientId):e.makeInVisible(Ln.idClientId)}function B(){wn.isClientIdVisible=!wn.isClientIdVisible,C()}function N(e){if(!oi(e)){var t=r.getTransposition(e);oi(t)||(wn.transpo=t,Lt(),Ee())}}function L(){U()}function w(){t.init(Ln.connectionPreference,Ln.appUrlSse,Ln.appUrlWebsockets,Ln.appUrlHttp,J,z)}function M(){var t=e.getElement(Ln.metro.idMetronomeRect);oi(t)||(e.listen("click",t,D),O())}function O(){var t=e.getElement(Ln.metro.idMetroFreqLine),i=e.getElement(Ln.metro.idMetroFreqRect);if(ai(t)&&ai(i)){var n=e.toInt(t.getAttribute(ki)),r=e.toInt(i.getAttribute(Ai)),o=Math.round(r/2),a=n-o;wn.metro.slider.xMax=a;var s=e.toInt(t.getAttribute(hi)),l=s+o;wn.metro.slider.xMin=l;var c=a-l;wn.metro.slider.range=c;var d=Math.round((a+l)/2);wn.metro.slider.xMid=d}Draggable.create(Ln.metro.ifMetroFreqSlider,{type:Ei,bounds:document.getElementById(Ln.metro.idMetroFreqLine),onDrag:R})}function R(t){var i=gsap.getProperty(Ln.metro.ifMetroFreqSlider,Ei),r=wn.metro.slider.xMid+i,o=r-wn.metro.slider.xMin,a=Math.round(100*o/wn.metro.slider.range),s=e.mapRange(a,0,100,Ln.metro.minFreq,Ln.metro.maxFreq);s<200&&(s=200),n.setBeepFreqenecy(s),li("onFreqSliderMove: freq: "+s)}function D(e){wn.metro.isMetroOn?V():_()}function V(){n.switchMetro(!1),i.setElementIdHref(Ln.metro.idMetronome,Ln.metro.ifSymbolMetroOff),e.makeInVisible(Ln.metro.idMetroSlider),wn.metro.isMetroOn=!1}function _(){n.switchMetro(!0),i.setElementIdHref(Ln.metro.idMetronome,Ln.metro.ifSymbolMetroOn),e.makeVisible(Ln.metro.idMetroSlider),wn.metro.isMetroOn=!0}function F(){oi(n)?si("initAudio: invalid zsAudio lib"):n.init()}function U(){oi(n)?si("resetAudio: invalid zsAudio lib"):n.reset()}function H(){i.init()}function q(t){if(!e.isObject(this))return null}function z(e,i){switch(e){case t.OPEN:Y(i);break;case t.CLOSED:X(i);break;case t.ERROR:j(i);break;default:si("Unknown Connection Event State: "+e+" for type: "+i)}}function Y(e){li(e+" connection opened."),G(e)}function X(e){li(e+" connection closed."),K(e)}function j(e){li(e+" connection error."),W(e)}function G(e){wn.isConnected=!0,wn.connectionType=e,wn.reconnectAttmpts=0,Q(Ln.connectedRectStyle,Ln.connectedBtnAttrib,Ln.connectedTxtStyle,Si),tt()}function K(e){wn.isConnected=!1,Q(Ln.disconnectedRectStyle,Ln.disconnectedBtnAttrib,Ln.disconnectedTxtStyle,bi),Z(e)}function W(e){wn.isConnected=!1,Q(Ln.errorRectStyle,Ln.errorBtnAttrib,Ln.errorTxtStyle,Ti),Z(e)}function Q(t,i,n,r){var o=e.getElement(Ln.idServerStatusRect);oi(o)||ni(o,t);var a=e.getElement(Ln.idServerStatusBtn);oi(a)||ri(a,i);var s=e.getElement(Ln.idServerStatusTxt);oi(s)||(ni(s,n),s.textContent=r)}function Z(e){t.reconnect(e,!0)}function J(e,t){wn.isConnected||G(),oi(e)||(t||L(),ai(e.scoreInfo)&&$(e.scoreInfo),ai(e.strategyInfo)&&ee(e.strategyInfo),ai(e.partInfo)&&we(e.partInfo),ai(e.pageInfo)&&Te(e.pageInfo),ai(e.mapInfo)&&ae(e.mapInfo),ai(e.bpm)&&0!=e.bpm&&oe(e.bpm),ai(e.actions)&&lt(e.actions))}function $(t){if(e.isObject(t)){if(ai(t.partHtmlPage)){var i=ie(t.partHtmlPage),n=e.getPageName();i&&t.partHtmlPage!==n&&e.loadPage(t.partHtmlPage)}if(ai(t.title)){var r=te(t.title);r&&g()}ai(t.instruments)&&$e(t.instruments),ai(t.bpm)&&re(t.bpm),ai(t.scoreDir)&&ne(t.scoreDir)}}function ee(e){ai(e.strategies)&&je(e.strategies)}function te(t){return wn.score.title!==t&&(wn.score.title=t,wn.score.noSpaceTitle=e.replaceEmptySpaces(t,ui),i.setElementIdText(Ln.idTitle,t),!0)}function ie(e){var t=wn.score.htmlFile;return oi(t)?(wn.score.htmlFile=e,!1):t!==e&&(wn.score.htmlFile=e,!0)}function ne(e){wn.scoreDir!==e&&(wn.scoreDir=e)}function re(e){wn.tempo!==e&&(wn.tempo=e,i.setElementIdText(Ln.idTempoBpm,e))}function oe(t){var i=e.toInt(t);if(!oi(i)){var n=wn.tempo,r=i/n;wn.tempoModifier=r,re(i),wn.isPlaying?le(r):de()}}function ae(t){if(!oi(t.map)&&!oi(t.pageId)){t.pageId;var i=t.staveId,n=t.map,r=wn[i];if(!oi(r)){var o=r.config.xLeftMargin,a=JSON.parse(JSON.stringify(n));if(e.isArray(a)){for(var s={},l=0;l<a.length;l++)se(s,a[l],o);r.beatMap=s,fe(i)}}}}function se(e,t,i){if(!(oi(e)||oi(t)||oi(t.beatStartNum))){var n=t.beatStartNum,r=t.xStart+i,o=t.xEnd+i,a=new l(r,o,t.yStart,t.yEnd,n,t.beatStartDenom,t.beatEndNum,t.beatEndDenom);e[n]=a}}function le(e){ce(wn.topStave.timeline,e),ce(wn.bottomStave.timeline,e)}function ce(e,t){if(!oi(e)){var i=e.timeScale(),n=i*t;e.timeScale(n)}}function de(){ue(wn.topStave),ue(wn.bottomStave)}function fe(e){oi(e)||ue(wn[e])}function ue(e){if(!oi(e)){var t=gsap.timeline({onComplete:Se,onCompleteParams:[e.id],paused:!0}),i=e.beatMap;if(!oi(i)){var n=e.config.positionLineId,o=e.config.beatBallId,a=e.config.ballYmax,s=!0;for(var l in i){var c=i[l],d=wn.tempo,f=r.getBeatDurationSec(d),u=c.beatStartNum;if(s){var m=Ln.beatIdPrefix+(u-1),v=c.xStart,p=me(n,0,v,m,0);t.add(p,Ci);var S=ve(o,0,v,m);t.add(S,Bi),s=!1}v=c.xEnd,m=Ln.beatIdPrefix+u;var I=Ln.tweenIdPrefix+m,g=me(n,f,v,m,u),b=ve(o,f,v,m),T=pe(o,f/2,a,m);I=g.vars.id;t.addLabel(I,Bi),t.add(g,Bi),t.add(b,Ci),t.add(T,I)}ai(e.currentBeat)&&qt(t,e.currentBeat),e.timeline=t}}}function me(t,i,n,r,o){var a=Ln.tweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:a,duration:i,attr:{x1:n,x2:n},ease:"none",onStart:Ie,onStartParams:[r,o],onComplete:ge,onCompleteParams:[r,o]})}function ve(t,i,n,r){var o=Ln.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cx:n},ease:"none"})}function pe(t,i,n,r){var o=Ln.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cy:n,r:2},ease:"power1.out",autoAlpha:.5,repeat:1,yoyo:!0})}function Se(e){ci("onTimelineComplete stave: "+e);var t=wn[e];ai(t)&&(t.isRunning=!1),ai(t.timeline)&&t.timeline.pause(0)}function Ie(e,t){var i=n.getCurrentTime();wn.audioTlBeatTime=i,ci("onBeatStart: beat: "+e+" beatNo: "+t+" beatTime: "+i),be(t,e)}function ge(e,t){var i=n.getCurrentTime(),r=i-wn.startTimeTl;ci("onBeatEnd: beat: "+e+" beatNo: "+t+" elapsedTime: "+r)}function be(t,i){e.isNumeric(t)&&(e.isNull(i)&&(i=Ln.beatIdPrefix+t),wn.currentBeatId=i,wn.currentBeatNo=t)}function Te(e){if(!oi(e.staveId)){var t=e.staveId,i=wn[t];oi(i)?si("processPageinfo: Invalid stave for id: {}",t):(ai(e.filename)&&(i.filename=e.filename),ai(e.pageId)&&(i.pageId=e.pageId),ai(e.rndPageId)?i.rndPageId=e.rndPageId:i.rndPageId=null,ai(e.transpositionInfo)&&ye(e.transpositionInfo,i),he(i))}}function ye(t,i){if(!oi(t)&&!oi(i)){var n=t.txtInfos;if(!oi(n)){var r=e.getElement(i.config.ovrlPitchStaveInfoId);if(ai(r)&&e.removeElementChildren(r),e.isArray(n))for(var o=0;o<n.length;o++)Pe(n[o],r);else Pe(n,r)}}}function Pe(t,n){if(!oi(t)&&!oi(n)){var o=null,a=null,s=null;if(ai(t.x)&&(o=t.x),ai(t.y)&&(a=t.y),ai(t.txt)&&(s=t.txt),!(oi(o)||oi(a)||oi(s))){var l=r.getPitch(s),c=r.PITCH_MOD.NATURAL;if(ai(l)){c=l.mod;var d=r.transpose(l,wn.transpo);ai(d)&&(l=d,s=d.pitchName,c=d.mod)}var f=Ln.idTranspoInfo+xe(),u=i.createTextElement(f);u.setAttribute("x",o),u.setAttribute("y",a),e.setElementAttributes(u,Ln.transpoInfoAttrib);var m=Ln.idTranspoInfo+xe(),v=i.createTspanElement(m);if(i.setElementText(v,s),ai(l)&&r.PITCH_MOD.NATURAL!==c&&ai(l.modUnicode)){var p=Ln.idTranspoInfo+xe(),S=i.createTspanElement(p);e.setElementAttributes(S,Ln.transpoPitchModAttrib),i.setElementText(S,l.modUnicode),e.addChildToParent(v,S)}e.addChildToParent(u,v),e.addChildToParent(n,u)}}}function xe(){return++wn.counter}function Ee(){if(!oi(wn.transpo)){var e=wn.transpo,t=r.PITCH.C;ai(e)&&(t=e.pitch),oi(t)||(ai(t.pitchName)&&i.setElementIdText(Ln.idTranspoKey,t.pitchName),ai(t.modUnicode)&&i.setElementIdText(Ln.idTranspoMod,t.modUnicode))}}function he(t){if(!oi(t)){var i=t.config;if(!oi(i)){var n=null,r=t.pageId;ai(t.rndPageId)&&(r=t.rndPageId);var o=Ce(r);n=oi(o)?Ae(t.fileName):o.src;var a=e.getElement(i.imgId);a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),a.setAttribute("href",n);var s=e.getElement(t.config.ovrlPitchStaveInfoId),l=!1;e.hasChildrenElements(s)&&(l=!0),Pt(i,l)}}}function ke(t){if(!oi(t)){var i=t.config;if(!oi(i)){var n=t.fileName,r=e.getElement(i.imgId);r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),r.setAttribute("href",n)}}}function Ae(e){return wn.scoreDir+wn.score.noSpaceTitle+mi+e}function Ce(e){var t=wn.part.pages[e];return oi(t)?null:t.img}function Be(e){var t=wn.part.pages[e];ai(t)&&(t.isLoaded=!0),wn.pageNoToLoad--,0===wn.pageNoToLoad&&Le(),Ne(wn.pageNoToLoad)}function Ne(e){if(e>0){var t=Ii+" "+e;Q(Ln.errorRectStyle,Ln.errorBtnAttrib,Ln.errorTxtStyle,t)}else Q(Ln.connectedRectStyle,Ln.connectedBtnAttrib,Ln.connectedTxtStyle,gi)}function Le(){li("onPageLoadComplete: ");var e=wn.part.pages,t=!0;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n.isLoaded||(li("onPageLoadComplete: page: "+i+" is not loaded, retying load"),_e(n.no),t=!1)}t&&(li("All Pages loaded: "),wn.isReady=!0,nt())}function we(t){if(ai(t.name)&&(wn.part.name=t.name),ai(t.pageRanges)){var i=t.pageRanges;if(e.isArray(i))for(var n=0;n<i.length;n++)Xe(i[n]);else Xe(i)}ai(t.imgDir)&&(wn.part.imgDir=t.imgDir),ai(t.imgPageNameToken)&&(wn.part.imgPageNameToken=t.imgPageNameToken),ai(t.imgContPageName)&&(wn.part.imgContPageName=t.imgContPageName),ai(t.contPageNo)&&(wn.part.contPageNo=t.contPageNo),ai(t.currentSection)&&(wn.part.currentSection=t.currentSection),Oe(),Me()}function Me(){var t=wn.part.name,n=wn.part.currentSection,r="";ai(n)&&(r+=e.capitalizeFirstLetter(n)+" - "),r+=t,i.setElementIdText(Ln.idInstrument,r)}function Oe(){var t=wn.part,i=t.pageRanges;if(e.isArray(i)){wn.part.pages=[];for(var n=0;n<i.length;n++)Ve(i[n]);Re(),De()}}function Re(){var e=qe();wn.pageNoToLoad++,Fe(e)}function De(){var e=He();wn.pageNoToLoad++,Fe(e)}function Ve(t){if(e.isObject(t)){var i=1,n=1;ai(t.start)&&(i=e.toInt(t.start)),ai(t.end)&&(n=e.toInt(t.end));var r=wn.pageNoToLoad+(n-i+1);wn.pageNoToLoad=r;for(var o=i;o<=n;o++)_e(o)}}function _e(e){var t=Ue(e);Fe(t)}function Fe(e){if(!oi(e)){var t=e.imgFileUrl;oi(t)||e.loadImg(t,e.id)}}function Ue(t){var i=Ye(t),n=wn.part.pages[i];if(ai(n))return n;var r=wn.part.imgPageNameToken;r=oi(r)?ze(t):e.replace(r,Ln.pageNoToken,""+t);var o=wn.part.imgDir+r;n=new c(i,t,r,o);return wn.part.pages[i]=n,n}function He(){var e=wn.part.contPageNo,t=Ye(e),i=wn.part.pages[t];if(ai(i))return i;var n=wn.part.imgContPageName,r=wn.part.imgDir+n;i=new c(t,e,n,r);return wn.part.pages[t]=i,i}function qe(){var e=wn.part.blankPageNo,t=Ye(e),i=wn.part.pages[t];if(ai(i))return i;var n=Ln.blankPageUrl,r=Ln.blankPageUrl;i=new c(t,e,n,r);return wn.part.pages[t]=i,i}function ze(e){return wn.score.noSpaceTitle+ui+instrumentName+"_page"+e+".png"}function Ye(e){return Ln.pageIdPrefix+e}function Xe(e){if(!(oi(e)||oi(e.start)||oi(e.end))){var t=e.start,i=e.end,n={start:t,end:i};wn.part.pageRanges=[],wn.part.pageRanges.push(n)}}function je(t){if(!oi(t))if(e.isArray(t))for(var i=0;i<t.length;i++)Ge(t[i]);else Ge(t)}function Ge(t){if(e.isObject(t))if(oi(t.name))si("processStrategies: invalid strategy name");else{var i=t.name;switch(i){case An:Ke(t);break;case Cn:Je(t);break;default:si("processStrategies: Unknown strategy: "+i)}}}function Ke(t){var i=!1;if(ai(t.isReady)&&(i=e.toBoolean(t.isReady)),ai(t.sections))if(wn.score.sections.length>0&&(wn.score.sections=[]),e.isArray(t.sections))for(var n=0;n<t.sections.length;n++)We(t.sections[n]);else We(t.sections);if(ai(t.assignmentType)&&(wn.score.assignmentType=t.assignmentType),wn.score.ownedSections=[],wn.score.mySections=[],ai(t.sectionOwners))for(var r in t.sectionOwners){var o=t.sectionOwners[r];wn.score.ownedSections.push(r),wn.clientId===o&&wn.score.mySections.push(r)}i?Ze():Qe()}function We(e){oi(e)||wn.score.sections.push(e)}function Qe(){var t=wn.score.sections;if(!(t.length<1)){var i=e.getElement(Ln.idSections);if(!oi(i)){for(var n=0;n<t.length;n++){var r=t[n],o=Ln.idSectionBtnPrefix+r,a=e.getElement(o);if(oi(a)){var s=new d(n+1,r);a=e.createButton(s),e.setText(a,r),e.addChildToParent(i,a)}e.arrContains(wn.score.ownedSections,r)&&h(a)}k(),e.makeVisible(Ln.idSectionsListOuterDiv)}}}function Ze(){var t=e.getElement(Ln.idSections);oi(t)||(e.removeElementChildren(t),e.makeInVisible(Ln.idSectionsListOuterDiv))}function Je(e){}function $e(t){var i=[];if(e.isArray(t))for(var n=0;n<t.length;n++){var r=t[n];e.arrContains(Ln.filterOutParts,r)||i.push(r)}else e.arrContains(Ln.filterOutParts,r)||i.push(t);e.arrEquals(wn.score.parts,i)||(wn.score.parts=i),et(i)&&it(wn.part.name)}function et(t){if(oi(wn.part.name)||!e.isArray(t))return!1;for(var i=wn.part.name,n=0;n<t.length;n++)if(i===t[n])return!0;return!1}function tt(){var e=st();t.sendEvent(tn,e)}function it(e){var i=st(),n="C";ai(wn.transpo)&&(n=wn.transpo),i[ln]=e,i[En]=n,t.sendEvent(nn,i)}function nt(){var e=st();e[ln]=wn.part.name,t.sendEvent(rn,e)}function rt(e){var i=st();i[cn]=e,t.sendEvent(on,i)}function ot(e,i,n){var r=st();r[vn]=e,r[pn]=i,r[ln]=n,t.sendEvent(an,r)}function at(e){var i=st();i[Pn]=e,t.sendEvent(sn,i)}function st(){var e=new v;return e[xn]=wn.clientId,e}function lt(t){var i=null,n=[],r={};if(e.isArray(t))for(var o=0;o<t.length;o++){var a=t[o];ai(a.type)&&(i=a.type),ai(a.targets)&&(n=a.targets),ai(a.params)&&(r=a.params),ct(i,n,r)}}function ct(t,i,n){if(e.logDebug("doAction: "+t),!oi(t))switch(t){case"PING":ii(n);break;case"START":dt(Jt,i,null);break;case"STOP":Zt();break;case"SEMAPHORE_ON":Xt(n);break;case"SEMAPHORE_OFF":jt(n);break;case"ACTIVATE":dt(zt,i,n);break;case"BEAT":dt(Ut,i,n);break;case"START_MARK":dt(Vt,i,n);break;case"INSTRUMENT_SLOTS":Ct(n);break;case"RESET_INSTRUMENT_SLOTS":At();break;case"RESET_STAVES":ht();break;case"OVERLAY_ELEMENT":dt(It,i,n);break;case"OVERLAY_LINE":dt(vt,i,n);break;case"OVERLAY_COLOUR":dt(ft,i,n);break;default:si("doAction: Unknown actionType: "+t)}}function dt(t,i,n){if(!oi(t))if(e.isArray(i))for(var r=0;r<i.length;r++)t(i[r],n);else t(target,n)}function ft(e,t){if(!oi(t)&&!oi(e)){var i=wn[e],n=t[Sn],r=t[yn];ut(i,n,r)}}function ut(e,t,i){if(!(oi(e)||oi(t)||oi(i)))switch(t){case"SPEED":case"PRESSURE":case"POSITION":break;case"PITCH":mt(e.config.ovrlPitchId+Ln.idRectSuffix,i);break;case"DYNAMICS":mt(e.config.ovrlDynId+Ln.idRectSuffix,i);break;case"TIMBRE":mt(e.config.ovrlTimbreId+Ln.idRectSuffix,i);break;default:li("setOverlayColour: unknown overlay type: "+t)}}function mt(t,i){e.setElementIdStyleProperty(t,{fill:i})}function vt(e,t){if(!oi(t)&&!oi(e)){var i=wn[e],n=t[Sn],r=t[gn];pt(i,n,r)}}function pt(e,t,i){if(!(oi(e)||oi(t)||oi(i)))switch(t){case"POSITION":case"SPEED":case"PRESSURE":break;case"PITCH":St(e.config.ovrlPitchId+Ln.idLineSuffix,i);break;case"DYNAMICS":St(e.config.ovrlDynId+Ln.idLineSuffix,i);break;case"TIMBRE":St(e.config.ovrlTimbreId+Ln.idLineSuffix,i);break;default:li("setOverlayLinePosition: unknown overlay type: "+t)}}function St(t,n){var r=e.getElement(t);i.setLineY(r,n,n)}function It(e,t){if(!oi(t)&&!oi(e)){var i=wn[e],n=t[Sn],r=t[In],o=t[bn],a=t[Tn];gt(i,n,r,o,a)}}function gt(e,t,i,n,r){if(!oi(e)&&!oi(t)){var o=e.config;if(!oi(o))switch(ci("setOverlayElement: overlayType: "+t),t){case"SPEED":case"PRESSURE":case"POSITION":break;case"PITCH":xt(o,i,n,r);break;case"DYNAMICS":Tt(o,i,n,r);break;case"TIMBRE":bt(o,i,n,r);break;case"PITCH_STAVE":yt(o,i,n,r);break;default:li("setOverlayElement: unknown overlay type: "+t)}}}function bt(e,t,i,n){if(!oi(t)&&!oi(e))switch(t){case"TIMBRE_BOX":Et(e.ovrlTimbreId+Ln.idRectSuffix,i,n),Et(e.ovrlTimbreId+Ln.idOrdSuffix+Ln.idLineSuffix,i,n),Et(e.ovrlTimbreId,i,n),i||Et(e.ovrlTimbreId+Ln.idLineSuffix,i,n);break;case"TIMBRE_ORD_LINE":Et(e.ovrlTimbreId+Ln.idOrdSuffix+Ln.idLineSuffix,i,n);break;case"TIMBRE_LINE":Et(e.ovrlTimbreId+Ln.idLineSuffix,i,n);break;default:li("setTimbreOverlay: unknown overlay element: "+t)}}function Tt(e,t,i,n){if(!oi(t)&&!oi(e))switch(t){case"DYNAMICS_BOX":Et(e.ovrlDynId+Ln.idRectSuffix,i,n),Et(e.ovrlDynId+Ln.idOrdSuffix+Ln.idLineSuffix,i,n),Et(e.ovrlDynId,i,n),i||Et(e.ovrlDynId+Ln.idLineSuffix,i,n);break;case"DYNAMICS_MID_LINE":Et(e.ovrlDynId+Ln.idOrdSuffix+Ln.idLineSuffix,i,n);break;case"DYNAMICS_LINE":Et(e.ovrlDynId+Ln.idLineSuffix,i,n);break;default:li("setDynamicsOverlay: unknown overlay element: "+t)}}function yt(e,t,i,n){if(!oi(t)&&!oi(e))switch(t){case"PITCH_STAVE_BOX":Et(e.ovrlPitchStaveId+Ln.idRectSuffix,i,n),Et(e.ovrlPitchStaveId,i,n),i||Et(e.ovrlPitchStaveId+Ln.idLineSuffix,i,n);break;case"PITCH_STAVE_MID_LINE":Et(e.ovrlPitchStaveId+Ln.idMidSuffix+Ln.idLineSuffix,i,n);break;default:li("setPitchOverlay: unknown overlay element: "+t)}}function Pt(e,t){yt(e,"PITCH_STAVE_BOX",t,1),yt(e,"PITCH_STAVE_MID_LINE",t,1)}function xt(e,t,i,n){if(!oi(t)&&!oi(e))switch(t){case"PITCH_BOX":Et(e.ovrlPitchId+Ln.idRectSuffix,i,n),Et(e.ovrlPitchId,i,n),i||Et(e.ovrlPitchId+Ln.idLineSuffix,i,n);break;case"PITCH_LINE":Et(e.ovrlPitchId+Ln.idLineSuffix,i,n);break;default:li("setPitchOverlay: unknown overlay element: "+t)}}function Et(t,i,n){if(!oi(t))if(i){var r=e.toFloat(n);e.isNumeric(r)||(r=1),e.setElementIdStyleProperty(t,{opacity:r}),e.makeVisible(t)}else e.makeInVisible(t)}function ht(){kt(wn.topStave),kt(wn.bottomStave)}function kt(e){oi(e)||(e.pageId=kn,e.rndPageId=null,e.filename=hn,e.beatMap=null,e.timeline=null,e.isActive=!0,e.isPlaying=!1,e.currentBeat=null,T(e),ke(e))}function At(){Mt(),Nt()}function Ct(e){if(!oi(e)){var t=e[mn];wt(t),Bt()}}function Bt(){e.makeVisible(Ln.idInstControls)}function Nt(){e.makeInVisible(Ln.idInstControls)}function Lt(){e.makeInVisible(Ln.idTranspoControls)}function wt(t){if(!oi(t)){var i=e.csvToArr(t);if(!(oi(i)||i.length<=0)){var n=wn.score.parts;if(!(oi(n)||n.length<=0))for(var r=0;r<n.length;r++){var o=r+1;r<i.length?Ot(i[r],o):Rt(o)}}}}function Mt(){var e=wn.score.parts;if(!(oi(e)||e.length<=0))for(var t=0;t<e.length;t++){var i=t+1;Dt(i)}}function Ot(t,n){if(!oi(t)&&!oi(n)){var r=Ln.idInstSlotTxtPrefix+n,o=Ln.idInstSlotBtnPrefix+n,a=Ln.idInstSlotPrefix+n,s=t===wn.part.name;e.makeVisible(r),e.makeVisible(o),e.makeVisible(a),e.setElementIdAttributes(a,Ln.instSlotActiveAttrib),i.setElementIdText(r,t.trim()),e.setElementIdStyleProperty(r,Ln.instSlotTxtActiveStyle),s?e.setElementIdStyleProperty(o,Ln.instSlotBtnActiveInstStyle):e.setElementIdStyleProperty(o,Ln.instSlotBtnActiveStyle);var l=new u(n,t);e.setElementIdAttributes(o,l)}}function Rt(t){var n=Ln.idInstSlotTxtPrefix+t,r=Ln.idInstSlotBtnPrefix+t,o=Ln.idInstSlotPrefix+t;e.makeVisible(n),e.makeVisible(r),e.makeVisible(o),e.setElementIdAttributes(o,Ln.instSlotInActiveAttrib),i.setElementIdText(n,fi),e.setElementIdStyleProperty(n,Ln.instSlotTxtInActiveStyle),e.setElementIdStyleProperty(r,Ln.instSlotBtnInActiveStyle);var a=new m;e.setElementIdAttributes(r,a)}function Dt(t){var i=Ln.idInstSlotTxtPrefix+t,n=Ln.idInstSlotBtnPrefix+t,r=Ln.idInstSlotPrefix+t;e.makeInVisible(i),e.makeInVisible(n),e.makeInVisible(r);var o=new m;e.setElementIdAttributes(n,o)}function Vt(e,t){if(!oi(t)&&!oi(e)){var n=wn[e],r=t[un];if(!oi(n)&&!oi(r)){var o=n.beatMap;if(!oi(o)){var a=o[r];if(!oi(a)){var s=a.xStart-1,l=_t(n);i.setLineX(l,s,s),Ft(l,!0)}}}}}function _t(t){return e.getElement(t.config.startLineId)}function Ft(t,i){i?e.makeElementVisible(t):e.makeElementInVisible(t)}function Ut(e,t){if(!oi(t)&&!oi(e)){var i=wn[e],n=t[un];Ht(i,n)}}function Ht(e,t){if(!oi(e)&&!oi(t)){var i=n.getCurrentTime();ci("setStaveBeat: stave: "+e.id+" beat: "+t+" time: "+i),qt(e.timeline,t),e.currentBeat=t}}function qt(e,t){if(!oi(e)){var i=Ln.tweenIdPrefix+Ln.beatIdPrefix+t,r=e.labels;i in r?(n.beep(),e.seek(i)):ci("setTimelineBeat: Invalid beat "+i)}}function zt(e,t){if(!oi(t)&&!oi(e)){var i=wn[e],n=t[dn],r=t[fn];Yt(i,n,r)}}function Yt(t,i,n){if(!(oi(t)||oi(i)||oi(n))){if(i)e.setElementIdStyleProperty(t.config.maskId,Ln.activeStaveStyle);else{e.setElementIdStyleProperty(t.config.maskId,Ln.inactiveStaveStyle);var r=_t(t);Ft(r,!1)}n&&$t(t.timeline)}}function Xt(e){oi(e)||Kt(e.lightNo,e.colourId)}function jt(e){oi(e)||Wt(e.lightNo,Fi)}function Gt(){Wt(4,Fi),Wt(1,Li)}function Kt(e,t){var i=Qt(t);Wt(e,i)}function Wt(t,n){if(!oi(t)&&!oi(n))for(var r=e.toInt(t),o=1;o<=r;o++){var a=Ln.idSemaphorePrefix+o;i.setElementIdColour(a,n)}}function Qt(e){var t;switch(e||(e=1),e){case 4:t=Li;break;case 3:t=wi;break;case 2:t=Mi;break;case 1:default:t=Ni}return t}function Zt(){ei(),wn.isPlaying=!1,Gt(),b()}function Jt(e){if(!oi(e)){var t=wn[e];if(!oi(t)){var i=t.timeline;oi(i)||($t(i),wn.isPlaying=!0)}}}function $t(e){if(oi(e))si("startTimeline: invalid timeline");else{var t=e.progress();t>0&&t<1?e.resume():e.play(0)}}function ei(){ti(wn.topStave.timeline),ti(wn.bottomStave.timeline),wn.bottomStave.isPlaying=!1,wn.topStave.isPlaying=!1}function ti(e){oi(e)?si("stopTimeline: invalid timeline"):e.pause()}function ii(t){e.isObject(t)&&ai(t.sendTimeMs)&&rt(t.sendTimeMs)}function ni(t,i){e.setElementStyleProperty(t,i)}function ri(t,i){e.setElementAttributes(t,i)}function oi(t){return e.isNull(t)}function ai(t){return e.isNotNull(t)}function si(t){e.logError(t)}function li(t){e.log(t)}function ci(t){e.logDebug(t)}const di="dev",fi="",ui="_",mi="/",vi="AV",pi="FullScore",Si="Connected",Ii="Loading",gi="READY",bi="Reconnecting",Ti="Error",yi="visible",Pi="hidden",xi="none",Ei="x",hi="x1",ki="x2",Ai="width",Ci="<",Bi=">",Ni="green",Li="red",wi="orange",Mi="yellow",Oi="white",Ri="black",Di="blue",Vi="grey",_i="lightgrey",Fi=xi,Ui=Fi,Hi=Oi,qi=Ni,zi=Li,Yi=wi,Xi=Di,ji=Vi,Gi=Ni,Ki=Li,Wi=wi,Qi=Oi,Zi=Oi,Ji=Ri,$i=6666,en="zsClientId",tn="HELLO",nn="PART_REG",rn="PART_READY",on="PING",an="SELECT_ISLOT",sn="SELECT_SECTION",ln="part",cn="serverTime",dn="isActive",fn="isPlay",un="beatNo",mn="csvInstruments",vn="slotNo",pn="slotInstrument",Sn="overlayType",In="overlayElement",gn="overlayLineY",bn="isEnabled",Tn="opacity",yn="colour",Pn="section",xn="clientId",En="transposition",hn="img/blankStave.png",kn="p0",An="BUILDER",Cn="RND";var Bn=null,Nn=null,Ln={connectionPreference:"ws,sse,poll",defaultConnectionType:t.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",pageNoToken:"@PgNo@",instToken:"@Inst@",slotNoToken:"@SlotNo@",pageIdPrefix:"p",tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",idParts:"parts",idPartsListOuterDiv:"partListOuterDiv",idSections:"sections",idSectionsListOuterDiv:"sectionListOuterDiv",idSectionBtnPrefix:"sectionBtn",idOwnedSections:"ownedSections",idInstrument:"part",idInstControls:"instControls",idTranspoControls:"transpositionListOuterDiv",idInstSlotPrefix:"instSlot",idInstSlotTxtPrefix:"instSlotTxt",idInstSlotBtnPrefix:"instSlotRect",idTempoBpm:"tmpBpm",idSemaphorePrefix:"semC",idLineSuffix:"Line",idBridgeSuffix:"Bridge",idOrdSuffix:"Ord",idMidSuffix:"Mid",idRectSuffix:"Rect",idClientIdGroup:"clientIdGroup",idClientId:"clientId",idTranspoKey:"transpoKey",idTranspoMod:"transpoMod",idTranspoInfo:"transpoInfo",blankPageUrl:"img/blankStave.png",filterOutParts:[vi,pi],connectedRectStyle:{fill:qi,stroke:Gi,"stroke-width":"0px",visibility:yi,opacity:1},disconnectedRectStyle:{fill:zi,stroke:Ki,"stroke-width":"1px",visibility:yi,opacity:1},errorRectStyle:{fill:Yi,stroke:Wi,"stroke-width":"1px",visibility:yi,opacity:1},connectedTxtStyle:{fill:Qi},disconnectedTxtStyle:{fill:Zi},errorTxtStyle:{fill:Ji},activeStaveStyle:{fill:Ui,stroke:Xi,"stroke-width":"1px",visibility:yi,opacity:.5},inactiveStaveStyle:{fill:Hi,stroke:ji,"stroke-width":"1px",visibility:yi,opacity:.4},instSlotBtnActiveStyle:{fill:Oi,stroke:Ri,"stroke-width":"1px",visibility:yi,opacity:1},instSlotBtnActiveInstStyle:{fill:"#d7f2cd",stroke:Ri,"stroke-width":"1px",visibility:yi,opacity:1},instSlotBtnInActiveStyle:{fill:_i,stroke:xi,visibility:yi,opacity:1},instSlotTxtActiveStyle:{fill:Ri,visibility:yi,opacity:1},instSlotTxtInActiveStyle:{fill:Ri,stroke:xi,visibility:Pi,opacity:0},instSlotActiveAttrib:{filter:"url(#dropshadow)"},instSlotInActiveAttrib:{filter:"none"},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},transpoInfoAttrib:{"dominant-baseline":"central","font-family":"sans-serif","font-weight":"bold","font-size":"0.75em"},transpoPitchModAttrib:{dy:-2,"font-family":"monospace","font-size":"1.5em"},errorBtnAttrib:{filter:"url(#dropshadow)"},topStave:{gId:"stvTop",imgId:"stvTopImg",startLineId:"stvTopStartLine",positionLineId:"stvTopPosLine",beatBallId:"stvTopBeatBall",maskId:"stvTopMask",ovrlPosId:"ovrlTopPos",ovrlPitchId:"ovrlTopPitch",ovrlPitchStaveId:"ovrlTopPitchStave",ovrlPitchStaveInfoId:"ovrlTopPitchStaveInfo",ovrlSpeedId:"ovrlTopSpeed",ovrlPressId:"ovrlTopPres",ovrlDynId:"ovrlTopDyn",ovrlTimbreId:"ovrlTopTimb",ballYmax:84,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"80",x2:"95",y2:"281"},posBallConf:{cx:"95",cy:"110",r:"4"}},bottomStave:{gId:"stvBot",imgId:"stvBotImg",startLineId:"stvBotStartLine",positionLineId:"stvBotPosLine",beatBallId:"stvBotBeatBall",maskId:"stvBotMask",ovrlPosId:"ovrlBotPos",ovrlPitchId:"ovrlBotPitch",ovrlPitchStaveId:"ovrlBotPitchStave",ovrlPitchStaveInfoId:"ovrlBotPitchStaveInfo",ovrlSpeedId:"ovrlBotSpeed",ovrlPressId:"ovrlBotPres",ovrlDynId:"ovrlBotDyn",ovrlTimbreId:"ovrlBotTimb",ballYmax:305,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"301",x2:"95",y2:"502"},posBallConf:{cx:"95",cy:"331",r:"4"}},metro:{idMetronomeRect:"metroRect",idMetronome:"metro",idMetroSlider:"metroFreqSlider",idMetroFreqRect:"metroFreq",idMetroFreqLine:"metroFreqLine",ifSymbolMetroOff:"#metronome",ifSymbolMetroOn:"#metronomeOn",ifMetroFreqSlider:"#metroFreq",minFreq:220,maxFreq:2200}},wn={clientId:null,isPlaying:!1,isReady:!1,score:{title:"ZScore",noSpaceTitle:"ZScore",htmlFile:null,instrument:"Part View",parts:["Part View"],firstPageNo:1,lastPageNo:2,sections:[],ownedSections:[],mySections:[],assignmentType:null},part:{name:"Part View",imgDir:null,imgPageNameToken:null,imgContPageName:null,blankPageNo:0,contPageNo:$i,currentSection:null,transpo:"C",pageRanges:[{start:1,end:1}],pages:{}},topStave:{id:"topStave",config:Ln.topStave,pageId:kn,rndPageId:null,filename:hn,beatMap:null,timeline:null,isActive:!0,isPlaying:!1,currentBeat:null,transpos:[]},bottomStave:{id:"bottomStave",config:Ln.bottomStave,pageId:kn,rndPageId:null,filename:hn,beatMap:null,timeline:null,isActive:!1,isPlaying:!1,currentBeat:null,transpos:[]},startTimeTl:0,currentBeatId:"b0",currentBeatNo:0,tempo:0,tempoModifier:1,scoreDir:"/score/",currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,isConnected:!1,isInitialised:!1,connectionType:null,pageNoToLoad:0,metro:{isMetroOn:!1,slider:{xMax:60,xMin:40,xMid:50,range:20}},isClientIdVisible:!1,transpo:r.TRANSPOSITION.C,counter:0};return c.prototype.loadImg=function(e){this.img.src=e,this.img.onload=function(){li("pageImgOnLoad: id: "+this.pageId),Be(this.pageId)}},{onStateBtn:function(){y()},onPartSelect:function(e){P(e)},onSectionSelect:function(e){x(e)},onInstrumentSelect:function(e,t){A(e,t)},onClientIdSelect:function(){B()},onTranspoSelect:function(e){N(e)}}}(zsUtil,zsNet,zsSvg,zsWsAudio,zsMusic,window,document);