var zscore=function(e,t,i,n,r,o,a){"use strict";function s(e){this.message=e,this.name="ZScoreException"}function l(e,t,i,n,r,o,a,s){this.xStart=e,this.xEnd=t,this.yStart=i,this.yEnd=n,this.beatStartNum=r,this.beatStartDenom=o,this.beatEndNum=a,this.beatEndDenom=s}function c(e,t,i,n){this.id=e,this.no=t,this.imgFileName=i,this.imgFileUrl=n,this.isLoaded=!1,this.img=new Image,this.img.pageId=e}function d(e,t){this.id=Vn.idSectionBtnPrefix+t,this.no=e,this.class="sectionListButton",this.onclick="onSectionSelect('"+t+"')"}function f(){this.class="sectionListButtonDisabled",this.onclick=""}function u(e,t){this.onclick="onInstrumentSelect("+e+",'"+t+"')"}function m(){this.onclick=""}function v(){}function p(){if(!_n.isInitialised){if(!(e&&t&&i&&n&&r))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");e.setRunMode(Ii),vi("init: "),S(),Rn=e.isTouchDevice(),Dn=e.isSafari(navigator),vi("init: IsTouch Device: "+Rn+" isSafari: "+Dn),_n.fontCanvas=a.createElement("canvas"),_n.canvasCtx=_n.fontCanvas.getContext("2d"),e.listen("resize",o,q),e.listen("orientationchange",o,q),w(),H(),F(),O(),I(),_n.isInitialised=!0}}function I(){}function S(){var t=e.getLocalParam(sn);fi(t)&&(t=e.generateRandomId(),e.storeLocalParam(sn,t)),_n.clientId=t,vi("clientId: "+_n.clientId),i.setElementIdText(Vn.idClientId,_n.clientId),C()}function g(){_n.part.pages={}}function b(){y(_n.topStave),y(_n.bottomStave)}function y(t){if(!fi(t)&&!fi(t.config)){var i=t.config;e.setElementIdAttributes(i.positionLineId,i.posLineConf),e.setElementIdAttributes(i.beatBallId,i.posBallConf)}}function T(){_n.isInitialised?(vi("onStateBtnClick: zscore initialised"),t.isConnected()||(vi("onStateBtnClick: zscore not connected, reconnecting..."),Z())):(vi("onStateBtnClick: initialising"),p())}function P(t){e.arrContains(_n.score.parts,t)?(_n.part.name=t,at(t),e.makeInVisible(Vn.idPartsListOuterDiv)):vi("onPartSelection: unexpected part: "+t)}function x(t){e.arrContains(_n.score.sections,t)?(h(t),dt(t)):vi("onSectionSelection: unexpected section: "+t)}function h(t){var i=Vn.idSectionBtnPrefix+t,n=e.getElement(i);fi(n)||E(n)}function E(t){fi(t)||e.setElementAttributes(t,new f)}function k(){var t=e.getElement(Vn.idOwnedSections);if(!fi(t)){for(var i=_n.score.mySections,n="",r="",o=0;o<i.length;o++)n=n+r+i[o],r="; ";e.setText(t,n)}}function A(e,t){fi(e)||fi(t)||fi(_n.part.name)||(ct(e,t,_n.part.name),Ot())}function C(){var t=_n.isClientIdVisible;t?e.makeVisible(Vn.idClientId):e.makeInVisible(Vn.idClientId)}function B(){_n.isClientIdVisible=!_n.isClientIdVisible,C()}function L(e){if(T(),!fi(e)){var t=r.getTransposition(e);fi(t)||(_n.transpo=t,Vt(),Ce())}}function N(){U()}function w(){t.init(Vn.connectionPreference,Vn.appUrlSse,Vn.appUrlWebsockets,Vn.appUrlHttp,J,z)}function O(){var t=e.getElement(Vn.metro.idMetronomeRect);fi(t)||(e.listen("click",t,D),M())}function M(){var t=e.getElement(Vn.metro.idMetroFreqLine),i=e.getElement(Vn.metro.idMetroFreqRect);if(ui(t)&&ui(i)){var n=e.toInt(t.getAttribute(wi)),r=e.toInt(i.getAttribute(Oi)),o=Math.round(r/2),a=n-o;_n.metro.slider.xMax=a;var s=e.toInt(t.getAttribute(Ni)),l=s+o;_n.metro.slider.xMin=l;var c=a-l;_n.metro.slider.range=c;var d=Math.round((a+l)/2);_n.metro.slider.xMid=d}Draggable.create(Vn.metro.ifMetroFreqSlider,{type:Li,bounds:document.getElementById(Vn.metro.idMetroFreqLine),onDrag:R})}function R(t){var i=gsap.getProperty(Vn.metro.ifMetroFreqSlider,Li),r=_n.metro.slider.xMid+i,o=r-_n.metro.slider.xMin,a=Math.round(100*o/_n.metro.slider.range),s=e.mapRange(a,0,100,Vn.metro.minFreq,Vn.metro.maxFreq);s<200&&(s=200),n.setBeepFreqenecy(s),vi("onFreqSliderMove: freq: "+s)}function D(e){_n.metro.isMetroOn?V():_()}function V(){n.switchMetro(!1),i.setElementIdHref(Vn.metro.idMetronome,Vn.metro.ifSymbolMetroOff),e.makeInVisible(Vn.metro.idMetroSlider),_n.metro.isMetroOn=!1}function _(){n.switchMetro(!0),i.setElementIdHref(Vn.metro.idMetronome,Vn.metro.ifSymbolMetroOn),e.makeVisible(Vn.metro.idMetroSlider),_n.metro.isMetroOn=!0}function F(){fi(n)?mi("initAudio: invalid zsAudio lib"):n.init()}function U(){fi(n)?mi("resetAudio: invalid zsAudio lib"):n.reset()}function H(){i.init()}function q(t){if(!e.isObject(this))return null}function z(e,i){switch(e){case t.OPEN:Y(i);break;case t.CLOSED:X(i);break;case t.ERROR:j(i);break;default:mi("Unknown Connection Event State: "+e+" for type: "+i)}}function Y(e){vi(e+" connection opened."),G(e)}function X(e){vi(e+" connection closed."),K(e)}function j(e){vi(e+" connection error."),W(e)}function G(e){_n.isConnected=!0,_n.connectionType=e,_n.reconnectAttmpts=0,Q(Vn.connectedRectStyle,Vn.connectedBtnAttrib,Vn.connectedTxtStyle,Pi),ot()}function K(e){_n.isConnected=!1,Q(Vn.disconnectedRectStyle,Vn.disconnectedBtnAttrib,Vn.disconnectedTxtStyle,Ei),Z(e)}function W(e){_n.isConnected=!1,Q(Vn.errorRectStyle,Vn.errorBtnAttrib,Vn.errorTxtStyle,ki),Z(e)}function Q(t,i,n,r){var o=e.getElement(Vn.idServerStatusRect);fi(o)||ci(o,t);var a=e.getElement(Vn.idServerStatusBtn);fi(a)||di(a,i);var s=e.getElement(Vn.idServerStatusTxt);fi(s)||(ci(s,n),s.textContent=r)}function Z(e){t.reconnect(e,!0)}function J(e,t){_n.isConnected||G(),fi(e)||(t||N(),ui(e.scoreInfo)&&$(e.scoreInfo),ui(e.strategyInfo)&&ee(e.strategyInfo),ui(e.partInfo)&&De(e.partInfo),ui(e.pageInfo)&&ye(e.pageInfo),ui(e.mapInfo)&&ae(e.mapInfo),ui(e.bpm)&&0!=e.bpm&&oe(e.bpm),ui(e.actions)&&ut(e.actions))}function $(t){if(e.isObject(t)){if(ui(t.partHtmlPage)){var i=ie(t.partHtmlPage),n=e.getPageName();i&&t.partHtmlPage!==n&&e.loadPage(t.partHtmlPage)}if(ui(t.title)){var r=te(t.title);r&&g()}ui(t.instruments)&&nt(t.instruments),ui(t.bpm)&&re(t.bpm),ui(t.scoreDir)&&ne(t.scoreDir)}}function ee(e){ui(e.strategies)&&Qe(e.strategies)}function te(t){return _n.score.title!==t&&(_n.score.title=t,_n.score.noSpaceTitle=e.replaceEmptySpaces(t,gi),i.setElementIdText(Vn.idTitle,t),!0)}function ie(e){var t=_n.score.htmlFile;return fi(t)?(_n.score.htmlFile=e,!1):t!==e&&(_n.score.htmlFile=e,!0)}function ne(e){_n.scoreDir!==e&&(_n.scoreDir=e)}function re(e){_n.tempo!==e&&(_n.tempo=e,i.setElementIdText(Vn.idTempoBpm,e))}function oe(t){var i=e.toInt(t);if(!fi(i)){var n=_n.tempo,r=i/n;_n.tempoModifier=r,re(i),_n.isPlaying?le(r):de()}}function ae(t){if(!fi(t.map)&&!fi(t.pageId)){t.pageId;var i=t.staveId,n=t.map,r=_n[i];if(!fi(r)){var o=r.config.xLeftMargin,a=JSON.parse(JSON.stringify(n));if(e.isArray(a)){for(var s={},l=0;l<a.length;l++)se(s,a[l],o);r.beatMap=s,fe(i)}}}}function se(e,t,i){if(!(fi(e)||fi(t)||fi(t.beatStartNum))){var n=t.beatStartNum,r=t.xStart+i,o=t.xEnd+i,a=new l(r,o,t.yStart,t.yEnd,n,t.beatStartDenom,t.beatEndNum,t.beatEndDenom);e[n]=a}}function le(e){ce(_n.topStave.timeline,e),ce(_n.bottomStave.timeline,e)}function ce(e,t){if(!fi(e)){var i=e.timeScale(),n=i*t;e.timeScale(n)}}function de(){ue(_n.topStave),ue(_n.bottomStave)}function fe(e){fi(e)||ue(_n[e])}function ue(e){if(!fi(e)){var t=gsap.timeline({onComplete:Ie,onCompleteParams:[e.id],paused:!0}),i=e.beatMap;if(!fi(i)){var n=e.config.positionLineId,o=e.config.beatBallId,a=e.config.ballYmax,s=!0;for(var l in i){var c=i[l],d=_n.tempo,f=r.getBeatDurationSec(d),u=c.beatStartNum;if(s){var m=Vn.beatIdPrefix+(u-1),v=c.xStart,p=me(n,0,v,m,0);t.add(p,Mi);var I=ve(o,0,v,m);t.add(I,Ri),s=!1}v=c.xEnd,m=Vn.beatIdPrefix+u;var S=Vn.tweenIdPrefix+m,g=me(n,f,v,m,u),b=ve(o,f,v,m),y=pe(o,f/2,a,m);S=g.vars.id;t.addLabel(S,Ri),t.add(g,Ri),t.add(b,Mi),t.add(y,S)}ui(e.currentBeat)&&Kt(t,e.currentBeat),e.timeline=t}}}function me(t,i,n,r,o){var a=Vn.tweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:a,duration:i,attr:{x1:n,x2:n},ease:"none",onStart:Se,onStartParams:[r,o],onComplete:ge,onCompleteParams:[r,o]})}function ve(t,i,n,r){var o=Vn.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cx:n},ease:"none"})}function pe(t,i,n,r){var o=Vn.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cy:n,r:2},ease:"power1.out",autoAlpha:.5,repeat:1,yoyo:!0})}function Ie(e){pi("onTimelineComplete stave: "+e);var t=_n[e];ui(t)&&(t.isRunning=!1),ui(t.timeline)&&t.timeline.pause(0)}function Se(e,t){var i=n.getCurrentTime();_n.audioTlBeatTime=i,pi("onBeatStart: beat: "+e+" beatNo: "+t+" beatTime: "+i),be(t,e)}function ge(e,t){var i=n.getCurrentTime(),r=i-_n.startTimeTl;pi("onBeatEnd: beat: "+e+" beatNo: "+t+" elapsedTime: "+r)}function be(t,i){e.isNumeric(t)&&(e.isNull(i)&&(i=Vn.beatIdPrefix+t),_n.currentBeatId=i,_n.currentBeatNo=t)}function ye(e){if(!fi(e.staveId)){var t=e.staveId,i=_n[t];fi(i)?mi("processPageinfo: Invalid stave for id: {}",t):(ui(e.filename)&&(i.filename=e.filename),ui(e.pageId)&&(i.pageId=e.pageId),ui(e.rndPageId)?i.rndPageId=e.rndPageId:i.rndPageId=null,Te(i),ui(e.transpositionInfo)&&Pe(e.transpositionInfo,i),Be(i))}}function Te(t){var i=e.getElement(t.config.ovrlPitchStaveInfoId);ui(i)&&e.removeElementChildren(i)}function Pe(e,t){fi(e)||fi(t)||(xe(e.rectInfos,t),Ee(e.txtInfos,t))}function xe(t,i){if(!fi(t)){var n=e.getElement(i.config.ovrlPitchStaveInfoId);if(e.isArray(t))for(var r=0;r<t.length;r++)he(t[r],n);else he(t,n)}}function he(t,n){if(!fi(t)&&!fi(n)){var r=null,o=null,a=null,s=null;if(ui(t.x)&&(r=t.x),ui(t.y)&&(o=t.y),ui(t.width)&&(a=t.width),ui(t.height)&&(s=t.height),!(fi(r)||fi(o)||fi(a)||fi(s))){var l=Vn.idTranspoInfo+Ae(),c=i.createRectangleElement(l);c.setAttribute("x",r),c.setAttribute("y",o),c.setAttribute("width",a),c.setAttribute("height",s),e.setElementAttributes(c,Vn.transpoExtRectAttrib),e.addChildToParent(n,c)}}}function Ee(t,i){if(!fi(t)){var n=e.getElement(i.config.ovrlPitchStaveInfoId);if(e.isArray(t))for(var r=0;r<t.length;r++)ke(t[r],n);else ke(t,n)}}function ke(t,n){if(!fi(t)&&!fi(n)){var o=null,a=null,s=null;if(ui(t.x)&&(o=t.x),ui(t.y)&&(a=t.y),ui(t.txt)&&(s=t.txt),!(fi(o)||fi(a)||fi(s))){var l=r.getPitch(s),c=r.PITCH_MOD.NATURAL;if(ui(l)){c=l.mod;var d=r.transpose(l,_n.transpo);ui(d)&&(l=d,s=d.pitchName,c=d.mod)}var f=Vn.idTranspoInfo+Ae(),u=i.createTextElement(f);u.setAttribute("x",o),u.setAttribute("y",a),e.setElementAttributes(u,Vn.transpoInfoAttrib);var m=Vn.idTranspoInfo+Ae(),v=i.createTspanElement(m);if(i.setElementText(v,s),e.addChildToParent(u,v),ui(l)&&r.PITCH_MOD.NATURAL!==c&&ui(l.modUnicode)){var p=Vn.idTranspoInfo+Ae(),I=i.createTspanElement(p);e.setElementAttributes(I,Vn.transpoPitchModAttrib),v.setAttribute("dx",-2),i.setElementText(I,l.modUnicode),e.addChildToParent(v,I)}else v.setAttribute("dx",2);e.addChildToParent(n,u)}}}function Ae(){return++_n.counter}function Ce(){if(!fi(_n.transpo)){var e=_n.transpo,t=r.PITCH.C;ui(e)&&(t=e.pitch),fi(t)||(ui(t.pitchName)&&i.setElementIdText(Vn.idTranspoKey,t.pitchName),ui(t.modUnicode)&&i.setElementIdText(Vn.idTranspoMod,t.modUnicode))}}function Be(t){if(!fi(t)){var i=t.config;if(!fi(i)){var n=null,r=t.pageId;ui(t.rndPageId)&&(r=t.rndPageId);var o=we(r);n=fi(o)?Ne(t.fileName):o.src;var a=e.getElement(i.imgId);a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),a.setAttribute("href",n);var s=e.getElement(t.config.ovrlPitchStaveInfoId),l=!1;e.hasChildrenElements(s)&&(l=!0),At(i,l)}}}function Le(t){if(!fi(t)){var i=t.config;if(!fi(i)){var n=t.fileName,r=e.getElement(i.imgId);r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),r.setAttribute("href",n)}}}function Ne(e){return _n.scoreDir+_n.score.noSpaceTitle+bi+e}function we(e){var t=_n.part.pages[e];return fi(t)?null:t.img}function Oe(e){var t=_n.part.pages[e];ui(t)&&(t.isLoaded=!0),_n.pageNoToLoad--,0===_n.pageNoToLoad&&Re(),Me(_n.pageNoToLoad)}function Me(e){if(e>0){var t=xi+" "+e;Q(Vn.errorRectStyle,Vn.errorBtnAttrib,Vn.errorTxtStyle,t)}else Q(Vn.connectedRectStyle,Vn.connectedBtnAttrib,Vn.connectedTxtStyle,hi)}function Re(){vi("onPageLoadComplete: ");var e=_n.part.pages,t=!0;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n.isLoaded||(vi("onPageLoadComplete: page: "+i+" is not loaded, retying load"),qe(n.no),t=!1)}t&&(vi("All Pages loaded: "),_n.isReady=!0,st())}function De(t){if(ui(t.name)&&(_n.part.name=t.name),ui(t.pageRanges)){var i=t.pageRanges;if(e.isArray(i))for(var n=0;n<i.length;n++)We(i[n]);else We(i)}ui(t.imgDir)&&(_n.part.imgDir=t.imgDir),ui(t.imgPageNameToken)&&(_n.part.imgPageNameToken=t.imgPageNameToken),ui(t.imgContPageName)&&(_n.part.imgContPageName=t.imgContPageName),ui(t.contPageNo)&&(_n.part.contPageNo=t.contPageNo),ui(t.currentSection)&&(_n.part.currentSection=t.currentSection),_e(),Ve()}function Ve(){var t=_n.part.name,n=_n.part.currentSection,r="";ui(n)&&(r+=e.capitalizeFirstLetter(n)+" - "),r+=t,i.setElementIdText(Vn.idInstrument,r)}function _e(){var t=_n.part,i=t.pageRanges;if(e.isArray(i)){_n.part.pages=[];for(var n=0;n<i.length;n++)He(i[n]);Fe(),Ue()}}function Fe(){var e=je();_n.pageNoToLoad++,ze(e)}function Ue(){var e=Xe();_n.pageNoToLoad++,ze(e)}function He(t){if(e.isObject(t)){var i=1,n=1;ui(t.start)&&(i=e.toInt(t.start)),ui(t.end)&&(n=e.toInt(t.end));var r=_n.pageNoToLoad+(n-i+1);_n.pageNoToLoad=r;for(var o=i;o<=n;o++)qe(o)}}function qe(e){var t=Ye(e);ze(t)}function ze(e){if(!fi(e)){var t=e.imgFileUrl;fi(t)||e.loadImg(t,e.id)}}function Ye(t){var i=Ke(t),n=_n.part.pages[i];if(ui(n))return n;var r=_n.part.imgPageNameToken;r=fi(r)?Ge(t):e.replace(r,Vn.pageNoToken,""+t);var o=_n.part.imgDir+r;n=new c(i,t,r,o);return _n.part.pages[i]=n,n}function Xe(){var e=_n.part.contPageNo,t=Ke(e),i=_n.part.pages[t];if(ui(i))return i;var n=_n.part.imgContPageName,r=_n.part.imgDir+n;i=new c(t,e,n,r);return _n.part.pages[t]=i,i}function je(){var e=_n.part.blankPageNo,t=Ke(e),i=_n.part.pages[t];if(ui(i))return i;var n=Vn.blankPageUrl,r=Vn.blankPageUrl;i=new c(t,e,n,r);return _n.part.pages[t]=i,i}function Ge(e){return _n.score.noSpaceTitle+gi+instrumentName+"_page"+e+".png"}function Ke(e){return Vn.pageIdPrefix+e}function We(e){if(!(fi(e)||fi(e.start)||fi(e.end))){var t=e.start,i=e.end,n={start:t,end:i};_n.part.pageRanges=[],_n.part.pageRanges.push(n)}}function Qe(t){if(!fi(t))if(e.isArray(t))for(var i=0;i<t.length;i++)Ze(t[i]);else Ze(t)}function Ze(t){if(e.isObject(t))if(fi(t.name))mi("processStrategies: invalid strategy name");else{var i=t.name;switch(i){case On:Je(t);break;case Mn:it(t);break;default:mi("processStrategies: Unknown strategy: "+i)}}}function Je(t){var i=!1;if(ui(t.isReady)&&(i=e.toBoolean(t.isReady)),ui(t.sections))if(_n.score.sections.length>0&&(_n.score.sections=[]),e.isArray(t.sections))for(var n=0;n<t.sections.length;n++)$e(t.sections[n]);else $e(t.sections);if(ui(t.assignmentType)&&(_n.score.assignmentType=t.assignmentType),_n.score.ownedSections=[],_n.score.mySections=[],ui(t.sectionOwners))for(var r in t.sectionOwners){var o=t.sectionOwners[r];_n.score.ownedSections.push(r),_n.clientId===o&&_n.score.mySections.push(r)}i?tt():et()}function $e(e){fi(e)||_n.score.sections.push(e)}function et(){var t=_n.score.sections;if(!(t.length<1)){var i=e.getElement(Vn.idSections);if(!fi(i)){for(var n=0;n<t.length;n++){var r=t[n],o=Vn.idSectionBtnPrefix+r,a=e.getElement(o);if(fi(a)){var s=new d(n+1,r);a=e.createButton(s),e.setText(a,r),e.addChildToParent(i,a)}e.arrContains(_n.score.ownedSections,r)&&E(a)}k(),e.makeVisible(Vn.idSectionsListOuterDiv)}}}function tt(){var t=e.getElement(Vn.idSections);fi(t)||(e.removeElementChildren(t),e.makeInVisible(Vn.idSectionsListOuterDiv))}function it(e){}function nt(t){var i=[];if(e.isArray(t))for(var n=0;n<t.length;n++){var r=t[n];e.arrContains(Vn.filterOutParts,r)||i.push(r)}else e.arrContains(Vn.filterOutParts,r)||i.push(t);e.arrEquals(_n.score.parts,i)||(_n.score.parts=i),rt(i)&&at(_n.part.name)}function rt(t){if(fi(_n.part.name)||!e.isArray(t))return!1;for(var i=_n.part.name,n=0;n<t.length;n++)if(i===t[n])return!0;return!1}function ot(){var e=ft();t.sendEvent(ln,e)}function at(e){var i=ft(),n="C";ui(_n.transpo)&&(n=_n.transpo),i[vn]=e,i[Ln]=n,t.sendEvent(cn,i)}function st(){var e=ft();e[vn]=_n.part.name,t.sendEvent(dn,e)}function lt(e){var i=ft();i[pn]=e,t.sendEvent(fn,i)}function ct(e,i,n){var r=ft();r[yn]=e,r[Tn]=i,r[vn]=n,t.sendEvent(un,r)}function dt(e){var i=ft();i[Cn]=e,t.sendEvent(mn,i)}function ft(){var e=new v;return e[Bn]=_n.clientId,e}function ut(t){var i=null,n=[],r={};if(e.isArray(t))for(var o=0;o<t.length;o++){var a=t[o];ui(a.type)&&(i=a.type),ui(a.targets)&&(n=a.targets),ui(a.params)&&(r=a.params),mt(i,n,r)}}function mt(t,i,n){if(e.logDebug("doAction: "+t),!fi(t))switch(t){case"PING":li(n);break;case"START":vt(ri,i,null);break;case"STOP":ni();break;case"SEMAPHORE_ON":Zt(n);break;case"SEMAPHORE_OFF":Jt(n);break;case"ACTIVATE":vt(Wt,i,n);break;case"BEAT":vt(jt,i,n);break;case"START_MARK":vt(zt,i,n);break;case"INSTRUMENT_SLOTS":Mt(n);break;case"RESET_INSTRUMENT_SLOTS":Ot();break;case"RESET_STAVES":Nt();break;case"OVERLAY_ELEMENT":vt(Tt,i,n);break;case"OVERLAY_LINE":vt(gt,i,n);break;case"OVERLAY_COLOUR":vt(pt,i,n);break;case"OVERLAY_TEXT":vt(xt,i,n);break;default:mi("doAction: Unknown actionType: "+t)}}function vt(t,i,n){if(!fi(t))if(e.isArray(i))for(var r=0;r<i.length;r++)t(i[r],n);else t(target,n)}function pt(e,t){if(!fi(t)&&!fi(e)){var i=_n[e],n=t[Pn],r=t[An];It(i,n,r)}}function It(e,t,i){if(!(fi(e)||fi(t)||fi(i)))switch(t){case"SPEED":case"PRESSURE":case"POSITION":break;case"PITCH":St(e.config.ovrlPitchId+Vn.idRectSuffix,i);break;case"DYNAMICS":St(e.config.ovrlDynId+Vn.idRectSuffix,i);break;case"TIMBRE":St(e.config.ovrlTimbreId+Vn.idRectSuffix,i);break;default:vi("setOverlayColour: unknown overlay type: "+t)}}function St(t,i){e.setElementIdStyleProperty(t,{fill:i})}function gt(e,t){if(!fi(t)&&!fi(e)){var i=_n[e],n=t[Pn],r=t[hn];bt(i,n,r)}}function bt(e,t,i){if(!(fi(e)||fi(t)||fi(i)))switch(t){case"POSITION":case"SPEED":case"PRESSURE":break;case"PITCH":yt(e.config.ovrlPitchId+Vn.idLineSuffix,i);break;case"DYNAMICS":yt(e.config.ovrlDynId+Vn.idLineSuffix,i);break;case"TIMBRE":yt(e.config.ovrlTimbreId+Vn.idLineSuffix,i);break;default:vi("setOverlayLinePosition: unknown overlay type: "+t)}}function yt(t,n){var r=e.getElement(t);i.setLineY(r,n,n)}function Tt(e,t){if(!fi(t)&&!fi(e)){var i=_n[e],n=t[Pn],r=t[xn],o=t[En],a=t[kn];Pt(i,n,r,o,a)}}function Pt(e,t,i,n,r){if(!fi(e)&&!fi(t)){var o=e.config;if(!fi(o))switch(pi("setOverlayElement: overlayType: "+t),t){case"SPEED":case"PRESSURE":case"POSITION":break;case"PITCH":Ct(o,i,n,r);break;case"DYNAMICS":Et(o,i,n,r);break;case"TIMBRE":ht(o,i,n,r);break;case"PITCH_STAVE":kt(o,i,n,r);break;default:vi("setOverlayElement: unknown overlay type: "+t)}}}function xt(e,t,i,n){if(!fi(e)&&!fi(t)){var r=e.config;if(!fi(r))switch(pi("setOverlayText: overlayType: "+t),t){case"PITCH":Bt(r,i,n);break;default:vi("setOverlayElement: unknown overlay type: "+t)}}}function ht(e,t,i,n){if(!fi(t)&&!fi(e))switch(t){case"TIMBRE_BOX":Lt(e.ovrlTimbreId+Vn.idRectSuffix,i,n),Lt(e.ovrlTimbreId+Vn.idOrdSuffix+Vn.idLineSuffix,i,n),Lt(e.ovrlTimbreId,i,n),i||Lt(e.ovrlTimbreId+Vn.idLineSuffix,i,n);break;case"TIMBRE_ORD_LINE":Lt(e.ovrlTimbreId+Vn.idOrdSuffix+Vn.idLineSuffix,i,n);break;case"TIMBRE_LINE":Lt(e.ovrlTimbreId+Vn.idLineSuffix,i,n);break;default:vi("setTimbreOverlay: unknown overlay element: "+t)}}function Et(e,t,i,n){if(!fi(t)&&!fi(e))switch(t){case"DYNAMICS_BOX":Lt(e.ovrlDynId+Vn.idRectSuffix,i,n),Lt(e.ovrlDynId+Vn.idOrdSuffix+Vn.idLineSuffix,i,n),Lt(e.ovrlDynId,i,n),i||Lt(e.ovrlDynId+Vn.idLineSuffix,i,n);break;case"DYNAMICS_MID_LINE":Lt(e.ovrlDynId+Vn.idOrdSuffix+Vn.idLineSuffix,i,n);break;case"DYNAMICS_LINE":Lt(e.ovrlDynId+Vn.idLineSuffix,i,n);break;default:vi("setDynamicsOverlay: unknown overlay element: "+t)}}function kt(e,t,i,n){if(!fi(t)&&!fi(e))switch(t){case"PITCH_STAVE_BOX":Lt(e.ovrlPitchStaveId+Vn.idRectSuffix,i,n),Lt(e.ovrlPitchStaveId,i,n),i||Lt(e.ovrlPitchStaveId+Vn.idLineSuffix,i,n);break;case"PITCH_STAVE_MID_LINE":Lt(e.ovrlPitchStaveId+Vn.idMidSuffix+Vn.idLineSuffix,i,n);break;default:vi("setPitchOverlay: unknown overlay element: "+t)}}function At(e,t){kt(e,"PITCH_STAVE_BOX",t,1),kt(e,"PITCH_STAVE_MID_LINE",t,1)}function Ct(e,t,i,n){if(!fi(t)&&!fi(e))switch(t){case"PITCH_BOX":Lt(e.ovrlPitchId+Vn.idRectSuffix,i,n),Lt(e.ovrlPitchId,i,n),i||Lt(e.ovrlPitchId+Vn.idLineSuffix,i,n);break;case"PITCH_LINE":Lt(e.ovrlPitchId+Vn.idLineSuffix,i,n);break;default:vi("setPitchOverlay: unknown overlay element: "+t)}}function Bt(e,t,i){if(!fi(overlayElement)&&!fi(e))switch(overlayElement){case"PITCH_BOX":Lt(e.ovrlPitchId+Vn.idRectSuffix,i,opacity),Lt(e.ovrlPitchId,i,opacity),i||Lt(e.ovrlPitchId+Vn.idLineSuffix,i,opacity);break;case"PITCH_LINE":Lt(e.ovrlPitchId+Vn.idLineSuffix,i,opacity);break;default:vi("setPitchOverlay: unknown overlay element: "+overlayElement)}}function Lt(t,i,n){if(!fi(t))if(i){var r=e.toFloat(n);e.isNumeric(r)||(r=1),e.setElementIdStyleProperty(t,{opacity:r}),e.makeVisible(t)}else e.makeInVisible(t)}function Nt(){wt(_n.topStave),wt(_n.bottomStave)}function wt(e){fi(e)||(e.pageId=wn,e.rndPageId=null,e.filename=Nn,e.beatMap=null,e.timeline=null,e.isActive=!0,e.isPlaying=!1,e.currentBeat=null,y(e),Le(e))}function Ot(){Ft(),Dt()}function Mt(e){if(!fi(e)){var t=e[bn];_t(t),Rt()}}function Rt(){e.makeVisible(Vn.idInstControls)}function Dt(){e.makeInVisible(Vn.idInstControls)}function Vt(){e.makeInVisible(Vn.idTranspoControls)}function _t(t){if(!fi(t)){var i=e.csvToArr(t);if(!(fi(i)||i.length<=0)){var n=_n.score.parts;if(!(fi(n)||n.length<=0))for(var r=0;r<n.length;r++){var o=r+1;r<i.length?Ut(i[r],o):Ht(o)}}}}function Ft(){var e=_n.score.parts;if(!(fi(e)||e.length<=0))for(var t=0;t<e.length;t++){var i=t+1;qt(i)}}function Ut(t,n){if(!fi(t)&&!fi(n)){var r=Vn.idInstSlotTxtPrefix+n,o=Vn.idInstSlotBtnPrefix+n,a=Vn.idInstSlotPrefix+n,s=t===_n.part.name;e.makeVisible(r),e.makeVisible(o),e.makeVisible(a),e.setElementIdAttributes(a,Vn.instSlotActiveAttrib),i.setElementIdText(r,t.trim()),e.setElementIdStyleProperty(r,Vn.instSlotTxtActiveStyle),s?e.setElementIdStyleProperty(o,Vn.instSlotBtnActiveInstStyle):e.setElementIdStyleProperty(o,Vn.instSlotBtnActiveStyle);var l=new u(n,t);e.setElementIdAttributes(o,l)}}function Ht(t){var n=Vn.idInstSlotTxtPrefix+t,r=Vn.idInstSlotBtnPrefix+t,o=Vn.idInstSlotPrefix+t;e.makeVisible(n),e.makeVisible(r),e.makeVisible(o),e.setElementIdAttributes(o,Vn.instSlotInActiveAttrib),i.setElementIdText(n,Si),e.setElementIdStyleProperty(n,Vn.instSlotTxtInActiveStyle),e.setElementIdStyleProperty(r,Vn.instSlotBtnInActiveStyle);var a=new m;e.setElementIdAttributes(r,a)}function qt(t){var i=Vn.idInstSlotTxtPrefix+t,n=Vn.idInstSlotBtnPrefix+t,r=Vn.idInstSlotPrefix+t;e.makeInVisible(i),e.makeInVisible(n),e.makeInVisible(r);var o=new m;e.setElementIdAttributes(n,o)}function zt(e,t){if(!fi(t)&&!fi(e)){var n=_n[e],r=t[gn];if(!fi(n)&&!fi(r)){var o=n.beatMap;if(!fi(o)){var a=o[r];if(!fi(a)){var s=a.xStart-1,l=Yt(n);i.setLineX(l,s,s),Xt(l,!0)}}}}}function Yt(t){return e.getElement(t.config.startLineId)}function Xt(t,i){i?e.makeElementVisible(t):e.makeElementInVisible(t)}function jt(e,t){if(!fi(t)&&!fi(e)){var i=_n[e],n=t[gn];Gt(i,n)}}function Gt(e,t){if(!fi(e)&&!fi(t)){var i=n.getCurrentTime();pi("setStaveBeat: stave: "+e.id+" beat: "+t+" time: "+i),Kt(e.timeline,t),e.currentBeat=t}}function Kt(e,t){if(!fi(e)){var i=Vn.tweenIdPrefix+Vn.beatIdPrefix+t,r=e.labels;i in r?(n.beep(),e.seek(i)):pi("setTimelineBeat: Invalid beat "+i)}}function Wt(e,t){if(!fi(t)&&!fi(e)){var i=_n[e],n=t[In],r=t[Sn];Qt(i,n,r)}}function Qt(t,i,n){if(!(fi(t)||fi(i)||fi(n))){if(i)e.setElementIdStyleProperty(t.config.maskId,Vn.activeStaveStyle);else{e.setElementIdStyleProperty(t.config.maskId,Vn.inactiveStaveStyle);var r=Yt(t);Xt(r,!1)}n&&oi(t.timeline)}}function Zt(e){fi(e)||ei(e.lightNo,e.colourId)}function Jt(e){fi(e)||ti(e.lightNo,Xi)}function $t(){ti(4,Xi),ti(1,Vi)}function ei(e,t){var i=ii(t);ti(e,i)}function ti(t,n){if(!fi(t)&&!fi(n))for(var r=e.toInt(t),o=1;o<=r;o++){var a=Vn.idSemaphorePrefix+o;i.setElementIdColour(a,n)}}function ii(e){var t;switch(e||(e=1),e){case 4:t=Vi;break;case 3:t=_i;break;case 2:t=Fi;break;case 1:default:t=Di}return t}function ni(){ai(),_n.isPlaying=!1,$t(),b()}function ri(e){if(!fi(e)){var t=_n[e];if(!fi(t)){var i=t.timeline;fi(i)||(oi(i),_n.isPlaying=!0)}}}function oi(e){if(fi(e))mi("startTimeline: invalid timeline");else{var t=e.progress();t>0&&t<1?e.resume():e.play(0)}}function ai(){si(_n.topStave.timeline),si(_n.bottomStave.timeline),_n.bottomStave.isPlaying=!1,_n.topStave.isPlaying=!1}function si(e){fi(e)?mi("stopTimeline: invalid timeline"):e.pause()}function li(t){e.isObject(t)&&ui(t.sendTimeMs)&&lt(t.sendTimeMs)}function ci(t,i){e.setElementStyleProperty(t,i)}function di(t,i){e.setElementAttributes(t,i)}function fi(t){return e.isNull(t)}function ui(t){return e.isNotNull(t)}function mi(t){e.logError(t)}function vi(t){e.log(t)}function pi(t){e.logDebug(t)}const Ii="dev",Si="",gi="_",bi="/",yi="AV",Ti="FullScore",Pi="Connected",xi="Loading",hi="READY",Ei="Reconnecting",ki="Error",Ai="visible",Ci="hidden",Bi="none",Li="x",Ni="x1",wi="x2",Oi="width",Mi="<",Ri=">",Di="green",Vi="red",_i="orange",Fi="yellow",Ui="white",Hi="black",qi="blue",zi="grey",Yi="lightgrey",Xi=Bi,ji=Xi,Gi=Ui,Ki=Di,Wi=Vi,Qi=_i,Zi=qi,Ji=zi,$i=Di,en=Vi,tn=_i,nn=Ui,rn=Ui,on=Hi,an=6666,sn="zsClientId",ln="HELLO",cn="PART_REG",dn="PART_READY",fn="PING",un="SELECT_ISLOT",mn="SELECT_SECTION",vn="part",pn="serverTime",In="isActive",Sn="isPlay",gn="beatNo",bn="csvInstruments",yn="slotNo",Tn="slotInstrument",Pn="overlayType",xn="overlayElement",hn="overlayLineY",En="isEnabled",kn="opacity",An="colour",Cn="section",Bn="clientId",Ln="transposition",Nn="img/blankStave.png",wn="p0",On="BUILDER",Mn="RND";var Rn=null,Dn=null,Vn={connectionPreference:"ws,sse,poll",defaultConnectionType:t.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",pageNoToken:"@PgNo@",instToken:"@Inst@",slotNoToken:"@SlotNo@",pageIdPrefix:"p",tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",idParts:"parts",idPartsListOuterDiv:"partListOuterDiv",idSections:"sections",idSectionsListOuterDiv:"sectionListOuterDiv",idSectionBtnPrefix:"sectionBtn",idOwnedSections:"ownedSections",idInstrument:"part",idInstControls:"instControls",idTranspoControls:"transpositionListOuterDiv",idInstSlotPrefix:"instSlot",idInstSlotTxtPrefix:"instSlotTxt",idInstSlotBtnPrefix:"instSlotRect",idTempoBpm:"tmpBpm",idSemaphorePrefix:"semC",idLineSuffix:"Line",idBridgeSuffix:"Bridge",idOrdSuffix:"Ord",idMidSuffix:"Mid",idRectSuffix:"Rect",idClientIdGroup:"clientIdGroup",idClientId:"clientId",idTranspoKey:"transpoKey",idTranspoMod:"transpoMod",idTranspoInfo:"transpoInfo",blankPageUrl:"img/blankStave.png",filterOutParts:[yi,Ti],connectedRectStyle:{fill:Ki,stroke:$i,"stroke-width":"0px",visibility:Ai,opacity:1},disconnectedRectStyle:{fill:Wi,stroke:en,"stroke-width":"1px",visibility:Ai,opacity:1},errorRectStyle:{fill:Qi,stroke:tn,"stroke-width":"1px",visibility:Ai,opacity:1},connectedTxtStyle:{fill:nn},disconnectedTxtStyle:{fill:rn},errorTxtStyle:{fill:on},activeStaveStyle:{fill:ji,stroke:Zi,"stroke-width":"1px",visibility:Ai,opacity:.5},inactiveStaveStyle:{fill:Gi,stroke:Ji,"stroke-width":"1px",visibility:Ai,opacity:.4},instSlotBtnActiveStyle:{fill:Ui,stroke:Hi,"stroke-width":"1px",visibility:Ai,opacity:1},instSlotBtnActiveInstStyle:{fill:"#d7f2cd",stroke:Hi,"stroke-width":"1px",visibility:Ai,opacity:1},instSlotBtnInActiveStyle:{fill:Yi,stroke:Bi,visibility:Ai,opacity:1},instSlotTxtActiveStyle:{fill:Hi,visibility:Ai,opacity:1},instSlotTxtInActiveStyle:{fill:Hi,stroke:Bi,visibility:Ci,opacity:0},instSlotActiveAttrib:{filter:"url(#dropshadow)"},instSlotInActiveAttrib:{filter:"none"},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},transpoInfoAttrib:{"dominant-baseline":"central","font-family":"sans-serif","font-weight":"bold","font-size":"0.75em"},transpoPitchModAttrib:{dy:-1,dx:-1.5,"font-family":"sans-serif","font-weight":"bold","font-size":"0.75em"},transpoExtRectAttrib:{fill:Ui,stroke:Bi,visibility:Ai,opacity:1},errorBtnAttrib:{filter:"url(#dropshadow)"},topStave:{gId:"stvTop",imgId:"stvTopImg",startLineId:"stvTopStartLine",positionLineId:"stvTopPosLine",beatBallId:"stvTopBeatBall",maskId:"stvTopMask",ovrlPosId:"ovrlTopPos",ovrlPitchId:"ovrlTopPitch",ovrlPitchStaveId:"ovrlTopPitchStave",ovrlPitchStaveInfoId:"ovrlTopPitchStaveInfo",ovrlSpeedId:"ovrlTopSpeed",ovrlPressId:"ovrlTopPres",ovrlDynId:"ovrlTopDyn",ovrlTimbreId:"ovrlTopTimb",ballYmax:84,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"80",x2:"95",y2:"281"},posBallConf:{cx:"95",cy:"110",r:"4"}},bottomStave:{gId:"stvBot",imgId:"stvBotImg",startLineId:"stvBotStartLine",positionLineId:"stvBotPosLine",beatBallId:"stvBotBeatBall",maskId:"stvBotMask",ovrlPosId:"ovrlBotPos",ovrlPitchId:"ovrlBotPitch",ovrlPitchStaveId:"ovrlBotPitchStave",ovrlPitchStaveInfoId:"ovrlBotPitchStaveInfo",ovrlSpeedId:"ovrlBotSpeed",ovrlPressId:"ovrlBotPres",ovrlDynId:"ovrlBotDyn",ovrlTimbreId:"ovrlBotTimb",ballYmax:305,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"301",x2:"95",y2:"502"},posBallConf:{cx:"95",cy:"331",r:"4"}},metro:{idMetronomeRect:"metroRect",idMetronome:"metro",idMetroSlider:"metroFreqSlider",idMetroFreqRect:"metroFreq",idMetroFreqLine:"metroFreqLine",ifSymbolMetroOff:"#metronome",ifSymbolMetroOn:"#metronomeOn",ifMetroFreqSlider:"#metroFreq",minFreq:220,maxFreq:2200}},_n={clientId:null,isPlaying:!1,isReady:!1,score:{title:"ZScore",noSpaceTitle:"ZScore",htmlFile:null,instrument:"Part View",parts:["Part View"],firstPageNo:1,lastPageNo:2,sections:[],ownedSections:[],mySections:[],assignmentType:null},part:{name:"Part View",imgDir:null,imgPageNameToken:null,imgContPageName:null,blankPageNo:0,contPageNo:an,currentSection:null,transpo:"C",pageRanges:[{start:1,end:1}],pages:{}},topStave:{id:"topStave",config:Vn.topStave,pageId:wn,rndPageId:null,filename:Nn,beatMap:null,timeline:null,isActive:!0,isPlaying:!1,currentBeat:null,transpos:[]},bottomStave:{id:"bottomStave",config:Vn.bottomStave,pageId:wn,rndPageId:null,filename:Nn,beatMap:null,timeline:null,isActive:!1,isPlaying:!1,currentBeat:null,transpos:[]},startTimeTl:0,currentBeatId:"b0",currentBeatNo:0,tempo:0,tempoModifier:1,scoreDir:"/score/",currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,isConnected:!1,isInitialised:!1,connectionType:null,pageNoToLoad:0,metro:{isMetroOn:!1,slider:{xMax:60,xMin:40,xMid:50,range:20}},isClientIdVisible:!1,transpo:r.TRANSPOSITION.C,counter:0};return c.prototype.loadImg=function(e){this.img.src=e,this.img.onload=function(){vi("pageImgOnLoad: id: "+this.pageId),Oe(this.pageId)}},{onStateBtn:function(){T()},onPartSelect:function(e){P(e)},onSectionSelect:function(e){x(e)},onInstrumentSelect:function(e,t){A(e,t)},onClientIdSelect:function(){B()},onTranspoSelect:function(e){L(e)}}}(zsUtil,zsNet,zsSvg,zsWsAudio,zsMusic,window,document);