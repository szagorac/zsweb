var zscore=function(e,t,i,n,r,o,a){"use strict";function s(e){this.message=e,this.name="ZScoreException"}function l(e,t,i,n,r,o,a,s){this.xStart=e,this.xEnd=t,this.yStart=i,this.yEnd=n,this.beatStartNum=r,this.beatStartDenom=o,this.beatEndNum=a,this.beatEndDenom=s}function c(e,t,i,n){this.id=e,this.no=t,this.imgFileName=i,this.imgFileUrl=n,this.isLoaded=!1,this.img=new Image,this.img.pageId=e}function d(e,t){this.id=Nn.idSectionBtnPrefix+t,this.no=e,this.class="sectionListButton",this.onclick="onSectionSelect('"+t+"')"}function f(){this.class="sectionListButtonDisabled",this.onclick=""}function u(e,t){this.onclick="onInstrumentSelect("+e+",'"+t+"')"}function m(){this.onclick=""}function v(){}function p(){if(!Ln.isInitialised){if(!(e&&t&&i&&n&&r))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");e.setRunMode(ci),si("init: "),S(),Bn=e.isTouchDevice(),Cn=e.isSafari(navigator),si("init: IsTouch Device: "+Bn+" isSafari: "+Cn),Ln.fontCanvas=a.createElement("canvas"),Ln.canvasCtx=Ln.fontCanvas.getContext("2d"),e.listen("resize",o,q),e.listen("orientationchange",o,q),L(),U(),_(),w(),Ln.isInitialised=!0}}function S(){var t=e.getLocalParam($i);ri(t)&&(t=e.generateRandomId(),e.storeLocalParam($i,t)),Ln.clientId=t,si("clientId: "+Ln.clientId),i.setElementIdText(Nn.idClientId,Ln.clientId),A()}function I(){Ln.part.pages={}}function g(){b(Ln.topStave),b(Ln.bottomStave)}function b(t){if(!ri(t)&&!ri(t.config)){var i=t.config;e.setElementIdAttributes(i.positionLineId,i.posLineConf),e.setElementIdAttributes(i.beatBallId,i.posBallConf)}}function y(){Ln.isInitialised?(si("onStateBtnClick: zscore initialised"),t.isConnected()||(si("onStateBtnClick: zscore not connected, reconnecting..."),Q())):(si("onStateBtnClick: initialising"),p())}function T(t){e.arrContains(Ln.score.parts,t)?(Ln.part.name=t,tt(t),e.makeInVisible(Nn.idPartsListOuterDiv)):si("onPartSelection: unexpected part: "+t)}function P(t){e.arrContains(Ln.score.sections,t)?(x(t),ot(t)):si("onSectionSelection: unexpected section: "+t)}function x(t){var i=Nn.idSectionBtnPrefix+t,n=e.getElement(i);ri(n)||E(n)}function E(t){ri(t)||e.setElementAttributes(t,new f)}function h(){var t=e.getElement(Nn.idOwnedSections);if(!ri(t)){for(var i=Ln.score.mySections,n="",r="",o=0;o<i.length;o++)n=n+r+i[o],r="; ";e.setText(t,n)}}function k(e,t){ri(e)||ri(t)||ri(Ln.part.name)||(rt(e,t,Ln.part.name),kt())}function A(){var t=Ln.isClientIdVisible;t?e.makeVisible(Nn.idClientId):e.makeInVisible(Nn.idClientId)}function B(){Ln.isClientIdVisible=!Ln.isClientIdVisible,A()}function C(e){Ln.traspo=e,Nt(),xe()}function N(){F()}function L(){t.init(Nn.connectionPreference,Nn.appUrlSse,Nn.appUrlWebsockets,Nn.appUrlHttp,Z,H)}function w(){var t=e.getElement(Nn.metro.idMetronomeRect);ri(t)||(e.listen("click",t,R),M())}function M(){var t=e.getElement(Nn.metro.idMetroFreqLine),i=e.getElement(Nn.metro.idMetroFreqRect);if(oi(t)&&oi(i)){var n=e.toInt(t.getAttribute(hi)),r=e.toInt(i.getAttribute(ki)),o=Math.round(r/2),a=n-o;Ln.metro.slider.xMax=a;var s=e.toInt(t.getAttribute(Ei)),l=s+o;Ln.metro.slider.xMin=l;var c=a-l;Ln.metro.slider.range=c;var d=Math.round((a+l)/2);Ln.metro.slider.xMid=d}Draggable.create(Nn.metro.ifMetroFreqSlider,{type:xi,bounds:document.getElementById(Nn.metro.idMetroFreqLine),onDrag:O})}function O(t){var i=gsap.getProperty(Nn.metro.ifMetroFreqSlider,xi),r=Ln.metro.slider.xMid+i,o=r-Ln.metro.slider.xMin,a=Math.round(100*o/Ln.metro.slider.range),s=e.mapRange(a,0,100,Nn.metro.minFreq,Nn.metro.maxFreq);s<200&&(s=200),n.setBeepFreqenecy(s),si("onFreqSliderMove: freq: "+s)}function R(e){Ln.metro.isMetroOn?D():V()}function D(){n.switchMetro(!1),i.setElementIdHref(Nn.metro.idMetronome,Nn.metro.ifSymbolMetroOff),e.makeInVisible(Nn.metro.idMetroSlider),Ln.metro.isMetroOn=!1}function V(){n.switchMetro(!0),i.setElementIdHref(Nn.metro.idMetronome,Nn.metro.ifSymbolMetroOn),e.makeVisible(Nn.metro.idMetroSlider),Ln.metro.isMetroOn=!0}function _(){ri(n)?ai("initAudio: invalid zsAudio lib"):n.init()}function F(){ri(n)?ai("resetAudio: invalid zsAudio lib"):n.reset()}function U(){i.init()}function q(t){if(!e.isObject(this))return null}function H(e,i){switch(e){case t.OPEN:z(i);break;case t.CLOSED:Y(i);break;case t.ERROR:X(i);break;default:ai("Unknown Connection Event State: "+e+" for type: "+i)}}function z(e){si(e+" connection opened."),j(e)}function Y(e){si(e+" connection closed."),G(e)}function X(e){si(e+" connection error."),K(e)}function j(e){Ln.isConnected=!0,Ln.connectionType=e,Ln.reconnectAttmpts=0,W(Nn.connectedRectStyle,Nn.connectedBtnAttrib,Nn.connectedTxtStyle,pi),et()}function G(e){Ln.isConnected=!1,W(Nn.disconnectedRectStyle,Nn.disconnectedBtnAttrib,Nn.disconnectedTxtStyle,gi),Q(e)}function K(e){Ln.isConnected=!1,W(Nn.errorRectStyle,Nn.errorBtnAttrib,Nn.errorTxtStyle,bi),Q(e)}function W(t,i,n,r){var o=e.getElement(Nn.idServerStatusRect);ri(o)||ii(o,t);var a=e.getElement(Nn.idServerStatusBtn);ri(a)||ni(a,i);var s=e.getElement(Nn.idServerStatusTxt);ri(s)||(ii(s,n),s.textContent=r)}function Q(e){t.reconnect(e,!0)}function Z(e,t){Ln.isConnected||j(),ri(e)||(t||N(),oi(e.scoreInfo)&&J(e.scoreInfo),oi(e.strategyInfo)&&$(e.strategyInfo),oi(e.partInfo)&&Le(e.partInfo),oi(e.pageInfo)&&be(e.pageInfo),oi(e.mapInfo)&&oe(e.mapInfo),oi(e.bpm)&&0!=e.bpm&&re(e.bpm),oi(e.actions)&&st(e.actions))}function J(t){if(e.isObject(t)){if(oi(t.partHtmlPage)){var i=te(t.partHtmlPage),n=e.getPageName();i&&t.partHtmlPage!==n&&e.loadPage(t.partHtmlPage)}if(oi(t.title)){var r=ee(t.title);r&&I()}oi(t.instruments)&&Je(t.instruments),oi(t.bpm)&&ne(t.bpm),oi(t.scoreDir)&&ie(t.scoreDir)}}function $(e){oi(e.strategies)&&Xe(e.strategies)}function ee(t){return Ln.score.title!==t&&(Ln.score.title=t,Ln.score.noSpaceTitle=e.replaceEmptySpaces(t,fi),i.setElementIdText(Nn.idTitle,t),!0)}function te(e){var t=Ln.score.htmlFile;return ri(t)?(Ln.score.htmlFile=e,!1):t!==e&&(Ln.score.htmlFile=e,!0)}function ie(e){Ln.scoreDir!==e&&(Ln.scoreDir=e)}function ne(e){Ln.tempo!==e&&(Ln.tempo=e,i.setElementIdText(Nn.idTempoBpm,e))}function re(t){var i=e.toInt(t);if(!ri(i)){var n=Ln.tempo,r=i/n;Ln.tempoModifier=r,ne(i),Ln.isPlaying?se(r):ce()}}function oe(t){if(!ri(t.map)&&!ri(t.pageId)){t.pageId;var i=t.staveId,n=t.map,r=Ln[i];if(!ri(r)){var o=r.config.xLeftMargin,a=JSON.parse(JSON.stringify(n));if(e.isArray(a)){for(var s={},l=0;l<a.length;l++)ae(s,a[l],o);r.beatMap=s,de(i)}}}}function ae(e,t,i){if(!(ri(e)||ri(t)||ri(t.beatStartNum))){var n=t.beatStartNum,r=t.xStart+i,o=t.xEnd+i,a=new l(r,o,t.yStart,t.yEnd,n,t.beatStartDenom,t.beatEndNum,t.beatEndDenom);e[n]=a}}function se(e){le(Ln.topStave.timeline,e),le(Ln.bottomStave.timeline,e)}function le(e,t){if(!ri(e)){var i=e.timeScale(),n=i*t;e.timeScale(n)}}function ce(){fe(Ln.topStave),fe(Ln.bottomStave)}function de(e){ri(e)||fe(Ln[e])}function fe(e){if(!ri(e)){var t=gsap.timeline({onComplete:pe,onCompleteParams:[e.id],paused:!0}),i=e.beatMap;if(!ri(i)){var n=e.config.positionLineId,o=e.config.beatBallId,a=e.config.ballYmax,s=!0;for(var l in i){var c=i[l],d=Ln.tempo,f=r.getBeatDurationSec(d),u=c.beatStartNum;if(s){var m=Nn.beatIdPrefix+(u-1),v=c.xStart,p=ue(n,0,v,m,0);t.add(p,Ai);var S=me(o,0,v,m);t.add(S,Bi),s=!1}v=c.xEnd,m=Nn.beatIdPrefix+u;var I=Nn.tweenIdPrefix+m,g=ue(n,f,v,m,u),b=me(o,f,v,m),y=ve(o,f/2,a,m);I=g.vars.id;t.addLabel(I,Bi),t.add(g,Bi),t.add(b,Ai),t.add(y,I)}oi(e.currentBeat)&&qt(t,e.currentBeat),e.timeline=t}}}function ue(t,i,n,r,o){var a=Nn.tweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:a,duration:i,attr:{x1:n,x2:n},ease:"none",onStart:Se,onStartParams:[r,o],onComplete:Ie,onCompleteParams:[r,o]})}function me(t,i,n,r){var o=Nn.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cx:n},ease:"none"})}function ve(t,i,n,r){var o=Nn.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cy:n,r:2},ease:"power1.out",autoAlpha:.5,repeat:1,yoyo:!0})}function pe(e){li("onTimelineComplete stave: "+e);var t=Ln[e];oi(t)&&(t.isRunning=!1),oi(t.timeline)&&t.timeline.pause(0)}function Se(e,t){var i=n.getCurrentTime();Ln.audioTlBeatTime=i,li("onBeatStart: beat: "+e+" beatNo: "+t+" beatTime: "+i),ge(t,e)}function Ie(e,t){var i=n.getCurrentTime(),r=i-Ln.startTimeTl;li("onBeatEnd: beat: "+e+" beatNo: "+t+" elapsedTime: "+r)}function ge(t,i){e.isNumeric(t)&&(e.isNull(i)&&(i=Nn.beatIdPrefix+t),Ln.currentBeatId=i,Ln.currentBeatNo=t)}function be(e){if(!ri(e.staveId)){var t=e.staveId,i=Ln[t];ri(i)?ai("processPageinfo: Invalid stave for id: {}",t):(oi(e.filename)&&(i.filename=e.filename),oi(e.pageId)&&(i.pageId=e.pageId),oi(e.rndPageId)?i.rndPageId=e.rndPageId:i.rndPageId=null,oi(e.transpositionInfo)&&ye(e.transpositionInfo,i),Ee(i))}}function ye(t,i){if(!ri(t)&&!ri(i)){var n=t.txtInfos;if(!ri(n)){var r=e.getElement(i.config.ovrlPitchStaveInfoId);if(oi(r)&&e.removeElementChildren(r),e.isArray(n))for(var o=0;o<n.length;o++)Te(n[o],r);else Te(n,r)}}}function Te(t,n){if(!ri(t)&&!ri(n)){var r=null,o=null,a=null;if(oi(t.x)&&(r=t.x),oi(t.y)&&(o=t.y),oi(t.txt)&&(a=t.txt),!(ri(r)||ri(o)||ri(a))){var s=Nn.idTranspoInfo+Pe(),l=i.createTextElement(s);l.setAttribute("x",r),l.setAttribute("y",o),e.setElementAttributes(l,Nn.transpoInfoAttrib),i.setElementText(l,a),e.addChildToParent(n,l)}}}function Pe(){return++Ln.counter}function xe(){if(!ri(Ln.traspo)){var e=Ln.traspo,t=r.getNote(e);ri(t)||(oi(t.pitchName)&&i.setElementIdText(Nn.idTranspoKey,t.pitchName),oi(t.modUnicode)&&i.setElementIdText(Nn.idTranspoMod,t.modUnicode))}}function Ee(t){if(!ri(t)){var i=t.config;if(!ri(i)){var n=null,r=t.pageId;oi(t.rndPageId)&&(r=t.rndPageId);var o=Ae(r);n=ri(o)?ke(t.fileName):o.src;var a=e.getElement(i.imgId);a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),a.setAttribute("href",n);var s=e.getElement(t.config.ovrlPitchStaveInfoId),l=!1;e.hasChildrenElements(s)&&(l=!0),Tt(i,l)}}}function he(t){if(!ri(t)){var i=t.config;if(!ri(i)){var n=t.fileName,r=e.getElement(i.imgId);r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),r.setAttribute("href",n)}}}function ke(e){return Ln.scoreDir+Ln.score.noSpaceTitle+ui+e}function Ae(e){var t=Ln.part.pages[e];return ri(t)?null:t.img}function Be(e){var t=Ln.part.pages[e];oi(t)&&(t.isLoaded=!0),Ln.pageNoToLoad--,0===Ln.pageNoToLoad&&Ne(),Ce(Ln.pageNoToLoad)}function Ce(e){if(e>0){var t=Si+" "+e;W(Nn.errorRectStyle,Nn.errorBtnAttrib,Nn.errorTxtStyle,t)}else W(Nn.connectedRectStyle,Nn.connectedBtnAttrib,Nn.connectedTxtStyle,Ii)}function Ne(){si("onPageLoadComplete: ");var e=Ln.part.pages,t=!0;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n.isLoaded||(si("onPageLoadComplete: page: "+i+" is not loaded, retying load"),Ve(n.no),t=!1)}t&&(si("All Pages loaded: "),Ln.isReady=!0,it())}function Le(t){if(oi(t.name)&&(Ln.part.name=t.name),oi(t.pageRanges)){var i=t.pageRanges;if(e.isArray(i))for(var n=0;n<i.length;n++)Ye(i[n]);else Ye(i)}oi(t.imgDir)&&(Ln.part.imgDir=t.imgDir),oi(t.imgPageNameToken)&&(Ln.part.imgPageNameToken=t.imgPageNameToken),oi(t.imgContPageName)&&(Ln.part.imgContPageName=t.imgContPageName),oi(t.contPageNo)&&(Ln.part.contPageNo=t.contPageNo),oi(t.currentSection)&&(Ln.part.currentSection=t.currentSection),Me(),we()}function we(){var t=Ln.part.name,n=Ln.part.currentSection,r="";oi(n)&&(r+=e.capitalizeFirstLetter(n)+" - "),r+=t,i.setElementIdText(Nn.idInstrument,r)}function Me(){var t=Ln.part,i=t.pageRanges;if(e.isArray(i)){Ln.part.pages=[];for(var n=0;n<i.length;n++)De(i[n]);Oe(),Re()}}function Oe(){var e=qe();Ln.pageNoToLoad++,_e(e)}function Re(){var e=Ue();Ln.pageNoToLoad++,_e(e)}function De(t){if(e.isObject(t)){var i=1,n=1;oi(t.start)&&(i=e.toInt(t.start)),oi(t.end)&&(n=e.toInt(t.end));var r=Ln.pageNoToLoad+(n-i+1);Ln.pageNoToLoad=r;for(var o=i;o<=n;o++)Ve(o)}}function Ve(e){var t=Fe(e);_e(t)}function _e(e){if(!ri(e)){var t=e.imgFileUrl;ri(t)||e.loadImg(t,e.id)}}function Fe(t){var i=ze(t),n=Ln.part.pages[i];if(oi(n))return n;var r=Ln.part.imgPageNameToken;r=ri(r)?He(t):e.replace(r,Nn.pageNoToken,""+t);var o=Ln.part.imgDir+r;n=new c(i,t,r,o);return Ln.part.pages[i]=n,n}function Ue(){var e=Ln.part.contPageNo,t=ze(e),i=Ln.part.pages[t];if(oi(i))return i;var n=Ln.part.imgContPageName,r=Ln.part.imgDir+n;i=new c(t,e,n,r);return Ln.part.pages[t]=i,i}function qe(){var e=Ln.part.blankPageNo,t=ze(e),i=Ln.part.pages[t];if(oi(i))return i;var n=Nn.blankPageUrl,r=Nn.blankPageUrl;i=new c(t,e,n,r);return Ln.part.pages[t]=i,i}function He(e){return Ln.score.noSpaceTitle+fi+instrumentName+"_page"+e+".png"}function ze(e){return Nn.pageIdPrefix+e}function Ye(e){if(!(ri(e)||ri(e.start)||ri(e.end))){var t=e.start,i=e.end,n={start:t,end:i};Ln.part.pageRanges=[],Ln.part.pageRanges.push(n)}}function Xe(t){if(!ri(t))if(e.isArray(t))for(var i=0;i<t.length;i++)je(t[i]);else je(t)}function je(t){if(e.isObject(t))if(ri(t.name))ai("processStrategies: invalid strategy name");else{var i=t.name;switch(i){case kn:Ge(t);break;case An:Ze(t);break;default:ai("processStrategies: Unknown strategy: "+i)}}}function Ge(t){var i=!1;if(oi(t.isReady)&&(i=e.toBoolean(t.isReady)),oi(t.sections))if(Ln.score.sections.length>0&&(Ln.score.sections=[]),e.isArray(t.sections))for(var n=0;n<t.sections.length;n++)Ke(t.sections[n]);else Ke(t.sections);if(oi(t.assignmentType)&&(Ln.score.assignmentType=t.assignmentType),Ln.score.ownedSections=[],Ln.score.mySections=[],oi(t.sectionOwners))for(var r in t.sectionOwners){var o=t.sectionOwners[r];Ln.score.ownedSections.push(r),Ln.clientId===o&&Ln.score.mySections.push(r)}i?Qe():We()}function Ke(e){ri(e)||Ln.score.sections.push(e)}function We(){var t=Ln.score.sections;if(!(t.length<1)){var i=e.getElement(Nn.idSections);if(!ri(i)){for(var n=0;n<t.length;n++){var r=t[n],o=Nn.idSectionBtnPrefix+r,a=e.getElement(o);if(ri(a)){var s=new d(n+1,r);a=e.createButton(s),e.setText(a,r),e.addChildToParent(i,a)}e.arrContains(Ln.score.ownedSections,r)&&E(a)}h(),e.makeVisible(Nn.idSectionsListOuterDiv)}}}function Qe(){var t=e.getElement(Nn.idSections);ri(t)||(e.removeElementChildren(t),e.makeInVisible(Nn.idSectionsListOuterDiv))}function Ze(e){}function Je(t){var i=[];if(e.isArray(t))for(var n=0;n<t.length;n++){var r=t[n];e.arrContains(Nn.filterOutParts,r)||i.push(r)}else e.arrContains(Nn.filterOutParts,r)||i.push(t);e.arrEquals(Ln.score.parts,i)||(Ln.score.parts=i),$e(i)&&tt(Ln.part.name)}function $e(t){if(ri(Ln.part.name)||!e.isArray(t))return!1;for(var i=Ln.part.name,n=0;n<t.length;n++)if(i===t[n])return!0;return!1}function et(){var e=at();t.sendEvent(en,e)}function tt(e){var i=at(),n="C";oi(Ln.traspo)&&(n=Ln.traspo),i[sn]=e,i[xn]=n,t.sendEvent(tn,i)}function it(){var e=at();e[sn]=Ln.part.name,t.sendEvent(nn,e)}function nt(e){var i=at();i[ln]=e,t.sendEvent(rn,i)}function rt(e,i,n){var r=at();r[mn]=e,r[vn]=i,r[sn]=n,t.sendEvent(on,r)}function ot(e){var i=at();i[Tn]=e,t.sendEvent(an,i)}function at(){var e=new v;return e[Pn]=Ln.clientId,e}function st(t){var i=null,n=[],r={};if(e.isArray(t))for(var o=0;o<t.length;o++){var a=t[o];oi(a.type)&&(i=a.type),oi(a.targets)&&(n=a.targets),oi(a.params)&&(r=a.params),lt(i,n,r)}}function lt(t,i,n){if(e.logDebug("doAction: "+t),!ri(t))switch(t){case"PING":ti(n);break;case"START":ct(Zt,i,null);break;case"STOP":Qt();break;case"SEMAPHORE_ON":Yt(n);break;case"SEMAPHORE_OFF":Xt(n);break;case"ACTIVATE":ct(Ht,i,n);break;case"BEAT":ct(Ft,i,n);break;case"START_MARK":ct(Dt,i,n);break;case"INSTRUMENT_SLOTS":At(n);break;case"RESET_INSTRUMENT_SLOTS":kt();break;case"RESET_STAVES":Et();break;case"OVERLAY_ELEMENT":ct(St,i,n);break;case"OVERLAY_LINE":ct(mt,i,n);break;case"OVERLAY_COLOUR":ct(dt,i,n);break;default:ai("doAction: Unknown actionType: "+t)}}function ct(t,i,n){if(!ri(t))if(e.isArray(i))for(var r=0;r<i.length;r++)t(i[r],n);else t(target,n)}function dt(e,t){if(!ri(t)&&!ri(e)){var i=Ln[e],n=t[pn],r=t[yn];ft(i,n,r)}}function ft(e,t,i){if(!(ri(e)||ri(t)||ri(i)))switch(t){case"SPEED":case"PRESSURE":case"POSITION":break;case"PITCH":ut(e.config.ovrlPitchId+Nn.idRectSuffix,i);break;case"DYNAMICS":ut(e.config.ovrlDynId+Nn.idRectSuffix,i);break;case"TIMBRE":ut(e.config.ovrlTimbreId+Nn.idRectSuffix,i);break;default:si("setOverlayColour: unknown overlay type: "+t)}}function ut(t,i){e.setElementIdStyleProperty(t,{fill:i})}function mt(e,t){if(!ri(t)&&!ri(e)){var i=Ln[e],n=t[pn],r=t[In];vt(i,n,r)}}function vt(e,t,i){if(!(ri(e)||ri(t)||ri(i)))switch(t){case"POSITION":case"SPEED":case"PRESSURE":break;case"PITCH":pt(e.config.ovrlPitchId+Nn.idLineSuffix,i);break;case"DYNAMICS":pt(e.config.ovrlDynId+Nn.idLineSuffix,i);break;case"TIMBRE":pt(e.config.ovrlTimbreId+Nn.idLineSuffix,i);break;default:si("setOverlayLinePosition: unknown overlay type: "+t)}}function pt(t,n){var r=e.getElement(t);i.setLineY(r,n,n)}function St(e,t){if(!ri(t)&&!ri(e)){var i=Ln[e],n=t[pn],r=t[Sn],o=t[gn],a=t[bn];It(i,n,r,o,a)}}function It(e,t,i,n,r){if(!ri(e)&&!ri(t)){var o=e.config;if(!ri(o))switch(li("setOverlayElement: overlayType: "+t),t){case"SPEED":case"PRESSURE":case"POSITION":break;case"PITCH":Pt(o,i,n,r);break;case"DYNAMICS":bt(o,i,n,r);break;case"TIMBRE":gt(o,i,n,r);break;case"PITCH_STAVE":yt(o,i,n,r);break;default:si("setOverlayElement: unknown overlay type: "+t)}}}function gt(e,t,i,n){if(!ri(t)&&!ri(e))switch(t){case"TIMBRE_BOX":xt(e.ovrlTimbreId+Nn.idRectSuffix,i,n),xt(e.ovrlTimbreId+Nn.idOrdSuffix+Nn.idLineSuffix,i,n),xt(e.ovrlTimbreId,i,n),i||xt(e.ovrlTimbreId+Nn.idLineSuffix,i,n);break;case"TIMBRE_ORD_LINE":xt(e.ovrlTimbreId+Nn.idOrdSuffix+Nn.idLineSuffix,i,n);break;case"TIMBRE_LINE":xt(e.ovrlTimbreId+Nn.idLineSuffix,i,n);break;default:si("setTimbreOverlay: unknown overlay element: "+t)}}function bt(e,t,i,n){if(!ri(t)&&!ri(e))switch(t){case"DYNAMICS_BOX":xt(e.ovrlDynId+Nn.idRectSuffix,i,n),xt(e.ovrlDynId+Nn.idOrdSuffix+Nn.idLineSuffix,i,n),xt(e.ovrlDynId,i,n),i||xt(e.ovrlDynId+Nn.idLineSuffix,i,n);break;case"DYNAMICS_MID_LINE":xt(e.ovrlDynId+Nn.idOrdSuffix+Nn.idLineSuffix,i,n);break;case"DYNAMICS_LINE":xt(e.ovrlDynId+Nn.idLineSuffix,i,n);break;default:si("setDynamicsOverlay: unknown overlay element: "+t)}}function yt(e,t,i,n){if(!ri(t)&&!ri(e))switch(t){case"PITCH_STAVE_BOX":xt(e.ovrlPitchStaveId+Nn.idRectSuffix,i,n),xt(e.ovrlPitchStaveId,i,n),i||xt(e.ovrlPitchStaveId+Nn.idLineSuffix,i,n);break;case"PITCH_STAVE_MID_LINE":xt(e.ovrlPitchStaveId+Nn.idMidSuffix+Nn.idLineSuffix,i,n);break;default:si("setPitchOverlay: unknown overlay element: "+t)}}function Tt(e,t){yt(e,"PITCH_STAVE_BOX",t,1),yt(e,"PITCH_STAVE_MID_LINE",t,1)}function Pt(e,t,i,n){if(!ri(t)&&!ri(e))switch(t){case"PITCH_BOX":xt(e.ovrlPitchId+Nn.idRectSuffix,i,n),xt(e.ovrlPitchId,i,n),i||xt(e.ovrlPitchId+Nn.idLineSuffix,i,n);break;case"PITCH_LINE":xt(e.ovrlPitchId+Nn.idLineSuffix,i,n);break;default:si("setPitchOverlay: unknown overlay element: "+t)}}function xt(t,i,n){if(!ri(t))if(i){var r=e.toFloat(n);e.isNumeric(r)||(r=1),e.setElementIdStyleProperty(t,{opacity:r}),e.makeVisible(t)}else e.makeInVisible(t)}function Et(){ht(Ln.topStave),ht(Ln.bottomStave)}function ht(e){ri(e)||(e.pageId=hn,e.rndPageId=null,e.filename=En,e.beatMap=null,e.timeline=null,e.isActive=!0,e.isPlaying=!1,e.currentBeat=null,b(e),he(e))}function kt(){wt(),Ct()}function At(e){if(!ri(e)){var t=e[un];Lt(t),Bt()}}function Bt(){e.makeVisible(Nn.idInstControls)}function Ct(){e.makeInVisible(Nn.idInstControls)}function Nt(){e.makeInVisible(Nn.idTranspoControls)}function Lt(t){if(!ri(t)){var i=e.csvToArr(t);if(!(ri(i)||i.length<=0)){var n=Ln.score.parts;if(!(ri(n)||n.length<=0))for(var r=0;r<n.length;r++){var o=r+1;r<i.length?Mt(i[r],o):Ot(o)}}}}function wt(){var e=Ln.score.parts;if(!(ri(e)||e.length<=0))for(var t=0;t<e.length;t++){var i=t+1;Rt(i)}}function Mt(t,n){if(!ri(t)&&!ri(n)){var r=Nn.idInstSlotTxtPrefix+n,o=Nn.idInstSlotBtnPrefix+n,a=Nn.idInstSlotPrefix+n,s=t===Ln.part.name;e.makeVisible(r),e.makeVisible(o),e.makeVisible(a),e.setElementIdAttributes(a,Nn.instSlotActiveAttrib),i.setElementIdText(r,t.trim()),e.setElementIdStyleProperty(r,Nn.instSlotTxtActiveStyle),s?e.setElementIdStyleProperty(o,Nn.instSlotBtnActiveInstStyle):e.setElementIdStyleProperty(o,Nn.instSlotBtnActiveStyle);var l=new u(n,t);e.setElementIdAttributes(o,l)}}function Ot(t){var n=Nn.idInstSlotTxtPrefix+t,r=Nn.idInstSlotBtnPrefix+t,o=Nn.idInstSlotPrefix+t;e.makeVisible(n),e.makeVisible(r),e.makeVisible(o),e.setElementIdAttributes(o,Nn.instSlotInActiveAttrib),i.setElementIdText(n,di),e.setElementIdStyleProperty(n,Nn.instSlotTxtInActiveStyle),e.setElementIdStyleProperty(r,Nn.instSlotBtnInActiveStyle);var a=new m;e.setElementIdAttributes(r,a)}function Rt(t){var i=Nn.idInstSlotTxtPrefix+t,n=Nn.idInstSlotBtnPrefix+t,r=Nn.idInstSlotPrefix+t;e.makeInVisible(i),e.makeInVisible(n),e.makeInVisible(r);var o=new m;e.setElementIdAttributes(n,o)}function Dt(e,t){if(!ri(t)&&!ri(e)){var n=Ln[e],r=t[fn];if(!ri(n)&&!ri(r)){var o=n.beatMap;if(!ri(o)){var a=o[r];if(!ri(a)){var s=a.xStart-1,l=Vt(n);i.setLineX(l,s,s),_t(l,!0)}}}}}function Vt(t){return e.getElement(t.config.startLineId)}function _t(t,i){i?e.makeElementVisible(t):e.makeElementInVisible(t)}function Ft(e,t){if(!ri(t)&&!ri(e)){var i=Ln[e],n=t[fn];Ut(i,n)}}function Ut(e,t){if(!ri(e)&&!ri(t)){var i=n.getCurrentTime();li("setStaveBeat: stave: "+e.id+" beat: "+t+" time: "+i),qt(e.timeline,t),e.currentBeat=t}}function qt(e,t){if(!ri(e)){var i=Nn.tweenIdPrefix+Nn.beatIdPrefix+t,r=e.labels;i in r?(n.beep(),e.seek(i)):li("setTimelineBeat: Invalid beat "+i)}}function Ht(e,t){if(!ri(t)&&!ri(e)){var i=Ln[e],n=t[cn],r=t[dn];zt(i,n,r)}}function zt(t,i,n){if(!(ri(t)||ri(i)||ri(n))){if(i)e.setElementIdStyleProperty(t.config.maskId,Nn.activeStaveStyle);else{e.setElementIdStyleProperty(t.config.maskId,Nn.inactiveStaveStyle);var r=Vt(t);_t(r,!1)}n&&Jt(t.timeline)}}function Yt(e){ri(e)||Gt(e.lightNo,e.colourId)}function Xt(e){ri(e)||Kt(e.lightNo,_i)}function jt(){Kt(4,_i),Kt(1,Ni)}function Gt(e,t){var i=Wt(t);Kt(e,i)}function Kt(t,n){if(!ri(t)&&!ri(n))for(var r=e.toInt(t),o=1;o<=r;o++){var a=Nn.idSemaphorePrefix+o;i.setElementIdColour(a,n)}}function Wt(e){var t;switch(e||(e=1),e){case 4:t=Ni;break;case 3:t=Li;break;case 2:t=wi;break;case 1:default:t=Ci}return t}function Qt(){$t(),Ln.isPlaying=!1,jt(),g()}function Zt(e){if(!ri(e)){var t=Ln[e];if(!ri(t)){var i=t.timeline;ri(i)||(Jt(i),Ln.isPlaying=!0)}}}function Jt(e){if(ri(e))ai("startTimeline: invalid timeline");else{var t=e.progress();t>0&&t<1?e.resume():e.play(0)}}function $t(){ei(Ln.topStave.timeline),ei(Ln.bottomStave.timeline),Ln.bottomStave.isPlaying=!1,Ln.topStave.isPlaying=!1}function ei(e){ri(e)?ai("stopTimeline: invalid timeline"):e.pause()}function ti(t){e.isObject(t)&&oi(t.sendTimeMs)&&nt(t.sendTimeMs)}function ii(t,i){e.setElementStyleProperty(t,i)}function ni(t,i){e.setElementAttributes(t,i)}function ri(t){return e.isNull(t)}function oi(t){return e.isNotNull(t)}function ai(t){e.logError(t)}function si(t){e.log(t)}function li(t){e.logDebug(t)}const ci="dev",di="",fi="_",ui="/",mi="AV",vi="FullScore",pi="Connected",Si="Loading",Ii="READY",gi="Reconnecting",bi="Error",yi="visible",Ti="hidden",Pi="none",xi="x",Ei="x1",hi="x2",ki="width",Ai="<",Bi=">",Ci="green",Ni="red",Li="orange",wi="yellow",Mi="white",Oi="black",Ri="blue",Di="grey",Vi="lightgrey",_i=Pi,Fi=_i,Ui=Mi,qi=Ci,Hi=Ni,zi=Li,Yi=Ri,Xi=Di,ji=Ci,Gi=Ni,Ki=Li,Wi=Mi,Qi=Mi,Zi=Oi,Ji=6666,$i="zsClientId",en="HELLO",tn="PART_REG",nn="PART_READY",rn="PING",on="SELECT_ISLOT",an="SELECT_SECTION",sn="part",ln="serverTime",cn="isActive",dn="isPlay",fn="beatNo",un="csvInstruments",mn="slotNo",vn="slotInstrument",pn="overlayType",Sn="overlayElement",In="overlayLineY",gn="isEnabled",bn="opacity",yn="colour",Tn="section",Pn="clientId",xn="transposition",En="img/blankStave.png",hn="p0",kn="BUILDER",An="RND";var Bn=null,Cn=null,Nn={connectionPreference:"ws,sse,poll",defaultConnectionType:t.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",pageNoToken:"@PgNo@",instToken:"@Inst@",slotNoToken:"@SlotNo@",pageIdPrefix:"p",tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",idParts:"parts",idPartsListOuterDiv:"partListOuterDiv",idSections:"sections",idSectionsListOuterDiv:"sectionListOuterDiv",idSectionBtnPrefix:"sectionBtn",idOwnedSections:"ownedSections",idInstrument:"part",idInstControls:"instControls",idTranspoControls:"transpositionListOuterDiv",idInstSlotPrefix:"instSlot",idInstSlotTxtPrefix:"instSlotTxt",idInstSlotBtnPrefix:"instSlotRect",idTempoBpm:"tmpBpm",idSemaphorePrefix:"semC",idLineSuffix:"Line",idBridgeSuffix:"Bridge",idOrdSuffix:"Ord",idMidSuffix:"Mid",idRectSuffix:"Rect",idClientIdGroup:"clientIdGroup",idClientId:"clientId",idTranspoKey:"transpoKey",idTranspoMod:"transpoMod",idTranspoInfo:"transpoInfo",blankPageUrl:"img/blankStave.png",filterOutParts:[mi,vi],connectedRectStyle:{fill:qi,stroke:ji,"stroke-width":"0px",visibility:yi,opacity:1},disconnectedRectStyle:{fill:Hi,stroke:Gi,"stroke-width":"1px",visibility:yi,opacity:1},errorRectStyle:{fill:zi,stroke:Ki,"stroke-width":"1px",visibility:yi,opacity:1},connectedTxtStyle:{fill:Wi},disconnectedTxtStyle:{fill:Qi},errorTxtStyle:{fill:Zi},activeStaveStyle:{fill:Fi,stroke:Yi,"stroke-width":"1px",visibility:yi,opacity:.5},inactiveStaveStyle:{fill:Ui,stroke:Xi,"stroke-width":"1px",visibility:yi,opacity:.4},instSlotBtnActiveStyle:{fill:Mi,stroke:Oi,"stroke-width":"1px",visibility:yi,opacity:1},instSlotBtnActiveInstStyle:{fill:"#d7f2cd",stroke:Oi,"stroke-width":"1px",visibility:yi,opacity:1},instSlotBtnInActiveStyle:{fill:Vi,stroke:Pi,visibility:yi,opacity:1},instSlotTxtActiveStyle:{fill:Oi,visibility:yi,opacity:1},instSlotTxtInActiveStyle:{fill:Oi,stroke:Pi,visibility:Ti,opacity:0},instSlotActiveAttrib:{filter:"url(#dropshadow)"},instSlotInActiveAttrib:{filter:"none"},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},transpoInfoAttrib:{"dominant-baseline":"central","font-family":"sans-serif","font-weight":"bold","font-size":"0.75em"},errorBtnAttrib:{filter:"url(#dropshadow)"},topStave:{gId:"stvTop",imgId:"stvTopImg",startLineId:"stvTopStartLine",positionLineId:"stvTopPosLine",beatBallId:"stvTopBeatBall",maskId:"stvTopMask",ovrlPosId:"ovrlTopPos",ovrlPitchId:"ovrlTopPitch",ovrlPitchStaveId:"ovrlTopPitchStave",ovrlPitchStaveInfoId:"ovrlTopPitchStaveInfo",ovrlSpeedId:"ovrlTopSpeed",ovrlPressId:"ovrlTopPres",ovrlDynId:"ovrlTopDyn",ovrlTimbreId:"ovrlTopTimb",ballYmax:84,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"80",x2:"95",y2:"281"},posBallConf:{cx:"95",cy:"110",r:"4"}},bottomStave:{gId:"stvBot",imgId:"stvBotImg",startLineId:"stvBotStartLine",positionLineId:"stvBotPosLine",beatBallId:"stvBotBeatBall",maskId:"stvBotMask",ovrlPosId:"ovrlBotPos",ovrlPitchId:"ovrlBotPitch",ovrlPitchStaveId:"ovrlBotPitchStave",ovrlPitchStaveInfoId:"ovrlBotPitchStaveInfo",ovrlSpeedId:"ovrlBotSpeed",ovrlPressId:"ovrlBotPres",ovrlDynId:"ovrlBotDyn",ovrlTimbreId:"ovrlBotTimb",ballYmax:305,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"301",x2:"95",y2:"502"},posBallConf:{cx:"95",cy:"331",r:"4"}},metro:{idMetronomeRect:"metroRect",idMetronome:"metro",idMetroSlider:"metroFreqSlider",idMetroFreqRect:"metroFreq",idMetroFreqLine:"metroFreqLine",ifSymbolMetroOff:"#metronome",ifSymbolMetroOn:"#metronomeOn",ifMetroFreqSlider:"#metroFreq",minFreq:220,maxFreq:2200}},Ln={clientId:null,isPlaying:!1,isReady:!1,score:{title:"ZScore",noSpaceTitle:"ZScore",htmlFile:null,instrument:"Part View",parts:["Part View"],firstPageNo:1,lastPageNo:2,sections:[],ownedSections:[],mySections:[],assignmentType:null},part:{name:"Part View",imgDir:null,imgPageNameToken:null,imgContPageName:null,blankPageNo:0,contPageNo:Ji,currentSection:null,transpo:"C",pageRanges:[{start:1,end:1}],pages:{}},topStave:{id:"topStave",config:Nn.topStave,pageId:hn,rndPageId:null,filename:En,beatMap:null,timeline:null,isActive:!0,isPlaying:!1,currentBeat:null,transpos:[]},bottomStave:{id:"bottomStave",config:Nn.bottomStave,pageId:hn,rndPageId:null,filename:En,beatMap:null,timeline:null,isActive:!1,isPlaying:!1,currentBeat:null,transpos:[]},startTimeTl:0,currentBeatId:"b0",currentBeatNo:0,tempo:0,tempoModifier:1,scoreDir:"/score/",currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,isConnected:!1,isInitialised:!1,connectionType:null,pageNoToLoad:0,metro:{isMetroOn:!1,slider:{xMax:60,xMin:40,xMid:50,range:20}},isClientIdVisible:!1,traspo:"C",counter:0};return c.prototype.loadImg=function(e){this.img.src=e,this.img.onload=function(){si("pageImgOnLoad: id: "+this.pageId),Be(this.pageId)}},{onStateBtn:function(){y()},onPartSelect:function(e){T(e)},onSectionSelect:function(e){P(e)},onInstrumentSelect:function(e,t){k(e,t)},onClientIdSelect:function(){B()},onTranspoSelect:function(e){C(e)}}}(zsUtil,zsNet,zsSvg,zsWsAudio,zsMusic,window,document);