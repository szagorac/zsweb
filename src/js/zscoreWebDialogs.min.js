var zscore=function(e,t,i,n,r,o,a){"use strict";function s(e){this.message=e,this.name="ZScoreException"}function l(e,t,i,n,r,o,a,s){this.xStart=e,this.xEnd=t,this.yStart=i,this.yEnd=n,this.beatStartNum=r,this.beatStartDenom=o,this.beatEndNum=a,this.beatEndDenom=s}function c(e,t,i,n){this.id=e,this.no=t,this.imgFileName=i,this.imgFileUrl=n,this.isLoaded=!1,this.img=new Image,this.img.pageId=e}function f(e,t){this.id=Pn.idSectionBtnPrefix+t,this.no=e,this.class="sectionListButton",this.onclick="onSectionSelect('"+t+"')"}function d(){this.class="sectionListButtonDisabled",this.onclick=""}function u(e,t){this.onclick="onInstrumentSelect("+e+",'"+t+"')"}function m(){this.onclick=""}function v(){}function S(){if(!xn.isInitialised){if(!(e&&t&&i&&n&&r))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");e.setRunMode(ti),$t("init: "),p(),bn=e.isTouchDevice(),yn=e.isSafari(navigator),$t("init: IsTouch Device: "+bn+" isSafari: "+yn),xn.fontCanvas=a.createElement("canvas"),xn.canvasCtx=xn.fontCanvas.getContext("2d"),e.listen("resize",o,F),e.listen("orientationchange",o,F),N(),_(),M(),B(),xn.isInitialised=!0}}function p(){var t=e.getLocalParam(Xi);Zt(t)&&(t=e.generateRandomId(),e.storeLocalParam(Xi,t)),xn.clientId=t,$t("clientId: "+xn.clientId)}function g(){xn.part.pages={}}function I(){b(xn.topStave),b(xn.bottomStave)}function b(t){if(!Zt(t)&&!Zt(t.config)){var i=t.config;e.setElementIdAttributes(i.positionLineId,i.posLineConf),e.setElementIdAttributes(i.beatBallId,i.posBallConf)}}function y(){xn.isInitialised?($t("onStateBtnClick: zscore initialised"),t.isConnected()||($t("onStateBtnClick: zscore not connected, reconnecting..."),G())):($t("onStateBtnClick: initialising"),S())}function P(t){e.arrContains(xn.score.parts,t)?(xn.part.name=t,We(t),e.makeInVisible(Pn.idPartsListOuterDiv)):$t("onPartSelection: unexpected part: "+t)}function x(t){e.arrContains(xn.score.sections,t)?(E(t),Ke(t)):$t("onSectionSelection: unexpected section: "+t)}function E(t){var i=Pn.idSectionBtnPrefix+t,n=e.getElement(i);Zt(n)||T(n)}function T(t){Zt(t)||e.setElementAttributes(t,new d)}function k(){var t=e.getElement(Pn.idOwnedSections);if(!Zt(t)){for(var i=xn.score.mySections,n="",r="",o=0;o<i.length;o++)n=n+r+i[o],r="; ";e.setText(t,n)}}function h(e,t){Zt(e)||Zt(t)||Zt(xn.part.name)||(Je(e,t,xn.part.name),bt())}function L(){D()}function N(){t.init(Pn.connectionPreference,Pn.appUrlSse,Pn.appUrlWebsockets,Pn.appUrlHttp,W,V)}function B(){var t=e.getElement(Pn.metro.idMetronomeRect);Zt(t)||(e.listen("click",t,w),O())}function O(){var t=e.getElement(Pn.metro.idMetroFreqLine),i=e.getElement(Pn.metro.idMetroFreqRect);if(Jt(t)&&Jt(i)){var n=e.toInt(t.getAttribute(gi)),r=e.toInt(i.getAttribute(Ii)),o=Math.round(r/2),a=n-o;xn.metro.slider.xMax=a;var s=e.toInt(t.getAttribute(pi)),l=s+o;xn.metro.slider.xMin=l;var c=a-l;xn.metro.slider.range=c;var f=Math.round((a+l)/2);xn.metro.slider.xMid=f}Draggable.create(Pn.metro.ifMetroFreqSlider,{type:Si,bounds:document.getElementById(Pn.metro.idMetroFreqLine),onDrag:A})}function A(t){var i=gsap.getProperty(Pn.metro.ifMetroFreqSlider,Si),r=xn.metro.slider.xMid+i,o=r-xn.metro.slider.xMin,a=Math.round(100*o/xn.metro.slider.range),s=e.mapRange(a,0,100,Pn.metro.minFreq,Pn.metro.maxFreq);s<200&&(s=200),n.setBeepFreqenecy(s),$t("onFreqSliderMove: freq: "+s)}function w(e){xn.metro.isMetroOn?R():C()}function R(){n.switchMetro(!1),i.setElementIdHref(Pn.metro.idMetronome,Pn.metro.ifSymbolMetroOff),e.makeInVisible(Pn.metro.idMetroSlider),xn.metro.isMetroOn=!1}function C(){n.switchMetro(!0),i.setElementIdHref(Pn.metro.idMetronome,Pn.metro.ifSymbolMetroOn),e.makeVisible(Pn.metro.idMetroSlider),xn.metro.isMetroOn=!0}function M(){Zt(n)?Kt("initAudio: invalid zsAudio lib"):n.init()}function D(){Zt(n)?Kt("resetAudio: invalid zsAudio lib"):n.reset()}function _(){i.init()}function F(t){if(!e.isObject(this))return null}function V(e,i){switch(e){case t.OPEN:U(i);break;case t.CLOSED:q(i);break;case t.ERROR:z(i);break;default:Kt("Unknown Connection Event State: "+e+" for type: "+i)}}function U(e){$t(e+" connection opened."),Y(e)}function q(e){$t(e+" connection closed."),H(e)}function z(e){$t(e+" connection error."),X(e)}function Y(e){xn.isConnected=!0,xn.connectionType=e,xn.reconnectAttmpts=0,j(Pn.connectedRectStyle,Pn.connectedBtnAttrib,Pn.connectedTxtStyle,si),Ge()}function H(e){xn.isConnected=!1,j(Pn.disconnectedRectStyle,Pn.disconnectedBtnAttrib,Pn.disconnectedTxtStyle,fi),G(e)}function X(e){xn.isConnected=!1,j(Pn.errorRectStyle,Pn.errorBtnAttrib,Pn.errorTxtStyle,di),G(e)}function j(t,i,n,r){var o=e.getElement(Pn.idServerStatusRect);Zt(o)||Wt(o,t);var a=e.getElement(Pn.idServerStatusBtn);Zt(a)||Qt(a,i);var s=e.getElement(Pn.idServerStatusTxt);Zt(s)||(Wt(s,n),s.textContent=r)}function G(e){t.reconnect(e,!0)}function W(e,t){xn.isConnected||Y(),Zt(e)||(t||L(),Jt(e.scoreInfo)&&Q(e.scoreInfo),Jt(e.strategyInfo)&&Z(e.strategyInfo),Jt(e.partInfo)&&Te(e.partInfo),Jt(e.pageInfo)&&pe(e.pageInfo),Jt(e.mapInfo)&&ie(e.mapInfo),Jt(e.bpm)&&0!=e.bpm&&te(e.bpm),Jt(e.actions)&&et(e.actions))}function Q(t){if(e.isObject(t)){if(Jt(t.partHtmlPage)){var i=K(t.partHtmlPage),n=e.getPageName();i&&t.partHtmlPage!==n&&e.loadPage(t.partHtmlPage)}if(Jt(t.title)){var r=J(t.title);r&&g()}Jt(t.instruments)&&Xe(t.instruments),Jt(t.bpm)&&ee(t.bpm),Jt(t.scoreDir)&&$(t.scoreDir)}}function Z(e){Jt(e.strategies)&&Fe(e.strategies)}function J(t){return xn.score.title!==t&&(xn.score.title=t,xn.score.noSpaceTitle=e.replaceEmptySpaces(t,ni),i.setElementText(Pn.idTitle,t),!0)}function K(e){var t=xn.score.htmlFile;return Zt(t)?(xn.score.htmlFile=e,!1):t!==e&&(xn.score.htmlFile=e,!0)}function $(e){xn.scoreDir!==e&&(xn.scoreDir=e)}function ee(e){xn.tempo!==e&&(xn.tempo=e,i.setElementText(Pn.idTempoBpm,e))}function te(t){var i=e.toInt(t);if(!Zt(i)){var n=xn.tempo,r=i/n;xn.tempoModifier=r,ee(i),xn.isPlaying?re(r):ae()}}function ie(t){if(!Zt(t.map)&&!Zt(t.pageId)){t.pageId;var i=t.staveId,n=t.map,r=xn[i];if(!Zt(r)){var o=r.config.xLeftMargin,a=JSON.parse(JSON.stringify(n));if(e.isArray(a)){for(var s={},l=0;l<a.length;l++)ne(s,a[l],o);r.beatMap=s,se(i)}}}}function ne(e,t,i){if(!(Zt(e)||Zt(t)||Zt(t.beatStartNum))){var n=t.beatStartNum,r=t.xStart+i,o=t.xEnd+i,a=new l(r,o,t.yStart,t.yEnd,n,t.beatStartDenom,t.beatEndNum,t.beatEndDenom);e[n]=a}}function re(e){oe(xn.topStave.timeline,e),oe(xn.bottomStave.timeline,e)}function oe(e,t){if(!Zt(e)){var i=e.timeScale(),n=i*t;e.timeScale(n)}}function ae(){le(xn.topStave),le(xn.bottomStave)}function se(e){Zt(e)||le(xn[e])}function le(e){if(!Zt(e)){var t=gsap.timeline({onComplete:ue,onCompleteParams:[e.id],paused:!0}),i=e.beatMap;if(!Zt(i)){var n=e.config.positionLineId,o=e.config.beatBallId,a=e.config.ballYmax,s=!0;for(var l in i){var c=i[l],f=xn.tempo,d=r.getBeatDurationSec(f),u=c.beatStartNum;if(s){var m=Pn.beatIdPrefix+(u-1),v=c.xStart,S=ce(n,0,v,m,0);t.add(S,bi);var p=fe(o,0,v,m);t.add(p,yi),s=!1}v=c.xEnd,m=Pn.beatIdPrefix+u;var g=Pn.tweenIdPrefix+m,I=ce(n,d,v,m,u),b=fe(o,d,v,m),y=de(o,d/2,a,m);g=I.vars.id;t.addLabel(g,yi),t.add(I,yi),t.add(b,bi),t.add(y,g)}Jt(e.currentBeat)&&Rt(t,e.currentBeat),e.timeline=t}}}function ce(t,i,n,r,o){var a=Pn.tweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:a,duration:i,attr:{x1:n,x2:n},ease:"none",onStart:me,onStartParams:[r,o],onComplete:ve,onCompleteParams:[r,o]})}function fe(t,i,n,r){var o=Pn.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cx:n},ease:"none"})}function de(t,i,n,r){var o=Pn.ballTweenIdPrefix+r;return gsap.to(e.toCssIdQuery(t),{id:o,duration:i,attr:{cy:n,r:2},ease:"power1.out",autoAlpha:.5,repeat:1,yoyo:!0})}function ue(e){ei("onTimelineComplete stave: "+e);var t=xn[e];Jt(t)&&(t.isRunning=!1),Jt(t.timeline)&&t.timeline.pause(0)}function me(e,t){var i=n.getCurrentTime();xn.audioTlBeatTime=i,ei("onBeatStart: beat: "+e+" beatNo: "+t+" beatTime: "+i),Se(t,e)}function ve(e,t){var i=n.getCurrentTime(),r=i-xn.startTimeTl;ei("onBeatEnd: beat: "+e+" beatNo: "+t+" elapsedTime: "+r)}function Se(t,i){e.isNumeric(t)&&(e.isNull(i)&&(i=Pn.beatIdPrefix+t),xn.currentBeatId=i,xn.currentBeatNo=t)}function pe(e){if(!Zt(e.staveId)){var t=e.staveId,i=xn[t];Zt(i)?Kt("processPageinfo: Invalid stave for id: {}",t):(Jt(e.filename)&&(i.filename=e.filename),Jt(e.pageId)&&(i.pageId=e.pageId),Jt(e.rndPageId)?i.rndPageId=e.rndPageId:i.rndPageId=null,ge(i))}}function ge(t){if(!Zt(t)){var i=t.config;if(!Zt(i)){var n=null,r=t.pageId;Jt(t.rndPageId)&&(r=t.rndPageId);var o=ye(r);n=Zt(o)?be(t.fileName):o.src;var a=e.getElement(i.imgId);a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),a.setAttribute("href",n)}}}function Ie(t){if(!Zt(t)){var i=t.config;if(!Zt(i)){var n=t.fileName,r=e.getElement(i.imgId);r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",n),r.setAttribute("href",n)}}}function be(e){return xn.scoreDir+xn.score.noSpaceTitle+ri+e}function ye(e){var t=xn.part.pages[e];return Zt(t)?null:t.img}function Pe(e){var t=xn.part.pages[e];Jt(t)&&(t.isLoaded=!0),xn.pageNoToLoad--,0===xn.pageNoToLoad&&Ee(),xe(xn.pageNoToLoad)}function xe(e){if(e>0){var t=li+" "+e;j(Pn.errorRectStyle,Pn.errorBtnAttrib,Pn.errorTxtStyle,t)}else j(Pn.connectedRectStyle,Pn.connectedBtnAttrib,Pn.connectedTxtStyle,ci)}function Ee(){$t("onPageLoadComplete: ");var e=xn.part.pages,t=!0;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];n.isLoaded||($t("onPageLoadComplete: page: "+i+" is not loaded, retying load"),Oe(n.no),t=!1)}t&&($t("All Pages loaded: "),xn.isReady=!0,Qe())}function Te(t){if(Jt(t.name)&&(xn.part.name=t.name),Jt(t.pageRanges)){var i=t.pageRanges;if(e.isArray(i))for(var n=0;n<i.length;n++)_e(i[n]);else _e(i)}Jt(t.imgDir)&&(xn.part.imgDir=t.imgDir),Jt(t.imgPageNameToken)&&(xn.part.imgPageNameToken=t.imgPageNameToken),Jt(t.imgContPageName)&&(xn.part.imgContPageName=t.imgContPageName),Jt(t.contPageNo)&&(xn.part.contPageNo=t.contPageNo),Jt(t.currentSection)&&(xn.part.currentSection=t.currentSection),he(),ke()}function ke(){var t=xn.part.name,n=xn.part.currentSection,r="";Jt(n)&&(r+=e.capitalizeFirstLetter(n)+" - "),r+=t,i.setElementText(Pn.idInstrument,r)}function he(){var t=xn.part,i=t.pageRanges;if(e.isArray(i)){xn.part.pages=[];for(var n=0;n<i.length;n++)Be(i[n]);Le(),Ne()}}function Le(){var e=Ce();xn.pageNoToLoad++,Ae(e)}function Ne(){var e=Re();xn.pageNoToLoad++,Ae(e)}function Be(t){if(e.isObject(t)){var i=1,n=1;Jt(t.start)&&(i=e.toInt(t.start)),Jt(t.end)&&(n=e.toInt(t.end));var r=xn.pageNoToLoad+(n-i+1);xn.pageNoToLoad=r;for(var o=i;o<=n;o++)Oe(o)}}function Oe(e){var t=we(e);Ae(t)}function Ae(e){if(!Zt(e)){var t=e.imgFileUrl;Zt(t)||e.loadImg(t,e.id)}}function we(t){var i=De(t),n=xn.part.pages[i];if(Jt(n))return n;var r=xn.part.imgPageNameToken;r=Zt(r)?Me(t):e.replace(r,Pn.pageNoToken,""+t);var o=xn.part.imgDir+r;n=new c(i,t,r,o);return xn.part.pages[i]=n,n}function Re(){var e=xn.part.contPageNo,t=De(e),i=xn.part.pages[t];if(Jt(i))return i;var n=xn.part.imgContPageName,r=xn.part.imgDir+n;i=new c(t,e,n,r);return xn.part.pages[t]=i,i}function Ce(){var e=xn.part.blankPageNo,t=De(e),i=xn.part.pages[t];if(Jt(i))return i;var n=Pn.blankPageUrl,r=Pn.blankPageUrl;i=new c(t,e,n,r);return xn.part.pages[t]=i,i}function Me(e){return xn.score.noSpaceTitle+ni+instrumentName+"_page"+e+".png"}function De(e){return Pn.pageIdPrefix+e}function _e(e){if(!(Zt(e)||Zt(e.start)||Zt(e.end))){var t=e.start,i=e.end,n={start:t,end:i};xn.part.pageRanges=[],xn.part.pageRanges.push(n)}}function Fe(t){if(!Zt(t))if(e.isArray(t))for(var i=0;i<t.length;i++)Ve(t[i]);else Ve(t)}function Ve(t){if(e.isObject(t))if(Zt(t.name))Kt("processStrategies: invalid strategy name");else{var i=t.name;switch(i){case gn:Ue(t);break;case In:He(t);break;default:Kt("processStrategies: Unknown strategy: "+i)}}}function Ue(t){var i=!1;if(Jt(t.isReady)&&(i=e.toBoolean(t.isReady)),Jt(t.sections))if(xn.score.sections.length>0&&(xn.score.sections=[]),e.isArray(t.sections))for(var n=0;n<t.sections.length;n++)qe(t.sections[n]);else qe(t.sections);if(Jt(t.assignmentType)&&(xn.score.assignmentType=t.assignmentType),xn.score.ownedSections=[],xn.score.mySections=[],Jt(t.sectionOwners))for(var r in t.sectionOwners){var o=t.sectionOwners[r];xn.score.ownedSections.push(r),xn.clientId===o&&xn.score.mySections.push(r)}i?Ye():ze()}function qe(e){Zt(e)||xn.score.sections.push(e)}function ze(){var t=xn.score.sections;if(!(t.length<1)){var i=e.getElement(Pn.idSections);if(!Zt(i)){for(var n=0;n<t.length;n++){var r=t[n],o=Pn.idSectionBtnPrefix+r,a=e.getElement(o);if(Zt(a)){var s=new f(n+1,r);a=e.createButton(s),e.setText(a,r),e.addChildToParent(i,a)}e.arrContains(xn.score.ownedSections,r)&&T(a)}k(),e.makeVisible(Pn.idSectionsListOuterDiv)}}}function Ye(){var t=e.getElement(Pn.idSections);Zt(t)||(e.removeElementChildren(t),e.makeInVisible(Pn.idSectionsListOuterDiv))}function He(e){}function Xe(t){var i=[];if(e.isArray(t))for(var n=0;n<t.length;n++){var r=t[n];e.arrContains(Pn.filterOutParts,r)||i.push(r)}else e.arrContains(Pn.filterOutParts,r)||i.push(t);e.arrEquals(xn.score.parts,i)||(xn.score.parts=i),je(i)&&We(xn.part.name)}function je(t){if(Zt(xn.part.name)||!e.isArray(t))return!1;for(var i=xn.part.name,n=0;n<t.length;n++)if(i===t[n])return!0;return!1}function Ge(){var e=$e();t.sendEvent(ji,e)}function We(e){var i=$e();i[Ki]=e,t.sendEvent(Gi,i)}function Qe(){var e=$e();e[Ki]=xn.part.name,t.sendEvent(Wi,e)}function Ze(e){var i=$e();i[$i]=e,t.sendEvent(Qi,i)}function Je(e,i,n){var r=$e();r[on]=e,r[an]=i,r[Ki]=n,t.sendEvent(Zi,r)}function Ke(e){var i=$e();i[mn]=e,t.sendEvent(Ji,i)}function $e(){var e=new v;return e[vn]=xn.clientId,e}function et(t){var i=null,n=[],r={};if(e.isArray(t))for(var o=0;o<t.length;o++){var a=t[o];Jt(a.type)&&(i=a.type),Jt(a.targets)&&(n=a.targets),Jt(a.params)&&(r=a.params),tt(i,n,r)}}function tt(t,i,n){if(e.logDebug("doAction: "+t),!Zt(t))switch(t){case"PING":Gt(n);break;case"START":it(Yt,i,null);break;case"STOP":zt();break;case"SEMAPHORE_ON":Dt(n);break;case"SEMAPHORE_OFF":_t(n);break;case"ACTIVATE":it(Ct,i,n);break;case"BEAT":it(At,i,n);break;case"START_MARK":it(Nt,i,n);break;case"INSTRUMENT_SLOTS":yt(n);break;case"RESET_INSTRUMENT_SLOTS":bt();break;case"RESET_STAVES":gt();break;case"OVERLAY_ELEMENT":it(ct,i,n);break;case"OVERLAY_LINE":it(at,i,n);break;case"OVERLAY_COLOUR":it(nt,i,n);break;default:Kt("doAction: Unknown actionType: "+t)}}function it(t,i,n){if(!Zt(t))if(e.isArray(i))for(var r=0;r<i.length;r++)t(i[r],n);else t(target,n)}function nt(e,t){if(!Zt(t)&&!Zt(e)){var i=xn[e],n=t[sn],r=t[un];rt(i,n,r)}}function rt(e,t,i){if(!(Zt(e)||Zt(t)||Zt(i)))switch(t){case"POSITION":ot(e.config.ovrlPosId+Pn.idRectSuffix,i);break;case"PITCH":ot(e.config.ovrlPitchId+Pn.idRectSuffix,i);break;case"SPEED":ot(e.config.ovrlSpeedId+Pn.idRectSuffix,i);break;case"PRESSURE":ot(e.config.ovrlPressId+Pn.idRectSuffix,i);break;case"DYNAMICS":ot(e.config.ovrlDynId+Pn.idRectSuffix,i);break;default:$t("setOverlayColour: unknown overlay type: "+t)}}function ot(t,i){e.setElementIdStyleProperty(t,{fill:i})}function at(e,t){if(!Zt(t)&&!Zt(e)){var i=xn[e],n=t[sn],r=t[cn];st(i,n,r)}}function st(e,t,i){if(!(Zt(e)||Zt(t)||Zt(i)))switch(t){case"POSITION":lt(e.config.ovrlPosId+Pn.idLineSuffix,i);break;case"PITCH":lt(e.config.ovrlPitchId+Pn.idLineSuffix,i);break;case"SPEED":lt(e.config.ovrlSpeedId+Pn.idLineSuffix,i);break;case"PRESSURE":lt(e.config.ovrlPressId+Pn.idLineSuffix,i);break;case"DYNAMICS":lt(e.config.ovrlDynId+Pn.idLineSuffix,i);break;default:$t("setOverlayElement: unknown overlay type: "+t)}}function lt(t,n){var r=e.getElement(t);i.setLineY(r,n,n)}function ct(e,t){if(!Zt(t)&&!Zt(e)){var i=xn[e],n=t[sn],r=t[ln],o=t[fn],a=t[dn];ft(i,n,r,o,a)}}function ft(e,t,i,n,r){if(!Zt(e)&&!Zt(t)){var o=e.config;if(!Zt(o))switch(ei("setOverlayElement: overlayType: "+t),t){case"POSITION":St(o,i,n,r);break;case"PITCH":vt(o,i,n,r);break;case"SPEED":mt(o,i,n,r);break;case"PRESSURE":ut(o,i,n,r);break;case"DYNAMICS":dt(o,i,n,r);break;default:$t("setOverlayElement: unknown overlay type: "+t)}}}function dt(e,t,i,n){if(!Zt(t)&&!Zt(e))switch(t){case"DYNAMICS_BOX":pt(e.ovrlDynId+Pn.idRectSuffix,i,n),pt(e.ovrlDynId+Pn.idOrdSuffix+Pn.idLineSuffix,i,n),pt(e.ovrlDynId,i,n),i||pt(e.ovrlDynId+Pn.idLineSuffix,i,n);break;case"DYNAMICS_MID_LINE":pt(e.ovrlDynId+Pn.idOrdSuffix+Pn.idLineSuffix,i,n);break;case"DYNAMICS_LINE":pt(e.ovrlDynId+Pn.idLineSuffix,i,n);break;default:$t("setOverlayElement: unknown overlay type: "+t)}}function ut(e,t,i,n){if(!Zt(t)&&!Zt(e))switch(t){case"PRESSURE_BOX":pt(e.ovrlPressId+Pn.idRectSuffix,i,n),pt(e.ovrlPressId+Pn.idOrdSuffix+Pn.idLineSuffix,i,n),pt(e.ovrlPressId,i,n),i||pt(e.ovrlPressId+Pn.idLineSuffix,i,n);break;case"PRESSURE_MID_LINE":pt(e.ovrlPressId+Pn.idOrdSuffix+Pn.idLineSuffix,i,n);break;case"PRESSURE_LINE":pt(e.ovrlPressId+Pn.idLineSuffix,i,n);break;default:$t("setOverlayElement: unknown overlay type: "+t)}}function mt(e,t,i,n){if(!Zt(t)&&!Zt(e))switch(t){case"SPEED_BOX":pt(e.ovrlSpeedId+Pn.idRectSuffix,i,n),pt(e.ovrlSpeedId+Pn.idOrdSuffix+Pn.idLineSuffix,i,n),pt(e.ovrlSpeedId,i,n),i||pt(e.ovrlSpeedId+Pn.idLineSuffix,i,n);break;case"SPEED_MID_LINE":pt(e.ovrlSpeedId+Pn.idOrdSuffix+Pn.idLineSuffix,i,n);break;case"SPEED_LINE":pt(e.ovrlSpeedId+Pn.idLineSuffix,i,n);break;default:$t("setOverlayElement: unknown overlay type: "+t)}}function vt(e,t,i,n){if(!Zt(t)&&!Zt(e))switch(t){case"PITCH_BOX":pt(e.ovrlPitchId+Pn.idRectSuffix,i,n),pt(e.ovrlPitchId,i,n),i||pt(e.ovrlPitchId+Pn.idLineSuffix,i,n);break;case"PITCH_LINE":pt(e.ovrlPitchId+Pn.idLineSuffix,i,n);break;default:$t("setOverlayElement: unknown overlay type: "+t)}}function St(e,t,i,n){if(!Zt(t)&&!Zt(e))switch(t){case"POSITION_BOX":pt(e.ovrlPosId+Pn.idRectSuffix,i,n),pt(e.ovrlPosId+Pn.idOrdSuffix+Pn.idLineSuffix,i,n),pt(e.ovrlPosId+Pn.idBridgeSuffix+Pn.idLineSuffix,i,n),pt(e.ovrlPosId,i,n),i||pt(e.ovrlPosId+Pn.idLineSuffix,i,n);break;case"POSITION_LINE":pt(e.ovrlPosId+Pn.idLineSuffix,i,n);break;case"POSITION_BRIDGE_LINE":pt(e.ovrlPosId+Pn.idBridgeSuffix+Pn.idLineSuffix,i,n);break;case"POSITION_ORD_LINE":pt(e.ovrlPosId+Pn.idOrdSuffix+Pn.idLineSuffix,i,n);break;default:$t("setOverlayElement: unknown overlay type: "+t)}}function pt(t,i,n){if(!Zt(t))if(i){var r=e.toFloat(n);e.isNumeric(r)||(r=1),e.setElementIdStyleProperty(t,{opacity:r}),e.makeVisible(t)}else e.makeInVisible(t)}function gt(){It(xn.topStave),It(xn.bottomStave)}function It(e){Zt(e)||(e.pageId=pn,e.rndPageId=null,e.filename=Sn,e.beatMap=null,e.timeline=null,e.isActive=!0,e.isPlaying=!1,e.currentBeat=null,b(e),Ie(e))}function bt(){Tt(),xt()}function yt(e){if(!Zt(e)){var t=e[rn];Et(t),Pt()}}function Pt(){e.makeVisible(Pn.idInstControls)}function xt(){e.makeInVisible(Pn.idInstControls)}function Et(t){if(!Zt(t)){var i=e.csvToArr(t);if(!(Zt(i)||i.length<=0)){var n=xn.score.parts;if(!(Zt(n)||n.length<=0))for(var r=0;r<n.length;r++){var o=r+1;r<i.length?kt(i[r],o):ht(o)}}}}function Tt(){var e=xn.score.parts;if(!(Zt(e)||e.length<=0))for(var t=0;t<e.length;t++){var i=t+1;Lt(i)}}function kt(t,n){if(!Zt(t)&&!Zt(n)){var r=Pn.idInstSlotTxtPrefix+n,o=Pn.idInstSlotBtnPrefix+n,a=Pn.idInstSlotPrefix+n,s=t===xn.part.name;e.makeVisible(r),e.makeVisible(o),e.makeVisible(a),e.setElementIdAttributes(a,Pn.instSlotActiveAttrib),i.setElementText(r,t.trim()),e.setElementIdStyleProperty(r,Pn.instSlotTxtActiveStyle),s?e.setElementIdStyleProperty(o,Pn.instSlotBtnActiveInstStyle):e.setElementIdStyleProperty(o,Pn.instSlotBtnActiveStyle);var l=new u(n,t);e.setElementIdAttributes(o,l)}}function ht(t){var n=Pn.idInstSlotTxtPrefix+t,r=Pn.idInstSlotBtnPrefix+t,o=Pn.idInstSlotPrefix+t;e.makeVisible(n),e.makeVisible(r),e.makeVisible(o),e.setElementIdAttributes(o,Pn.instSlotInActiveAttrib),i.setElementText(n,ii),e.setElementIdStyleProperty(n,Pn.instSlotTxtInActiveStyle),e.setElementIdStyleProperty(r,Pn.instSlotBtnInActiveStyle);var a=new m;e.setElementIdAttributes(r,a)}function Lt(t){var i=Pn.idInstSlotTxtPrefix+t,n=Pn.idInstSlotBtnPrefix+t,r=Pn.idInstSlotPrefix+t;e.makeInVisible(i),e.makeInVisible(n),e.makeInVisible(r);var o=new m;e.setElementIdAttributes(n,o)}function Nt(e,t){if(!Zt(t)&&!Zt(e)){var n=xn[e],r=t[nn];if(!Zt(n)&&!Zt(r)){var o=n.beatMap;if(!Zt(o)){var a=o[r];if(!Zt(a)){var s=a.xStart-1,l=Bt(n);i.setLineX(l,s,s),Ot(l,!0)}}}}}function Bt(t){return e.getElement(t.config.startLineId)}function Ot(t,i){i?e.makeElementVisible(t):e.makeElementInVisible(t)}function At(e,t){if(!Zt(t)&&!Zt(e)){var i=xn[e],n=t[nn];wt(i,n)}}function wt(e,t){if(!Zt(e)&&!Zt(t)){var i=n.getCurrentTime();ei("setStaveBeat: stave: "+e.id+" beat: "+t+" time: "+i),Rt(e.timeline,t),e.currentBeat=t}}function Rt(e,t){if(!Zt(e)){var i=Pn.tweenIdPrefix+Pn.beatIdPrefix+t,r=e.labels;i in r?(n.beep(),e.seek(i)):ei("setTimelineBeat: Invalid beat "+i)}}function Ct(e,t){if(!Zt(t)&&!Zt(e)){var i=xn[e],n=t[en],r=t[tn];Mt(i,n,r)}}function Mt(t,i,n){if(!(Zt(t)||Zt(i)||Zt(n))){if(i)e.setElementIdStyleProperty(t.config.maskId,Pn.activeStaveStyle);else{e.setElementIdStyleProperty(t.config.maskId,Pn.inactiveStaveStyle);var r=Bt(t);Ot(r,!1)}n&&Ht(t.timeline)}}function Dt(e){Zt(e)||Vt(e.lightNo,e.colourId)}function _t(e){Zt(e)||Ut(e.lightNo,Oi)}function Ft(){Ut(4,Oi),Ut(1,xi)}function Vt(e,t){var i=qt(t);Ut(e,i)}function Ut(t,n){if(!Zt(t)&&!Zt(n))for(var r=e.toInt(t),o=1;o<=r;o++){var a=Pn.idSemaphorePrefix+o;i.setElementColour(a,n)}}function qt(e){var t;switch(e||(e=1),e){case 4:t=xi;break;case 3:t=Ei;break;case 2:t=Ti;break;case 1:default:t=Pi}return t}function zt(){Xt(),xn.isPlaying=!1,Ft(),I()}function Yt(e){if(!Zt(e)){var t=xn[e];if(!Zt(t)){var i=t.timeline;Zt(i)||(Ht(i),xn.isPlaying=!0)}}}function Ht(e){if(Zt(e))Kt("startTimeline: invalid timeline");else{var t=e.progress();t>0&&t<1?e.resume():e.play(0)}}function Xt(){jt(xn.topStave.timeline),jt(xn.bottomStave.timeline),xn.bottomStave.isPlaying=!1,xn.topStave.isPlaying=!1}function jt(e){Zt(e)?Kt("stopTimeline: invalid timeline"):e.pause()}function Gt(t){e.isObject(t)&&Jt(t.sendTimeMs)&&Ze(t.sendTimeMs)}function Wt(t,i){e.setElementStyleProperty(t,i)}function Qt(t,i){e.setElementAttributes(t,i)}function Zt(t){return e.isNull(t)}function Jt(t){return e.isNotNull(t)}function Kt(t){e.logError(t)}function $t(t){e.log(t)}function ei(t){e.logDebug(t)}const ti="dev",ii="",ni="_",ri="/",oi="AV",ai="FullScore",si="Connected",li="Loading",ci="READY",fi="Reconnecting",di="Error",ui="visible",mi="hidden",vi="none",Si="x",pi="x1",gi="x2",Ii="width",bi="<",yi=">",Pi="green",xi="red",Ei="orange",Ti="yellow",ki="white",hi="black",Li="blue",Ni="grey",Bi="lightgrey",Oi=vi,Ai=Oi,wi=ki,Ri=Pi,Ci=xi,Mi=Ei,Di=Li,_i=Ni,Fi=Pi,Vi=xi,Ui=Ei,qi=ki,zi=ki,Yi=hi,Hi=6666,Xi="zsClientId",ji="HELLO",Gi="PART_REG",Wi="PART_READY",Qi="PING",Zi="SELECT_ISLOT",Ji="SELECT_SECTION",Ki="part",$i="serverTime",en="isActive",tn="isPlay",nn="beatNo",rn="csvInstruments",on="slotNo",an="slotInstrument",sn="overlayType",ln="overlayElement",cn="overlayLineY",fn="isEnabled",dn="opacity",un="colour",mn="section",vn="clientId",Sn="img/blankStave.png",pn="p0",gn="BUILDER",In="RND";var bn=null,yn=null,Pn={connectionPreference:"ws,sse,poll",defaultConnectionType:t.WEBSOCKET,appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",pageNoToken:"@PgNo@",instToken:"@Inst@",slotNoToken:"@SlotNo@",pageIdPrefix:"p",tsBaseBeatDenom:8,tsY:0,beatIdPrefix:"b",tweenIdPrefix:"tw",beatTweenIdPrefix:"btw",ballTweenIdPrefix:"bltw",idTitle:"title",idServerStatusRect:"srvrStatusRect",idServerStatusTxt:"srvrStatusTxt",idServerStatusBtn:"srvrStatBtn",idParts:"parts",idPartsListOuterDiv:"partListOuterDiv",idSections:"sections",idSectionsListOuterDiv:"sectionListOuterDiv",idSectionBtnPrefix:"sectionBtn",idOwnedSections:"ownedSections",idInstrument:"part",idInstControls:"instControls",idInstSlotPrefix:"instSlot",idInstSlotTxtPrefix:"instSlotTxt",idInstSlotBtnPrefix:"instSlotRect",idTempoBpm:"tmpBpm",idSemaphorePrefix:"semC",idLineSuffix:"Line",idBridgeSuffix:"Bridge",idOrdSuffix:"Ord",idRectSuffix:"Rect",blankPageUrl:"img/blankStave.png",filterOutParts:[oi,ai],connectedRectStyle:{fill:Ri,stroke:Fi,"stroke-width":"0px",visibility:ui,opacity:1},disconnectedRectStyle:{fill:Ci,stroke:Vi,"stroke-width":"1px",visibility:ui,opacity:1},errorRectStyle:{fill:Mi,stroke:Ui,"stroke-width":"1px",visibility:ui,opacity:1},connectedTxtStyle:{fill:qi},disconnectedTxtStyle:{fill:zi},errorTxtStyle:{fill:Yi},activeStaveStyle:{fill:Ai,stroke:Di,"stroke-width":"1px",visibility:ui,opacity:.5},inactiveStaveStyle:{fill:wi,stroke:_i,"stroke-width":"1px",visibility:ui,opacity:.4},instSlotBtnActiveStyle:{fill:ki,stroke:hi,"stroke-width":"1px",visibility:ui,opacity:1},instSlotBtnActiveInstStyle:{fill:"#d7f2cd",stroke:hi,"stroke-width":"1px",visibility:ui,opacity:1},instSlotBtnInActiveStyle:{fill:Bi,stroke:vi,visibility:ui,opacity:1},instSlotTxtActiveStyle:{fill:hi,visibility:ui,opacity:1},instSlotTxtInActiveStyle:{fill:hi,stroke:vi,visibility:mi,opacity:0},instSlotActiveAttrib:{filter:"url(#dropshadow)"},instSlotInActiveAttrib:{filter:"none"},connectedBtnAttrib:{filter:""},disconnectedBtnAttrib:{filter:"url(#dropshadow)"},errorBtnAttrib:{filter:"url(#dropshadow)"},topStave:{gId:"stvTop",imgId:"stvTopImg",startLineId:"stvTopStartLine",positionLineId:"stvTopPosLine",beatBallId:"stvTopBeatBall",maskId:"stvTopMask",ovrlPosId:"ovrlTopPos",ovrlPitchId:"ovrlTopPitch",ovrlSpeedId:"ovrlTopSpeed",ovrlPressId:"ovrlTopPres",ovrlDynId:"ovrlTopDyn",ballYmax:84,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"80",x2:"95",y2:"281"},posBallConf:{cx:"95",cy:"110",r:"4"}},bottomStave:{gId:"stvBot",imgId:"stvBotImg",startLineId:"stvBotStartLine",positionLineId:"stvBotPosLine",beatBallId:"stvBotBeatBall",maskId:"stvBotMask",ovrlPosId:"ovrlBotPos",ovrlPitchId:"ovrlBotPitch",ovrlSpeedId:"ovrlBotSpeed",ovrlPressId:"ovrlBotPres",ovrlDynId:"ovrlBotDyn",ballYmax:305,xLeftMargin:31.5,posLineConf:{x1:"95",y1:"301",x2:"95",y2:"502"},posBallConf:{cx:"95",cy:"331",r:"4"}},metro:{idMetronomeRect:"metroRect",idMetronome:"metro",idMetroSlider:"metroFreqSlider",idMetroFreqRect:"metroFreq",idMetroFreqLine:"metroFreqLine",ifSymbolMetroOff:"#metronome",ifSymbolMetroOn:"#metronomeOn",ifMetroFreqSlider:"#metroFreq",minFreq:220,maxFreq:2200}},xn={clientId:null,isPlaying:!1,isReady:!1,score:{title:"ZScore",noSpaceTitle:"ZScore",htmlFile:null,instrument:"Part View",parts:["Part View"],firstPageNo:1,lastPageNo:2,sections:[],ownedSections:[],mySections:[],assignmentType:null},part:{name:"Part View",imgDir:null,imgPageNameToken:null,imgContPageName:null,blankPageNo:0,contPageNo:Hi,currentSection:null,pageRanges:[{start:1,end:1}],pages:{}},topStave:{id:"topStave",config:Pn.topStave,pageId:pn,rndPageId:null,filename:Sn,beatMap:null,timeline:null,isActive:!0,isPlaying:!1,currentBeat:null},bottomStave:{id:"bottomStave",config:Pn.bottomStave,pageId:pn,rndPageId:null,filename:Sn,beatMap:null,timeline:null,isActive:!1,isPlaying:!1,currentBeat:null},startTimeTl:0,currentBeatId:"b0",currentBeatNo:0,tempo:0,tempoModifier:1,scoreDir:"/score/",currentTickTimeSec:0,nextBeatTickTimeSec:0,audioTlBeatTime:0,audioTickBeatTime:0,isConnected:!1,isInitialised:!1,connectionType:null,pageNoToLoad:0,metro:{isMetroOn:!1,slider:{xMax:60,xMin:40,xMid:50,range:20}}};return c.prototype.loadImg=function(e){this.img.src=e,this.img.onload=function(){$t("pageImgOnLoad: id: "+this.pageId),Pe(this.pageId)}},{onStateBtn:function(){y()},onPartSelect:function(e){P(e)},onSectionSelect:function(e){x(e)},onInstrumentSelect:function(e,t){h(e,t)}}}(zsUtil,zsNet,zsSvg,zsWsAudio,zsMusic,window,document);