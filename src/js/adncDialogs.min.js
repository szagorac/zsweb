var zscore=function(t,e,n,i,o,r,a,s){"use strict";function l(t){this.message=t,this.name="ZScoreException"}function u(t,e,n,i,o,r,a){this.boxNo=t,this.midX=e,this.midY=n,this.boxWidth=i,this.boxHeight=o,this.boxIdPrefix=r,this.styleConfig=a,this.boxSvgIdPrefix=r+he,this.boxes=[],this.isInitialised=!1,this.positiveMinIndex=0,this.positiveMaxIndex=0,this.negativeMinIndex=0,this.negativeMaxIndex=0,this.zeroIndex=null,this.isPlayAudio=!1,this.currentValue=0,this.currentMaxVal=0}function d(t,e,n,i,o,r){this.inactiveStyle=t,this.zeroStyle=e,this.negMinRGB=n,this.negMaxRGB=i,this.posMinRGB=o,this.posMaxRGB=r}function c(t,e,n,i,o,r,a,s){this.id=t,this.svgId=e,this.x=n,this.y=i,this.width=o,this.height=r,this.inactiveStyle=a,this.activeStyle=s}function f(){ue("onLoad: "),h()}function h(){if(!(t&&e&&n&&i&&o&&r))throw new l("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio, zsSynth and zsMusic");t.setRunMode(de),ue("init: "),Se=t.isTouchDevice(),Me=t.isSafari(navigator),ue("init: IsTouch Device: "+Se+" isSafari: "+Me),De.fontCanvas=s.createElement("canvas"),De.canvasCtx=De.fontCanvas.getContext("2d"),v(),I(),b(),S(),M(),A(),D(),m(),g()}function p(){y()}function m(){_(),J(),K()}function v(){e.init(Te.connectionPreference,Te.appUrlSse,Te.appUrlWebsockets,Te.appUrlHttp,Ct)}function g(){e.getServerState()}function x(){i.initNoise(),i.initPlayer(),i.initSynth(),i.initGranulator(De.granulatorIndex),t.makeInVisible(Te.loadingIconId),ue("onAudioLoaded: completed")}function b(){ae(i)?le("initAudio: invalid zsAudio lib"):i.init(Ie,x)}function y(){ae(i)?le("resetAudio: invalid zsAudio lib"):i.reset()}function I(){n.init(),w()}function w(){var e=Ht();se(e)&&(t.listen("touchend",e,ne),t.listen("mouseup",e,ee));var n=qt();se(n)&&(t.listen("touchend",n,oe),t.listen("mouseup",n,ie))}function S(){var t=new d(Te.meterInactiveStyle,Te.meterZeroStyle,Te.negativeMinCol,Te.negativeMaxCol,Te.positiveMinCol,Te.positiveMaxCol),e=new u(Te.meterBoxNo,Te.centreX,Te.centreY,Te.meterBoxWidth,Te.meterBoxHeight,Te.meterBoxIdPrefix,t);e.init(),De.meter=e}function M(){var e=Vt();ae(e)||(Ae=e,t.listen("resize",a,nt),t.listen("orientationchange",a,nt),$("Welcome to","<span style='color:blueviolet;'>ZScore</span>","awaiting performance start ...",null,!0))}function A(){var e=Te.voteTimeoutMs/1e3;De.thumbUpTween=gsap.from(t.toCssIdQuery(Te.thumbUpSymId),{duration:e,scaleY:.5,fill:"green",transformOrigin:"right bottom",paused:!0,ease:"slow(0.9, 0.4, false)",onComplete:V}),De.thumbUpTween.progress(1),De.thumbDownTween=gsap.from(t.toCssIdQuery(Te.thumbDownSymId),{duration:e,scaleY:.5,fill:"red",transformOrigin:"left top",paused:!0,ease:"slow(0.9, 0.4, false)",onComplete:B}),De.thumbDownTween.progress(1)}function D(){T(),U()}function T(){var e=t.getRandomIntFromRange(0,Te.noteDurations.length-1),n=Te.noteDurations[e],i=t.toCssIdQuery(Te.noteSymbolsUp[e]),o=t.getElement(Te.noteUpSymId);o.setAttribute("href",i),o.setAttribute("xlink:href",i);var r=k()*Te.noteDurationMultipler;De.noteUpDurationSec=n*r,De.noteUpTween=G()}function U(){var e=t.getRandomIntFromRange(0,Te.noteDurations.length-1),n=Te.noteDurations[e],i=t.toCssIdQuery(Te.noteSymbolsDown[e]),o=t.getElement(Te.noteDownSymId);o.setAttribute("href",i),o.setAttribute("xlink:href",i);var r=k()*Te.noteDurationMultipler;De.noteDownDurationSec=n*r,De.noteDownTween=P()}function C(){R()}function E(){F()}function R(){var e=t.getRandomIntFromRange(0,De.noteUpFreq.length-1),n=De.noteUpFreq[e];ue("playing freq: "+n),i.playSynth(n,De.noteUpDurationSec)}function F(){var e=t.getRandomIntFromRange(0,De.noteDownFreq.length-1),n=De.noteDownFreq[e];ue("playing freq: "+n),i.playSynth(n,De.noteDownDurationSec)}function N(){var t=o.getBeatDurationSec(De.bpm);return ae(t)&&(t=1),t}function k(){var t=N();return 4*t}function G(){var t=De.noteUpDurationSec,e={sign:-1,angleMin:0,angleMax:120,rMin:10,rMax:30,rotAngleMin:-360,rotAngleMax:360,xmod:20,ymod:30};return z(t,Te.noteUpSymId,e,O)}function P(){var t=De.noteDownDurationSec,e={sign:1,angleMin:0,angleMax:120,rMin:20,rMax:40,rotAngleMin:-360,rotAngleMax:360,xmod:0,ymod:0};return z(t,Te.noteDownSymId,e,H)}function z(e,n,i,o){var r=t.randomIntFromInterval(i.angleMin,i.angleMax),a=t.randomIntFromInterval(i.rMin,i.rMax),s=0,l=i.sign,u=l*a;if(r<90){var d=t.toRadians(r);s=l*a*Math.cos(d),u=l*a*Math.sin(d)}else if(r>90){d=t.toRadians(180-r);s=-1*l*a*Math.cos(d),u=l*a*Math.sin(d)}s+=i.xmod,u+=i.ymod;var c=t.randomIntFromInterval(i.rotAngleMin,i.rotAngleMax);return gsap.to(t.toCssIdQuery(n),{duration:e,scale:.1,autoAlpha:0,rotation:c,x:s,y:u,ease:"slow(0.9, 0.4, false)",paused:!0,onComplete:o})}function V(){t.setElementAttributes(Ot(),Te.filterGreenAttrib)}function B(){t.setElementAttributes(Lt(),Te.filterRedAttrib)}function O(){q(Te.noteUpSymId),T(),L(Te.noteUpSymId),L(Te.noteDownSymId)}function H(){q(Te.noteDownSymId),U(),L(Te.noteDownSymId),L(Te.noteUpSymId)}function q(e){gsap.set(t.toCssIdQuery(e),{autoAlpha:0,scale:1,rotation:0,x:0,y:0})}function L(e){gsap.to(t.toCssIdQuery(e),{duration:1,autoAlpha:1})}function Q(e){gsap.to(t.toCssIdQuery(e),{duration:1,autoAlpha:0})}function W(t){De.currentVote=t;var n={};n[ve]=t,e.sendEvent(me,n)}function j(){return se(De.thumbUpTween)&&De.thumbUpTween.isActive()}function Y(){return se(De.thumbDownTween)&&De.thumbDownTween.isActive()}function X(){return se(De.noteUpTween)&&De.noteUpTween.isActive()}function Z(){return se(De.noteDownTween)&&De.noteDownTween.isActive()}function _(){t.makeVisible(Te.meterGroupId),De.isVotingEnabled=!0}function J(){t.makeInVisible(Te.thumbUpGroupId),t.makeInVisible(Te.thumbDownGroupId),De.isThumbEnabled=!1}function K(){t.makeVisible(Te.noteUpGroupId),t.makeVisible(Te.noteDownGroupId),De.isNoteEnabled=!0}function $(t,e,n,i,o){if(!ae(Ae)){var r=!1;if(!ae(t)){var a=t.trim();De.instructions.l1!=a&&(De.instructions.l1=a,r=!0)}if(!ae(e)){a=e.trim();De.instructions.l2!=a&&(De.instructions.l2=a,r=!0)}if(!ae(n)){a=n.trim();De.instructions.l3!=a&&(De.instructions.l3=a,r=!0)}ae(i)||(De.instructions.bckgCol=i),o?r&&St():Tt()}}function tt(e){ae(e)||(t.isNumeric(e)||(e=t.toInt(e)),De.voteCount=e)}function et(e){ae(e)||(t.isNumeric(e)||(e=t.toInt(e)),De.userNo=e)}function nt(e){if(!t.isObject(this))return null;St()}function it(e,n,i){if(t.isArray(n))for(var o=0;o<n.length;o++)ot(e,n[o],i);else ot(e,n,i)}function ot(t,e,n){if(!ae(e))switch(ue("runAudio: "+t+fe+e),e){case"all":rt(t,n);break;case"player":st(t,n);break;case"granulator":ct(t,n)}}function rt(e,n){if(t.isString(e))switch(e){case"volume":at(n);break;default:return void le("runPlayer: Unknown actionId: "+e)}}function at(e){if(ae(i))le("setAudioMasterVolume: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null;ae(e.level)||(n=e.level),ae(e.timeMs)||(o=e.timeMs),i.setMasterVolume(n,o)}}function st(e,n){if(t.isString(e))switch(e){case"play":ut(n);break;case"volume":dt(n);break;case"config":lt(n);break;default:return void le("runPlayer: Unknown actionId: "+e)}}function lt(e){if(ae(i))le("updateAudioPlayerCofig: Invalid zsAudio lib");else if(t.isObject(e)){var n=!1;if(!ae(e.audioFiles)){var o=e.audioFiles;t.isArray(o)?t.arrEquals(Ie,o)?ue("updateAudioPlayerCofig: audioFiles array identical, ignoring update"):(Ie=o,n=!0):le("updateAudioPlayerCofig: invalid audioFiles array")}if(!ae(e.audioFilesIndexMap)){var r=e.audioFilesIndexMap;!t.isArray(r)||r.length<1?le("updateAudioPlayerCofig: invalid fileIndexMap array"):we=r}n&&(ue("updateAudioPlayerCofig: laoding audioFiles"),t.makeVisible(Te.loadingIconId),i.loadAudioBuffers(Ie))}}function ut(e){if(ae(i))le("runPlayerPlay: Invalid zsAudio lib");else if(t.isObject(e)){var n=0;ae(e.index)||(t.isString(e.index)?n=t.toInt(e.index):t.isNumeric(e.index)&&(n=e.index));var o=n;if(n>0&&n<we.length){var r=we[n];o=t.randomArrayElement(r)}var a=null,s=null,l=null;ae(e.startTime)||(a=e.startTime),ae(e.offset)||(s=e.offset),ae(e.duration)||(l=e.duration),i.playAudio(o,a,s,l)}}function dt(e){if(ae(i))le("setAudioMasterVolume: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null;ae(e.level)||(n=e.level),ae(e.timeMs)||(o=e.timeMs),i.setPlayerVolume(n,o)}}function ct(e,n){if(t.isString(e))switch(e){case"play":ft(n);break;case"stop":ht(n);break;case"config":gt(n);break;case"rampLinear":pt(n);break;case"rampSin":vt(n);break;case"volume":mt(n);break;default:return void le("runAudioGranulator: Unknown actionId: "+e)}}function ft(t){ae(i)?le("runAudioPlayGranulator: Invalid zsAudio lib"):i.playGranulator()}function ht(t){ae(i)?le("runAudioPlayGranulator: Invalid zsAudio lib"):i.stopGranulator()}function pt(e){if(ae(i))le("runAudioPlayGranulator: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null,r=null;ae(e.paramName)||(n=e.paramName),ae(e.endValue)||(o=e.endValue),ae(e.duration)||(r=e.duration),i.setGranulatorRampLinear(n,o,r)}}function mt(e){if(ae(i))le("runAudioPlayGranulator: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null;ae(e.level)||(n=e.level),ae(e.timeMs)||(o=e.timeMs),i.setGranulatorGain(n,o)}}function vt(e){if(ae(i))le("runAudioPlayGranulator: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null,r=null,a=null;ae(e.paramName)||(n=e.paramName),ae(e.amplitude)||(o=e.amplitude),ae(e.frequency)||(r=e.frequency),ae(e.duration)||(a=e.duration),i.setGranulatorRampSin(n,o,r,a)}}function gt(e){ae(i)?le("runAudioPlayGranulator: Invalid zsAudio lib"):t.isObject(e)&&(i.setGranulatorConfig(e),i.initGranulator(De.granulatorIndex))}function xt(t){$(t.line1,t.line2,t.line3,t.colour,t.isVisible)}function bt(t){se(t.count)&&tt(t.count),se(t.maxCount)&&et(t.maxCount),wt()}function yt(t){lt(t)}function It(t){gt(t)}function wt(){if(!ae(De.meter)){var t=De.userNo;t<=Te.meterMaxVotes&&(t=Te.meterMaxVotes),De.meter.set(De.voteCount,t)}}function St(e){if(!ae(Ae)){Ae.innerHTML=ce;var n=De.instructions.l1,i=Te.textSpanPrefix+"1",o=De.instructions.l2,r=Te.textSpanPrefix+"2",a=De.instructions.l3,s=Te.textSpanPrefix+"3",l=ce;e||(e=ce,t.isEmptyString(n)||(l=At(n,l),n=Mt(n,i),e+=n),t.isEmptyString(o)||(ue("displayInstructions: processing line2 "+o),l=At(o,l),o=Mt(o,r),e=t.addSuffixIfNotThere(e,Te.textLineBreak),e+=o),t.isEmptyString(a)||(ue("displayInstructions: processing line3 "+a),l=At(a,l),a=Mt(a,s),e=t.addSuffixIfNotThere(e,Te.textLineBreak),e+=a));var u=Te.textFontSize,d=Xt(l,u,Ae);Ae.style.fontSize=ce+d+"px",Ae.style.fontFamily=Te.textFontFamily,Ae.innerHTML=e;var c=t.getChildElement(Ae,t.toCssIdQuery(i));ae(c)||(c.style.opacity=0);var f=t.getChildElement(Ae,t.toCssIdQuery(r));ae(f)||(f.style.opacity=0);var h=t.getChildElement(Ae,t.toCssIdQuery(s));if(ae(h)||(h.style.opacity=0),De.instructions.isVisible=!0,Ut(Ae,De.instructions),Te.textSpanIsFadeIn){var p=Te.textSpanFadeTimeSec,m=Te.textSpanFadeStaggerTimeSec;ae(c)||gsap.to(c,{duration:p,autoAlpha:1,ease:"power1.in"}),ae(f)||gsap.to(f,{delay:m,duration:p,autoAlpha:1,ease:"power1.in"}),ae(h)||gsap.to(h,{delay:2*m,duration:p,autoAlpha:1,ease:"power1.in"})}else ae(c)||(c.style.opacity=1),ae(f)||(f.style.opacity=1),ae(h)||(h.style.opacity=1)}}function Mt(e,n){for(;t.contains(e,be);)e=t.replace(e,be,ye);return e=t.wrapInSpanElement(e,n),e}function At(e,n){var i=t.removeMarkup(e);return i.length>n.length?i:n}function Dt(t){return Te.textFontType+fe+t+"px "+Te.textFontFamily}function Tt(){ae(Ae)||(Ae.innerHTML=ce,De.instructions.isVisible=!1,Ut(Ae,De.instructions))}function Ut(e,n){var i=Et(n);ae(n.bckgCol)||(i.background=n.bckgCol),t.setElementStyleProperty(e,i)}function Ct(t,e){ae(t)||(e||p(),se(t.actions)&&Rt(t.actions),se(t.instructions)&&xt(t.instructions),se(t.counter)&&bt(t.counter),se(t.playerConfig)&&yt(t.playerConfig),se(t.granulatorConfig)&&It(t.granulatorConfig))}function Et(t){return t.isVisible?Te.textStyleVisible:Te.textStyleInvisible}function Rt(e){var n=null,i=null,o=[],r={};if(t.isArray(e))for(var a=0;a<e.length;a++){var s=e[a];se(s.id)&&(n=s.id),se(s.actionType)&&(i=s.actionType),se(s.elementIds)&&(o=s.elementIds),se(s.params)&&(r=s.params),Ft(n,i,o,r)}}function Ft(t,e,n,i){if(ue("doAction: "+t+" actionType: "+e),!ae(e)&&!ae(n))switch(e){case"AUDIO":it(t,n,i);break;case"STOP":Nt(t,n,i);break;default:le("doAction: Unknown actionType: "+e)}}function Nt(e,n,i){if(t.isArray(n))for(var o=0;o<n.length;o++)kt(e,n[o],i);else kt(e,n,i)}function kt(e,n,i){if(t.isString(e))switch(ue("stop: actionId: "+e+fe+n),e){case"stop":Gt(n,i);break;default:return void le("Unknown stop actionId: "+e)}}function Gt(t,e){if(!ae(t))switch(ue("runStopAction: target: "+t),t){case"all":Pt(e);break;case"player":zt(e)}}function Pt(t){ue("runStopAll: "),!ae(i)&&i.isReady()&&zt(t)}function zt(t){ae(i)?le("runAudioStopPlayer: Invalid zsAudio lib"):i.stopPlayer()}function Vt(){return t.getElement(Te.instructionTxtElementId)}function Bt(){return t.getElement(Te.meterGroupId)}function Ot(){return t.getElement(Te.thumbUpGroupId)}function Ht(){return t.getElement(Te.thumbUpRectId)}function qt(){return t.getElement(Te.thumbDownRectId)}function Lt(){return t.getElement(Te.thumbDownGroupId)}function Qt(){return De.thumbUpTween}function Wt(){return De.thumbDownTween}function jt(){return De.noteUpTween}function Yt(){return De.noteDownTween}function Xt(t,e,n){var i=1;a.innerWidth||s.documentElement.clientWidth||s.body.clientWidth;var o=a.innerHeight||s.documentElement.clientHeight||s.body.clientHeight,r=(Dt(i),n.clientWidth),l=r*Te.textWidthCompressor,u=o*Te.textAreaMax;i=_t(t,e,l),i=Zt(r,i,u);var d=Te.textMaxFontSize;return i>d&&(i=d),i}function Zt(t,e,n){var i=Dt(e),o=e,r=Kt(i,t,n);if(r<0)return o;var a=r*Te.textNumberOfLines,s=n/a;return s<1&&(o*=s),o}function _t(t,e,n){var i=Dt(e),o=Jt(i,t),r=o.width;if(r<=0||r>n||Math.abs(n-r)<1)return e;var a=n/r,s=e*a;return _t(t,s,n)}function Jt(t,e){var n=De.fontCanvas,i=De.canvasCtx;return i.fillRect(0,0,n.width,n.height),i.textBaseline="top",i.fillStyle=pe,i.font=t,i.measureText(e)}function Kt(t,e,n){var i=De.fontCanvas,o=De.canvasCtx;i.width=e,i.height=n,o.fillRect(0,0,i.width,i.height),o.textBaseline="top",o.fillStyle=pe,o.font=t;var r="gM";o.fillText(r,0,0);for(var a=o.getImageData(0,0,i.width,i.height).data,s=-1,l=-1,u=0;u<i.height;u++)for(var d=0;d<i.width;d++){var c=4*(u*i.width+d);if(0!==a[c]){-1===s&&(s=u);break}if(d===i.width-1&&-1!==s){l=u,u=i.height;break}}var f=(l-s)*Te.textHeightCompressor;return f}function $t(){if(ue("onThumbsUp:"),De.isThumbEnabled){if(j())return;t.setElementAttributes(Ot(),Te.filterInActiveAttrib),t.playOrRestartTween(Qt())}if(De.isNoteEnabled){if(X()||Z())return;Q(Te.noteDownSymId),t.playOrRestartTween(jt()),C()}De.isVotingEnabled&&W(ge)}function te(){if(ue("onThumbsDown:"),De.isThumbEnabled){if(Y())return;t.setElementAttributes(Lt(),Te.filterInActiveAttrib),t.playOrRestartTween(Wt())}if(De.isNoteEnabled){if(X()||Z())return;Q(Te.noteUpSymId),t.playOrRestartTween(Yt()),E()}De.isVotingEnabled&&W(xe)}function ee(t){ue("onMouseUpThumbsUp:"),Se||$t()}function ne(t){ue("onTouchEndThumbsUp:"),Se&&$t()}function ie(t){ue("onMouseUpThumbsDown:"),Se||te()}function oe(t){ue("onTouchEndThumbsDown:"),Se&&te()}function re(e,n){t.setElementAttributes(e,n)}function ae(e){return t.isNull(e)}function se(e){return t.isNotNull(e)}function le(e){t.logError(e)}function ue(e){t.log(e)}const de="DEV",ce="",fe=" ",he="Rect",pe="#FFFFFF",me="VOTE",ve="value",ge=1,xe=-1,be="&#39;",ye="'";var Ie=["/audio/DialogsRhythm7-1.wav"],we=[[0]],Se=null,Me=null,Ae=null,De={bpm:80,instructions:{isVisible:!1,l1:ce,l2:ce,l3:ce,bckgCol:"rgba(225, 225, 225, 0.85)"},voteCount:0,userNo:10,meter:null,currentVote:null,voteTimeMs:0,thumbUpTween:null,thumbDownTween:null,noteUpTween:null,noteUpDurationSec:1,noteDownTween:null,noteDownDurationSec:1,isVotingEnabled:!1,isThumbEnabled:!1,isNoteEnabled:!0,granulatorIndex:0,filterFreq:1,filterQ:0,noteUpFreq:[523.25,631.62,739.99],noteDownFreq:[261.63,315.81,369.99]},Te={connectionPreference:"ws,sse,poll",appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",textSpanPrefix:"is",instructionTxtElementId:"instructionTxt",textLineBreak:"<br/>",textStyleInvisible:{visibility:"hidden"},textStyleVisible:{visibility:"visible"},textFontFamily:"Arial",textFontType:"normal",textFontSize:50,textMaxFontSize:70,textMaxLineLen:30,textHeightCompressor:1.1,textWidthCompressor:.9,textAreaMax:.4,textNumberOfLines:3,textSpanIsFadeIn:!0,textSpanFadeTimeSec:1,textSpanFadeStaggerTimeSec:.5,voteTimeoutMs:5e3,noteDurationMultipler:8,loadingIconId:"loadingIcon",elementGroupSuffix:"Grp",meterGroupId:"meterGrp",thumbUpRectId:"thUpRect",thumbDownRectId:"thDownRect",thumbUpGroupId:"thumbUpGrp",thumbUpPathId:"thumbUpPth",thumbUpSymId:"thumbUpSym",thumbDownGroupId:"thumbDownGrp",thumbDownPathId:"thumbDownPth",thumbDownSymId:"thumbDownSym",noteUpGroupId:"noteUpGrp",noteUpSymId:"noteUpSym",noteDownGroupId:"noteDownGrp",noteDownSymId:"noteDownSym",meterBoxIdPrefix:"meterBox",meterBoxNo:20,meterMaxVotes:5,meterInactiveStyle:{fill:"none",stroke:"black","stroke-width":"4px"},meterZeroStyle:{fill:"yellow"},thumbsUpActiveStyle:{fill:"green"},thumbsUpInActiveStyle:{fill:"none"},thumbsDownActiveStyle:{fill:"red"},thumbsDownInActiveStyle:{fill:"none"},centreX:450,centreY:800,meterBoxWidth:80,meterBoxHeight:40,negativeMinCol:{r:255,g:165,b:0},negativeMaxCol:{r:255,g:0,b:0},positiveMinCol:{r:255,g:255,b:0},positiveMaxCol:{r:0,g:125,b:0},maxNoiseLevel:1,audioFadeInMs:1e3,filterGreenAttrib:{filter:"url(#dropshadowgreen)"},filterRedAttrib:{filter:"url(#dropshadowred)"},filterInActiveAttrib:{filter:"none"},noteUpConfig:{minAngle:0,maxAngle:360},noteDurations:[o.DURATION.MINIM,o.DURATION.CROTCHET,o.DURATION.QUAVER,o.DURATION.SEMI_QUAVER],noteSymbolsUp:["minimUp","crotchetUp","quaverUp","semiquaverUp"],noteSymbolsDown:["minimDown","crotchetDown","quaverDown","semiquaverDown"]};return u.prototype.init=function(){if(!ae(this.styleConfig)&&t.isNumeric(this.boxNo)&&t.isNumeric(this.midX)&&t.isNumeric(this.midY)){var e=t.isOddNumber(this.boxNo),n=Math.round(this.boxNo/2);this.positiveMaxIndex=this.boxNo-1,this.positiveMinIndex=n,this.negativeMinIndex=n-1,this.negativeMaxIndex=0,this.zeroIndex=null;var i=this.midY+n*this.boxHeight;e&&(this.negativeMinIndex=n-2,this.zeroIndex=n-1,i=this.midY+this.boxHeight/2+this.zeroIndex*this.boxHeight);for(var o=i,r=this.midX-this.boxWidth/2,a=0;a<this.boxNo;++a){var s=this.boxIdPrefix+a,l=this.boxSvgIdPrefix+a,u=o-this.boxHeight,d=this.getActiveStyle(a),f=new c(s,l,r,u,this.boxWidth,this.boxHeight,this.styleConfig.inactiveStyle,d);this.boxes[a]=f,o=u}this.draw(),this.isInitialised=!0}else le("ZScoreMeter.init: invalid inputs")},u.prototype.getActiveStyle=function(e){var n="yellow";if(!ae(this.zeroIndex)&&e===this.zeroIndex)return this.styleConfig.zeroStyle;if(e>=this.positiveMinIndex&&e<=this.positiveMaxIndex){var i=0;this.positiveMaxIndex!=this.positiveMinIndex&&(i=(e-this.positiveMinIndex)/(this.positiveMaxIndex-this.positiveMinIndex));var o=t.interpolateRgbColours(this.styleConfig.posMinRGB,this.styleConfig.posMaxRGB,i);ae(o)||(n=t.rgbToHex(o.r,o.g,o.b))}else if(e>=this.negativeMaxIndex&&e<=this.negativeMinIndex){i=0;this.negativeMinIndex!=this.negativeMaxIndex&&(i=(this.negativeMinIndex-e)/(this.negativeMinIndex-this.negativeMaxIndex));o=t.interpolateRgbColours(this.styleConfig.negMinRGB,this.styleConfig.negMaxRGB,i);ae(o)||(n=t.rgbToHex(o.r,o.g,o.b))}return{fill:n}},u.prototype.clear=function(){for(var t=0;t<this.boxes.length;++t)this.setBoxStyle(t,this.styleConfig.inactiveStyle)},u.prototype.draw=function(){for(var t=0;t<this.boxes.length;++t)this.boxes[t].draw()},u.prototype.setPlayAudio=function(t){this.isPlayAudio=t},u.prototype.set=function(e,n){if(t.isNumeric(e)&&t.isNumeric(n))if(this.clear(),ae(this.zeroIndex)||this.activateBox(this.zeroIndex,!0),e>0){n<0&&(n*=-1);var i=1,o=n;o<i&&(o=i),e>o&&(e=o);for(var r=Math.floor(t.mapRange(e,i,o,this.positiveMinIndex,this.positiveMaxIndex)),a=this.positiveMinIndex;a<=r;a++)this.activateBox(a,!0);this.currentValue=e,this.currentMaxVal=o,this.playAudio(e,o)}else{n>0&&(n*=-1);i=-1,o=n;o>i&&(o=i),e<o&&(e=o);for(r=Math.ceil(t.mapRange(e,i,o,this.negativeMinIndex,this.negativeMaxIndex)),a=this.negativeMinIndex;a>=r;a--)this.activateBox(a,!0);this.currentValue=e,this.currentMaxVal=o,this.playAudio(e,o)}},u.prototype.activateBox=function(t,e){var n=this.boxes[t];ae(n)||n.setActive(e)},u.prototype.setBoxStyle=function(t,e){var n=this.boxes[t];ae(n)||n.setStyle(e)},u.prototype.playAudio=function(e,n){if(this.isPlayAudio){if(0===e)return i.playNoise(0),void i.setPlayerVolume(0,500);if(e>0){i.playNoise(0);var o=t.mapRange(Math.abs(e),0,Math.abs(n),0,1);i.setPlayerVolume(o,Te.audioFadeInMs)}else{i.setPlayerVolume(0,Te.audioFadeInMs);o=t.mapRange(Math.abs(e),0,Math.abs(n),0,Te.maxNoiseLevel);i.playNoise(o)}}},c.prototype.draw=function(){var e=Bt();if(!ae(e)){var i=n.createSvgRectangle(this.x,this.y,this.width,this.height,this.svgId);re(i,this.inactiveStyle),t.addChildToParent(e,i)}},c.prototype.setStyle=function(e){var n=t.getElement(this.svgId);ae(n)||re(n,e)},c.prototype.setActive=function(e){var n=t.getElement(this.svgId);ae(n)||re(n,e?this.activeStyle:this.inactiveStyle)},{load:function(){f()},onThumbsDownSelect:function(){te()},onThumbsUpSelect:function(){$t()}}}(zsUtil,zsNet,zsSvg,zsAudio,zsMusic,zsSynth,window,document);