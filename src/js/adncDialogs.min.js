var zscore=function(t,e,i,n,o,r,a){"use strict";function s(t){this.message=t,this.name="ZScoreException"}function l(t,e,i,n,o,r,a){this.boxNo=t,this.midX=e,this.midY=i,this.boxWidth=n,this.boxHeight=o,this.boxIdPrefix=r,this.styleConfig=a,this.boxSvgIdPrefix=r+le,this.boxes=[],this.isInitialised=!1,this.positiveMinIndex=0,this.positiveMaxIndex=0,this.negativeMinIndex=0,this.negativeMaxIndex=0,this.zeroIndex=null,this.isPlayAudio=!1,this.currentValue=0,this.currentMaxVal=0}function u(t,e,i,n,o,r){this.inactiveStyle=t,this.zeroStyle=e,this.negMinRGB=i,this.negMaxRGB=n,this.posMinRGB=o,this.posMaxRGB=r}function c(t,e,i,n,o,r,a,s){this.id=t,this.svgId=e,this.x=i,this.y=n,this.width=o,this.height=r,this.inactiveStyle=a,this.activeStyle=s}function d(){oe("onLoad: "),f()}function f(){if(!(t&&e&&i&&n&&o))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio and zsMusic");t.setRunMode(re),oe("init: "),be=t.isTouchDevice(),ge=t.isSafari(navigator),oe("init: IsTouch Device: "+be+" isSafari: "+ge),Ie.fontCanvas=a.createElement("canvas"),Ie.canvasCtx=Ie.fontCanvas.getContext("2d"),m(),y(),b(),M(),w(),S(),A(),p(),v()}function h(){g()}function p(){j(),q(),Y()}function m(){e.init(Me.connectionPreference,Me.appUrlSse,Me.appUrlWebsockets,Me.appUrlHttp,St)}function v(){e.getServerState()}function x(){n.initNoise(),n.initPlayer(),n.initGranulator(Ie.granulatorIndex),t.makeInVisible(Me.loadingIconId),oe("onAudioLoaded: completed")}function b(){ee(n)?ne("initAudio: invalid zsAudio lib"):n.init(ve,x)}function g(){ee(n)?ne("resetAudio: invalid zsAudio lib"):n.reset()}function y(){i.init(),I()}function I(){var e=Ft();ie(e)&&(t.listen("touchend",e,Jt),t.listen("mouseup",e,_t));var i=Vt();ie(i)&&(t.listen("touchend",i,$t),t.listen("mouseup",i,Kt))}function M(){var t=new u(Me.meterInactiveStyle,Me.meterZeroStyle,Me.negativeMinCol,Me.negativeMaxCol,Me.positiveMinCol,Me.positiveMaxCol),e=new l(Me.meterBoxNo,Me.centreX,Me.centreY,Me.meterBoxWidth,Me.meterBoxHeight,Me.meterBoxIdPrefix,t);e.init(),Ie.meter=e}function w(){var e=Nt();ee(e)||(ye=e,t.listen("resize",r,J),t.listen("orientationchange",r,J),X("Welcome to","<span style='color:blueviolet;'>ZScore</span>","awaiting performance start ...",null,!0))}function S(){var e=Me.voteTimeoutMs/1e3;Ie.thumbUpTween=gsap.from(t.toCssIdQuery(Me.thumbUpSymId),{duration:e,scaleY:.5,fill:"green",transformOrigin:"right bottom",paused:!0,ease:"slow(0.9, 0.4, false)",onComplete:P}),Ie.thumbUpTween.progress(1),Ie.thumbDownTween=gsap.from(t.toCssIdQuery(Me.thumbDownSymId),{duration:e,scaleY:.5,fill:"red",transformOrigin:"left top",paused:!0,ease:"slow(0.9, 0.4, false)",onComplete:F}),Ie.thumbDownTween.progress(1)}function A(){T()}function T(){var e=t.getRandomIntFromRange(0,Me.noteDurations.length-1),i=Me.noteDurations[e],n=t.toCssIdQuery(Me.noteSymbolsUp[e]),o=t.getElement(Me.noteUpSymId);o.setAttribute("href",n),o.setAttribute("xlink:href",n);var r=R()*Me.noteDurationMultipler;Ie.noteUpDurationSec=i*r,Ie.noteUpTween=N()}function U(t){n.stopGranulator(),n.initGranulator(Ie.granulatorIndex);var e=Ie.noteUpDurationSec;D(e,e,-.7,1.5)}function C(){n.stopGranulator(),n.initGranulator(1),D(.2,5,.1,2)}function D(e,i,o,r){Ie.noteUpDurationSec;var a=t.randomFloatFromInterval(e,i),s=1e3*a,l=t.randomFloatFromInterval(o,r),u={pitchRate:l};n.setGranulatorGrainConfig(u),n.playGranulator();var c=.2*s,d=.5*s;setTimeout(n.setGranulatorRampSin("grain.pitchRate",.2,.2,d),c),setTimeout(G,s)}function G(){n.stopGranulator()}function E(){var t=o.getBeatDurationSec(Ie.bpm);return ee(t)&&(t=1),t}function R(){var t=E();return 4*t}function N(){var t=Ie.noteUpDurationSec,e={sign:-1,angleMin:0,angleMax:120,rMin:5,rMax:10,rotAngleMin:-360,rotAngleMax:360};return k(t,Me.noteUpSymId,e,V)}function k(e,i,n,o){var r=t.randomIntFromInterval(n.angleMin,n.angleMax),a=t.randomIntFromInterval(n.rMin,n.rMax),s=0,l=n.sign,u=l*a;if(r<90){var c=t.toRadians(r);s=l*a*Math.cos(c),u=l*a*Math.sin(c)}else if(r>90){c=t.toRadians(180-r);s=-1*l*a*Math.cos(c),u=l*a*Math.sin(c)}var d=t.randomIntFromInterval(n.rotAngleMin,n.rotAngleMax);return gsap.to(t.toCssIdQuery(i),{duration:e,scale:.1,autoAlpha:0,rotation:d,x:s,y:u,ease:"slow(0.9, 0.4, false)",paused:!0,onComplete:o})}function P(){t.setElementAttributes(Pt(),Me.filterGreenAttrib)}function F(){t.setElementAttributes(zt(),Me.filterRedAttrib)}function V(){z(Me.noteUpSymId),T(),B(Me.noteUpSymId)}function z(e){gsap.set(t.toCssIdQuery(e),{autoAlpha:0,scale:1,rotation:0,x:0,y:0})}function B(e){gsap.to(t.toCssIdQuery(e),{duration:1,autoAlpha:1})}function O(t){Ie.currentVote=t;var i={};i[de]=t,e.sendEvent(ce,i)}function H(){return ie(Ie.thumbUpTween)&&Ie.thumbUpTween.isActive()}function L(){return ie(Ie.thumbDownTween)&&Ie.thumbDownTween.isActive()}function W(){return ie(Ie.noteUpTween)&&Ie.noteUpTween.isActive()}function Q(){return ie(Ie.noteDownTween)&&Ie.noteDownTween.isActive()}function j(){t.makeVisible(Me.meterGroupId),Ie.isVotingEnabled=!0}function q(){t.makeInVisible(Me.thumbUpGroupId),t.makeInVisible(Me.thumbDownGroupId),Ie.isThumbEnabled=!1}function Y(){t.makeVisible(Me.noteUpGroupId),t.makeVisible(Me.noteDownGroupId),Ie.isNoteEnabled=!0}function X(t,e,i,n,o){if(!ee(ye)){var r=!1;if(!ee(t)){var a=t.trim();Ie.instructions.l1!=a&&(Ie.instructions.l1=a,r=!0)}if(!ee(e)){a=e.trim();Ie.instructions.l2!=a&&(Ie.instructions.l2=a,r=!0)}if(!ee(i)){a=i.trim();Ie.instructions.l3!=a&&(Ie.instructions.l3=a,r=!0)}ee(n)||(Ie.instructions.bckgCol=n),o?r&&bt():Mt()}}function Z(e){ee(e)||(t.isNumeric(e)||(e=t.toInt(e)),Ie.voteCount=e)}function _(e){ee(e)||(t.isNumeric(e)||(e=t.toInt(e)),Ie.userNo=e)}function J(e){if(!t.isObject(this))return null;bt()}function K(e,i,n){if(t.isArray(i))for(var o=0;o<i.length;o++)$(e,i[o],n);else $(e,i,n)}function $(t,e,i){if(!ee(e))switch(oe("runAudio: "+t+se+e),e){case"all":tt(t,i);break;case"player":it(t,i);break;case"granulator":at(t,i)}}function tt(e,i){if(t.isString(e))switch(e){case"volume":et(i);break;default:return void ne("runPlayer: Unknown actionId: "+e)}}function et(e){if(ee(n))ne("setAudioMasterVolume: Invalid zsAudio lib");else if(t.isObject(e)){var i=null,o=null;ee(e.level)||(i=e.level),ee(e.timeMs)||(o=e.timeMs),n.setMasterVolume(i,o)}}function it(e,i){if(t.isString(e))switch(e){case"play":ot(i);break;case"volume":rt(i);break;case"config":nt(i);break;default:return void ne("runPlayer: Unknown actionId: "+e)}}function nt(e){if(ee(n))ne("updateAudioPlayerCofig: Invalid zsAudio lib");else if(t.isObject(e)){var i=!1;if(!ee(e.audioFiles)){var o=e.audioFiles;t.isArray(o)?t.arrEquals(ve,o)?oe("updateAudioPlayerCofig: audioFiles array identical, ignoring update"):(ve=o,i=!0):ne("updateAudioPlayerCofig: invalid audioFiles array")}if(!ee(e.audioFilesIndexMap)){var r=e.audioFilesIndexMap;!t.isArray(r)||r.length<1?ne("updateAudioPlayerCofig: invalid fileIndexMap array"):xe=r}i&&(oe("updateAudioPlayerCofig: laoding audioFiles"),t.makeVisible(Me.loadingIconId),n.loadAudioBuffers(ve))}}function ot(e){if(ee(n))ne("runPlayerPlay: Invalid zsAudio lib");else if(t.isObject(e)){var i=0;ee(e.index)||(t.isString(e.index)?i=t.toInt(e.index):t.isNumeric(e.index)&&(i=e.index));var o=i;if(i>0&&i<xe.length){var r=xe[i];o=t.randomArrayElement(r)}var a=null,s=null,l=null;ee(e.startTime)||(a=e.startTime),ee(e.offset)||(s=e.offset),ee(e.duration)||(l=e.duration),n.playAudio(o,a,s,l)}}function rt(e){if(ee(n))ne("setAudioMasterVolume: Invalid zsAudio lib");else if(t.isObject(e)){var i=null,o=null;ee(e.level)||(i=e.level),ee(e.timeMs)||(o=e.timeMs),n.setPlayerVolume(i,o)}}function at(e,i){if(t.isString(e))switch(e){case"play":st(i);break;case"stop":lt(i);break;case"config":ft(i);break;case"rampLinear":ut(i);break;case"rampSin":dt(i);break;case"volume":ct(i);break;default:return void ne("runAudioGranulator: Unknown actionId: "+e)}}function st(t){ee(n)?ne("runAudioPlayGranulator: Invalid zsAudio lib"):n.playGranulator()}function lt(t){ee(n)?ne("runAudioPlayGranulator: Invalid zsAudio lib"):n.stopGranulator()}function ut(e){if(ee(n))ne("runAudioPlayGranulator: Invalid zsAudio lib");else if(t.isObject(e)){var i=null,o=null,r=null;ee(e.paramName)||(i=e.paramName),ee(e.endValue)||(o=e.endValue),ee(e.duration)||(r=e.duration),n.setGranulatorRampLinear(i,o,r)}}function ct(e){if(ee(n))ne("runAudioPlayGranulator: Invalid zsAudio lib");else if(t.isObject(e)){var i=null,o=null;ee(e.level)||(i=e.level),ee(e.timeMs)||(o=e.timeMs),n.setGranulatorGain(i,o)}}function dt(e){if(ee(n))ne("runAudioPlayGranulator: Invalid zsAudio lib");else if(t.isObject(e)){var i=null,o=null,r=null,a=null;ee(e.paramName)||(i=e.paramName),ee(e.amplitude)||(o=e.amplitude),ee(e.frequency)||(r=e.frequency),ee(e.duration)||(a=e.duration),n.setGranulatorRampSin(i,o,r,a)}}function ft(e){ee(n)?ne("runAudioPlayGranulator: Invalid zsAudio lib"):t.isObject(e)&&(n.setGranulatorConfig(e),n.initGranulator(Ie.granulatorIndex))}function ht(t){X(t.line1,t.line2,t.line3,t.colour,t.isVisible)}function pt(t){ie(t.count)&&Z(t.count),ie(t.maxCount)&&_(t.maxCount),xt()}function mt(t){nt(t)}function vt(t){ft(t)}function xt(){if(!ee(Ie.meter)){var t=Ie.userNo;t<=Me.meterMaxVotes&&(t=Me.meterMaxVotes),Ie.meter.set(Ie.voteCount,t)}}function bt(e){if(!ee(ye)){ye.innerHTML=ae;var i=Ie.instructions.l1,n=Me.textSpanPrefix+"1",o=Ie.instructions.l2,r=Me.textSpanPrefix+"2",a=Ie.instructions.l3,s=Me.textSpanPrefix+"3",l=ae;e||(e=ae,t.isEmptyString(i)||(l=yt(i,l),i=gt(i,n),e+=i),t.isEmptyString(o)||(oe("displayInstructions: processing line2 "+o),l=yt(o,l),o=gt(o,r),e=t.addSuffixIfNotThere(e,Me.textLineBreak),e+=o),t.isEmptyString(a)||(oe("displayInstructions: processing line3 "+a),l=yt(a,l),a=gt(a,s),e=t.addSuffixIfNotThere(e,Me.textLineBreak),e+=a));var u=Me.textFontSize,c=Wt(l,u,ye);ye.style.fontSize=ae+c+"px",ye.style.fontFamily=Me.textFontFamily,ye.innerHTML=e;var d=t.getChildElement(ye,t.toCssIdQuery(n));ee(d)||(d.style.opacity=0);var f=t.getChildElement(ye,t.toCssIdQuery(r));ee(f)||(f.style.opacity=0);var h=t.getChildElement(ye,t.toCssIdQuery(s));if(ee(h)||(h.style.opacity=0),Ie.instructions.isVisible=!0,wt(ye,Ie.instructions),Me.textSpanIsFadeIn){var p=Me.textSpanFadeTimeSec,m=Me.textSpanFadeStaggerTimeSec;ee(d)||gsap.to(d,{duration:p,autoAlpha:1,ease:"power1.in"}),ee(f)||gsap.to(f,{delay:m,duration:p,autoAlpha:1,ease:"power1.in"}),ee(h)||gsap.to(h,{delay:2*m,duration:p,autoAlpha:1,ease:"power1.in"})}else ee(d)||(d.style.opacity=1),ee(f)||(f.style.opacity=1),ee(h)||(h.style.opacity=1)}}function gt(e,i){for(;t.contains(e,pe);)e=t.replace(e,pe,me);return e=t.wrapInSpanElement(e,i),e}function yt(e,i){var n=t.removeMarkup(e);return n.length>i.length?n:i}function It(t){return Me.textFontType+se+t+"px "+Me.textFontFamily}function Mt(){ee(ye)||(ye.innerHTML=ae,Ie.instructions.isVisible=!1,wt(ye,Ie.instructions))}function wt(e,i){var n=At(i);ee(i.bckgCol)||(n.background=i.bckgCol),t.setElementStyleProperty(e,n)}function St(t,e){ee(t)||(e||h(),ie(t.actions)&&Tt(t.actions),ie(t.instructions)&&ht(t.instructions),ie(t.counter)&&pt(t.counter),ie(t.playerConfig)&&mt(t.playerConfig),ie(t.granulatorConfig)&&vt(t.granulatorConfig))}function At(t){return t.isVisible?Me.textStyleVisible:Me.textStyleInvisible}function Tt(e){var i=null,n=null,o=[],r={};if(t.isArray(e))for(var a=0;a<e.length;a++){var s=e[a];ie(s.id)&&(i=s.id),ie(s.actionType)&&(n=s.actionType),ie(s.elementIds)&&(o=s.elementIds),ie(s.params)&&(r=s.params),Ut(i,n,o,r)}}function Ut(t,e,i,n){if(oe("doAction: "+t+" actionType: "+e),!ee(e)&&!ee(i))switch(e){case"AUDIO":K(t,i,n);break;case"STOP":Ct(t,i,n);break;default:ne("doAction: Unknown actionType: "+e)}}function Ct(e,i,n){if(t.isArray(i))for(var o=0;o<i.length;o++)Dt(e,i[o],n);else Dt(e,i,n)}function Dt(e,i,n){if(t.isString(e))switch(oe("stop: actionId: "+e+se+i),e){case"stop":Gt(i,n);break;default:return void ne("Unknown stop actionId: "+e)}}function Gt(t,e){if(!ee(t))switch(oe("runStopAction: target: "+t),t){case"all":Et(e);break;case"player":Rt(e)}}function Et(t){oe("runStopAll: "),!ee(n)&&n.isReady()&&Rt(t)}function Rt(t){ee(n)?ne("runAudioStopPlayer: Invalid zsAudio lib"):n.stopPlayer()}function Nt(){return t.getElement(Me.instructionTxtElementId)}function kt(){return t.getElement(Me.meterGroupId)}function Pt(){return t.getElement(Me.thumbUpGroupId)}function Ft(){return t.getElement(Me.thumbUpRectId)}function Vt(){return t.getElement(Me.thumbDownRectId)}function zt(){return t.getElement(Me.thumbDownGroupId)}function Bt(){return Ie.thumbUpTween}function Ot(){return Ie.thumbDownTween}function Ht(){return Ie.noteUpTween}function Lt(){return Ie.noteDownTween}function Wt(t,e,i){var n=1;r.innerWidth||a.documentElement.clientWidth||a.body.clientWidth;var o=r.innerHeight||a.documentElement.clientHeight||a.body.clientHeight,s=(It(n),i.clientWidth),l=s*Me.textWidthCompressor,u=o*Me.textAreaMax;n=jt(t,e,l),n=Qt(s,n,u);var c=Me.textMaxFontSize;return n>c&&(n=c),n}function Qt(t,e,i){var n=It(e),o=e,r=Yt(n,t,i);if(r<0)return o;var a=r*Me.textNumberOfLines,s=i/a;return s<1&&(o*=s),o}function jt(t,e,i){var n=It(e),o=qt(n,t),r=o.width;if(r<=0||r>i||Math.abs(i-r)<1)return e;var a=i/r,s=e*a;return jt(t,s,i)}function qt(t,e){var i=Ie.fontCanvas,n=Ie.canvasCtx;return n.fillRect(0,0,i.width,i.height),n.textBaseline="top",n.fillStyle=ue,n.font=t,n.measureText(e)}function Yt(t,e,i){var n=Ie.fontCanvas,o=Ie.canvasCtx;n.width=e,n.height=i,o.fillRect(0,0,n.width,n.height),o.textBaseline="top",o.fillStyle=ue,o.font=t;var r="gM";o.fillText(r,0,0);for(var a=o.getImageData(0,0,n.width,n.height).data,s=-1,l=-1,u=0;u<n.height;u++)for(var c=0;c<n.width;c++){var d=4*(u*n.width+c);if(0!==a[d]){-1===s&&(s=u);break}if(c===n.width-1&&-1!==s){l=u,u=n.height;break}}var f=(l-s)*Me.textHeightCompressor;return f}function Xt(){if(oe("onThumbsUp:"),Ie.isThumbEnabled){if(H())return;t.setElementAttributes(Pt(),Me.filterInActiveAttrib),t.playOrRestartTween(Bt())}if(Ie.isNoteEnabled){if(W())return;t.playOrRestartTween(Ht()),U()}Ie.isVotingEnabled&&O(fe)}function Zt(){if(oe("onThumbsDown:"),Ie.isThumbEnabled){if(L())return;t.setElementAttributes(zt(),Me.filterInActiveAttrib),t.playOrRestartTween(Ot())}if(Ie.isNoteEnabled){if(Q())return;t.playOrRestartTween(Lt()),C()}Ie.isVotingEnabled&&O(he)}function _t(t){oe("onMouseUpThumbsUp:"),be||Xt()}function Jt(t){oe("onTouchEndThumbsUp:"),be&&Xt()}function Kt(t){oe("onMouseUpThumbsDown:"),be||Zt()}function $t(t){oe("onTouchEndThumbsDown:"),be&&Zt()}function te(e,i){t.setElementAttributes(e,i)}function ee(e){return t.isNull(e)}function ie(e){return t.isNotNull(e)}function ne(e){t.logError(e)}function oe(e){t.log(e)}const re="DEV",ae="",se=" ",le="Rect",ue="#FFFFFF",ce="VOTE",de="value",fe=1,he=-1,pe="&#39;",me="'";var ve=["/audio/DialogsRhythm7-1.wav"],xe=[[0]],be=null,ge=null,ye=null,Ie={bpm:80,instructions:{isVisible:!1,l1:ae,l2:ae,l3:ae,bckgCol:"rgba(225, 225, 225, 0.85)"},voteCount:0,userNo:10,meter:null,currentVote:null,voteTimeMs:0,thumbUpTween:null,thumbDownTween:null,noteUpTween:null,noteUpDurationSec:1,noteDownTween:null,noteDownDurationSec:1,isVotingEnabled:!1,isThumbEnabled:!1,isNoteEnabled:!0,granulatorIndex:0},Me={connectionPreference:"ws,sse,poll",appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",textSpanPrefix:"is",instructionTxtElementId:"instructionTxt",textLineBreak:"<br/>",textStyleInvisible:{visibility:"hidden"},textStyleVisible:{visibility:"visible"},textFontFamily:"Arial",textFontType:"normal",textFontSize:50,textMaxFontSize:70,textMaxLineLen:30,textHeightCompressor:1.1,textWidthCompressor:.9,textAreaMax:.4,textNumberOfLines:3,textSpanIsFadeIn:!0,textSpanFadeTimeSec:1,textSpanFadeStaggerTimeSec:.5,voteTimeoutMs:5e3,noteDurationMultipler:4,loadingIconId:"loadingIcon",elementGroupSuffix:"Grp",meterGroupId:"meterGrp",thumbUpRectId:"thUpRect",thumbDownRectId:"thDownRect",thumbUpGroupId:"thumbUpGrp",thumbUpPathId:"thumbUpPth",thumbUpSymId:"thumbUpSym",thumbDownGroupId:"thumbDownGrp",thumbDownPathId:"thumbDownPth",thumbDownSymId:"thumbDownSym",noteUpGroupId:"noteUpGrp",noteUpSymId:"noteUpSym",noteDownGroupId:"noteDownGrp",noteDownSymId:"noteDownSym",meterBoxIdPrefix:"meterBox",meterBoxNo:20,meterMaxVotes:5,meterInactiveStyle:{fill:"none",stroke:"black","stroke-width":"4px"},meterZeroStyle:{fill:"yellow"},thumbsUpActiveStyle:{fill:"green"},thumbsUpInActiveStyle:{fill:"none"},thumbsDownActiveStyle:{fill:"red"},thumbsDownInActiveStyle:{fill:"none"},centreX:450,centreY:800,meterBoxWidth:80,meterBoxHeight:40,negativeMinCol:{r:255,g:165,b:0},negativeMaxCol:{r:255,g:0,b:0},positiveMinCol:{r:255,g:255,b:0},positiveMaxCol:{r:0,g:125,b:0},maxNoiseLevel:.5,audioFadeInMs:1e3,filterGreenAttrib:{filter:"url(#dropshadowgreen)"},filterRedAttrib:{filter:"url(#dropshadowred)"},filterInActiveAttrib:{filter:"none"},noteUpConfig:{minAngle:0,maxAngle:360},noteDurations:[o.DURATION.MINIM,o.DURATION.CROTCHET,o.DURATION.QUAVER,o.DURATION.SEMI_QUAVER],noteSymbolsUp:["minimUp","crotchetUp","quaverUp","semiquaverUp"],noteSymbolsDown:["minimDown","crotchetDown","quaverDown","semiquaverDown"]};return l.prototype.init=function(){if(!ee(this.styleConfig)&&t.isNumeric(this.boxNo)&&t.isNumeric(this.midX)&&t.isNumeric(this.midY)){var e=t.isOddNumber(this.boxNo),i=Math.round(this.boxNo/2);this.positiveMaxIndex=this.boxNo-1,this.positiveMinIndex=i,this.negativeMinIndex=i-1,this.negativeMaxIndex=0,this.zeroIndex=null;var n=this.midY+i*this.boxHeight;e&&(this.negativeMinIndex=i-2,this.zeroIndex=i-1,n=this.midY+this.boxHeight/2+this.zeroIndex*this.boxHeight);for(var o=n,r=this.midX-this.boxWidth/2,a=0;a<this.boxNo;++a){var s=this.boxIdPrefix+a,l=this.boxSvgIdPrefix+a,u=o-this.boxHeight,d=this.getActiveStyle(a),f=new c(s,l,r,u,this.boxWidth,this.boxHeight,this.styleConfig.inactiveStyle,d);this.boxes[a]=f,o=u}this.draw(),this.isInitialised=!0}else ne("ZScoreMeter.init: invalid inputs")},l.prototype.getActiveStyle=function(e){var i="yellow";if(!ee(this.zeroIndex)&&e===this.zeroIndex)return this.styleConfig.zeroStyle;if(e>=this.positiveMinIndex&&e<=this.positiveMaxIndex){var n=0;this.positiveMaxIndex!=this.positiveMinIndex&&(n=(e-this.positiveMinIndex)/(this.positiveMaxIndex-this.positiveMinIndex));var o=t.interpolateRgbColours(this.styleConfig.posMinRGB,this.styleConfig.posMaxRGB,n);ee(o)||(i=t.rgbToHex(o.r,o.g,o.b))}else if(e>=this.negativeMaxIndex&&e<=this.negativeMinIndex){n=0;this.negativeMinIndex!=this.negativeMaxIndex&&(n=(this.negativeMinIndex-e)/(this.negativeMinIndex-this.negativeMaxIndex));o=t.interpolateRgbColours(this.styleConfig.negMinRGB,this.styleConfig.negMaxRGB,n);ee(o)||(i=t.rgbToHex(o.r,o.g,o.b))}return{fill:i}},l.prototype.clear=function(){for(var t=0;t<this.boxes.length;++t)this.setBoxStyle(t,this.styleConfig.inactiveStyle)},l.prototype.draw=function(){for(var t=0;t<this.boxes.length;++t)this.boxes[t].draw()},l.prototype.setPlayAudio=function(t){this.isPlayAudio=t},l.prototype.set=function(e,i){if(t.isNumeric(e)&&t.isNumeric(i))if(this.clear(),ee(this.zeroIndex)||this.activateBox(this.zeroIndex,!0),e>0){i<0&&(i*=-1);var n=1,o=i;o<n&&(o=n),e>o&&(e=o);for(var r=Math.floor(t.mapRange(e,n,o,this.positiveMinIndex,this.positiveMaxIndex)),a=this.positiveMinIndex;a<=r;a++)this.activateBox(a,!0);this.currentValue=e,this.currentMaxVal=o,this.playAudio(e,o)}else{i>0&&(i*=-1);n=-1,o=i;o>n&&(o=n),e<o&&(e=o);for(r=Math.ceil(t.mapRange(e,n,o,this.negativeMinIndex,this.negativeMaxIndex)),a=this.negativeMinIndex;a>=r;a--)this.activateBox(a,!0);this.currentValue=e,this.currentMaxVal=o,this.playAudio(e,o)}},l.prototype.activateBox=function(t,e){var i=this.boxes[t];ee(i)||i.setActive(e)},l.prototype.setBoxStyle=function(t,e){var i=this.boxes[t];ee(i)||i.setStyle(e)},l.prototype.playAudio=function(e,i){if(this.isPlayAudio){if(0===e)return n.playNoise(0),void n.setPlayerVolume(0,500);if(e>0){n.playNoise(0);var o=t.mapRange(Math.abs(e),0,Math.abs(i),0,1);n.setPlayerVolume(o,Me.audioFadeInMs)}else{n.setPlayerVolume(0,Me.audioFadeInMs);o=t.mapRange(Math.abs(e),0,Math.abs(i),0,Me.maxNoiseLevel);n.playNoise(o)}}},c.prototype.draw=function(){var e=kt();if(!ee(e)){var n=i.createSvgRectangle(this.x,this.y,this.width,this.height,this.svgId);te(n,this.inactiveStyle),t.addChildToParent(e,n)}},c.prototype.setStyle=function(e){var i=t.getElement(this.svgId);ee(i)||te(i,e)},c.prototype.setActive=function(e){var i=t.getElement(this.svgId);ee(i)||te(i,e?this.activeStyle:this.inactiveStyle)},{load:function(){d()},onThumbsDownSelect:function(){Zt()},onThumbsUpSelect:function(){Xt()}}}(zsUtil,zsNet,zsSvg,zsAudio,zsMusic,window,document);