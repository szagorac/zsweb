var zscore=function(t,e,i,n,o,s){"use strict";function r(t){this.message=t,this.name="ZScoreException"}function a(t,e,i,n,o,s,r){this.boxNo=t,this.midX=e,this.midY=i,this.boxWidth=n,this.boxHeight=o,this.boxIdPrefix=s,this.styleConfig=r,this.boxSvgIdPrefix=s+ut,this.boxes=[],this.isInitialised=!1,this.positiveMinIndex=0,this.positiveMaxIndex=0,this.negativeMinIndex=0,this.negativeMaxIndex=0,this.zeroIndex=null}function l(t,e,i,n,o,s){this.inactiveStyle=t,this.zeroStyle=e,this.negMinRGB=i,this.negMaxRGB=n,this.posMinRGB=o,this.posMaxRGB=s}function h(t,e,i,n,o,s,r,a){this.id=t,this.svgId=e,this.x=i,this.y=n,this.width=o,this.height=s,this.inactiveStyle=r,this.activeStyle=a}function u(){rt("onLoad: "),c()}function c(){if(!(t&&e&&i&&n))throw new r("Invalid libraries. Required: zsUtil, zsNet, zsSvg and zsAudio");t.setRunMode(at),rt("init: "),mt=t.isTouchDevice(),gt=t.isSafari(navigator),rt("init: IsTouch Device: "+mt+" isSafari: "+gt),yt.fontCanvas=s.createElement("canvas"),yt.canvasCtx=yt.fontCanvas.getContext("2d"),d(),m(),v(),b(),y(),p()}function x(){f()}function d(){e.init(It.connectionPreference,It.appUrlSse,It.appUrlWebsockets,It.appUrlHttp,D)}function p(){e.getServerState()}function v(){nt(n)?st("initAudio: invalid zsAudio lib"):n.init(ft,0)}function f(){nt(n)?st("resetAudio: invalid zsAudio lib"):n.reset()}function m(){i.init(),g()}function g(){var e=L();ot(e)&&(t.listen("touchend",e,_),t.listen("mouseup",e,$));var i=Y();ot(i)&&(t.listen("touchend",i,et),t.listen("mouseup",i,tt))}function b(){var t=new l(It.meterInactiveStyle,It.meterZeroStyle,It.negativeMinCol,It.negativeMaxCol,It.positiveMinCol,It.positiveMaxCol),e=new a(It.meterBoxNo,It.centreX,It.centreY,It.meterBoxWidth,It.meterBoxHeight,It.meterBoxIdPrefix,t);e.init(),yt.meter=e}function y(){var e=G();nt(e)||(bt=e,t.listen("resize",o,T),t.listen("orientationchange",o,T),w("Welcome to","<span style='color:blueviolet;'>ZScore</span>","awaiting performance start ...",null,!0))}function I(t){var i={};i[dt]=t,e.sendEvent(xt,i)}function S(t){var e=V();nt(e)||it(e,t?It.thumbsUpActiveStyle:It.thumbsUpInActiveStyle)}function M(t){var e=O();nt(e)||it(e,t?It.thumbsDownActiveStyle:It.thumbsDownInActiveStyle)}function w(t,e,i,n,o){if(!nt(bt)){var s=!1;if(!nt(t)){var r=t.trim();yt.instructions.l1!=r&&(yt.instructions.l1=r,s=!0)}if(!nt(e)){r=e.trim();yt.instructions.l2!=r&&(yt.instructions.l2=r,s=!0)}if(!nt(i)){r=i.trim();yt.instructions.l3!=r&&(yt.instructions.l3=r,s=!0)}nt(n)||(yt.instructions.bckgCol=n),o?s&&z():N()}}function C(e){nt(e)||(t.isNumeric(e)||(e=t.toInt(e)),yt.voteCount=e)}function T(e){if(!t.isObject(this))return null;z()}function E(t){w(t.line1,t.line2,t.line3,t.colour,t.isVisible)}function A(t){ot(t.count)&&C(t.count),B()}function B(){nt(yt.meter)||yt.meter.set(yt.voteCount,10)}function z(e){if(!nt(bt)){bt.innerHTML=lt;var i=yt.instructions.l1,n=It.textSpanPrefix+"1",o=yt.instructions.l2,s=It.textSpanPrefix+"2",r=yt.instructions.l3,a=It.textSpanPrefix+"3",l=lt;e||(e=lt,t.isEmptyString(i)||(l=U(i,l),i=t.wrapInSpanElement(i,n),e+=i),t.isEmptyString(o)||(rt("displayInstructions: processing line2 "+o),l=U(o,l),o=t.wrapInSpanElement(o,s),e=t.addSuffixIfNotThere(e,It.textLineBreak),e+=o),t.isEmptyString(r)||(rt("displayInstructions: processing line3 "+r),l=U(r,l),r=t.wrapInSpanElement(r,a),e=t.addSuffixIfNotThere(e,It.textLineBreak),e+=r));var h=It.textFontSize,u=X(l,h,bt);bt.style.fontSize=lt+u+"px",bt.style.fontFamily=It.textFontFamily,bt.innerHTML=e;var c=t.getChildElement(bt,t.toCssIdQuery(n));nt(c)||(c.style.opacity=0);var x=t.getChildElement(bt,t.toCssIdQuery(s));nt(x)||(x.style.opacity=0);var d=t.getChildElement(bt,t.toCssIdQuery(a));if(nt(d)||(d.style.opacity=0),yt.instructions.isVisible=!0,R(bt,yt.instructions),It.textSpanIsFadeIn){var p=It.textSpanFadeTimeSec,v=It.textSpanFadeStaggerTimeSec;nt(c)||gsap.to(c,{duration:p,autoAlpha:1,ease:"power1.in"}),nt(x)||gsap.to(x,{delay:v,duration:p,autoAlpha:1,ease:"power1.in"}),nt(d)||gsap.to(d,{delay:2*v,duration:p,autoAlpha:1,ease:"power1.in"})}else nt(c)||(c.style.opacity=1),nt(x)||(x.style.opacity=1),nt(d)||(d.style.opacity=1)}}function U(e,i){var n=t.removeMarkup(e);return n.length>i.length?n:i}function F(t){return It.textFontType+ht+t+"px "+It.textFontFamily}function N(){nt(bt)||(bt.innerHTML=lt,yt.instructions.isVisible=!1,R(bt,yt.instructions))}function R(e,i){var n=H(i);nt(i.bckgCol)||(n.background=i.bckgCol),t.setElementStyleProperty(e,n)}function D(t,e){nt(t)||(e||x(),ot(t.actions)&&P(t.actions),ot(t.instructions)&&E(t.instructions),ot(t.counter)&&A(t.counter))}function H(t){return t.isVisible?It.textStyleVisible:It.textStyleInvisible}function P(e){var i=null,n=null,o=[],s={};if(t.isArray(e))for(var r=0;r<e.length;r++){var a=e[r];ot(a.id)&&(i=a.id),ot(a.actionType)&&(n=a.actionType),ot(a.elementIds)&&(o=a.elementIds),ot(a.params)&&(s=a.params),k(i,n,o,s)}}function k(t,e,i,n){rt("doAction: "+t+" actionType: "+e),nt(e)||nt(i)||st("doAction: Unknown actionType: "+e)}function G(){return t.getElement(It.instructionTxtElementId)}function W(){return t.getElement(It.meterGroupId)}function L(){return t.getElement(It.thumbUpRectId)}function V(){return t.getElement(It.thumbUpPathId)}function Y(){return t.getElement(It.thumbDownRectId)}function O(){return t.getElement(It.thumbDownPathId)}function X(t,e,i){var n=1;o.innerWidth||s.documentElement.clientWidth||s.body.clientWidth;var r=o.innerHeight||s.documentElement.clientHeight||s.body.clientHeight,a=(F(n),i.clientWidth),l=a*It.textWidthCompressor,h=r*It.textAreaMax;n=Q(t,e,l),n=Z(a,n,h);var u=It.textMaxFontSize;return n>u&&(n=u),n}function Z(t,e,i){var n=F(e),o=e,s=q(n,t,i);if(s<0)return o;var r=s*It.textNumberOfLines,a=i/r;return a<1&&(o*=a),o}function Q(t,e,i){var n=F(e),o=j(n,t),s=o.width;if(s<=0||s>i||Math.abs(i-s)<1)return e;var r=i/s,a=e*r;return Q(t,a,i)}function j(t,e){var i=yt.fontCanvas,n=yt.canvasCtx;return n.fillRect(0,0,i.width,i.height),n.textBaseline="top",n.fillStyle=ct,n.font=t,n.measureText(e)}function q(t,e,i){var n=yt.fontCanvas,o=yt.canvasCtx;n.width=e,n.height=i,o.fillRect(0,0,n.width,n.height),o.textBaseline="top",o.fillStyle=ct,o.font=t;var s="gM";o.fillText(s,0,0);for(var r=o.getImageData(0,0,n.width,n.height).data,a=-1,l=-1,h=0;h<n.height;h++)for(var u=0;u<n.width;u++){var c=4*(h*n.width+u);if(0!==r[c]){-1===a&&(a=h);break}if(u===n.width-1&&-1!==a){l=h,h=n.height;break}}var x=(l-a)*It.textHeightCompressor;return x}function J(){rt("onThumbsUp:"),S(!0),M(!1),I(pt)}function K(){rt("onThumbsDown:"),S(!1),M(!0),I(vt)}function $(t){rt("onMouseUpThumbsUp:"),mt||J()}function _(t){rt("onTouchEndThumbsUp:"),mt&&J()}function tt(t){rt("onMouseUpThumbsDown:"),mt||K()}function et(t){rt("onTouchEndThumbsDown:"),mt&&K()}function it(e,i){t.setElementAttributes(e,i)}function nt(e){return t.isNull(e)}function ot(e){return t.isNotNull(e)}function st(e){t.logError(e)}function rt(e){t.log(e)}const at="DEV",lt="",ht=" ",ut="Rect",ct="#FFFFFF",xt="VOTE",dt="value",pt=1,vt=-1;var ft=["/audio/violin-tuning.mp3"],mt=null,gt=null,bt=null,yt={instructions:{isVisible:!1,l1:lt,l2:lt,l3:lt,bckgCol:"rgba(225, 225, 225, 0.85)"},voteCount:0,meter:null},It={connectionPreference:"ws,sse,poll",appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",textSpanPrefix:"is",instructionTxtElementId:"instructionTxt",textLineBreak:"<br/>",textStyleInvisible:{visibility:"hidden"},textStyleVisible:{visibility:"visible"},textFontFamily:"Arial",textFontType:"normal",textFontSize:50,textMaxFontSize:70,textMaxLineLen:30,textHeightCompressor:1.1,textWidthCompressor:.9,textAreaMax:.4,textNumberOfLines:3,textSpanIsFadeIn:!0,textSpanFadeTimeSec:1,textSpanFadeStaggerTimeSec:.5,elementGroupSuffix:"Grp",meterGroupId:"meterGrp",thumbUpRectId:"thUpRect",thumbDownRectId:"thDownRect",thumbUpGroupId:"thumbUpGrp",thumbUpPathId:"thumbUpPth",thumbDownGroupId:"thumbDownGrp",thumbDownPathId:"thumbDownPth",meterBoxIdPrefix:"meterBox",meterBoxNo:20,meterInactiveStyle:{fill:"none",stroke:"black","stroke-width":"4px"},meterZeroStyle:{fill:"yellow"},thumbsUpActiveStyle:{fill:"green"},thumbsUpInActiveStyle:{fill:"none"},thumbsDownActiveStyle:{fill:"red"},thumbsDownInActiveStyle:{fill:"none"},centreX:450,centreY:800,meterBoxWidth:80,meterBoxHeight:40,negativeMinCol:{r:255,g:165,b:0},negativeMaxCol:{r:255,g:0,b:0},positiveMinCol:{r:255,g:255,b:0},positiveMaxCol:{r:0,g:125,b:0}};return a.prototype.init=function(){if(!nt(this.styleConfig)&&t.isNumeric(this.boxNo)&&t.isNumeric(this.midX)&&t.isNumeric(this.midY)){var e=t.isOddNumber(this.boxNo),i=Math.round(this.boxNo/2);this.positiveMaxIndex=this.boxNo-1,this.positiveMinIndex=i,this.negativeMinIndex=i-1,this.negativeMaxIndex=0,this.zeroIndex=null;var n=this.midY+i*this.boxHeight;e&&(this.negativeMinIndex=i-2,this.zeroIndex=i-1,n=this.midY+this.boxHeight/2+this.zeroIndex*this.boxHeight);for(var o=n,s=this.midX-this.boxWidth/2,r=0;r<this.boxNo;++r){var a=this.boxIdPrefix+r,l=this.boxSvgIdPrefix+r,u=o-this.boxHeight,c=this.getActiveStyle(r),x=new h(a,l,s,u,this.boxWidth,this.boxHeight,this.styleConfig.inactiveStyle,c);this.boxes[r]=x,o=u}this.draw(),this.isInitialised=!0}else st("ZScoreMeter.init: invalid inputs")},a.prototype.getActiveStyle=function(e){var i="yellow";if(!nt(this.zeroIndex)&&e===this.zeroIndex)return this.styleConfig.zeroStyle;if(e>=this.positiveMinIndex&&e<=this.positiveMaxIndex){var n=0;this.positiveMaxIndex!=this.positiveMinIndex&&(n=(e-this.positiveMinIndex)/(this.positiveMaxIndex-this.positiveMinIndex));var o=t.interpolateRgbColours(this.styleConfig.posMinRGB,this.styleConfig.posMaxRGB,n);nt(o)||(i=t.rgbToHex(o.r,o.g,o.b))}else if(e>=this.negativeMaxIndex&&e<=this.negativeMinIndex){n=0;this.negativeMinIndex!=this.negativeMaxIndex&&(n=(this.negativeMinIndex-e)/(this.negativeMinIndex-this.negativeMaxIndex));o=t.interpolateRgbColours(this.styleConfig.negMinRGB,this.styleConfig.negMaxRGB,n);nt(o)||(i=t.rgbToHex(o.r,o.g,o.b))}return{fill:i}},a.prototype.clear=function(){for(var t=0;t<this.boxes.length;++t)this.setBoxStyle(t,this.styleConfig.inactiveStyle)},a.prototype.draw=function(){for(var t=0;t<this.boxes.length;++t)this.boxes[t].draw()},a.prototype.set=function(e,i){if(t.isNumeric(e)&&t.isNumeric(i))if(this.clear(),nt(this.zeroIndex)||this.activateBox(this.zeroIndex,!0),e>0){i<0&&(i*=-1);var n=1,o=i;o<n&&(o=n),e>o&&(e=o);for(var s=Math.floor(t.mapRange(e,n,o,this.positiveMinIndex,this.positiveMaxIndex)),r=this.positiveMinIndex;r<=s;r++)this.activateBox(r,!0)}else{i>0&&(i*=-1);n=-1,o=i;o>n&&(o=n),e<o&&(e=o);for(s=Math.ceil(t.mapRange(e,n,o,this.negativeMinIndex,this.negativeMaxIndex)),r=this.negativeMinIndex;r>=s;r--)this.activateBox(r,!0)}},a.prototype.activateBox=function(t,e){var i=this.boxes[t];nt(i)||i.setActive(e)},a.prototype.setBoxStyle=function(t,e){var i=this.boxes[t];nt(i)||i.setStyle(e)},h.prototype.draw=function(){var e=W();if(!nt(e)){var n=i.createSvgRectangle(this.x,this.y,this.width,this.height,this.svgId);it(n,this.inactiveStyle),t.addChildToParent(e,n)}},h.prototype.setStyle=function(e){var i=t.getElement(this.svgId);nt(i)||it(i,e)},h.prototype.setActive=function(e){var i=t.getElement(this.svgId);nt(i)||it(i,e?this.activeStyle:this.inactiveStyle)},{load:function(){u()},onThumbsDownSelect:function(){K()},onThumbsUpSelect:function(){J()}}}(zsUtil,zsNet,zsSvg,zsAudio,window,document);