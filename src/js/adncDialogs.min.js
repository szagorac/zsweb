var zscore=function(t,e,n,i,o,r,a,s){"use strict";function u(t){this.message=t,this.name="ZScoreException"}function l(t,e,n,i,o,r,a){this.boxNo=t,this.midX=e,this.midY=n,this.boxWidth=i,this.boxHeight=o,this.boxIdPrefix=r,this.styleConfig=a,this.boxSvgIdPrefix=r+Le,this.boxes=[],this.isInitialised=!1,this.positiveMinIndex=0,this.positiveMaxIndex=0,this.negativeMinIndex=0,this.negativeMaxIndex=0,this.zeroIndex=null,this.isPlayAudio=!1,this.currentValue=0,this.currentMaxVal=0}function c(t,e,n,i,o,r){this.inactiveStyle=t,this.zeroStyle=e,this.negMinRGB=n,this.negMaxRGB=i,this.posMinRGB=o,this.posMaxRGB=r}function d(t,e,n,i,o,r,a,s){this.id=t,this.svgId=e,this.x=n,this.y=i,this.width=o,this.height=r,this.inactiveStyle=a,this.activeStyle=s}function f(){qe("onLoad: "),h()}function h(){if(!(t&&e&&n&&i&&o&&r))throw new u("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio, zsSynth and zsMusic");t.setRunMode(Oe),qe("init: "),an=t.isTouchDevice(),sn=t.isSafari(navigator),qe("init: IsTouch Device: "+an+" isSafari: "+sn),ln.fontCanvas=s.createElement("canvas"),ln.canvasCtx=ln.fontCanvas.getContext("2d"),v(),I(),y(),S(),A(),M(),D(),p(),b()}function m(){x()}function p(){wt(),Mt(),Tt()}function v(){e.init(cn.connectionPreference,cn.appUrlSse,cn.appUrlWebsockets,cn.appUrlHttp,re)}function b(){e.getServerState()}function g(){i.initNoise(),i.initPlayer(),i.initSynth(),i.initGranulator(ln.granulatorIndex),t.makeInVisible(cn.loadingIconId),qe("onAudioLoaded: completed")}function y(){qe("initAudio: #####"),Ge(i)?Be("initAudio: invalid zsAudio lib"):i.init(on,g)}function x(){Ge(i)?Be("resetAudio: invalid zsAudio lib"):i.reset()}function I(){n.init(),w()}function w(){var e=ge();ze(e)&&(t.listen("touchend",e,Ve),t.listen("mouseup",e,Ee));var n=ye();ze(n)&&(t.listen("touchend",n,Re),t.listen("mouseup",n,Ne))}function S(){var t=new c(cn.meterInactiveStyle,cn.meterZeroStyle,cn.negativeMinCol,cn.negativeMaxCol,cn.positiveMinCol,cn.positiveMaxCol),e=new l(cn.meterBoxNo,cn.centreX,cn.centreY,cn.meterBoxWidth,cn.meterBoxHeight,cn.meterBoxIdPrefix,t);e.init(),ln.meter=e}function A(){var e=pe();Ge(e)||(un=e,t.listen("resize",a,et),t.listen("orientationchange",a,et),K("Welcome to","<span style='color:blueviolet;'>ZScore</span>","awaiting performance start ...",null,!0))}function M(){var e=cn.voteTimeoutMs/1e3;ln.thumbUpTween=gsap.from(t.toCssIdQuery(cn.thumbUpSymId),{duration:e,scaleY:.5,fill:"green",transformOrigin:"right bottom",paused:!0,ease:"slow(0.9, 0.4, false)",onComplete:B}),ln.thumbUpTween.progress(1),ln.thumbDownTween=gsap.from(t.toCssIdQuery(cn.thumbDownSymId),{duration:e,scaleY:.5,fill:"red",transformOrigin:"left top",paused:!0,ease:"slow(0.9, 0.4, false)",onComplete:q}),ln.thumbDownTween.progress(1)}function D(){T(),U()}function T(){var e=t.getRandomIntFromRange(0,cn.noteDurations.length-1),n=cn.noteDurations[e],i=t.toCssIdQuery(cn.noteSymbolsUp[e]),o=t.getElement(cn.noteUpSymId);o.setAttribute("href",i),o.setAttribute("xlink:href",i);var r=R()*cn.noteDurationMultipler;ln.noteUpDurationSec=n*r,ln.noteUpTween=P()}function U(){var e=t.getRandomIntFromRange(0,cn.noteDurations.length-1),n=cn.noteDurations[e],i=t.toCssIdQuery(cn.noteSymbolsDown[e]),o=t.getElement(cn.noteDownSymId);o.setAttribute("href",i),o.setAttribute("xlink:href",i);var r=R()*cn.noteDurationMultipler;ln.noteDownDurationSec=n*r,ln.noteDownTween=G()}function C(e,n){ln.meterAudioValue;if(ln.meterAudioValue=e,ln.isAudioEnabled){if(0===e)return i.stopNoise(),void i.setPlayerVolume(0,500);if(e>0){i.stopNoise();var o=t.mapRange(Math.abs(e),0,Math.abs(n),0,1);i.setPlayerVolume(o,cn.audioFadeInMs)}else{var r=Math.abs(e);r>10?r=10:r<1&&(r=1),i.setPlayerVolume(0,cn.audioFadeInMs);o=t.mapRange(Math.abs(e),0,Math.abs(n),.5,cn.maxNoiseLevel);var a=0,s=ln.noiseFreqs.length-1;r<4?s=Math.floor(s/3):r>3&&r<7?(a=Math.floor(s/3),s=Math.floor(2*s/3)):r>6&&(a=Math.floor(s/2));var u=t.getRandomIntFromRange(a,s),l=ln.noiseFreqs[u];i.setNoiseFilterFreq(l),ln.noiseFreq=l;var c=cn.noiseFilterQSteps[r-1];ln.noiseQ=c,i.setNoiseFilterQ(c),i.playNoise(o)}}}function F(){E()}function k(){V()}function E(){var e=t.getRandomIntFromRange(0,ln.noteUpFreq.length-1),n=ln.noteUpFreq[e];qe("playing freq: "+n),i.playSynth(n,ln.noteUpDurationSec)}function V(){var e=t.getRandomIntFromRange(0,ln.noteDownFreq.length-1),n=ln.noteDownFreq[e];qe("playing freq: "+n),i.playSynth(n,ln.noteDownDurationSec)}function N(){var t=o.getBeatDurationSec(ln.synthBpm);return Ge(t)&&(t=1),t}function R(){var t=N();return 4*t}function P(){var t=ln.noteUpDurationSec,e={sign:-1,angleMin:0,angleMax:120,rMin:10,rMax:30,rotAngleMin:-360,rotAngleMax:360,xmod:20,ymod:30};return z(t,cn.noteUpSymId,e,O)}function G(){var t=ln.noteDownDurationSec,e={sign:1,angleMin:0,angleMax:120,rMin:20,rMax:40,rotAngleMin:-360,rotAngleMax:360,xmod:0,ymod:0};return z(t,cn.noteDownSymId,e,H)}function z(e,n,i,o){var r=t.randomIntFromInterval(i.angleMin,i.angleMax),a=t.randomIntFromInterval(i.rMin,i.rMax),s=0,u=i.sign,l=u*a;if(r<90){var c=t.toRadians(r);s=u*a*Math.cos(c),l=u*a*Math.sin(c)}else if(r>90){c=t.toRadians(180-r);s=-1*u*a*Math.cos(c),l=u*a*Math.sin(c)}s+=i.xmod,l+=i.ymod;var d=t.randomIntFromInterval(i.rotAngleMin,i.rotAngleMax);return gsap.to(t.toCssIdQuery(n),{duration:e,scale:.1,autoAlpha:0,rotation:d,x:s,y:l,ease:"slow(0.9, 0.4, false)",paused:!0,onComplete:o})}function B(){t.setElementAttributes(be(),cn.filterGreenAttrib)}function q(){t.setElementAttributes(xe(),cn.filterRedAttrib)}function O(){Q(cn.noteUpSymId),T(),L(cn.noteUpSymId),L(cn.noteDownSymId)}function H(){Q(cn.noteDownSymId),U(),L(cn.noteDownSymId),L(cn.noteUpSymId)}function Q(e){gsap.set(t.toCssIdQuery(e),{autoAlpha:0,scale:1,rotation:0,x:0,y:0})}function L(e){Ge(e)||gsap.to(t.toCssIdQuery(e),{duration:1,autoAlpha:1})}function W(e){Ge(e)||gsap.to(t.toCssIdQuery(e),{duration:1,autoAlpha:0,onComplete:j,onCompleteParams:[e]})}function j(e){t.makeInVisible(e)}function Y(t){ln.currentVote=t;var n={};n[Ye]=t,e.sendEvent(je,n)}function X(){return ze(ln.thumbUpTween)&&ln.thumbUpTween.isActive()}function Z(){return ze(ln.thumbDownTween)&&ln.thumbDownTween.isActive()}function _(){return ze(ln.noteUpTween)&&ln.noteUpTween.isActive()}function J(){return ze(ln.noteDownTween)&&ln.noteDownTween.isActive()}function K(t,e,n,i,o){if(!Ge(un)){var r=!1;if(!Ge(t)){var a=t.trim();ln.instructions.l1!=a&&(ln.instructions.l1=a,r=!0)}if(!Ge(e)){a=e.trim();ln.instructions.l2!=a&&(ln.instructions.l2=a,r=!0)}if(!Ge(n)){a=n.trim();ln.instructions.l3!=a&&(ln.instructions.l3=a,r=!0)}Ge(i)||(ln.instructions.bckgCol=i),o?r&&$t():ie()}}function $(e){Ge(e)||(t.isNumeric(e)||(e=t.toInt(e)),ln.voteCount=e)}function tt(e){Ge(e)||(t.isNumeric(e)||(e=t.toInt(e)),ln.userNo=e)}function et(e){if(!t.isObject(this))return null;$t()}function nt(e,n,i){if(t.isArray(n))for(var o=0;o<n.length;o++)it(e,n[o],i);else it(e,n,i)}function it(t,e,n){if(!Ge(e))switch(qe("runActivate: "+t+Qe+e),e){case"view":ot(t,n)}}function ot(e,n){if(t.isString(e))switch(e){case"section":rt(n);break;default:return void Be("activateView: Unknown actionId: "+e)}}function rt(e){if(t.isObject(e)){var n=null;Ge(e.id)||(n=e.id),dt(n)}}function at(e){if(!Ge(e)){var n=null,i=!1;if(ze(e.isSectionActive)&&(i=e.isSectionActive),ze(e.sectionName)&&(n=e.sectionName),st(n,i),ze(e.activeViews)){for(var o=[],r=0;r<cn.availableViews.length;r++)t.arrContains(e.activeViews,cn.availableViews[r])||o.push(cn.availableViews[r]);ut(o),lt(e.activeViews)}}}function st(t,e){ln.currentSection=t,ln.isSectionActive=e}function ut(t){for(var e=0;e<t.length;e++)ct(t[e])}function lt(t){for(var e=0;e<t.length;e++)ot(t[e])}function ct(t){switch(t){case Ke:gt();break;case $e:bt();break;case tn:yt();break;case en:xt();break;case nn:It();break;default:qe("deactivateView: unknown view: "+t)}}function ot(t){switch(t){case Ke:ht();break;case $e:ft();break;case tn:mt();break;case en:pt();break;case nn:vt();break;default:qe("activateView: unknown view: "+t)}}function dt(t){}function ft(){Dt()}function ht(){At()}function mt(){Ut()}function pt(){wt()}function vt(){ln.isAudioEnabled=!0,ze(ln.meter)&&ln.meter.setPlayAudio(!0)}function bt(){Tt()}function gt(){Mt()}function yt(){Ct()}function xt(){St()}function It(){ln.isAudioEnabled=!1,ze(ln.meter)&&ln.meter.setPlayAudio(!1),fe()}function wt(){ln.isVotingEnabled=!0}function St(){ln.isVotingEnabled=!1}function At(){t.makeVisible(cn.thumbUpGroupId),t.makeVisible(cn.thumbDownGroupId),L(cn.thumbUpSymId),L(cn.thumbDownSymId),ln.isThumbEnabled=!0}function Mt(){W(cn.thumbUpSymId),W(cn.thumbDownSymId),ln.isThumbEnabled=!1}function Dt(){t.makeVisible(cn.noteUpGroupId),t.makeVisible(cn.noteDownGroupId),L(cn.noteUpSymId),L(cn.noteDownSymId),ln.isNoteEnabled=!0}function Tt(){W(cn.noteUpSymId),W(cn.noteDownSymId),ln.isNoteEnabled=!1}function Ut(){t.makeVisible(cn.meterGroupId),L(cn.meterGroupId)}function Ct(){W(cn.meterGroupId)}function Ft(e,n,i){if(t.isArray(n))for(var o=0;o<n.length;o++)kt(e,n[o],i);else kt(e,n,i)}function kt(t,e,n){if(!Ge(e))switch(qe("runAudio: "+t+Qe+e),e){case"all":Et(t,n);break;case"player":Nt(t,n);break;case"granulator":Bt(t,n)}}function Et(e,n){if(t.isString(e))switch(e){case"volume":Vt(n);break;default:return void Be("runPlayer: Unknown actionId: "+e)}}function Vt(e){if(Ge(i))Be("setAudioMasterVolume: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null;Ge(e.level)||(n=e.level),Ge(e.timeMs)||(o=e.timeMs),i.setMasterVolume(n,o)}}function Nt(e,n){if(t.isString(e))switch(e){case"play":Gt(n);break;case"volume":zt(n);break;case"config":Pt(n);break;default:return void Be("runPlayer: Unknown actionId: "+e)}}function Rt(e){if(Ge(i))Be("updateAudioPlayerCofig: Invalid zsAudio lib");else if(t.isObject(e)){var n=!1;if(!Ge(e.bpm)){var o=ln.synthBpm;ln.synthBpm=e.bpm,ln.synthBpm!==o&&(n=!0)}if(!Ge(e.durationMultiplier)){o=cn.noteDurationMultipler;cn.noteDurationMultipler=e.durationMultiplier,cn.noteDurationMultipler!==o&&(n=!0)}Ge(e.osc1Freq)||(ln.noteUpFreq=e.osc1Freq),Ge(e.osc2Freq)||(ln.noteDownFreq=e.osc2Freq),Ge(e.osc3Freq)||(ln.noiseFreqs=e.osc3Freq),n&&D()}}function Pt(e){if(Ge(i))Be("updateAudioPlayerCofig: Invalid zsAudio lib");else if(t.isObject(e)){var n=!1;if(!Ge(e.audioFiles)){var o=e.audioFiles;t.isArray(o)?t.arrEquals(on,o)?qe("updateAudioPlayerCofig: audioFiles array identical, ignoring update"):(on=o,qe("updateAudioPlayerCofig: audioFiles array set to: "+on),n=!0):Be("updateAudioPlayerCofig: invalid audioFiles array")}if(!Ge(e.audioFilesIndexMap)){var r=e.audioFilesIndexMap;!t.isArray(r)||r.length<1?Be("updateAudioPlayerCofig: invalid fileIndexMap array"):rn=r}n&&(qe("updateAudioPlayerCofig: laoding audioFiles"),t.makeVisible(cn.loadingIconId),i.loadAudioBuffers(on))}}function Gt(e){if(Ge(i))Be("runPlayerPlay: Invalid zsAudio lib");else if(t.isObject(e)){var n=0;Ge(e.index)||(t.isString(e.index)?n=t.toInt(e.index):t.isNumeric(e.index)&&(n=e.index));var o=n;if(n>0&&n<rn.length){var r=rn[n];o=t.randomArrayElement(r)}var a=null,s=null,u=null;Ge(e.startTime)||(a=e.startTime),Ge(e.offset)||(s=e.offset),Ge(e.duration)||(u=e.duration),i.playAudio(o,a,s,u)}}function zt(e){if(Ge(i))Be("setAudioMasterVolume: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null;Ge(e.level)||(n=e.level),Ge(e.timeMs)||(o=e.timeMs),i.setPlayerVolume(n,o)}}function Bt(e,n){if(t.isString(e))switch(e){case"play":qt(n);break;case"stop":Ot(n);break;case"config":Wt(n);break;case"rampLinear":Ht(n);break;case"rampSin":Lt(n);break;case"volume":Qt(n);break;default:return void Be("runAudioGranulator: Unknown actionId: "+e)}}function qt(t){Ge(i)?Be("runAudioPlayGranulator: Invalid zsAudio lib"):i.playGranulator()}function Ot(t){Ge(i)?Be("runAudioPlayGranulator: Invalid zsAudio lib"):i.stopGranulator()}function Ht(e){if(Ge(i))Be("runAudioPlayGranulator: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null,r=null;Ge(e.paramName)||(n=e.paramName),Ge(e.endValue)||(o=e.endValue),Ge(e.duration)||(r=e.duration),i.setGranulatorRampLinear(n,o,r)}}function Qt(e){if(Ge(i))Be("runAudioPlayGranulator: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null;Ge(e.level)||(n=e.level),Ge(e.timeMs)||(o=e.timeMs),i.setGranulatorGain(n,o)}}function Lt(e){if(Ge(i))Be("runAudioPlayGranulator: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null,r=null,a=null;Ge(e.paramName)||(n=e.paramName),Ge(e.amplitude)||(o=e.amplitude),Ge(e.frequency)||(r=e.frequency),Ge(e.duration)||(a=e.duration),i.setGranulatorRampSin(n,o,r,a)}}function Wt(e){Ge(i)?Be("runAudioPlayGranulator: Invalid zsAudio lib"):t.isObject(e)&&(i.setGranulatorConfig(e),i.initGranulator(ln.granulatorIndex))}function jt(t){K(t.line1,t.line2,t.line3,t.colour,t.isVisible)}function Yt(t){ze(t.count)&&$(t.count),ze(t.maxCount)&&tt(t.maxCount),Kt()}function Xt(t){Pt(t)}function Zt(t){Rt(t)}function _t(t){Wt(t)}function Jt(t){at(t)}function Kt(){if(!Ge(ln.meter)){var t=ln.userNo;t<=cn.meterMaxVotes&&(t=cn.meterMaxVotes),ln.meter.set(ln.voteCount,t)}}function $t(e){if(!Ge(un)){un.innerHTML=He;var n=ln.instructions.l1,i=cn.textSpanPrefix+"1",o=ln.instructions.l2,r=cn.textSpanPrefix+"2",a=ln.instructions.l3,s=cn.textSpanPrefix+"3",u=He;e||(e=He,t.isEmptyString(n)||(u=ee(n,u),n=te(n,i),e+=n),t.isEmptyString(o)||(qe("displayInstructions: processing line2 "+o),u=ee(o,u),o=te(o,r),e=t.addSuffixIfNotThere(e,cn.textLineBreak),e+=o),t.isEmptyString(a)||(qe("displayInstructions: processing line3 "+a),u=ee(a,u),a=te(a,s),e=t.addSuffixIfNotThere(e,cn.textLineBreak),e+=a));var l=cn.textFontSize,c=Me(u,l,un);un.style.fontSize=He+c+"px",un.style.fontFamily=cn.textFontFamily,un.innerHTML=e;var d=t.getChildElement(un,t.toCssIdQuery(i));Ge(d)||(d.style.opacity=0);var f=t.getChildElement(un,t.toCssIdQuery(r));Ge(f)||(f.style.opacity=0);var h=t.getChildElement(un,t.toCssIdQuery(s));if(Ge(h)||(h.style.opacity=0),ln.instructions.isVisible=!0,oe(un,ln.instructions),cn.textSpanIsFadeIn){var m=cn.textSpanFadeTimeSec,p=cn.textSpanFadeStaggerTimeSec;Ge(d)||gsap.to(d,{duration:m,autoAlpha:1,ease:"power1.in"}),Ge(f)||gsap.to(f,{delay:p,duration:m,autoAlpha:1,ease:"power1.in"}),Ge(h)||gsap.to(h,{delay:2*p,duration:m,autoAlpha:1,ease:"power1.in"})}else Ge(d)||(d.style.opacity=1),Ge(f)||(f.style.opacity=1),Ge(h)||(h.style.opacity=1)}}function te(e,n){for(;t.contains(e,_e);)e=t.replace(e,_e,Je);return e=t.wrapInSpanElement(e,n),e}function ee(e,n){var i=t.removeMarkup(e);return i.length>n.length?i:n}function ne(t){return cn.textFontType+Qe+t+"px "+cn.textFontFamily}function ie(){Ge(un)||(un.innerHTML=He,ln.instructions.isVisible=!1,oe(un,ln.instructions))}function oe(e,n){var i=ae(n);Ge(n.bckgCol)||(i.background=n.bckgCol),t.setElementStyleProperty(e,i)}function re(t,e){Ge(t)||(e||m(),ze(t.actions)&&se(t.actions),ze(t.instructions)&&jt(t.instructions),ze(t.counter)&&Yt(t.counter),ze(t.playerConfig)&&Xt(t.playerConfig),ze(t.granulatorConfig)&&_t(t.granulatorConfig),ze(t.viewState)&&Jt(t.viewState),ze(t.synthConfig)&&Zt(t.synthConfig))}function ae(t){return t.isVisible?cn.textStyleVisible:cn.textStyleInvisible}function se(e){var n=null,i=null,o=[],r={};if(t.isArray(e))for(var a=0;a<e.length;a++){var s=e[a];ze(s.id)&&(n=s.id),ze(s.actionType)&&(i=s.actionType),ze(s.elementIds)&&(o=s.elementIds),ze(s.params)&&(r=s.params),ue(n,i,o,r)}}function ue(t,e,n,i){if(qe("doAction: "+t+" actionType: "+e),!Ge(e)&&!Ge(n))switch(e){case"AUDIO":Ft(t,n,i);break;case"ACTIVATE":nt(t,n,i);break;case"STOP":le(t,n,i);break;default:Be("doAction: Unknown actionType: "+e)}}function le(e,n,i){if(t.isArray(n))for(var o=0;o<n.length;o++)ce(e,n[o],i);else ce(e,n,i)}function ce(e,n,i){if(t.isString(e))switch(qe("stop: actionId: "+e+Qe+n),e){case"stop":de(n,i);break;default:return void Be("Unknown stop actionId: "+e)}}function de(t,e){if(!Ge(t))switch(qe("runStopAction: target: "+t),t){case"all":fe(e);break;case"player":he(e)}}function fe(t){qe("runStopAll: "),!Ge(i)&&i.isReady()&&(he(),me())}function he(){Ge(i)?Be("runAudioStopPlayer: Invalid zsAudio lib"):i.stopPlayer()}function me(){Ge(i)?Be("runAudioStopNoise: Invalid zsAudio lib"):i.stopNoise()}function pe(){return t.getElement(cn.instructionTxtElementId)}function ve(){return t.getElement(cn.meterGroupId)}function be(){return t.getElement(cn.thumbUpGroupId)}function ge(){return t.getElement(cn.thumbUpRectId)}function ye(){return t.getElement(cn.thumbDownRectId)}function xe(){return t.getElement(cn.thumbDownGroupId)}function Ie(){return ln.thumbUpTween}function we(){return ln.thumbDownTween}function Se(){return ln.noteUpTween}function Ae(){return ln.noteDownTween}function Me(t,e,n){var i=1;a.innerWidth||s.documentElement.clientWidth||s.body.clientWidth;var o=a.innerHeight||s.documentElement.clientHeight||s.body.clientHeight,r=(ne(i),n.clientWidth),u=r*cn.textWidthCompressor,l=o*cn.textAreaMax;i=Te(t,e,u),i=De(r,i,l);var c=cn.textMaxFontSize;return i>c&&(i=c),i}function De(t,e,n){var i=ne(e),o=e,r=Ce(i,t,n);if(r<0)return o;var a=r*cn.textNumberOfLines,s=n/a;return s<1&&(o*=s),o}function Te(t,e,n){var i=ne(e),o=Ue(i,t),r=o.width;if(r<=0||r>n||Math.abs(n-r)<1)return e;var a=n/r,s=e*a;return Te(t,s,n)}function Ue(t,e){var n=ln.fontCanvas,i=ln.canvasCtx;return i.fillRect(0,0,n.width,n.height),i.textBaseline="top",i.fillStyle=We,i.font=t,i.measureText(e)}function Ce(t,e,n){var i=ln.fontCanvas,o=ln.canvasCtx;i.width=e,i.height=n,o.fillRect(0,0,i.width,i.height),o.textBaseline="top",o.fillStyle=We,o.font=t;var r="gM";o.fillText(r,0,0);for(var a=o.getImageData(0,0,i.width,i.height).data,s=-1,u=-1,l=0;l<i.height;l++)for(var c=0;c<i.width;c++){var d=4*(l*i.width+c);if(0!==a[d]){-1===s&&(s=l);break}if(c===i.width-1&&-1!==s){u=l,l=i.height;break}}var f=(u-s)*cn.textHeightCompressor;return f}function Fe(){if(qe("onThumbsUp:"),ln.isThumbEnabled){if(X())return;t.setElementAttributes(be(),cn.filterInActiveAttrib),t.playOrRestartTween(Ie())}if(ln.isNoteEnabled){if(_()||J())return;W(cn.noteDownSymId),t.playOrRestartTween(Se()),F()}ln.isVotingEnabled&&Y(Xe)}function ke(){if(qe("onThumbsDown:"),ln.isThumbEnabled){if(Z())return;t.setElementAttributes(xe(),cn.filterInActiveAttrib),t.playOrRestartTween(we())}if(ln.isNoteEnabled){if(_()||J())return;W(cn.noteUpSymId),t.playOrRestartTween(Ae()),k()}ln.isVotingEnabled&&Y(Ze)}function Ee(t){qe("onMouseUpThumbsUp:"),an||Fe()}function Ve(t){qe("onTouchEndThumbsUp:"),an&&Fe()}function Ne(t){qe("onMouseUpThumbsDown:"),an||ke()}function Re(t){qe("onTouchEndThumbsDown:"),an&&ke()}function Pe(e,n){t.setElementAttributes(e,n)}function Ge(e){return t.isNull(e)}function ze(e){return t.isNotNull(e)}function Be(e){t.logError(e)}function qe(e){t.log(e)}const Oe="DEV",He="",Qe=" ",Le="Rect",We="#FFFFFF",je="VOTE",Ye="value",Xe=1,Ze=-1,_e="&#39;",Je="'",Ke="thumbs",$e="notes",tn="meter",en="vote",nn="audio";var on=["/audio/DialogsRhythm7-1.wav"],rn=[[0]],an=null,sn=null,un=null,ln={bpm:80,synthBpm:80,instructions:{isVisible:!1,l1:He,l2:He,l3:He,bckgCol:"rgba(225, 225, 225, 0.85)"},voteCount:0,userNo:10,meter:null,currentVote:null,voteTimeMs:0,thumbUpTween:null,thumbDownTween:null,noteUpTween:null,noteUpDurationSec:1,noteDownTween:null,noteDownDurationSec:1,isVotingEnabled:!1,isThumbEnabled:!1,isNoteEnabled:!0,granulatorIndex:0,filterFreq:1,filterQ:0,noteUpFreq:[523.25,631.62,739.99],noteDownFreq:[261.63,315.81,369.99],noiseFreqs:[261.63,369.99,523.25,739.99,1046.5,1479.98,2093,2959.96,4186.01,5919.91],isAudioEnabled:!0,currentSection:null,isSectionActive:!1,filterMod:null,meterAudioValue:0,noiseFreq:1e3,noiseQ:100,filterDetuneTween:null},cn={connectionPreference:"ws,sse,poll",appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",textSpanPrefix:"is",instructionTxtElementId:"instructionTxt",textLineBreak:"<br/>",textStyleInvisible:{visibility:"hidden"},textStyleVisible:{visibility:"visible"},textFontFamily:"Arial",textFontType:"normal",textFontSize:50,textMaxFontSize:70,textMaxLineLen:30,textHeightCompressor:1.1,textWidthCompressor:.9,textAreaMax:.4,textNumberOfLines:3,textSpanIsFadeIn:!0,textSpanFadeTimeSec:1,textSpanFadeStaggerTimeSec:.5,voteTimeoutMs:5e3,noteDurationMultipler:8,loadingIconId:"loadingIcon",elementGroupSuffix:"Grp",meterGroupId:"meterGrp",thumbUpRectId:"thUpRect",thumbDownRectId:"thDownRect",thumbUpGroupId:"thumbUpGrp",thumbUpPathId:"thumbUpPth",thumbUpSymId:"thumbUpSym",thumbDownGroupId:"thumbDownGrp",thumbDownPathId:"thumbDownPth",thumbDownSymId:"thumbDownSym",noteUpGroupId:"noteUpGrp",noteUpSymId:"noteUpSym",noteDownGroupId:"noteDownGrp",noteDownSymId:"noteDownSym",meterBoxIdPrefix:"meterBox",meterBoxNo:20,meterMaxVotes:10,meterInactiveStyle:{fill:"none",stroke:"black","stroke-width":"4px"},meterZeroStyle:{fill:"yellow"},thumbsUpActiveStyle:{fill:"green"},thumbsUpInActiveStyle:{fill:"none"},thumbsDownActiveStyle:{fill:"red"},thumbsDownInActiveStyle:{fill:"none"},centreX:450,centreY:800,meterBoxWidth:80,meterBoxHeight:40,negativeMinCol:{r:255,g:165,b:0},negativeMaxCol:{r:255,g:0,b:0},positiveMinCol:{r:255,g:255,b:0},positiveMaxCol:{r:0,g:125,b:0},maxNoiseLevel:1,audioFadeInMs:1e3,filterGreenAttrib:{filter:"url(#dropshadowgreen)"},filterRedAttrib:{filter:"url(#dropshadowred)"},filterInActiveAttrib:{filter:"none"},noteUpConfig:{minAngle:0,maxAngle:360},noteDurations:[o.DURATION.MINIM,o.DURATION.CROTCHET,o.DURATION.QUAVER,o.DURATION.SEMI_QUAVER],noteSymbolsUp:["minimUp","crotchetUp","quaverUp","semiquaverUp"],noteSymbolsDown:["minimDown","crotchetDown","quaverDown","semiquaverDown"],availableViews:[Ke,$e,tn,en,nn],maxNoiseFreq:5e3,minNoiseFreq:300,maxNoiseQ:10,minNoiseQ:1,noiseFilterQSteps:[300,100,70,50,30,20,15,10,5,3]};return l.prototype.init=function(){if(!Ge(this.styleConfig)&&t.isNumeric(this.boxNo)&&t.isNumeric(this.midX)&&t.isNumeric(this.midY)){var e=t.isOddNumber(this.boxNo),n=Math.round(this.boxNo/2);this.positiveMaxIndex=this.boxNo-1,this.positiveMinIndex=n,this.negativeMinIndex=n-1,this.negativeMaxIndex=0,this.zeroIndex=null;var i=this.midY+n*this.boxHeight;e&&(this.negativeMinIndex=n-2,this.zeroIndex=n-1,i=this.midY+this.boxHeight/2+this.zeroIndex*this.boxHeight);for(var o=i,r=this.midX-this.boxWidth/2,a=0;a<this.boxNo;++a){var s=this.boxIdPrefix+a,u=this.boxSvgIdPrefix+a,l=o-this.boxHeight,c=this.getActiveStyle(a),f=new d(s,u,r,l,this.boxWidth,this.boxHeight,this.styleConfig.inactiveStyle,c);this.boxes[a]=f,o=l}this.draw(),this.isInitialised=!0}else Be("ZScoreMeter.init: invalid inputs")},l.prototype.getActiveStyle=function(e){var n="yellow";if(!Ge(this.zeroIndex)&&e===this.zeroIndex)return this.styleConfig.zeroStyle;if(e>=this.positiveMinIndex&&e<=this.positiveMaxIndex){var i=0;this.positiveMaxIndex!=this.positiveMinIndex&&(i=(e-this.positiveMinIndex)/(this.positiveMaxIndex-this.positiveMinIndex));var o=t.interpolateRgbColours(this.styleConfig.posMinRGB,this.styleConfig.posMaxRGB,i);Ge(o)||(n=t.rgbToHex(o.r,o.g,o.b))}else if(e>=this.negativeMaxIndex&&e<=this.negativeMinIndex){i=0;this.negativeMinIndex!=this.negativeMaxIndex&&(i=(this.negativeMinIndex-e)/(this.negativeMinIndex-this.negativeMaxIndex));o=t.interpolateRgbColours(this.styleConfig.negMinRGB,this.styleConfig.negMaxRGB,i);Ge(o)||(n=t.rgbToHex(o.r,o.g,o.b))}return{fill:n}},l.prototype.clear=function(){for(var t=0;t<this.boxes.length;++t)this.setBoxStyle(t,this.styleConfig.inactiveStyle)},l.prototype.draw=function(){for(var t=0;t<this.boxes.length;++t)this.boxes[t].draw()},l.prototype.setPlayAudio=function(t){this.isPlayAudio=t,this.playAudio(this.currentValue,this.currentMaxVal)},l.prototype.set=function(e,n){if(t.isNumeric(e)&&t.isNumeric(n))if(this.clear(),Ge(this.zeroIndex)||this.activateBox(this.zeroIndex,!0),e>0){n<0&&(n*=-1);var i=1,o=n;o<i&&(o=i),e>o&&(e=o);for(var r=Math.floor(t.mapRange(e,i,o,this.positiveMinIndex,this.positiveMaxIndex)),a=this.positiveMinIndex;a<=r;a++)this.activateBox(a,!0);this.currentValue=e,this.currentMaxVal=o,this.playAudio(e,o)}else{n>0&&(n*=-1);i=-1,o=n;o>i&&(o=i),e<o&&(e=o);for(r=Math.ceil(t.mapRange(e,i,o,this.negativeMinIndex,this.negativeMaxIndex)),a=this.negativeMinIndex;a>=r;a--)this.activateBox(a,!0);this.currentValue=e,this.currentMaxVal=o,this.playAudio(e,o)}},l.prototype.activateBox=function(t,e){var n=this.boxes[t];Ge(n)||n.setActive(e)},l.prototype.setBoxStyle=function(t,e){var n=this.boxes[t];Ge(n)||n.setStyle(e)},l.prototype.playAudio=function(t,e){this.isPlayAudio&&C(t,e)},d.prototype.draw=function(){var e=ve();if(!Ge(e)){var i=n.createSvgRectangle(this.x,this.y,this.width,this.height,this.svgId);Pe(i,this.inactiveStyle),t.addChildToParent(e,i)}},d.prototype.setStyle=function(e){var n=t.getElement(this.svgId);Ge(n)||Pe(n,e)},d.prototype.setActive=function(e){var n=t.getElement(this.svgId);Ge(n)||Pe(n,e?this.activeStyle:this.inactiveStyle)},{load:function(){f()},onThumbsDownSelect:function(){ke()},onThumbsUpSelect:function(){Fe()}}}(zsUtil,zsNet,zsSvg,zsAudio,zsMusic,zsSynth,window,document);