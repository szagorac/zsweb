var zscore=function(t,e,n,i,o,r,a,s){"use strict";function u(t){this.message=t,this.name="ZScoreException"}function l(t,e,n,i,o,r,a){this.boxNo=t,this.midX=e,this.midY=n,this.boxWidth=i,this.boxHeight=o,this.boxIdPrefix=r,this.styleConfig=a,this.boxSvgIdPrefix=r+ye,this.boxes=[],this.isInitialised=!1,this.positiveMinIndex=0,this.positiveMaxIndex=0,this.negativeMinIndex=0,this.negativeMaxIndex=0,this.zeroIndex=null,this.isPlayAudio=!1,this.currentValue=0,this.currentMaxVal=0}function d(t,e,n,i,o,r){this.inactiveStyle=t,this.zeroStyle=e,this.negMinRGB=n,this.negMaxRGB=i,this.posMinRGB=o,this.posMaxRGB=r}function c(t,e,n,i,o,r,a,s){this.id=t,this.svgId=e,this.x=n,this.y=i,this.width=o,this.height=r,this.inactiveStyle=a,this.activeStyle=s}function f(){ve("onLoad: "),h()}function h(){if(!(t&&e&&n&&i&&o&&r))throw new u("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio, zsSynth and zsMusic");t.setRunMode(be),ve("init: "),Ee=t.isTouchDevice(),ke=t.isSafari(navigator),ve("init: IsTouch Device: "+Ee+" isSafari: "+ke),Ge.fontCanvas=s.createElement("canvas"),Ge.canvasCtx=Ge.fontCanvas.getContext("2d"),v(),I(),x(),S(),M(),A(),D(),m(),b()}function p(){y()}function m(){_(),J(),K()}function v(){e.init(Fe.connectionPreference,Fe.appUrlSse,Fe.appUrlWebsockets,Fe.appUrlHttp,Vt)}function b(){e.getServerState()}function g(){i.initNoise(),i.initPlayer(),i.initSynth(),i.initGranulator(Ge.granulatorIndex),t.makeInVisible(Fe.loadingIconId),ve("onAudioLoaded: completed")}function x(){he(i)?me("initAudio: invalid zsAudio lib"):i.init(Ue,g)}function y(){he(i)?me("resetAudio: invalid zsAudio lib"):i.reset()}function I(){n.init(),w()}function w(){var e=Xt();pe(e)&&(t.listen("touchend",e,le),t.listen("mouseup",e,ue));var n=Zt();pe(n)&&(t.listen("touchend",n,ce),t.listen("mouseup",n,de))}function S(){var t=new d(Fe.meterInactiveStyle,Fe.meterZeroStyle,Fe.negativeMinCol,Fe.negativeMaxCol,Fe.positiveMinCol,Fe.positiveMaxCol),e=new l(Fe.meterBoxNo,Fe.centreX,Fe.centreY,Fe.meterBoxWidth,Fe.meterBoxHeight,Fe.meterBoxIdPrefix,t);e.init(),Ge.meter=e}function M(){var e=Wt();he(e)||(Re=e,t.listen("resize",a,nt),t.listen("orientationchange",a,nt),$("Welcome to","<span style='color:blueviolet;'>ZScore</span>","awaiting performance start ...",null,!0))}function A(){var e=Fe.voteTimeoutMs/1e3;Ge.thumbUpTween=gsap.from(t.toCssIdQuery(Fe.thumbUpSymId),{duration:e,scaleY:.5,fill:"green",transformOrigin:"right bottom",paused:!0,ease:"slow(0.9, 0.4, false)",onComplete:z}),Ge.thumbUpTween.progress(1),Ge.thumbDownTween=gsap.from(t.toCssIdQuery(Fe.thumbDownSymId),{duration:e,scaleY:.5,fill:"red",transformOrigin:"left top",paused:!0,ease:"slow(0.9, 0.4, false)",onComplete:B}),Ge.thumbDownTween.progress(1)}function D(){T(),U()}function T(){var e=t.getRandomIntFromRange(0,Fe.noteDurations.length-1),n=Fe.noteDurations[e],i=t.toCssIdQuery(Fe.noteSymbolsUp[e]),o=t.getElement(Fe.noteUpSymId);o.setAttribute("href",i),o.setAttribute("xlink:href",i);var r=F()*Fe.noteDurationMultipler;Ge.noteUpDurationSec=n*r,Ge.noteUpTween=N()}function U(){var e=t.getRandomIntFromRange(0,Fe.noteDurations.length-1),n=Fe.noteDurations[e],i=t.toCssIdQuery(Fe.noteSymbolsDown[e]),o=t.getElement(Fe.noteDownSymId);o.setAttribute("href",i),o.setAttribute("xlink:href",i);var r=F()*Fe.noteDurationMultipler;Ge.noteDownDurationSec=n*r,Ge.noteDownTween=V()}function C(){k()}function E(){R()}function k(){var e=t.getRandomIntFromRange(0,Ge.noteUpFreq.length-1),n=Ge.noteUpFreq[e];ve("playing freq: "+n),i.playSynth(n,Ge.noteUpDurationSec)}function R(){var e=t.getRandomIntFromRange(0,Ge.noteDownFreq.length-1),n=Ge.noteDownFreq[e];ve("playing freq: "+n),i.playSynth(n,Ge.noteDownDurationSec)}function G(){var t=o.getBeatDurationSec(Ge.bpm);return he(t)&&(t=1),t}function F(){var t=G();return 4*t}function N(){var t=Ge.noteUpDurationSec,e={sign:-1,angleMin:0,angleMax:120,rMin:10,rMax:30,rotAngleMin:-360,rotAngleMax:360,xmod:20,ymod:30};return P(t,Fe.noteUpSymId,e,O)}function V(){var t=Ge.noteDownDurationSec,e={sign:1,angleMin:0,angleMax:120,rMin:20,rMax:40,rotAngleMin:-360,rotAngleMax:360,xmod:0,ymod:0};return P(t,Fe.noteDownSymId,e,H)}function P(e,n,i,o){var r=t.randomIntFromInterval(i.angleMin,i.angleMax),a=t.randomIntFromInterval(i.rMin,i.rMax),s=0,u=i.sign,l=u*a;if(r<90){var d=t.toRadians(r);s=u*a*Math.cos(d),l=u*a*Math.sin(d)}else if(r>90){d=t.toRadians(180-r);s=-1*u*a*Math.cos(d),l=u*a*Math.sin(d)}s+=i.xmod,l+=i.ymod;var c=t.randomIntFromInterval(i.rotAngleMin,i.rotAngleMax);return gsap.to(t.toCssIdQuery(n),{duration:e,scale:.1,autoAlpha:0,rotation:c,x:s,y:l,ease:"slow(0.9, 0.4, false)",paused:!0,onComplete:o})}function z(){t.setElementAttributes(Yt(),Fe.filterGreenAttrib)}function B(){t.setElementAttributes(_t(),Fe.filterRedAttrib)}function O(){q(Fe.noteUpSymId),T(),L(Fe.noteUpSymId),L(Fe.noteDownSymId)}function H(){q(Fe.noteDownSymId),U(),L(Fe.noteDownSymId),L(Fe.noteUpSymId)}function q(e){gsap.set(t.toCssIdQuery(e),{autoAlpha:0,scale:1,rotation:0,x:0,y:0})}function L(e){he(e)||gsap.to(t.toCssIdQuery(e),{duration:1,autoAlpha:1})}function Q(e){he(e)||gsap.to(t.toCssIdQuery(e),{duration:1,autoAlpha:0})}function W(t){Ge.currentVote=t;var n={};n[Se]=t,e.sendEvent(we,n)}function j(){return pe(Ge.thumbUpTween)&&Ge.thumbUpTween.isActive()}function Y(){return pe(Ge.thumbDownTween)&&Ge.thumbDownTween.isActive()}function X(){return pe(Ge.noteUpTween)&&Ge.noteUpTween.isActive()}function Z(){return pe(Ge.noteDownTween)&&Ge.noteDownTween.isActive()}function _(){t.makeVisible(Fe.meterGroupId),Ge.isVotingEnabled=!0}function J(){t.makeInVisible(Fe.thumbUpGroupId),t.makeInVisible(Fe.thumbDownGroupId),Ge.isThumbEnabled=!1}function K(){t.makeVisible(Fe.noteUpGroupId),t.makeVisible(Fe.noteDownGroupId),Ge.isNoteEnabled=!0}function $(t,e,n,i,o){if(!he(Re)){var r=!1;if(!he(t)){var a=t.trim();Ge.instructions.l1!=a&&(Ge.instructions.l1=a,r=!0)}if(!he(e)){a=e.trim();Ge.instructions.l2!=a&&(Ge.instructions.l2=a,r=!0)}if(!he(n)){a=n.trim();Ge.instructions.l3!=a&&(Ge.instructions.l3=a,r=!0)}he(i)||(Ge.instructions.bckgCol=i),o?r&&Et():Ft()}}function tt(e){he(e)||(t.isNumeric(e)||(e=t.toInt(e)),Ge.voteCount=e)}function et(e){he(e)||(t.isNumeric(e)||(e=t.toInt(e)),Ge.userNo=e)}function nt(e){if(!t.isObject(this))return null;Et()}function it(e,n,i){if(t.isArray(n))for(var o=0;o<n.length;o++)ot(e,n[o],i);else ot(e,n,i)}function ot(t,e,n){if(!he(e))switch(ve("runActivate: "+t+xe+e),e){case"view":rt(t,n)}}function rt(e,n){if(t.isString(e))switch(e){case"section":at(n);break;default:return void me("activateView: Unknown actionId: "+e)}}function at(e){if(t.isObject(e)){var n=null;he(e.id)||(n=e.id),st(n)}}function st(t){lt(),ut()}function ut(){L(Fe.thumbUpSymId),L(Fe.thumbDownSymId),t.makeVisible(Fe.thumbUpGroupId),t.makeVisible(Fe.thumbDownGroupId),Ge.isThumbEnabled=!0}function lt(){Q(Fe.noteUpSymId),Q(Fe.noteDownSymId),t.makeInVisible(Fe.noteUpGroupId),t.makeInVisible(Fe.noteDownGroupId),Ge.isNoteEnabled=!1}function dt(e,n,i){if(t.isArray(n))for(var o=0;o<n.length;o++)ct(e,n[o],i);else ct(e,n,i)}function ct(t,e,n){if(!he(e))switch(ve("runAudio: "+t+xe+e),e){case"all":ft(t,n);break;case"player":pt(t,n);break;case"granulator":gt(t,n)}}function ft(e,n){if(t.isString(e))switch(e){case"volume":ht(n);break;default:return void me("runPlayer: Unknown actionId: "+e)}}function ht(e){if(he(i))me("setAudioMasterVolume: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null;he(e.level)||(n=e.level),he(e.timeMs)||(o=e.timeMs),i.setMasterVolume(n,o)}}function pt(e,n){if(t.isString(e))switch(e){case"play":vt(n);break;case"volume":bt(n);break;case"config":mt(n);break;default:return void me("runPlayer: Unknown actionId: "+e)}}function mt(e){if(he(i))me("updateAudioPlayerCofig: Invalid zsAudio lib");else if(t.isObject(e)){var n=!1;if(!he(e.audioFiles)){var o=e.audioFiles;t.isArray(o)?t.arrEquals(Ue,o)?ve("updateAudioPlayerCofig: audioFiles array identical, ignoring update"):(Ue=o,n=!0):me("updateAudioPlayerCofig: invalid audioFiles array")}if(!he(e.audioFilesIndexMap)){var r=e.audioFilesIndexMap;!t.isArray(r)||r.length<1?me("updateAudioPlayerCofig: invalid fileIndexMap array"):Ce=r}n&&(ve("updateAudioPlayerCofig: laoding audioFiles"),t.makeVisible(Fe.loadingIconId),i.loadAudioBuffers(Ue))}}function vt(e){if(he(i))me("runPlayerPlay: Invalid zsAudio lib");else if(t.isObject(e)){var n=0;he(e.index)||(t.isString(e.index)?n=t.toInt(e.index):t.isNumeric(e.index)&&(n=e.index));var o=n;if(n>0&&n<Ce.length){var r=Ce[n];o=t.randomArrayElement(r)}var a=null,s=null,u=null;he(e.startTime)||(a=e.startTime),he(e.offset)||(s=e.offset),he(e.duration)||(u=e.duration),i.playAudio(o,a,s,u)}}function bt(e){if(he(i))me("setAudioMasterVolume: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null;he(e.level)||(n=e.level),he(e.timeMs)||(o=e.timeMs),i.setPlayerVolume(n,o)}}function gt(e,n){if(t.isString(e))switch(e){case"play":xt(n);break;case"stop":yt(n);break;case"config":Mt(n);break;case"rampLinear":It(n);break;case"rampSin":St(n);break;case"volume":wt(n);break;default:return void me("runAudioGranulator: Unknown actionId: "+e)}}function xt(t){he(i)?me("runAudioPlayGranulator: Invalid zsAudio lib"):i.playGranulator()}function yt(t){he(i)?me("runAudioPlayGranulator: Invalid zsAudio lib"):i.stopGranulator()}function It(e){if(he(i))me("runAudioPlayGranulator: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null,r=null;he(e.paramName)||(n=e.paramName),he(e.endValue)||(o=e.endValue),he(e.duration)||(r=e.duration),i.setGranulatorRampLinear(n,o,r)}}function wt(e){if(he(i))me("runAudioPlayGranulator: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null;he(e.level)||(n=e.level),he(e.timeMs)||(o=e.timeMs),i.setGranulatorGain(n,o)}}function St(e){if(he(i))me("runAudioPlayGranulator: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null,r=null,a=null;he(e.paramName)||(n=e.paramName),he(e.amplitude)||(o=e.amplitude),he(e.frequency)||(r=e.frequency),he(e.duration)||(a=e.duration),i.setGranulatorRampSin(n,o,r,a)}}function Mt(e){he(i)?me("runAudioPlayGranulator: Invalid zsAudio lib"):t.isObject(e)&&(i.setGranulatorConfig(e),i.initGranulator(Ge.granulatorIndex))}function At(t){$(t.line1,t.line2,t.line3,t.colour,t.isVisible)}function Dt(t){pe(t.count)&&tt(t.count),pe(t.maxCount)&&et(t.maxCount),Ct()}function Tt(t){mt(t)}function Ut(t){Mt(t)}function Ct(){if(!he(Ge.meter)){var t=Ge.userNo;t<=Fe.meterMaxVotes&&(t=Fe.meterMaxVotes),Ge.meter.set(Ge.voteCount,t)}}function Et(e){if(!he(Re)){Re.innerHTML=ge;var n=Ge.instructions.l1,i=Fe.textSpanPrefix+"1",o=Ge.instructions.l2,r=Fe.textSpanPrefix+"2",a=Ge.instructions.l3,s=Fe.textSpanPrefix+"3",u=ge;e||(e=ge,t.isEmptyString(n)||(u=Rt(n,u),n=kt(n,i),e+=n),t.isEmptyString(o)||(ve("displayInstructions: processing line2 "+o),u=Rt(o,u),o=kt(o,r),e=t.addSuffixIfNotThere(e,Fe.textLineBreak),e+=o),t.isEmptyString(a)||(ve("displayInstructions: processing line3 "+a),u=Rt(a,u),a=kt(a,s),e=t.addSuffixIfNotThere(e,Fe.textLineBreak),e+=a));var l=Fe.textFontSize,d=ee(u,l,Re);Re.style.fontSize=ge+d+"px",Re.style.fontFamily=Fe.textFontFamily,Re.innerHTML=e;var c=t.getChildElement(Re,t.toCssIdQuery(i));he(c)||(c.style.opacity=0);var f=t.getChildElement(Re,t.toCssIdQuery(r));he(f)||(f.style.opacity=0);var h=t.getChildElement(Re,t.toCssIdQuery(s));if(he(h)||(h.style.opacity=0),Ge.instructions.isVisible=!0,Nt(Re,Ge.instructions),Fe.textSpanIsFadeIn){var p=Fe.textSpanFadeTimeSec,m=Fe.textSpanFadeStaggerTimeSec;he(c)||gsap.to(c,{duration:p,autoAlpha:1,ease:"power1.in"}),he(f)||gsap.to(f,{delay:m,duration:p,autoAlpha:1,ease:"power1.in"}),he(h)||gsap.to(h,{delay:2*m,duration:p,autoAlpha:1,ease:"power1.in"})}else he(c)||(c.style.opacity=1),he(f)||(f.style.opacity=1),he(h)||(h.style.opacity=1)}}function kt(e,n){for(;t.contains(e,De);)e=t.replace(e,De,Te);return e=t.wrapInSpanElement(e,n),e}function Rt(e,n){var i=t.removeMarkup(e);return i.length>n.length?i:n}function Gt(t){return Fe.textFontType+xe+t+"px "+Fe.textFontFamily}function Ft(){he(Re)||(Re.innerHTML=ge,Ge.instructions.isVisible=!1,Nt(Re,Ge.instructions))}function Nt(e,n){var i=Pt(n);he(n.bckgCol)||(i.background=n.bckgCol),t.setElementStyleProperty(e,i)}function Vt(t,e){he(t)||(e||p(),pe(t.actions)&&zt(t.actions),pe(t.instructions)&&At(t.instructions),pe(t.counter)&&Dt(t.counter),pe(t.playerConfig)&&Tt(t.playerConfig),pe(t.granulatorConfig)&&Ut(t.granulatorConfig))}function Pt(t){return t.isVisible?Fe.textStyleVisible:Fe.textStyleInvisible}function zt(e){var n=null,i=null,o=[],r={};if(t.isArray(e))for(var a=0;a<e.length;a++){var s=e[a];pe(s.id)&&(n=s.id),pe(s.actionType)&&(i=s.actionType),pe(s.elementIds)&&(o=s.elementIds),pe(s.params)&&(r=s.params),Bt(n,i,o,r)}}function Bt(t,e,n,i){if(ve("doAction: "+t+" actionType: "+e),!he(e)&&!he(n))switch(e){case"AUDIO":dt(t,n,i);break;case"ACTIVATE":it(t,n,i);break;case"STOP":Ot(t,n,i);break;default:me("doAction: Unknown actionType: "+e)}}function Ot(e,n,i){if(t.isArray(n))for(var o=0;o<n.length;o++)Ht(e,n[o],i);else Ht(e,n,i)}function Ht(e,n,i){if(t.isString(e))switch(ve("stop: actionId: "+e+xe+n),e){case"stop":qt(n,i);break;default:return void me("Unknown stop actionId: "+e)}}function qt(t,e){if(!he(t))switch(ve("runStopAction: target: "+t),t){case"all":Lt(e);break;case"player":Qt(e)}}function Lt(t){ve("runStopAll: "),!he(i)&&i.isReady()&&Qt(t)}function Qt(t){he(i)?me("runAudioStopPlayer: Invalid zsAudio lib"):i.stopPlayer()}function Wt(){return t.getElement(Fe.instructionTxtElementId)}function jt(){return t.getElement(Fe.meterGroupId)}function Yt(){return t.getElement(Fe.thumbUpGroupId)}function Xt(){return t.getElement(Fe.thumbUpRectId)}function Zt(){return t.getElement(Fe.thumbDownRectId)}function _t(){return t.getElement(Fe.thumbDownGroupId)}function Jt(){return Ge.thumbUpTween}function Kt(){return Ge.thumbDownTween}function $t(){return Ge.noteUpTween}function te(){return Ge.noteDownTween}function ee(t,e,n){var i=1;a.innerWidth||s.documentElement.clientWidth||s.body.clientWidth;var o=a.innerHeight||s.documentElement.clientHeight||s.body.clientHeight,r=(Gt(i),n.clientWidth),u=r*Fe.textWidthCompressor,l=o*Fe.textAreaMax;i=ie(t,e,u),i=ne(r,i,l);var d=Fe.textMaxFontSize;return i>d&&(i=d),i}function ne(t,e,n){var i=Gt(e),o=e,r=re(i,t,n);if(r<0)return o;var a=r*Fe.textNumberOfLines,s=n/a;return s<1&&(o*=s),o}function ie(t,e,n){var i=Gt(e),o=oe(i,t),r=o.width;if(r<=0||r>n||Math.abs(n-r)<1)return e;var a=n/r,s=e*a;return ie(t,s,n)}function oe(t,e){var n=Ge.fontCanvas,i=Ge.canvasCtx;return i.fillRect(0,0,n.width,n.height),i.textBaseline="top",i.fillStyle=Ie,i.font=t,i.measureText(e)}function re(t,e,n){var i=Ge.fontCanvas,o=Ge.canvasCtx;i.width=e,i.height=n,o.fillRect(0,0,i.width,i.height),o.textBaseline="top",o.fillStyle=Ie,o.font=t;var r="gM";o.fillText(r,0,0);for(var a=o.getImageData(0,0,i.width,i.height).data,s=-1,u=-1,l=0;l<i.height;l++)for(var d=0;d<i.width;d++){var c=4*(l*i.width+d);if(0!==a[c]){-1===s&&(s=l);break}if(d===i.width-1&&-1!==s){u=l,l=i.height;break}}var f=(u-s)*Fe.textHeightCompressor;return f}function ae(){if(ve("onThumbsUp:"),Ge.isThumbEnabled){if(j())return;t.setElementAttributes(Yt(),Fe.filterInActiveAttrib),t.playOrRestartTween(Jt())}if(Ge.isNoteEnabled){if(X()||Z())return;Q(Fe.noteDownSymId),t.playOrRestartTween($t()),C()}Ge.isVotingEnabled&&W(Me)}function se(){if(ve("onThumbsDown:"),Ge.isThumbEnabled){if(Y())return;t.setElementAttributes(_t(),Fe.filterInActiveAttrib),t.playOrRestartTween(Kt())}if(Ge.isNoteEnabled){if(X()||Z())return;Q(Fe.noteUpSymId),t.playOrRestartTween(te()),E()}Ge.isVotingEnabled&&W(Ae)}function ue(t){ve("onMouseUpThumbsUp:"),Ee||ae()}function le(t){ve("onTouchEndThumbsUp:"),Ee&&ae()}function de(t){ve("onMouseUpThumbsDown:"),Ee||se()}function ce(t){ve("onTouchEndThumbsDown:"),Ee&&se()}function fe(e,n){t.setElementAttributes(e,n)}function he(e){return t.isNull(e)}function pe(e){return t.isNotNull(e)}function me(e){t.logError(e)}function ve(e){t.log(e)}const be="DEV",ge="",xe=" ",ye="Rect",Ie="#FFFFFF",we="VOTE",Se="value",Me=1,Ae=-1,De="&#39;",Te="'";var Ue=["/audio/DialogsRhythm7-1.wav"],Ce=[[0]],Ee=null,ke=null,Re=null,Ge={bpm:80,instructions:{isVisible:!1,l1:ge,l2:ge,l3:ge,bckgCol:"rgba(225, 225, 225, 0.85)"},voteCount:0,userNo:10,meter:null,currentVote:null,voteTimeMs:0,thumbUpTween:null,thumbDownTween:null,noteUpTween:null,noteUpDurationSec:1,noteDownTween:null,noteDownDurationSec:1,isVotingEnabled:!1,isThumbEnabled:!1,isNoteEnabled:!0,granulatorIndex:0,filterFreq:1,filterQ:0,noteUpFreq:[523.25,631.62,739.99],noteDownFreq:[261.63,315.81,369.99]},Fe={connectionPreference:"ws,sse,poll",appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",textSpanPrefix:"is",instructionTxtElementId:"instructionTxt",textLineBreak:"<br/>",textStyleInvisible:{visibility:"hidden"},textStyleVisible:{visibility:"visible"},textFontFamily:"Arial",textFontType:"normal",textFontSize:50,textMaxFontSize:70,textMaxLineLen:30,textHeightCompressor:1.1,textWidthCompressor:.9,textAreaMax:.4,textNumberOfLines:3,textSpanIsFadeIn:!0,textSpanFadeTimeSec:1,textSpanFadeStaggerTimeSec:.5,voteTimeoutMs:5e3,noteDurationMultipler:8,loadingIconId:"loadingIcon",elementGroupSuffix:"Grp",meterGroupId:"meterGrp",thumbUpRectId:"thUpRect",thumbDownRectId:"thDownRect",thumbUpGroupId:"thumbUpGrp",thumbUpPathId:"thumbUpPth",thumbUpSymId:"thumbUpSym",thumbDownGroupId:"thumbDownGrp",thumbDownPathId:"thumbDownPth",thumbDownSymId:"thumbDownSym",noteUpGroupId:"noteUpGrp",noteUpSymId:"noteUpSym",noteDownGroupId:"noteDownGrp",noteDownSymId:"noteDownSym",meterBoxIdPrefix:"meterBox",meterBoxNo:20,meterMaxVotes:5,meterInactiveStyle:{fill:"none",stroke:"black","stroke-width":"4px"},meterZeroStyle:{fill:"yellow"},thumbsUpActiveStyle:{fill:"green"},thumbsUpInActiveStyle:{fill:"none"},thumbsDownActiveStyle:{fill:"red"},thumbsDownInActiveStyle:{fill:"none"},centreX:450,centreY:800,meterBoxWidth:80,meterBoxHeight:40,negativeMinCol:{r:255,g:165,b:0},negativeMaxCol:{r:255,g:0,b:0},positiveMinCol:{r:255,g:255,b:0},positiveMaxCol:{r:0,g:125,b:0},maxNoiseLevel:1,audioFadeInMs:1e3,filterGreenAttrib:{filter:"url(#dropshadowgreen)"},filterRedAttrib:{filter:"url(#dropshadowred)"},filterInActiveAttrib:{filter:"none"},noteUpConfig:{minAngle:0,maxAngle:360},noteDurations:[o.DURATION.MINIM,o.DURATION.CROTCHET,o.DURATION.QUAVER,o.DURATION.SEMI_QUAVER],noteSymbolsUp:["minimUp","crotchetUp","quaverUp","semiquaverUp"],noteSymbolsDown:["minimDown","crotchetDown","quaverDown","semiquaverDown"]};return l.prototype.init=function(){if(!he(this.styleConfig)&&t.isNumeric(this.boxNo)&&t.isNumeric(this.midX)&&t.isNumeric(this.midY)){var e=t.isOddNumber(this.boxNo),n=Math.round(this.boxNo/2);this.positiveMaxIndex=this.boxNo-1,this.positiveMinIndex=n,this.negativeMinIndex=n-1,this.negativeMaxIndex=0,this.zeroIndex=null;var i=this.midY+n*this.boxHeight;e&&(this.negativeMinIndex=n-2,this.zeroIndex=n-1,i=this.midY+this.boxHeight/2+this.zeroIndex*this.boxHeight);for(var o=i,r=this.midX-this.boxWidth/2,a=0;a<this.boxNo;++a){var s=this.boxIdPrefix+a,u=this.boxSvgIdPrefix+a,l=o-this.boxHeight,d=this.getActiveStyle(a),f=new c(s,u,r,l,this.boxWidth,this.boxHeight,this.styleConfig.inactiveStyle,d);this.boxes[a]=f,o=l}this.draw(),this.isInitialised=!0}else me("ZScoreMeter.init: invalid inputs")},l.prototype.getActiveStyle=function(e){var n="yellow";if(!he(this.zeroIndex)&&e===this.zeroIndex)return this.styleConfig.zeroStyle;if(e>=this.positiveMinIndex&&e<=this.positiveMaxIndex){var i=0;this.positiveMaxIndex!=this.positiveMinIndex&&(i=(e-this.positiveMinIndex)/(this.positiveMaxIndex-this.positiveMinIndex));var o=t.interpolateRgbColours(this.styleConfig.posMinRGB,this.styleConfig.posMaxRGB,i);he(o)||(n=t.rgbToHex(o.r,o.g,o.b))}else if(e>=this.negativeMaxIndex&&e<=this.negativeMinIndex){i=0;this.negativeMinIndex!=this.negativeMaxIndex&&(i=(this.negativeMinIndex-e)/(this.negativeMinIndex-this.negativeMaxIndex));o=t.interpolateRgbColours(this.styleConfig.negMinRGB,this.styleConfig.negMaxRGB,i);he(o)||(n=t.rgbToHex(o.r,o.g,o.b))}return{fill:n}},l.prototype.clear=function(){for(var t=0;t<this.boxes.length;++t)this.setBoxStyle(t,this.styleConfig.inactiveStyle)},l.prototype.draw=function(){for(var t=0;t<this.boxes.length;++t)this.boxes[t].draw()},l.prototype.setPlayAudio=function(t){this.isPlayAudio=t},l.prototype.set=function(e,n){if(t.isNumeric(e)&&t.isNumeric(n))if(this.clear(),he(this.zeroIndex)||this.activateBox(this.zeroIndex,!0),e>0){n<0&&(n*=-1);var i=1,o=n;o<i&&(o=i),e>o&&(e=o);for(var r=Math.floor(t.mapRange(e,i,o,this.positiveMinIndex,this.positiveMaxIndex)),a=this.positiveMinIndex;a<=r;a++)this.activateBox(a,!0);this.currentValue=e,this.currentMaxVal=o,this.playAudio(e,o)}else{n>0&&(n*=-1);i=-1,o=n;o>i&&(o=i),e<o&&(e=o);for(r=Math.ceil(t.mapRange(e,i,o,this.negativeMinIndex,this.negativeMaxIndex)),a=this.negativeMinIndex;a>=r;a--)this.activateBox(a,!0);this.currentValue=e,this.currentMaxVal=o,this.playAudio(e,o)}},l.prototype.activateBox=function(t,e){var n=this.boxes[t];he(n)||n.setActive(e)},l.prototype.setBoxStyle=function(t,e){var n=this.boxes[t];he(n)||n.setStyle(e)},l.prototype.playAudio=function(e,n){if(this.isPlayAudio){if(0===e)return i.playNoise(0),void i.setPlayerVolume(0,500);if(e>0){i.playNoise(0);var o=t.mapRange(Math.abs(e),0,Math.abs(n),0,1);i.setPlayerVolume(o,Fe.audioFadeInMs)}else{i.setPlayerVolume(0,Fe.audioFadeInMs);o=t.mapRange(Math.abs(e),0,Math.abs(n),0,Fe.maxNoiseLevel);i.playNoise(o)}}},c.prototype.draw=function(){var e=jt();if(!he(e)){var i=n.createSvgRectangle(this.x,this.y,this.width,this.height,this.svgId);fe(i,this.inactiveStyle),t.addChildToParent(e,i)}},c.prototype.setStyle=function(e){var n=t.getElement(this.svgId);he(n)||fe(n,e)},c.prototype.setActive=function(e){var n=t.getElement(this.svgId);he(n)||fe(n,e?this.activeStyle:this.inactiveStyle)},{load:function(){f()},onThumbsDownSelect:function(){se()},onThumbsUpSelect:function(){ae()}}}(zsUtil,zsNet,zsSvg,zsAudio,zsMusic,zsSynth,window,document);