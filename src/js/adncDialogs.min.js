var zscore=function(t,e,i,n,s,o){"use strict";function r(t){this.message=t,this.name="ZScoreException"}function a(t,e,i,n,s,o,r){this.boxNo=t,this.midX=e,this.midY=i,this.boxWidth=n,this.boxHeight=s,this.boxIdPrefix=o,this.styleConfig=r,this.boxSvgIdPrefix=o+j,this.boxes=[],this.isInitialised=!1,this.positiveMinIndex=0,this.positiveMaxIndex=0,this.negativeMinIndex=0,this.negativeMaxIndex=0,this.zeroIndex=null}function l(t,e,i,n,s,o){this.inactiveStyle=t,this.zeroStyle=e,this.negMinRGB=i,this.negMaxRGB=n,this.posMinRGB=s,this.posMaxRGB=o}function h(t,e,i,n,s,o,r,a){this.id=t,this.svgId=e,this.x=i,this.y=n,this.width=s,this.height=o,this.inactiveStyle=r,this.activeStyle=a}function c(){X("onLoad: "),x()}function x(){if(!(t&&e&&i&&n))throw new r("Invalid libraries. Required: zsUtil, zsNet, zsSvg and zsAudio");t.setRunMode(Z),X("init: "),K=t.isTouchDevice(),$=t.isSafari(navigator),X("init: IsTouch Device: "+K+" isSafari: "+$),tt.fontCanvas=o.createElement("canvas"),tt.canvasCtx=tt.fontCanvas.getContext("2d"),d(),g(),p(),m(),y(),v()}function u(){f()}function d(){e.init(et.connectionPreference,et.appUrlSse,et.appUrlWebsockets,et.appUrlHttp,T)}function v(){e.getServerState()}function p(){V(n)?Y("initAudio: invalid zsAudio lib"):n.init(J,0)}function f(){V(n)?Y("resetAudio: invalid zsAudio lib"):n.reset()}function g(){i.init()}function m(){var t=new l(et.meterInactiveStyle,et.meterZeroStyle,et.negativeMinCol,et.negativeMaxCol,et.positiveMinCol,et.positiveMaxCol),e=new a(et.meterBoxNo,et.centreX,et.centreY,et.meterBoxWidth,et.meterBoxHeight,et.meterBoxIdPrefix,t);e.init(),tt.meter=e}function y(){var e=P();V(e)||(_=e,t.listen("resize",s,S),t.listen("orientationchange",s,S),b("Welcome to","<span style='color:blueviolet;'>ZScore</span>","awaiting performance start ...",null,!0))}function b(t,e,i,n,s){if(!V(_)){var o=!1;if(!V(t)){var r=t.trim();tt.instructions.l1!=r&&(tt.instructions.l1=r,o=!0)}if(!V(e)){r=e.trim();tt.instructions.l2!=r&&(tt.instructions.l2=r,o=!0)}if(!V(i)){r=i.trim();tt.instructions.l3!=r&&(tt.instructions.l3=r,o=!0)}V(n)||(tt.instructions.bckgCol=n),s?o&&w():E()}}function I(e){V(e)||(t.isNumeric(e)||(e=t.toInt(e)),tt.voteCount=e)}function S(e){if(!t.isObject(this))return null;w()}function M(t){b(t.line1,t.line2,t.line3,t.colour,t.isVisible)}function C(t){D(t.count)&&I(t.count)}function w(e){if(!V(_)){_.innerHTML=O;var i=tt.instructions.l1,n=et.textSpanPrefix+"1",s=tt.instructions.l2,o=et.textSpanPrefix+"2",r=tt.instructions.l3,a=et.textSpanPrefix+"3",l=O;e||(e=O,t.isEmptyString(i)||(l=B(i,l),i=t.wrapInSpanElement(i,n),e+=i),t.isEmptyString(s)||(X("displayInstructions: processing line2 "+s),l=B(s,l),s=t.wrapInSpanElement(s,o),e=t.addSuffixIfNotThere(e,et.textLineBreak),e+=s),t.isEmptyString(r)||(X("displayInstructions: processing line3 "+r),l=B(r,l),r=t.wrapInSpanElement(r,a),e=t.addSuffixIfNotThere(e,et.textLineBreak),e+=r));var h=et.textFontSize,c=k(l,h,_);_.style.fontSize=O+c+"px",_.style.fontFamily=et.textFontFamily,_.innerHTML=e;var x=t.getChildElement(_,t.toCssIdQuery(n));V(x)||(x.style.opacity=0);var u=t.getChildElement(_,t.toCssIdQuery(o));V(u)||(u.style.opacity=0);var d=t.getChildElement(_,t.toCssIdQuery(a));if(V(d)||(d.style.opacity=0),tt.instructions.isVisible=!0,F(_,tt.instructions),et.textSpanIsFadeIn){var v=et.textSpanFadeTimeSec,p=et.textSpanFadeStaggerTimeSec;V(x)||gsap.to(x,{duration:v,autoAlpha:1,ease:"power1.in"}),V(u)||gsap.to(u,{delay:p,duration:v,autoAlpha:1,ease:"power1.in"}),V(d)||gsap.to(d,{delay:2*p,duration:v,autoAlpha:1,ease:"power1.in"})}else V(x)||(x.style.opacity=1),V(u)||(u.style.opacity=1),V(d)||(d.style.opacity=1)}}function B(e,i){var n=t.removeMarkup(e);return n.length>i.length?n:i}function z(t){return et.textFontType+Q+t+"px "+et.textFontFamily}function E(){V(_)||(_.innerHTML=O,tt.instructions.isVisible=!1,F(_,tt.instructions))}function F(e,i){var n=N(i);V(i.bckgCol)||(n.background=i.bckgCol),t.setElementStyleProperty(e,n)}function T(t,e){V(t)||(e||u(),D(t.actions)&&A(t.actions),D(t.instructions)&&M(t.instructions),D(t.counter)&&C(t.counter))}function N(t){return t.isVisible?et.textStyleVisible:et.textStyleInvisible}function A(e){var i=null,n=null,s=[],o={};if(t.isArray(e))for(var r=0;r<e.length;r++){var a=e[r];D(a.id)&&(i=a.id),D(a.actionType)&&(n=a.actionType),D(a.elementIds)&&(s=a.elementIds),D(a.params)&&(o=a.params),H(i,n,s,o)}}function H(t,e,i,n){X("doAction: "+t+" actionType: "+e),V(e)||V(i)||Y("doAction: Unknown actionType: "+e)}function P(){return t.getElement(et.instructionTxtElementId)}function R(){return t.getElement(et.meterGroupId)}function k(t,e,i){var n=1;s.innerWidth||o.documentElement.clientWidth||o.body.clientWidth;var r=s.innerHeight||o.documentElement.clientHeight||o.body.clientHeight,a=(z(n),i.clientWidth),l=a*et.textWidthCompressor,h=r*et.textAreaMax;n=G(t,e,l),n=W(a,n,h);var c=et.textMaxFontSize;return n>c&&(n=c),n}function W(t,e,i){var n=z(e),s=e,o=U(n,t,i);if(o<0)return s;var r=o*et.textNumberOfLines,a=i/r;return a<1&&(s*=a),s}function G(t,e,i){var n=z(e),s=L(n,t),o=s.width;if(o<=0||o>i||Math.abs(i-o)<1)return e;var r=i/o,a=e*r;return G(t,a,i)}function L(t,e){var i=tt.fontCanvas,n=tt.canvasCtx;return n.fillRect(0,0,i.width,i.height),n.textBaseline="top",n.fillStyle=q,n.font=t,n.measureText(e)}function U(t,e,i){var n=tt.fontCanvas,s=tt.canvasCtx;n.width=e,n.height=i,s.fillRect(0,0,n.width,n.height),s.textBaseline="top",s.fillStyle=q,s.font=t;var o="gM";s.fillText(o,0,0);for(var r=s.getImageData(0,0,n.width,n.height).data,a=-1,l=-1,h=0;h<n.height;h++)for(var c=0;c<n.width;c++){var x=4*(h*n.width+c);if(0!==r[x]){-1===a&&(a=h);break}if(c===n.width-1&&-1!==a){l=h,h=n.height;break}}var u=(l-a)*et.textHeightCompressor;return u}function V(e){return t.isNull(e)}function D(e){return t.isNotNull(e)}function Y(e){t.logError(e)}function X(e){t.log(e)}const Z="DEV",O="",Q=" ",j="Rect",q="#FFFFFF";var J=["/audio/violin-tuning.mp3"],K=null,$=null,_=null,tt={instructions:{isVisible:!1,l1:O,l2:O,l3:O,bckgCol:"rgba(225, 225, 225, 0.85)"},voteCount:0,meter:null},et={connectionPreference:"ws,sse,poll",appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",textSpanPrefix:"is",instructionTxtElementId:"instructionTxt",textLineBreak:"<br/>",textStyleInvisible:{visibility:"hidden"},textStyleVisible:{visibility:"visible"},textFontFamily:"Arial",textFontType:"normal",textFontSize:50,textMaxFontSize:70,textMaxLineLen:30,textHeightCompressor:1.1,textWidthCompressor:.9,textAreaMax:.4,textNumberOfLines:3,textSpanIsFadeIn:!0,textSpanFadeTimeSec:1,textSpanFadeStaggerTimeSec:.5,elementGroupSuffix:"Grp",meterGroupId:"meterGrp",meterBoxIdPrefix:"meterBox",thumbsUpPathId:"thumbUpPth",thumbsDownPathId:"thumbDownPth",meterBoxNo:20,meterInactiveStyle:{fill:"none",stroke:"black","stroke-width":"4px"},meterZeroStyle:{fill:"yellow"},centreX:450,centreY:800,meterBoxWidth:80,meterBoxHeight:40,negativeMinCol:{r:255,g:165,b:0},negativeMaxCol:{r:255,g:0,b:0},positiveMinCol:{r:255,g:255,b:0},positiveMaxCol:{r:0,g:125,b:0}};return a.prototype.init=function(){if(!V(this.styleConfig)&&t.isNumeric(this.boxNo)&&t.isNumeric(this.midX)&&t.isNumeric(this.midY)){var e=t.isOddNumber(this.boxNo),i=Math.round(this.boxNo/2);this.positiveMaxIndex=this.boxNo-1,this.positiveMinIndex=i,this.negativeMinIndex=i-1,this.negativeMaxIndex=0,this.zeroIndex=null;var n=this.midY+i*this.boxHeight;e&&(this.negativeMinIndex=i-2,this.zeroIndex=i-1,n=this.midY+this.boxHeight/2+this.zeroIndex*this.boxHeight);for(var s=n,o=this.midX-this.boxWidth/2,r=0;r<this.boxNo;++r){var a=this.boxIdPrefix+r,l=this.boxSvgIdPrefix+r,c=s-this.boxHeight,x=this.getActiveStyle(r),u=new h(a,l,o,c,this.boxWidth,this.boxHeight,this.styleConfig.inactiveStyle,x);this.boxes[r]=u,s=c}this.draw(),this.isInitialised=!0}else Y("ZScoreMeter.init: invalid inputs")},a.prototype.getActiveStyle=function(e){var i="yellow";if(!V(this.zeroIndex)&&e===this.zeroIndex)return this.styleConfig.zeroStyle;if(e>=this.positiveMinIndex&&e<=this.positiveMaxIndex){var n=0;this.positiveMaxIndex!=this.positiveMinIndex&&(n=(e-this.positiveMinIndex)/(this.positiveMaxIndex-this.positiveMinIndex));var s=t.interpolateRgbColours(this.styleConfig.posMinRGB,this.styleConfig.posMaxRGB,n);V(s)||(i=t.rgbToHex(s.r,s.g,s.b))}else if(e>=this.negativeMaxIndex&&e<=this.negativeMinIndex){n=0;this.negativeMinIndex!=this.negativeMaxIndex&&(n=(this.negativeMinIndex-e)/(this.negativeMinIndex-this.negativeMaxIndex));s=t.interpolateRgbColours(this.styleConfig.negMinRGB,this.styleConfig.negMaxRGB,n);V(s)||(i=t.rgbToHex(s.r,s.g,s.b))}return{fill:i}},a.prototype.clear=function(){for(var t=0;t<this.boxes.length;++t)this.setBoxStyle(t,this.styleConfig.inactiveStyle)},a.prototype.draw=function(){for(var t=0;t<this.boxes.length;++t)this.boxes[t].draw()},a.prototype.set=function(e,i){if(t.isNumeric(e)&&t.isNumeric(i))if(this.clear(),V(this.zeroIndex)||this.activateBox(this.zeroIndex,!0),e>0){i<0&&(i*=-1);var n=1,s=i;s<n&&(s=n),e>s&&(e=s);for(var o=Math.floor(t.mapRange(e,n,s,this.positiveMinIndex,this.positiveMaxIndex)),r=this.positiveMinIndex;r<=o;r++)this.activateBox(r,!0)}else{i>0&&(i*=-1);n=-1,s=i;s>n&&(s=n),e<s&&(e=s);for(o=Math.ceil(t.mapRange(e,n,s,this.negativeMinIndex,this.negativeMaxIndex)),r=this.negativeMinIndex;r>=o;r--)this.activateBox(r,!0)}},a.prototype.activateBox=function(t,e){var i=this.boxes[t];V(i)||i.setActive(e)},a.prototype.setBoxStyle=function(t,e){var i=this.boxes[t];V(i)||i.setStyle(e)},h.prototype.draw=function(){var e=R();if(!V(e)){var n=i.createSvgRectangle(this.x,this.y,this.width,this.height,this.svgId);t.setElementAttributes(n,this.inactiveStyle),t.addChildToParent(e,n)}},h.prototype.setStyle=function(e){var i=t.getElement(this.svgId);V(i)||t.setElementAttributes(i,e)},h.prototype.setActive=function(e){var i=t.getElement(this.svgId);V(i)||(e?t.setElementAttributes(i,this.activeStyle):t.setElementAttributes(i,this.inactiveStyle))},{load:function(){c()}}}(zsUtil,zsNet,zsSvg,zsAudio,window,document);