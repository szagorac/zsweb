var zscore=function(t,e,i,n,r,o){"use strict";function a(t){this.message=t,this.name="ZScoreException"}function s(){V("onLoad: "),l()}function l(){if(!(t&&e&&i&&n))throw new a("Invalid libraries. Required: zsUtil, zsNet, zsSvg and zsAudio");t.setRunMode(P),V("init: "),Q=t.isTouchDevice(),Z=t.isSafari(navigator),V("init: IsTouch Device: "+Q+" isSafari: "+Z),q.fontCanvas=o.createElement("canvas"),q.canvasCtx=q.fontCanvas.getContext("2d"),u(),x(),p(),v(),f()}function c(){d()}function u(){e.init(G.connectionPreference,G.appUrlSse,G.appUrlWebsockets,G.appUrlHttp,w)}function f(){e.getServerState()}function p(){N(n)?W("initAudio: invalid zsAudio lib"):n.init(O,0)}function d(){N(n)?W("resetAudio: invalid zsAudio lib"):n.reset()}function x(){i.init()}function v(){var e=z();N(e)||(j=e,t.listen("resize",r,g),t.listen("orientationchange",r,g),h("Welcome to","<span style='color:blueviolet;'>ZScore</span>","awaiting performance start ...",null,!0))}function h(t,e,i,n,r){if(!N(j)){var o=!1;if(!N(t)){var a=t.trim();q.instructions.l1!=a&&(q.instructions.l1=a,o=!0)}if(!N(e)){a=e.trim();q.instructions.l2!=a&&(q.instructions.l2=a,o=!0)}if(!N(i)){a=i.trim();q.instructions.l3!=a&&(q.instructions.l3=a,o=!0)}N(n)||(q.instructions.bckgCol=n),r?o&&y():F()}}function g(e){if(!t.isObject(this))return null;y()}function m(t){h(t.line1,t.line2,t.line3,t.colour,t.isVisible)}function y(e){if(!N(j)){j.innerHTML=B;var i=q.instructions.l1,n=G.textSpanPrefix+"1",r=q.instructions.l2,o=G.textSpanPrefix+"2",a=q.instructions.l3,s=G.textSpanPrefix+"3",l=B;e||(e=B,t.isEmptyString(i)||(l=S(i,l),i=t.wrapInSpanElement(i,n),e+=i),t.isEmptyString(r)||(V("displayInstructions: processing line2 "+r),l=S(r,l),r=t.wrapInSpanElement(r,o),e=t.addSuffixIfNotThere(e,G.textLineBreak),e+=r),t.isEmptyString(a)||(V("displayInstructions: processing line3 "+a),l=S(a,l),a=t.wrapInSpanElement(a,s),e=t.addSuffixIfNotThere(e,G.textLineBreak),e+=a));var c=G.textFontSize,u=A(l,c,j);j.style.fontSize=B+u+"px",j.style.fontFamily=G.textFontFamily,j.innerHTML=e;var f=t.getChildElement(j,t.toCssIdQuery(n));N(f)||(f.style.opacity=0);var p=t.getChildElement(j,t.toCssIdQuery(o));N(p)||(p.style.opacity=0);var d=t.getChildElement(j,t.toCssIdQuery(s));if(N(d)||(d.style.opacity=0),q.instructions.isVisible=!0,I(j,q.instructions),G.textSpanIsFadeIn){var x=G.textSpanFadeTimeSec,v=G.textSpanFadeStaggerTimeSec;N(f)||gsap.to(f,{duration:x,autoAlpha:1,ease:"power1.in"}),N(p)||gsap.to(p,{delay:v,duration:x,autoAlpha:1,ease:"power1.in"}),N(d)||gsap.to(d,{delay:2*v,duration:x,autoAlpha:1,ease:"power1.in"})}else N(f)||(f.style.opacity=1),N(p)||(p.style.opacity=1),N(d)||(d.style.opacity=1)}}function S(e,i){var n=t.removeMarkup(e);return n.length>i.length?n:i}function b(t){return G.textFontType+D+t+"px "+G.textFontFamily}function F(){N(j)||(j.innerHTML=B,q.instructions.isVisible=!1,I(j,q.instructions))}function I(e,i){var n=C(i);N(i.bckgCol)||(n.background=i.bckgCol),t.setElementStyleProperty(e,n)}function w(t,e){N(t)||(e||c(),U(t.actions)&&T(t.actions),U(t.instructions)&&m(t.instructions))}function C(t){return t.isVisible?G.textStyleVisible:G.textStyleInvisible}function T(e){var i=null,n=null,r=[],o={};if(t.isArray(e))for(var a=0;a<e.length;a++){var s=e[a];U(s.id)&&(i=s.id),U(s.actionType)&&(n=s.actionType),U(s.elementIds)&&(r=s.elementIds),U(s.params)&&(o=s.params),E(i,n,r,o)}}function E(t,e,i,n){V("doAction: "+t+" actionType: "+e),N(e)||N(i)||W("doAction: Unknown actionType: "+e)}function z(){return t.getElement(G.instructionTxtElementId)}function A(t,e,i){var n=1;r.innerWidth||o.documentElement.clientWidth||o.body.clientWidth;var a=r.innerHeight||o.documentElement.clientHeight||o.body.clientHeight,s=(b(n),i.clientWidth),l=s*G.textWidthCompressor,c=a*G.textAreaMax;n=M(t,e,l),n=k(s,n,c);var u=G.textMaxFontSize;return n>u&&(n=u),n}function k(t,e,i){var n=b(e),r=e,o=H(n,t,i);if(o<0)return r;var a=o*G.textNumberOfLines,s=i/a;return s<1&&(r*=s),r}function M(t,e,i){var n=b(e),r=L(n,t),o=r.width;if(o<=0||o>i||Math.abs(i-o)<1)return e;var a=i/o,s=e*a;return M(t,s,i)}function L(t,e){var i=q.fontCanvas,n=q.canvasCtx;return n.fillRect(0,0,i.width,i.height),n.textBaseline="top",n.fillStyle=R,n.font=t,n.measureText(e)}function H(t,e,i){var n=q.fontCanvas,r=q.canvasCtx;n.width=e,n.height=i,r.fillRect(0,0,n.width,n.height),r.textBaseline="top",r.fillStyle=R,r.font=t;var o="gM";r.fillText(o,0,0);for(var a=r.getImageData(0,0,n.width,n.height).data,s=-1,l=-1,c=0;c<n.height;c++)for(var u=0;u<n.width;u++){var f=4*(c*n.width+u);if(0!==a[f]){-1===s&&(s=c);break}if(u===n.width-1&&-1!==s){l=c,c=n.height;break}}var p=(l-s)*G.textHeightCompressor;return p}function N(e){return t.isNull(e)}function U(e){return t.isNotNull(e)}function W(e){t.logError(e)}function V(e){t.log(e)}const P="DEV",B="",D=" ",R="#FFFFFF";var O=["/audio/violin-tuning.mp3"],Q=null,Z=null,j=null,q={instructions:{isVisible:!1,l1:B,l2:B,l3:B,bckgCol:"rgba(225, 225, 225, 0.85)"}},G={connectionPreference:"ws,sse,poll",appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",textSpanPrefix:"is",instructionTxtElementId:"instructionTxt",textLineBreak:"<br/>",textStyleInvisible:{visibility:"hidden"},textStyleVisible:{visibility:"visible"},textFontFamily:"Arial",textFontType:"normal",textFontSize:50,textMaxFontSize:70,textMaxLineLen:30,textHeightCompressor:1.1,textWidthCompressor:.9,textAreaMax:.4,textNumberOfLines:3,textSpanIsFadeIn:!0,textSpanFadeTimeSec:1,textSpanFadeStaggerTimeSec:.5};return{load:function(){s()}}}(zsUtil,zsNet,zsSvg,zsAudio,window,document);