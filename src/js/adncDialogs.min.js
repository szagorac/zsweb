var zscore=function(e,t,n,i,o,r,a,s){"use strict";function u(e){this.message=e,this.name="ZScoreException"}function l(e,t,n,i,o,r,a){this.boxNo=e,this.midX=t,this.midY=n,this.boxWidth=i,this.boxHeight=o,this.boxIdPrefix=r,this.styleConfig=a,this.boxSvgIdPrefix=r+jt,this.boxes=[],this.isInitialised=!1,this.positiveMinIndex=0,this.positiveMaxIndex=0,this.negativeMinIndex=0,this.negativeMaxIndex=0,this.zeroIndex=null,this.isPlayAudio=!1,this.currentValue=0,this.currentMaxVal=0}function c(e,t,n,i,o,r){this.inactiveStyle=e,this.zeroStyle=t,this.negMinRGB=n,this.negMaxRGB=i,this.posMinRGB=o,this.posMaxRGB=r}function d(e,t,n,i,o,r,a,s){this.id=e,this.svgId=t,this.x=n,this.y=i,this.width=o,this.height=r,this.inactiveStyle=a,this.activeStyle=s}function f(){Ht("onLoad: "),h()}function h(){if(!(e&&t&&n&&i&&o&&r))throw new u("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio, zsSynth and zsMusic");e.setRunMode(Qt),Ht("init: "),un=e.isTouchDevice(),ln=e.isSafari(navigator),Ht("init: IsTouch Device: "+un+" isSafari: "+ln),dn.fontCanvas=s.createElement("canvas"),dn.canvasCtx=dn.fontCanvas.getContext("2d"),v(),I(),y(),S(),M(),A(),D(),p(),b()}function m(){x()}function p(){we(),Ae(),Ue()}function v(){t.init(fn.connectionPreference,fn.appUrlSse,fn.appUrlWebsockets,fn.appUrlHttp,st)}function b(){t.getServerState()}function g(){i.initNoise(),i.initPlayer(),i.initSynth(),i.initGranulator(dn.granulatorIndex),e.makeInVisible(fn.loadingIconId),Ht("onAudioLoaded: completed")}function y(){Ht("initAudio: #####"),qt(i)?Ot("initAudio: invalid zsAudio lib"):i.init(an,g)}function x(){qt(i)?Ot("resetAudio: invalid zsAudio lib"):i.reset()}function I(){n.init(),w()}function w(){var t=xt();Bt(t)&&(e.listen("touchend",t,Rt),e.listen("mouseup",t,Nt));var n=It();Bt(n)&&(e.listen("touchend",n,Gt),e.listen("mouseup",n,Pt))}function S(){var e=new c(fn.meterInactiveStyle,fn.meterZeroStyle,fn.negativeMinCol,fn.negativeMaxCol,fn.positiveMinCol,fn.positiveMaxCol),t=new l(fn.meterBoxNo,fn.centreX,fn.centreY,fn.meterBoxWidth,fn.meterBoxHeight,fn.meterBoxIdPrefix,e);t.init(),dn.meter=t}function M(){var t=bt();qt(t)||(cn=t,e.listen("resize",a,te),e.listen("orientationchange",a,te),K("Welcome to","<span style='color:blueviolet;'>ZScore</span>","awaiting performance start ...",null,!0))}function A(){var t=fn.voteTimeoutMs/1e3;dn.thumbUpTween=gsap.from(e.toCssIdQuery(fn.thumbUpSymId),{duration:t,scaleY:.5,fill:"green",transformOrigin:"right bottom",paused:!0,ease:"slow(0.9, 0.4, false)",onComplete:q}),dn.thumbUpTween.progress(1),dn.thumbDownTween=gsap.from(e.toCssIdQuery(fn.thumbDownSymId),{duration:t,scaleY:.5,fill:"red",transformOrigin:"left top",paused:!0,ease:"slow(0.9, 0.4, false)",onComplete:B}),dn.thumbDownTween.progress(1)}function D(){U(),T()}function U(){var t=e.getRandomIntFromRange(0,fn.noteDurations.length-1),n=fn.noteDurations[t],i=e.toCssIdQuery(fn.noteSymbolsUp[t]),o=e.getElement(fn.noteUpSymId);o.setAttribute("href",i),o.setAttribute("xlink:href",i);var r=R()*fn.noteDurationMultipler;dn.noteUpDurationSec=n*r,dn.noteUpTween=P()}function T(){var t=e.getRandomIntFromRange(0,fn.noteDurations.length-1),n=fn.noteDurations[t],i=e.toCssIdQuery(fn.noteSymbolsDown[t]),o=e.getElement(fn.noteDownSymId);o.setAttribute("href",i),o.setAttribute("xlink:href",i);var r=R()*fn.noteDurationMultipler;dn.noteDownDurationSec=n*r,dn.noteDownTween=G()}function C(t,n){dn.meterAudioValue;if(dn.meterAudioValue=t,dn.isAudioEnabled){if(0===t)return i.stopNoise(),void i.setPlayerVolume(0,500);if(t>0){i.stopNoise();var o=e.mapRange(Math.abs(t),0,Math.abs(n),0,1);i.setPlayerVolume(o,fn.audioFadeInMs)}else{var r=Math.abs(t);r>10?r=10:r<1&&(r=1),i.setPlayerVolume(0,fn.audioFadeInMs);o=e.mapRange(Math.abs(t),0,Math.abs(n),.5,fn.maxNoiseLevel);var a=0,s=dn.noiseFreqs.length-1;r<4?s=Math.floor(s/3):r>3&&r<7?(a=Math.floor(s/3),s=Math.floor(2*s/3)):r>6&&(a=Math.floor(s/2));var u=e.getRandomIntFromRange(a,s),l=dn.noiseFreqs[u];i.setNoiseFilterFreq(l),dn.noiseFreq=l;var c=fn.noiseFilterQSteps[r-1];dn.noiseQ=c,i.setNoiseFilterQ(c),i.playNoise(o)}}}function F(){E()}function k(){V()}function E(){var t=e.getRandomIntFromRange(0,dn.noteUpFreq.length-1),n=dn.noteUpFreq[t];n*=fn.noteFreqMultipler,Ht("playing freq: "+n),i.playSynth(n,dn.noteUpDurationSec)}function V(){var t=e.getRandomIntFromRange(0,dn.noteDownFreq.length-1),n=dn.noteDownFreq[t];n*=fn.noteFreqMultipler,Ht("playing freq: "+n),i.playSynth(n,dn.noteDownDurationSec)}function N(){var e=o.getBeatDurationSec(dn.synthBpm);return qt(e)&&(e=1),e}function R(){var e=N();return 4*e}function P(){var e=dn.noteUpDurationSec,t={sign:-1,angleMin:0,angleMax:120,rMin:10,rMax:30,rotAngleMin:-360,rotAngleMax:360,xmod:20,ymod:30};return z(e,fn.noteUpSymId,t,O)}function G(){var e=dn.noteDownDurationSec,t={sign:1,angleMin:0,angleMax:120,rMin:20,rMax:40,rotAngleMin:-360,rotAngleMax:360,xmod:0,ymod:0};return z(e,fn.noteDownSymId,t,H)}function z(t,n,i,o){var r=e.randomIntFromInterval(i.angleMin,i.angleMax),a=e.randomIntFromInterval(i.rMin,i.rMax),s=0,u=i.sign,l=u*a;if(r<90){var c=e.toRadians(r);s=u*a*Math.cos(c),l=u*a*Math.sin(c)}else if(r>90){c=e.toRadians(180-r);s=-1*u*a*Math.cos(c),l=u*a*Math.sin(c)}s+=i.xmod,l+=i.ymod;var d=e.randomIntFromInterval(i.rotAngleMin,i.rotAngleMax);return gsap.to(e.toCssIdQuery(n),{duration:t,scale:.1,autoAlpha:0,rotation:d,x:s,y:l,ease:"slow(0.9, 0.4, false)",paused:!0,onComplete:o})}function q(){e.setElementAttributes(yt(),fn.filterGreenAttrib)}function B(){e.setElementAttributes(wt(),fn.filterRedAttrib)}function O(){Q(fn.noteUpSymId),U(),dn.isNoteEnabled&&(L(fn.noteUpSymId),L(fn.noteDownSymId))}function H(){Q(fn.noteDownSymId),T(),dn.isNoteEnabled&&(L(fn.noteDownSymId),L(fn.noteUpSymId))}function Q(t){gsap.set(e.toCssIdQuery(t),{autoAlpha:0,scale:1,rotation:0,x:0,y:0})}function L(t){qt(t)||gsap.to(e.toCssIdQuery(t),{duration:1,autoAlpha:1})}function W(t){qt(t)||gsap.to(e.toCssIdQuery(t),{duration:1,autoAlpha:0,onComplete:j,onCompleteParams:[t]})}function j(t){e.makeInVisible(t)}function Y(e){dn.currentVote=e;var n={};n[Zt]=e,t.sendEvent(Xt,n)}function X(){return Bt(dn.thumbUpTween)&&dn.thumbUpTween.isActive()}function Z(){return Bt(dn.thumbDownTween)&&dn.thumbDownTween.isActive()}function _(){return Bt(dn.noteUpTween)&&dn.noteUpTween.isActive()}function J(){return Bt(dn.noteDownTween)&&dn.noteDownTween.isActive()}function K(e,t,n,i,o){if(!qt(cn)){var r=!1;if(!qt(e)){var a=e.trim();dn.instructions.l1!=a&&(dn.instructions.l1=a,r=!0)}if(!qt(t)){a=t.trim();dn.instructions.l2!=a&&(dn.instructions.l2=a,r=!0)}if(!qt(n)){a=n.trim();dn.instructions.l3!=a&&(dn.instructions.l3=a,r=!0)}qt(i)||(dn.instructions.bckgCol=i),o?r&&tt():rt()}}function $(t){qt(t)||(e.isNumeric(t)||(t=e.toInt(t)),dn.voteCount=t)}function ee(t){qt(t)||(e.isNumeric(t)||(t=e.toInt(t)),dn.userNo=t)}function te(t){if(!e.isObject(this))return null;tt()}function ne(t,n,i){if(e.isArray(n))for(var o=0;o<n.length;o++)ie(t,n[o],i);else ie(t,n,i)}function ie(e,t,n){if(!qt(t))switch(Ht("runActivate: "+e+Wt+t),t){case"view":oe(e,n)}}function oe(t,n){if(e.isString(t))switch(t){case"section":re(n);break;default:return void Ot("activateView: Unknown actionId: "+t)}}function re(t){if(e.isObject(t)){var n=null;qt(t.id)||(n=t.id),de(n)}}function ae(t){if(!qt(t)){var n=null,i=!1;if(Bt(t.isSectionActive)&&(i=t.isSectionActive),Bt(t.sectionName)&&(n=t.sectionName),se(n,i),Bt(t.activeViews)){for(var o=[],r=0;r<fn.availableViews.length;r++)e.arrContains(t.activeViews,fn.availableViews[r])||o.push(fn.availableViews[r]);ue(o),le(t.activeViews)}}}function se(e,t){dn.currentSection=e,dn.isSectionActive=t}function ue(e){for(var t=0;t<e.length;t++)ce(e[t])}function le(e){for(var t=0;t<e.length;t++)oe(e[t])}function ce(e){switch(e){case en:ge();break;case tn:be();break;case nn:ye();break;case on:xe();break;case rn:Ie();break;default:Ht("deactivateView: unknown view: "+e)}}function oe(e){switch(e){case en:he();break;case tn:fe();break;case nn:me();break;case on:pe();break;case rn:ve();break;default:Ht("activateView: unknown view: "+e)}}function de(e){}function fe(){De()}function he(){Me()}function me(){Te()}function pe(){we()}function ve(){dn.isAudioEnabled=!0,Bt(dn.meter)&&dn.meter.setPlayAudio(!0)}function be(){Ue()}function ge(){Ae()}function ye(){Ce()}function xe(){Se()}function Ie(){dn.isAudioEnabled=!1,Bt(dn.meter)&&dn.meter.setPlayAudio(!1),mt()}function we(){dn.isVotingEnabled=!0}function Se(){dn.isVotingEnabled=!1}function Me(){e.makeVisible(fn.thumbUpGroupId),e.makeVisible(fn.thumbDownGroupId),L(fn.thumbUpSymId),L(fn.thumbDownSymId),dn.isThumbEnabled=!0}function Ae(){W(fn.thumbUpSymId),W(fn.thumbDownSymId),dn.isThumbEnabled=!1}function De(){e.makeVisible(fn.noteUpGroupId),e.makeVisible(fn.noteDownGroupId),L(fn.noteUpSymId),L(fn.noteDownSymId),dn.isNoteEnabled=!0}function Ue(){W(fn.noteUpSymId),W(fn.noteDownSymId),dn.isNoteEnabled=!1}function Te(){e.makeVisible(fn.meterGroupId),L(fn.meterGroupId)}function Ce(){W(fn.meterGroupId)}function Fe(t,n,i){if(e.isArray(n))for(var o=0;o<n.length;o++)ke(t,n[o],i);else ke(t,n,i)}function ke(e,t,n){if(!qt(t))switch(Ht("runAudio: "+e+Wt+t),t){case"all":Ee(e,n);break;case"player":Ne(e,n);break;case"granulator":Oe(e,n);break;case"speechSynth":break;case"synth":Re(e,n)}}function Ee(t,n){if(e.isString(t))switch(t){case"volume":Ve(n);break;default:return void Ot("runPlayer: Unknown actionId: "+t)}}function Ve(t){if(qt(i))Ot("setAudioMasterVolume: Invalid zsAudio lib");else if(e.isObject(t)){var n=null,o=null;qt(t.level)||(n=t.level),qt(t.timeMs)||(o=t.timeMs),i.setMasterVolume(n,o)}}function Ne(t,n){if(e.isString(t))switch(t){case"play":ze(n);break;case"volume":Be(n);break;case"config":Ge(n);break;default:return void Ot("runPlayer: Unknown actionId: "+t)}}function Re(t,n){if(e.isString(t))switch(t){case"volume":qe(n);break;default:return void Ot("runSynth: Unknown actionId: "+t)}}function Pe(t){if(qt(i))Ot("updateAudioPlayerCofig: Invalid zsAudio lib");else if(e.isObject(t)){var n=!1;if(!qt(t.bpm)){var o=dn.synthBpm;dn.synthBpm=t.bpm,dn.synthBpm!==o&&(n=!0)}if(!qt(t.durationMultiplier)){o=fn.noteDurationMultipler;fn.noteDurationMultipler=t.durationMultiplier,fn.noteDurationMultipler!==o&&(n=!0)}qt(t.freqMultiplier)||(fn.noteFreqMultipler=t.freqMultiplier),qt(t.osc1Freq)||(dn.noteUpFreq=t.osc1Freq),qt(t.osc2Freq)||(dn.noteDownFreq=t.osc2Freq),qt(t.osc3Freq)||(dn.noiseFreqs=t.osc3Freq),n&&D()}}function Ge(t){if(qt(i))Ot("updateAudioPlayerCofig: Invalid zsAudio lib");else if(e.isObject(t)){var n=!1;if(!qt(t.audioFiles)){var o=t.audioFiles;e.isArray(o)?e.arrEquals(an,o)?Ht("updateAudioPlayerCofig: audioFiles array identical, ignoring update"):(an=o,Ht("updateAudioPlayerCofig: audioFiles array set to: "+an),n=!0):Ot("updateAudioPlayerCofig: invalid audioFiles array")}if(!qt(t.audioFilesIndexMap)){var r=t.audioFilesIndexMap;!e.isArray(r)||r.length<1?Ot("updateAudioPlayerCofig: invalid fileIndexMap array"):sn=r}n&&(Ht("updateAudioPlayerCofig: laoding audioFiles"),e.makeVisible(fn.loadingIconId),i.loadAudioBuffers(an))}}function ze(t){if(qt(i))Ot("runPlayerPlay: Invalid zsAudio lib");else if(e.isObject(t)){var n=0;qt(t.index)||(e.isString(t.index)?n=e.toInt(t.index):e.isNumeric(t.index)&&(n=t.index));var o=n;if(n>0&&n<sn.length){var r=sn[n];o=e.randomArrayElement(r)}var a=null,s=null,u=null;qt(t.startTime)||(a=t.startTime),qt(t.offset)||(s=t.offset),qt(t.duration)||(u=t.duration),i.playAudio(o,a,s,u)}}function qe(t){if(qt(i))Ot("setAudioMasterVolume: Invalid zsAudio lib");else if(e.isObject(t)){var n=null,o=null;qt(t.level)||(n=t.level),qt(t.timeMs)||(o=t.timeMs),i.setSynthVolume(n,o)}}function Be(t){if(qt(i))Ot("setAudioMasterVolume: Invalid zsAudio lib");else if(e.isObject(t)){var n=null,o=null;qt(t.level)||(n=t.level),qt(t.timeMs)||(o=t.timeMs),i.setPlayerVolume(n,o)}}function Oe(t,n){if(e.isString(t))switch(t){case"play":He(n);break;case"stop":Qe(n);break;case"config":Ye(n);break;case"rampLinear":Le(n);break;case"rampSin":je(n);break;case"volume":We(n);break;default:return void Ot("runAudioGranulator: Unknown actionId: "+t)}}function He(e){qt(i)?Ot("runAudioPlayGranulator: Invalid zsAudio lib"):i.playGranulator()}function Qe(e){qt(i)?Ot("runAudioPlayGranulator: Invalid zsAudio lib"):i.stopGranulator()}function Le(t){if(qt(i))Ot("runAudioPlayGranulator: Invalid zsAudio lib");else if(e.isObject(t)){var n=null,o=null,r=null;qt(t.paramName)||(n=t.paramName),qt(t.endValue)||(o=t.endValue),qt(t.duration)||(r=t.duration),i.setGranulatorRampLinear(n,o,r)}}function We(t){if(qt(i))Ot("runAudioPlayGranulator: Invalid zsAudio lib");else if(e.isObject(t)){var n=null,o=null;qt(t.level)||(n=t.level),qt(t.timeMs)||(o=t.timeMs),i.setGranulatorGain(n,o)}}function je(t){if(qt(i))Ot("runAudioPlayGranulator: Invalid zsAudio lib");else if(e.isObject(t)){var n=null,o=null,r=null,a=null;qt(t.paramName)||(n=t.paramName),qt(t.amplitude)||(o=t.amplitude),qt(t.frequency)||(r=t.frequency),qt(t.duration)||(a=t.duration),i.setGranulatorRampSin(n,o,r,a)}}function Ye(t){qt(i)?Ot("runAudioPlayGranulator: Invalid zsAudio lib"):e.isObject(t)&&(i.setGranulatorConfig(t),i.initGranulator(dn.granulatorIndex))}function Xe(e){K(e.line1,e.line2,e.line3,e.colour,e.isVisible)}function Ze(e){Bt(e.count)&&$(e.count),Bt(e.maxCount)&&ee(e.maxCount),et()}function _e(e){Ge(e)}function Je(e){Pe(e)}function Ke(e){Ye(e)}function $e(e){ae(e)}function et(){if(!qt(dn.meter)){var e=dn.userNo;e<=fn.meterMaxVotes&&(e=fn.meterMaxVotes),dn.meter.set(dn.voteCount,e)}}function tt(t){if(!qt(cn)){cn.innerHTML=Lt;var n=dn.instructions.l1,i=fn.textSpanPrefix+"1",o=dn.instructions.l2,r=fn.textSpanPrefix+"2",a=dn.instructions.l3,s=fn.textSpanPrefix+"3",u=Lt;t||(t=Lt,e.isEmptyString(n)||(u=it(n,u),n=nt(n,i),t+=n),e.isEmptyString(o)||(Ht("displayInstructions: processing line2 "+o),u=it(o,u),o=nt(o,r),t=e.addSuffixIfNotThere(t,fn.textLineBreak),t+=o),e.isEmptyString(a)||(Ht("displayInstructions: processing line3 "+a),u=it(a,u),a=nt(a,s),t=e.addSuffixIfNotThere(t,fn.textLineBreak),t+=a));var l=fn.textFontSize,c=Ut(u,l,cn);cn.style.fontSize=Lt+c+"px",cn.style.fontFamily=fn.textFontFamily,cn.innerHTML=t;var d=e.getChildElement(cn,e.toCssIdQuery(i));qt(d)||(d.style.opacity=0);var f=e.getChildElement(cn,e.toCssIdQuery(r));qt(f)||(f.style.opacity=0);var h=e.getChildElement(cn,e.toCssIdQuery(s));if(qt(h)||(h.style.opacity=0),dn.instructions.isVisible=!0,at(cn,dn.instructions),fn.textSpanIsFadeIn){var m=fn.textSpanFadeTimeSec,p=fn.textSpanFadeStaggerTimeSec;qt(d)||gsap.to(d,{duration:m,autoAlpha:1,ease:"power1.in"}),qt(f)||gsap.to(f,{delay:p,duration:m,autoAlpha:1,ease:"power1.in"}),qt(h)||gsap.to(h,{delay:2*p,duration:m,autoAlpha:1,ease:"power1.in"})}else qt(d)||(d.style.opacity=1),qt(f)||(f.style.opacity=1),qt(h)||(h.style.opacity=1)}}function nt(t,n){for(;e.contains(t,Kt);)t=e.replace(t,Kt,$t);return t=e.wrapInSpanElement(t,n),t}function it(t,n){var i=e.removeMarkup(t);return i.length>n.length?i:n}function ot(e){return fn.textFontType+Wt+e+"px "+fn.textFontFamily}function rt(){qt(cn)||(cn.innerHTML=Lt,dn.instructions.isVisible=!1,at(cn,dn.instructions))}function at(t,n){var i=ut(n);qt(n.bckgCol)||(i.background=n.bckgCol),e.setElementStyleProperty(t,i)}function st(e,t){qt(e)||(t||m(),Bt(e.actions)&&lt(e.actions),Bt(e.instructions)&&Xe(e.instructions),Bt(e.counter)&&Ze(e.counter),Bt(e.playerConfig)&&_e(e.playerConfig),Bt(e.granulatorConfig)&&Ke(e.granulatorConfig),Bt(e.viewState)&&$e(e.viewState),Bt(e.synthConfig)&&Je(e.synthConfig))}function ut(e){return e.isVisible?fn.textStyleVisible:fn.textStyleInvisible}function lt(t){var n=null,i=null,o=[],r={};if(e.isArray(t))for(var a=0;a<t.length;a++){var s=t[a];Bt(s.id)&&(n=s.id),Bt(s.actionType)&&(i=s.actionType),Bt(s.elementIds)&&(o=s.elementIds),Bt(s.params)&&(r=s.params),ct(n,i,o,r)}}function ct(e,t,n,i){if(Ht("doAction: "+e+" actionType: "+t),!qt(t)&&!qt(n))switch(t){case"AUDIO":Fe(e,n,i);break;case"ACTIVATE":ne(e,n,i);break;case"STOP":dt(e,n,i);break;default:Ot("doAction: Unknown actionType: "+t)}}function dt(t,n,i){if(e.isArray(n))for(var o=0;o<n.length;o++)ft(t,n[o],i);else ft(t,n,i)}function ft(t,n,i){if(e.isString(t))switch(Ht("stop: actionId: "+t+Wt+n),t){case"stop":ht(n,i);break;default:return void Ot("Unknown stop actionId: "+t)}}function ht(e,t){if(!qt(e))switch(Ht("runStopAction: target: "+e),e){case"all":mt(t);break;case"player":pt(t)}}function mt(e){Ht("runStopAll: "),!qt(i)&&i.isReady()&&(pt(),vt())}function pt(){qt(i)?Ot("runAudioStopPlayer: Invalid zsAudio lib"):i.stopPlayer()}function vt(){qt(i)?Ot("runAudioStopNoise: Invalid zsAudio lib"):i.stopNoise()}function bt(){return e.getElement(fn.instructionTxtElementId)}function gt(){return e.getElement(fn.meterGroupId)}function yt(){return e.getElement(fn.thumbUpGroupId)}function xt(){return e.getElement(fn.thumbUpRectId)}function It(){return e.getElement(fn.thumbDownRectId)}function wt(){return e.getElement(fn.thumbDownGroupId)}function St(){return dn.thumbUpTween}function Mt(){return dn.thumbDownTween}function At(){return dn.noteUpTween}function Dt(){return dn.noteDownTween}function Ut(e,t,n){var i=1;a.innerWidth||s.documentElement.clientWidth||s.body.clientWidth;var o=a.innerHeight||s.documentElement.clientHeight||s.body.clientHeight,r=(ot(i),n.clientWidth),u=r*fn.textWidthCompressor,l=o*fn.textAreaMax;i=Ct(e,t,u),i=Tt(r,i,l);var c=fn.textMaxFontSize;return i>c&&(i=c),i}function Tt(e,t,n){var i=ot(t),o=t,r=kt(i,e,n);if(r<0)return o;var a=r*fn.textNumberOfLines,s=n/a;return s<1&&(o*=s),o}function Ct(e,t,n){var i=ot(t),o=Ft(i,e),r=o.width;if(r<=0||r>n||Math.abs(n-r)<1)return t;var a=n/r,s=t*a;return Ct(e,s,n)}function Ft(e,t){var n=dn.fontCanvas,i=dn.canvasCtx;return i.fillRect(0,0,n.width,n.height),i.textBaseline="top",i.fillStyle=Yt,i.font=e,i.measureText(t)}function kt(e,t,n){var i=dn.fontCanvas,o=dn.canvasCtx;i.width=t,i.height=n,o.fillRect(0,0,i.width,i.height),o.textBaseline="top",o.fillStyle=Yt,o.font=e;var r="gM";o.fillText(r,0,0);for(var a=o.getImageData(0,0,i.width,i.height).data,s=-1,u=-1,l=0;l<i.height;l++)for(var c=0;c<i.width;c++){var d=4*(l*i.width+c);if(0!==a[d]){-1===s&&(s=l);break}if(c===i.width-1&&-1!==s){u=l,l=i.height;break}}var f=(u-s)*fn.textHeightCompressor;return f}function Et(){if(Ht("onThumbsUp:"),dn.isThumbEnabled){if(X())return;e.setElementAttributes(yt(),fn.filterInActiveAttrib),e.playOrRestartTween(St())}if(dn.isNoteEnabled){if(_()||J())return;W(fn.noteDownSymId),e.playOrRestartTween(At()),F()}dn.isVotingEnabled&&Y(_t)}function Vt(){if(Ht("onThumbsDown:"),dn.isThumbEnabled){if(Z())return;e.setElementAttributes(wt(),fn.filterInActiveAttrib),e.playOrRestartTween(Mt())}if(dn.isNoteEnabled){if(_()||J())return;W(fn.noteUpSymId),e.playOrRestartTween(Dt()),k()}dn.isVotingEnabled&&Y(Jt)}function Nt(e){Ht("onMouseUpThumbsUp:"),un||Et()}function Rt(e){Ht("onTouchEndThumbsUp:"),un&&Et()}function Pt(e){Ht("onMouseUpThumbsDown:"),un||Vt()}function Gt(e){Ht("onTouchEndThumbsDown:"),un&&Vt()}function zt(t,n){e.setElementAttributes(t,n)}function qt(t){return e.isNull(t)}function Bt(t){return e.isNotNull(t)}function Ot(t){e.logError(t)}function Ht(t){e.log(t)}const Qt="DEV",Lt="",Wt=" ",jt="Rect",Yt="#FFFFFF",Xt="VOTE",Zt="value",_t=1,Jt=-1,Kt="&#39;",$t="'",en="thumbs",tn="notes",nn="meter",on="vote",rn="audio";var an=["/audio/DialogsRhythm7-1.wav"],sn=[[0]],un=null,ln=null,cn=null,dn={bpm:80,synthBpm:80,instructions:{isVisible:!1,l1:Lt,l2:Lt,l3:Lt,bckgCol:"rgba(225, 225, 225, 0.85)"},voteCount:0,userNo:10,meter:null,currentVote:null,voteTimeMs:0,thumbUpTween:null,thumbDownTween:null,noteUpTween:null,noteUpDurationSec:1,noteDownTween:null,noteDownDurationSec:1,isVotingEnabled:!1,isThumbEnabled:!1,isNoteEnabled:!0,granulatorIndex:0,filterFreq:1,filterQ:0,noteUpFreq:[523.25,631.62,739.99],noteDownFreq:[261.63,315.81,369.99],noiseFreqs:[261.63,369.99,523.25,739.99,1046.5,1479.98,2093,2959.96,4186.01,5919.91],isAudioEnabled:!0,currentSection:null,isSectionActive:!1,filterMod:null,meterAudioValue:0,noiseFreq:1e3,noiseQ:100,filterDetuneTween:null},fn={connectionPreference:"ws,sse,poll",appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",textSpanPrefix:"is",instructionTxtElementId:"instructionTxt",textLineBreak:"<br/>",textStyleInvisible:{visibility:"hidden"},textStyleVisible:{visibility:"visible"},textFontFamily:"Arial",textFontType:"normal",textFontSize:50,textMaxFontSize:70,textMaxLineLen:30,textHeightCompressor:1.1,textWidthCompressor:.9,textAreaMax:.4,textNumberOfLines:3,textSpanIsFadeIn:!0,textSpanFadeTimeSec:1,textSpanFadeStaggerTimeSec:.5,voteTimeoutMs:5e3,noteDurationMultipler:8,noteFreqMultipler:1,loadingIconId:"loadingIcon",elementGroupSuffix:"Grp",meterGroupId:"meterGrp",thumbUpRectId:"thUpRect",thumbDownRectId:"thDownRect",thumbUpGroupId:"thumbUpGrp",thumbUpPathId:"thumbUpPth",thumbUpSymId:"thumbUpSym",thumbDownGroupId:"thumbDownGrp",thumbDownPathId:"thumbDownPth",thumbDownSymId:"thumbDownSym",noteUpGroupId:"noteUpGrp",noteUpSymId:"noteUpSym",noteDownGroupId:"noteDownGrp",noteDownSymId:"noteDownSym",meterBoxIdPrefix:"meterBox",meterBoxNo:20,meterMaxVotes:10,meterInactiveStyle:{fill:"none",stroke:"black","stroke-width":"4px"},meterZeroStyle:{fill:"yellow"},thumbsUpActiveStyle:{fill:"green"},thumbsUpInActiveStyle:{fill:"none"},thumbsDownActiveStyle:{fill:"red"},thumbsDownInActiveStyle:{fill:"none"},centreX:450,centreY:800,meterBoxWidth:80,meterBoxHeight:40,negativeMinCol:{r:255,g:165,b:0},negativeMaxCol:{r:255,g:0,b:0},positiveMinCol:{r:255,g:255,b:0},positiveMaxCol:{r:0,g:125,b:0},maxNoiseLevel:1,audioFadeInMs:1e3,filterGreenAttrib:{filter:"url(#dropshadowgreen)"},filterRedAttrib:{filter:"url(#dropshadowred)"},filterInActiveAttrib:{filter:"none"},noteUpConfig:{minAngle:0,maxAngle:360},noteDurations:[o.DURATION.MINIM,o.DURATION.CROTCHET,o.DURATION.QUAVER,o.DURATION.SEMI_QUAVER],noteSymbolsUp:["minimUp","crotchetUp","quaverUp","semiquaverUp"],noteSymbolsDown:["minimDown","crotchetDown","quaverDown","semiquaverDown"],availableViews:[en,tn,nn,on,rn],maxNoiseFreq:5e3,minNoiseFreq:300,maxNoiseQ:10,minNoiseQ:1,noiseFilterQSteps:[300,100,70,50,30,20,15,10,5,3]};return l.prototype.init=function(){if(!qt(this.styleConfig)&&e.isNumeric(this.boxNo)&&e.isNumeric(this.midX)&&e.isNumeric(this.midY)){var t=e.isOddNumber(this.boxNo),n=Math.round(this.boxNo/2);this.positiveMaxIndex=this.boxNo-1,this.positiveMinIndex=n,this.negativeMinIndex=n-1,this.negativeMaxIndex=0,this.zeroIndex=null;var i=this.midY+n*this.boxHeight;t&&(this.negativeMinIndex=n-2,this.zeroIndex=n-1,i=this.midY+this.boxHeight/2+this.zeroIndex*this.boxHeight);for(var o=i,r=this.midX-this.boxWidth/2,a=0;a<this.boxNo;++a){var s=this.boxIdPrefix+a,u=this.boxSvgIdPrefix+a,l=o-this.boxHeight,c=this.getActiveStyle(a),f=new d(s,u,r,l,this.boxWidth,this.boxHeight,this.styleConfig.inactiveStyle,c);this.boxes[a]=f,o=l}this.draw(),this.isInitialised=!0}else Ot("ZScoreMeter.init: invalid inputs")},l.prototype.getActiveStyle=function(t){var n="yellow";if(!qt(this.zeroIndex)&&t===this.zeroIndex)return this.styleConfig.zeroStyle;if(t>=this.positiveMinIndex&&t<=this.positiveMaxIndex){var i=0;this.positiveMaxIndex!=this.positiveMinIndex&&(i=(t-this.positiveMinIndex)/(this.positiveMaxIndex-this.positiveMinIndex));var o=e.interpolateRgbColours(this.styleConfig.posMinRGB,this.styleConfig.posMaxRGB,i);qt(o)||(n=e.rgbToHex(o.r,o.g,o.b))}else if(t>=this.negativeMaxIndex&&t<=this.negativeMinIndex){i=0;this.negativeMinIndex!=this.negativeMaxIndex&&(i=(this.negativeMinIndex-t)/(this.negativeMinIndex-this.negativeMaxIndex));o=e.interpolateRgbColours(this.styleConfig.negMinRGB,this.styleConfig.negMaxRGB,i);qt(o)||(n=e.rgbToHex(o.r,o.g,o.b))}return{fill:n}},l.prototype.clear=function(){for(var e=0;e<this.boxes.length;++e)this.setBoxStyle(e,this.styleConfig.inactiveStyle)},l.prototype.draw=function(){for(var e=0;e<this.boxes.length;++e)this.boxes[e].draw()},l.prototype.setPlayAudio=function(e){this.isPlayAudio=e,this.playAudio(this.currentValue,this.currentMaxVal)},l.prototype.set=function(t,n){if(e.isNumeric(t)&&e.isNumeric(n))if(this.clear(),qt(this.zeroIndex)||this.activateBox(this.zeroIndex,!0),t>0){n<0&&(n*=-1);var i=1,o=n;o<i&&(o=i),t>o&&(t=o);for(var r=Math.floor(e.mapRange(t,i,o,this.positiveMinIndex,this.positiveMaxIndex)),a=this.positiveMinIndex;a<=r;a++)this.activateBox(a,!0);this.currentValue=t,this.currentMaxVal=o,this.playAudio(t,o)}else{n>0&&(n*=-1);i=-1,o=n;o>i&&(o=i),t<o&&(t=o);for(r=Math.ceil(e.mapRange(t,i,o,this.negativeMinIndex,this.negativeMaxIndex)),a=this.negativeMinIndex;a>=r;a--)this.activateBox(a,!0);this.currentValue=t,this.currentMaxVal=o,this.playAudio(t,o)}},l.prototype.activateBox=function(e,t){var n=this.boxes[e];qt(n)||n.setActive(t)},l.prototype.setBoxStyle=function(e,t){var n=this.boxes[e];qt(n)||n.setStyle(t)},l.prototype.playAudio=function(e,t){this.isPlayAudio&&C(e,t)},d.prototype.draw=function(){var t=gt();if(!qt(t)){var i=n.createSvgRectangle(this.x,this.y,this.width,this.height,this.svgId);zt(i,this.inactiveStyle),e.addChildToParent(t,i)}},d.prototype.setStyle=function(t){var n=e.getElement(this.svgId);qt(n)||zt(n,t)},d.prototype.setActive=function(t){var n=e.getElement(this.svgId);qt(n)||zt(n,t?this.activeStyle:this.inactiveStyle)},{load:function(){f()},onThumbsDownSelect:function(){Vt()},onThumbsUpSelect:function(){Et()}}}(zsUtil,zsNet,zsSvg,zsAudio,zsMusic,zsSynth,window,document);