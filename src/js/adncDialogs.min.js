var zscore=function(t,e,n,i,o,r,a,s){"use strict";function u(t){this.message=t,this.name="ZScoreException"}function l(t,e,n,i,o,r,a){this.boxNo=t,this.midX=e,this.midY=n,this.boxWidth=i,this.boxHeight=o,this.boxIdPrefix=r,this.styleConfig=a,this.boxSvgIdPrefix=r+He,this.boxes=[],this.isInitialised=!1,this.positiveMinIndex=0,this.positiveMaxIndex=0,this.negativeMinIndex=0,this.negativeMaxIndex=0,this.zeroIndex=null,this.isPlayAudio=!1,this.currentValue=0,this.currentMaxVal=0}function c(t,e,n,i,o,r){this.inactiveStyle=t,this.zeroStyle=e,this.negMinRGB=n,this.negMaxRGB=i,this.posMinRGB=o,this.posMaxRGB=r}function d(t,e,n,i,o,r,a,s){this.id=t,this.svgId=e,this.x=n,this.y=i,this.width=o,this.height=r,this.inactiveStyle=a,this.activeStyle=s}function f(){ze("onLoad: "),h()}function h(){if(!(t&&e&&n&&i&&o&&r))throw new u("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio, zsSynth and zsMusic");t.setRunMode(Be),ze("init: "),on=t.isTouchDevice(),rn=t.isSafari(navigator),ze("init: IsTouch Device: "+on+" isSafari: "+rn),sn.fontCanvas=s.createElement("canvas"),sn.canvasCtx=sn.fontCanvas.getContext("2d"),v(),I(),y(),S(),A(),M(),D(),p(),b()}function m(){x()}function p(){wt(),Mt(),Tt()}function v(){e.init(un.connectionPreference,un.appUrlSse,un.appUrlWebsockets,un.appUrlHttp,ie)}function b(){e.getServerState()}function g(){i.initNoise(),i.initPlayer(),i.initSynth(),i.initGranulator(sn.granulatorIndex),t.makeInVisible(un.loadingIconId),ze("onAudioLoaded: completed")}function y(){ze("initAudio: #####"),Re(i)?Ge("initAudio: invalid zsAudio lib"):i.init(en,g)}function x(){Re(i)?Ge("resetAudio: invalid zsAudio lib"):i.reset()}function I(){n.init(),w()}function w(){var e=ve();Pe(e)&&(t.listen("touchend",e,ke),t.listen("mouseup",e,Fe));var n=be();Pe(n)&&(t.listen("touchend",n,Ve),t.listen("mouseup",n,Ee))}function S(){var t=new c(un.meterInactiveStyle,un.meterZeroStyle,un.negativeMinCol,un.negativeMaxCol,un.positiveMinCol,un.positiveMaxCol),e=new l(un.meterBoxNo,un.centreX,un.centreY,un.meterBoxWidth,un.meterBoxHeight,un.meterBoxIdPrefix,t);e.init(),sn.meter=e}function A(){var e=he();Re(e)||(an=e,t.listen("resize",a,et),t.listen("orientationchange",a,et),K("Welcome to","<span style='color:blueviolet;'>ZScore</span>","awaiting performance start ...",null,!0))}function M(){var e=un.voteTimeoutMs/1e3;sn.thumbUpTween=gsap.from(t.toCssIdQuery(un.thumbUpSymId),{duration:e,scaleY:.5,fill:"green",transformOrigin:"right bottom",paused:!0,ease:"slow(0.9, 0.4, false)",onComplete:B}),sn.thumbUpTween.progress(1),sn.thumbDownTween=gsap.from(t.toCssIdQuery(un.thumbDownSymId),{duration:e,scaleY:.5,fill:"red",transformOrigin:"left top",paused:!0,ease:"slow(0.9, 0.4, false)",onComplete:O}),sn.thumbDownTween.progress(1)}function D(){T(),U()}function T(){var e=t.getRandomIntFromRange(0,un.noteDurations.length-1),n=un.noteDurations[e],i=t.toCssIdQuery(un.noteSymbolsUp[e]),o=t.getElement(un.noteUpSymId);o.setAttribute("href",i),o.setAttribute("xlink:href",i);var r=R()*un.noteDurationMultipler;sn.noteUpDurationSec=n*r,sn.noteUpTween=P()}function U(){var e=t.getRandomIntFromRange(0,un.noteDurations.length-1),n=un.noteDurations[e],i=t.toCssIdQuery(un.noteSymbolsDown[e]),o=t.getElement(un.noteDownSymId);o.setAttribute("href",i),o.setAttribute("xlink:href",i);var r=R()*un.noteDurationMultipler;sn.noteDownDurationSec=n*r,sn.noteDownTween=G()}function C(e,n){sn.meterAudioValue;if(sn.meterAudioValue=e,sn.isAudioEnabled){if(0===e)return i.stopNoise(),void i.setPlayerVolume(0,500);if(e>0){i.stopNoise();var o=t.mapRange(Math.abs(e),0,Math.abs(n),0,1);i.setPlayerVolume(o,un.audioFadeInMs)}else{var r=Math.abs(e);r>10?r=10:r<1&&(r=1),i.setPlayerVolume(0,un.audioFadeInMs);o=t.mapRange(Math.abs(e),0,Math.abs(n),.5,un.maxNoiseLevel);var a=0,s=sn.noiseFreqs.length-1;r<4?s=Math.floor(s/3):r>3&&r<7?(a=Math.floor(s/3),s=Math.floor(2*s/3)):r>6&&(a=Math.floor(s/2));var u=t.getRandomIntFromRange(a,s),l=sn.noiseFreqs[u];i.setNoiseFilterFreq(l),sn.noiseFreq=l;var c=un.noiseFilterQSteps[r-1];sn.noiseQ=c,i.setNoiseFilterQ(c),i.playNoise(o)}}}function F(){E()}function k(){V()}function E(){var e=t.getRandomIntFromRange(0,sn.noteUpFreq.length-1),n=sn.noteUpFreq[e];ze("playing freq: "+n),i.playSynth(n,sn.noteUpDurationSec)}function V(){var e=t.getRandomIntFromRange(0,sn.noteDownFreq.length-1),n=sn.noteDownFreq[e];ze("playing freq: "+n),i.playSynth(n,sn.noteDownDurationSec)}function N(){var t=o.getBeatDurationSec(sn.bpm);return Re(t)&&(t=1),t}function R(){var t=N();return 4*t}function P(){var t=sn.noteUpDurationSec,e={sign:-1,angleMin:0,angleMax:120,rMin:10,rMax:30,rotAngleMin:-360,rotAngleMax:360,xmod:20,ymod:30};return z(t,un.noteUpSymId,e,q)}function G(){var t=sn.noteDownDurationSec,e={sign:1,angleMin:0,angleMax:120,rMin:20,rMax:40,rotAngleMin:-360,rotAngleMax:360,xmod:0,ymod:0};return z(t,un.noteDownSymId,e,H)}function z(e,n,i,o){var r=t.randomIntFromInterval(i.angleMin,i.angleMax),a=t.randomIntFromInterval(i.rMin,i.rMax),s=0,u=i.sign,l=u*a;if(r<90){var c=t.toRadians(r);s=u*a*Math.cos(c),l=u*a*Math.sin(c)}else if(r>90){c=t.toRadians(180-r);s=-1*u*a*Math.cos(c),l=u*a*Math.sin(c)}s+=i.xmod,l+=i.ymod;var d=t.randomIntFromInterval(i.rotAngleMin,i.rotAngleMax);return gsap.to(t.toCssIdQuery(n),{duration:e,scale:.1,autoAlpha:0,rotation:d,x:s,y:l,ease:"slow(0.9, 0.4, false)",paused:!0,onComplete:o})}function B(){t.setElementAttributes(pe(),un.filterGreenAttrib)}function O(){t.setElementAttributes(ge(),un.filterRedAttrib)}function q(){Q(un.noteUpSymId),T(),L(un.noteUpSymId),L(un.noteDownSymId)}function H(){Q(un.noteDownSymId),U(),L(un.noteDownSymId),L(un.noteUpSymId)}function Q(e){gsap.set(t.toCssIdQuery(e),{autoAlpha:0,scale:1,rotation:0,x:0,y:0})}function L(e){Re(e)||gsap.to(t.toCssIdQuery(e),{duration:1,autoAlpha:1})}function W(e){Re(e)||gsap.to(t.toCssIdQuery(e),{duration:1,autoAlpha:0,onComplete:j,onCompleteParams:[e]})}function j(e){t.makeInVisible(e)}function Y(t){sn.currentVote=t;var n={};n[We]=t,e.sendEvent(Le,n)}function X(){return Pe(sn.thumbUpTween)&&sn.thumbUpTween.isActive()}function Z(){return Pe(sn.thumbDownTween)&&sn.thumbDownTween.isActive()}function _(){return Pe(sn.noteUpTween)&&sn.noteUpTween.isActive()}function J(){return Pe(sn.noteDownTween)&&sn.noteDownTween.isActive()}function K(t,e,n,i,o){if(!Re(an)){var r=!1;if(!Re(t)){var a=t.trim();sn.instructions.l1!=a&&(sn.instructions.l1=a,r=!0)}if(!Re(e)){a=e.trim();sn.instructions.l2!=a&&(sn.instructions.l2=a,r=!0)}if(!Re(n)){a=n.trim();sn.instructions.l3!=a&&(sn.instructions.l3=a,r=!0)}Re(i)||(sn.instructions.bckgCol=i),o?r&&Jt():ee()}}function $(e){Re(e)||(t.isNumeric(e)||(e=t.toInt(e)),sn.voteCount=e)}function tt(e){Re(e)||(t.isNumeric(e)||(e=t.toInt(e)),sn.userNo=e)}function et(e){if(!t.isObject(this))return null;Jt()}function nt(e,n,i){if(t.isArray(n))for(var o=0;o<n.length;o++)it(e,n[o],i);else it(e,n,i)}function it(t,e,n){if(!Re(e))switch(ze("runActivate: "+t+qe+e),e){case"view":ot(t,n)}}function ot(e,n){if(t.isString(e))switch(e){case"section":rt(n);break;default:return void Ge("activateView: Unknown actionId: "+e)}}function rt(e){if(t.isObject(e)){var n=null;Re(e.id)||(n=e.id),dt(n)}}function at(e){if(!Re(e)){var n=null,i=!1;if(Pe(e.isSectionActive)&&(i=e.isSectionActive),Pe(e.sectionName)&&(n=e.sectionName),st(n,i),Pe(e.activeViews)){for(var o=[],r=0;r<un.availableViews.length;r++)t.arrContains(e.activeViews,un.availableViews[r])||o.push(un.availableViews[r]);ut(o),lt(e.activeViews)}}}function st(t,e){sn.currentSection=t,sn.isSectionActive=e}function ut(t){for(var e=0;e<t.length;e++)ct(t[e])}function lt(t){for(var e=0;e<t.length;e++)ot(t[e])}function ct(t){switch(t){case _e:gt();break;case Je:bt();break;case Ke:yt();break;case $e:xt();break;case tn:It();break;default:ze("deactivateView: unknown view: "+t)}}function ot(t){switch(t){case _e:ht();break;case Je:ft();break;case Ke:mt();break;case $e:pt();break;case tn:vt();break;default:ze("activateView: unknown view: "+t)}}function dt(t){}function ft(){Dt()}function ht(){At()}function mt(){Ut()}function pt(){wt()}function vt(){sn.isAudioEnabled=!0,Pe(sn.meter)&&sn.meter.setPlayAudio(!0)}function bt(){Tt()}function gt(){Mt()}function yt(){Ct()}function xt(){St()}function It(){sn.isAudioEnabled=!1,Pe(sn.meter)&&sn.meter.setPlayAudio(!1),ce()}function wt(){sn.isVotingEnabled=!0}function St(){sn.isVotingEnabled=!1}function At(){t.makeVisible(un.thumbUpGroupId),t.makeVisible(un.thumbDownGroupId),L(un.thumbUpSymId),L(un.thumbDownSymId),sn.isThumbEnabled=!0}function Mt(){W(un.thumbUpSymId),W(un.thumbDownSymId),sn.isThumbEnabled=!1}function Dt(){t.makeVisible(un.noteUpGroupId),t.makeVisible(un.noteDownGroupId),L(un.noteUpSymId),L(un.noteDownSymId),sn.isNoteEnabled=!0}function Tt(){W(un.noteUpSymId),W(un.noteDownSymId),sn.isNoteEnabled=!1}function Ut(){t.makeVisible(un.meterGroupId),L(un.meterGroupId)}function Ct(){W(un.meterGroupId)}function Ft(e,n,i){if(t.isArray(n))for(var o=0;o<n.length;o++)kt(e,n[o],i);else kt(e,n,i)}function kt(t,e,n){if(!Re(e))switch(ze("runAudio: "+t+qe+e),e){case"all":Et(t,n);break;case"player":Nt(t,n);break;case"granulator":zt(t,n)}}function Et(e,n){if(t.isString(e))switch(e){case"volume":Vt(n);break;default:return void Ge("runPlayer: Unknown actionId: "+e)}}function Vt(e){if(Re(i))Ge("setAudioMasterVolume: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null;Re(e.level)||(n=e.level),Re(e.timeMs)||(o=e.timeMs),i.setMasterVolume(n,o)}}function Nt(e,n){if(t.isString(e))switch(e){case"play":Pt(n);break;case"volume":Gt(n);break;case"config":Rt(n);break;default:return void Ge("runPlayer: Unknown actionId: "+e)}}function Rt(e){if(Re(i))Ge("updateAudioPlayerCofig: Invalid zsAudio lib");else if(t.isObject(e)){var n=!1;if(!Re(e.audioFiles)){var o=e.audioFiles;t.isArray(o)?t.arrEquals(en,o)?ze("updateAudioPlayerCofig: audioFiles array identical, ignoring update"):(en=o,ze("updateAudioPlayerCofig: audioFiles array set to: "+en),n=!0):Ge("updateAudioPlayerCofig: invalid audioFiles array")}if(!Re(e.audioFilesIndexMap)){var r=e.audioFilesIndexMap;!t.isArray(r)||r.length<1?Ge("updateAudioPlayerCofig: invalid fileIndexMap array"):nn=r}n&&(ze("updateAudioPlayerCofig: laoding audioFiles"),t.makeVisible(un.loadingIconId),i.loadAudioBuffers(en))}}function Pt(e){if(Re(i))Ge("runPlayerPlay: Invalid zsAudio lib");else if(t.isObject(e)){var n=0;Re(e.index)||(t.isString(e.index)?n=t.toInt(e.index):t.isNumeric(e.index)&&(n=e.index));var o=n;if(n>0&&n<nn.length){var r=nn[n];o=t.randomArrayElement(r)}var a=null,s=null,u=null;Re(e.startTime)||(a=e.startTime),Re(e.offset)||(s=e.offset),Re(e.duration)||(u=e.duration),i.playAudio(o,a,s,u)}}function Gt(e){if(Re(i))Ge("setAudioMasterVolume: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null;Re(e.level)||(n=e.level),Re(e.timeMs)||(o=e.timeMs),i.setPlayerVolume(n,o)}}function zt(e,n){if(t.isString(e))switch(e){case"play":Bt(n);break;case"stop":Ot(n);break;case"config":Lt(n);break;case"rampLinear":qt(n);break;case"rampSin":Qt(n);break;case"volume":Ht(n);break;default:return void Ge("runAudioGranulator: Unknown actionId: "+e)}}function Bt(t){Re(i)?Ge("runAudioPlayGranulator: Invalid zsAudio lib"):i.playGranulator()}function Ot(t){Re(i)?Ge("runAudioPlayGranulator: Invalid zsAudio lib"):i.stopGranulator()}function qt(e){if(Re(i))Ge("runAudioPlayGranulator: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null,r=null;Re(e.paramName)||(n=e.paramName),Re(e.endValue)||(o=e.endValue),Re(e.duration)||(r=e.duration),i.setGranulatorRampLinear(n,o,r)}}function Ht(e){if(Re(i))Ge("runAudioPlayGranulator: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null;Re(e.level)||(n=e.level),Re(e.timeMs)||(o=e.timeMs),i.setGranulatorGain(n,o)}}function Qt(e){if(Re(i))Ge("runAudioPlayGranulator: Invalid zsAudio lib");else if(t.isObject(e)){var n=null,o=null,r=null,a=null;Re(e.paramName)||(n=e.paramName),Re(e.amplitude)||(o=e.amplitude),Re(e.frequency)||(r=e.frequency),Re(e.duration)||(a=e.duration),i.setGranulatorRampSin(n,o,r,a)}}function Lt(e){Re(i)?Ge("runAudioPlayGranulator: Invalid zsAudio lib"):t.isObject(e)&&(i.setGranulatorConfig(e),i.initGranulator(sn.granulatorIndex))}function Wt(t){K(t.line1,t.line2,t.line3,t.colour,t.isVisible)}function jt(t){Pe(t.count)&&$(t.count),Pe(t.maxCount)&&tt(t.maxCount),_t()}function Yt(t){Rt(t)}function Xt(t){Lt(t)}function Zt(t){at(t)}function _t(){if(!Re(sn.meter)){var t=sn.userNo;t<=un.meterMaxVotes&&(t=un.meterMaxVotes),sn.meter.set(sn.voteCount,t)}}function Jt(e){if(!Re(an)){an.innerHTML=Oe;var n=sn.instructions.l1,i=un.textSpanPrefix+"1",o=sn.instructions.l2,r=un.textSpanPrefix+"2",a=sn.instructions.l3,s=un.textSpanPrefix+"3",u=Oe;e||(e=Oe,t.isEmptyString(n)||(u=$t(n,u),n=Kt(n,i),e+=n),t.isEmptyString(o)||(ze("displayInstructions: processing line2 "+o),u=$t(o,u),o=Kt(o,r),e=t.addSuffixIfNotThere(e,un.textLineBreak),e+=o),t.isEmptyString(a)||(ze("displayInstructions: processing line3 "+a),u=$t(a,u),a=Kt(a,s),e=t.addSuffixIfNotThere(e,un.textLineBreak),e+=a));var l=un.textFontSize,c=Se(u,l,an);an.style.fontSize=Oe+c+"px",an.style.fontFamily=un.textFontFamily,an.innerHTML=e;var d=t.getChildElement(an,t.toCssIdQuery(i));Re(d)||(d.style.opacity=0);var f=t.getChildElement(an,t.toCssIdQuery(r));Re(f)||(f.style.opacity=0);var h=t.getChildElement(an,t.toCssIdQuery(s));if(Re(h)||(h.style.opacity=0),sn.instructions.isVisible=!0,ne(an,sn.instructions),un.textSpanIsFadeIn){var m=un.textSpanFadeTimeSec,p=un.textSpanFadeStaggerTimeSec;Re(d)||gsap.to(d,{duration:m,autoAlpha:1,ease:"power1.in"}),Re(f)||gsap.to(f,{delay:p,duration:m,autoAlpha:1,ease:"power1.in"}),Re(h)||gsap.to(h,{delay:2*p,duration:m,autoAlpha:1,ease:"power1.in"})}else Re(d)||(d.style.opacity=1),Re(f)||(f.style.opacity=1),Re(h)||(h.style.opacity=1)}}function Kt(e,n){for(;t.contains(e,Xe);)e=t.replace(e,Xe,Ze);return e=t.wrapInSpanElement(e,n),e}function $t(e,n){var i=t.removeMarkup(e);return i.length>n.length?i:n}function te(t){return un.textFontType+qe+t+"px "+un.textFontFamily}function ee(){Re(an)||(an.innerHTML=Oe,sn.instructions.isVisible=!1,ne(an,sn.instructions))}function ne(e,n){var i=oe(n);Re(n.bckgCol)||(i.background=n.bckgCol),t.setElementStyleProperty(e,i)}function ie(t,e){Re(t)||(e||m(),Pe(t.actions)&&re(t.actions),Pe(t.instructions)&&Wt(t.instructions),Pe(t.counter)&&jt(t.counter),Pe(t.playerConfig)&&Yt(t.playerConfig),Pe(t.granulatorConfig)&&Xt(t.granulatorConfig),Pe(t.viewState)&&Zt(t.viewState))}function oe(t){return t.isVisible?un.textStyleVisible:un.textStyleInvisible}function re(e){var n=null,i=null,o=[],r={};if(t.isArray(e))for(var a=0;a<e.length;a++){var s=e[a];Pe(s.id)&&(n=s.id),Pe(s.actionType)&&(i=s.actionType),Pe(s.elementIds)&&(o=s.elementIds),Pe(s.params)&&(r=s.params),ae(n,i,o,r)}}function ae(t,e,n,i){if(ze("doAction: "+t+" actionType: "+e),!Re(e)&&!Re(n))switch(e){case"AUDIO":Ft(t,n,i);break;case"ACTIVATE":nt(t,n,i);break;case"STOP":se(t,n,i);break;default:Ge("doAction: Unknown actionType: "+e)}}function se(e,n,i){if(t.isArray(n))for(var o=0;o<n.length;o++)ue(e,n[o],i);else ue(e,n,i)}function ue(e,n,i){if(t.isString(e))switch(ze("stop: actionId: "+e+qe+n),e){case"stop":le(n,i);break;default:return void Ge("Unknown stop actionId: "+e)}}function le(t,e){if(!Re(t))switch(ze("runStopAction: target: "+t),t){case"all":ce(e);break;case"player":de(e)}}function ce(t){ze("runStopAll: "),!Re(i)&&i.isReady()&&(de(),fe())}function de(){Re(i)?Ge("runAudioStopPlayer: Invalid zsAudio lib"):i.stopPlayer()}function fe(){Re(i)?Ge("runAudioStopNoise: Invalid zsAudio lib"):i.stopNoise()}function he(){return t.getElement(un.instructionTxtElementId)}function me(){return t.getElement(un.meterGroupId)}function pe(){return t.getElement(un.thumbUpGroupId)}function ve(){return t.getElement(un.thumbUpRectId)}function be(){return t.getElement(un.thumbDownRectId)}function ge(){return t.getElement(un.thumbDownGroupId)}function ye(){return sn.thumbUpTween}function xe(){return sn.thumbDownTween}function Ie(){return sn.noteUpTween}function we(){return sn.noteDownTween}function Se(t,e,n){var i=1;a.innerWidth||s.documentElement.clientWidth||s.body.clientWidth;var o=a.innerHeight||s.documentElement.clientHeight||s.body.clientHeight,r=(te(i),n.clientWidth),u=r*un.textWidthCompressor,l=o*un.textAreaMax;i=Me(t,e,u),i=Ae(r,i,l);var c=un.textMaxFontSize;return i>c&&(i=c),i}function Ae(t,e,n){var i=te(e),o=e,r=Te(i,t,n);if(r<0)return o;var a=r*un.textNumberOfLines,s=n/a;return s<1&&(o*=s),o}function Me(t,e,n){var i=te(e),o=De(i,t),r=o.width;if(r<=0||r>n||Math.abs(n-r)<1)return e;var a=n/r,s=e*a;return Me(t,s,n)}function De(t,e){var n=sn.fontCanvas,i=sn.canvasCtx;return i.fillRect(0,0,n.width,n.height),i.textBaseline="top",i.fillStyle=Qe,i.font=t,i.measureText(e)}function Te(t,e,n){var i=sn.fontCanvas,o=sn.canvasCtx;i.width=e,i.height=n,o.fillRect(0,0,i.width,i.height),o.textBaseline="top",o.fillStyle=Qe,o.font=t;var r="gM";o.fillText(r,0,0);for(var a=o.getImageData(0,0,i.width,i.height).data,s=-1,u=-1,l=0;l<i.height;l++)for(var c=0;c<i.width;c++){var d=4*(l*i.width+c);if(0!==a[d]){-1===s&&(s=l);break}if(c===i.width-1&&-1!==s){u=l,l=i.height;break}}var f=(u-s)*un.textHeightCompressor;return f}function Ue(){if(ze("onThumbsUp:"),sn.isThumbEnabled){if(X())return;t.setElementAttributes(pe(),un.filterInActiveAttrib),t.playOrRestartTween(ye())}if(sn.isNoteEnabled){if(_()||J())return;W(un.noteDownSymId),t.playOrRestartTween(Ie()),F()}sn.isVotingEnabled&&Y(je)}function Ce(){if(ze("onThumbsDown:"),sn.isThumbEnabled){if(Z())return;t.setElementAttributes(ge(),un.filterInActiveAttrib),t.playOrRestartTween(xe())}if(sn.isNoteEnabled){if(_()||J())return;W(un.noteUpSymId),t.playOrRestartTween(we()),k()}sn.isVotingEnabled&&Y(Ye)}function Fe(t){ze("onMouseUpThumbsUp:"),on||Ue()}function ke(t){ze("onTouchEndThumbsUp:"),on&&Ue()}function Ee(t){ze("onMouseUpThumbsDown:"),on||Ce()}function Ve(t){ze("onTouchEndThumbsDown:"),on&&Ce()}function Ne(e,n){t.setElementAttributes(e,n)}function Re(e){return t.isNull(e)}function Pe(e){return t.isNotNull(e)}function Ge(e){t.logError(e)}function ze(e){t.log(e)}const Be="DEV",Oe="",qe=" ",He="Rect",Qe="#FFFFFF",Le="VOTE",We="value",je=1,Ye=-1,Xe="&#39;",Ze="'",_e="thumbs",Je="notes",Ke="meter",$e="vote",tn="audio";var en=["/audio/DialogsRhythm7-1.wav"],nn=[[0]],on=null,rn=null,an=null,sn={bpm:80,instructions:{isVisible:!1,l1:Oe,l2:Oe,l3:Oe,bckgCol:"rgba(225, 225, 225, 0.85)"},voteCount:0,userNo:10,meter:null,currentVote:null,voteTimeMs:0,thumbUpTween:null,thumbDownTween:null,noteUpTween:null,noteUpDurationSec:1,noteDownTween:null,noteDownDurationSec:1,isVotingEnabled:!1,isThumbEnabled:!1,isNoteEnabled:!0,granulatorIndex:0,filterFreq:1,filterQ:0,noteUpFreq:[523.25,631.62,739.99],noteDownFreq:[261.63,315.81,369.99],noiseFreqs:[261.63,369.99,523.25,739.99,1046.5,1479.98,2093,2959.96,4186.01,5919.91],isAudioEnabled:!0,currentSection:null,isSectionActive:!1,filterMod:null,meterAudioValue:0,noiseFreq:1e3,noiseQ:100,filterDetuneTween:null},un={connectionPreference:"ws,sse,poll",appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",textSpanPrefix:"is",instructionTxtElementId:"instructionTxt",textLineBreak:"<br/>",textStyleInvisible:{visibility:"hidden"},textStyleVisible:{visibility:"visible"},textFontFamily:"Arial",textFontType:"normal",textFontSize:50,textMaxFontSize:70,textMaxLineLen:30,textHeightCompressor:1.1,textWidthCompressor:.9,textAreaMax:.4,textNumberOfLines:3,textSpanIsFadeIn:!0,textSpanFadeTimeSec:1,textSpanFadeStaggerTimeSec:.5,voteTimeoutMs:5e3,noteDurationMultipler:8,loadingIconId:"loadingIcon",elementGroupSuffix:"Grp",meterGroupId:"meterGrp",thumbUpRectId:"thUpRect",thumbDownRectId:"thDownRect",thumbUpGroupId:"thumbUpGrp",thumbUpPathId:"thumbUpPth",thumbUpSymId:"thumbUpSym",thumbDownGroupId:"thumbDownGrp",thumbDownPathId:"thumbDownPth",thumbDownSymId:"thumbDownSym",noteUpGroupId:"noteUpGrp",noteUpSymId:"noteUpSym",noteDownGroupId:"noteDownGrp",noteDownSymId:"noteDownSym",meterBoxIdPrefix:"meterBox",meterBoxNo:20,meterMaxVotes:10,meterInactiveStyle:{fill:"none",stroke:"black","stroke-width":"4px"},meterZeroStyle:{fill:"yellow"},thumbsUpActiveStyle:{fill:"green"},thumbsUpInActiveStyle:{fill:"none"},thumbsDownActiveStyle:{fill:"red"},thumbsDownInActiveStyle:{fill:"none"},centreX:450,centreY:800,meterBoxWidth:80,meterBoxHeight:40,negativeMinCol:{r:255,g:165,b:0},negativeMaxCol:{r:255,g:0,b:0},positiveMinCol:{r:255,g:255,b:0},positiveMaxCol:{r:0,g:125,b:0},maxNoiseLevel:1,audioFadeInMs:1e3,filterGreenAttrib:{filter:"url(#dropshadowgreen)"},filterRedAttrib:{filter:"url(#dropshadowred)"},filterInActiveAttrib:{filter:"none"},noteUpConfig:{minAngle:0,maxAngle:360},noteDurations:[o.DURATION.MINIM,o.DURATION.CROTCHET,o.DURATION.QUAVER,o.DURATION.SEMI_QUAVER],noteSymbolsUp:["minimUp","crotchetUp","quaverUp","semiquaverUp"],noteSymbolsDown:["minimDown","crotchetDown","quaverDown","semiquaverDown"],availableViews:[_e,Je,Ke,$e,tn],maxNoiseFreq:5e3,minNoiseFreq:300,maxNoiseQ:10,minNoiseQ:1,noiseFilterQSteps:[300,100,70,50,30,20,15,10,5,3]};return l.prototype.init=function(){if(!Re(this.styleConfig)&&t.isNumeric(this.boxNo)&&t.isNumeric(this.midX)&&t.isNumeric(this.midY)){var e=t.isOddNumber(this.boxNo),n=Math.round(this.boxNo/2);this.positiveMaxIndex=this.boxNo-1,this.positiveMinIndex=n,this.negativeMinIndex=n-1,this.negativeMaxIndex=0,this.zeroIndex=null;var i=this.midY+n*this.boxHeight;e&&(this.negativeMinIndex=n-2,this.zeroIndex=n-1,i=this.midY+this.boxHeight/2+this.zeroIndex*this.boxHeight);for(var o=i,r=this.midX-this.boxWidth/2,a=0;a<this.boxNo;++a){var s=this.boxIdPrefix+a,u=this.boxSvgIdPrefix+a,l=o-this.boxHeight,c=this.getActiveStyle(a),f=new d(s,u,r,l,this.boxWidth,this.boxHeight,this.styleConfig.inactiveStyle,c);this.boxes[a]=f,o=l}this.draw(),this.isInitialised=!0}else Ge("ZScoreMeter.init: invalid inputs")},l.prototype.getActiveStyle=function(e){var n="yellow";if(!Re(this.zeroIndex)&&e===this.zeroIndex)return this.styleConfig.zeroStyle;if(e>=this.positiveMinIndex&&e<=this.positiveMaxIndex){var i=0;this.positiveMaxIndex!=this.positiveMinIndex&&(i=(e-this.positiveMinIndex)/(this.positiveMaxIndex-this.positiveMinIndex));var o=t.interpolateRgbColours(this.styleConfig.posMinRGB,this.styleConfig.posMaxRGB,i);Re(o)||(n=t.rgbToHex(o.r,o.g,o.b))}else if(e>=this.negativeMaxIndex&&e<=this.negativeMinIndex){i=0;this.negativeMinIndex!=this.negativeMaxIndex&&(i=(this.negativeMinIndex-e)/(this.negativeMinIndex-this.negativeMaxIndex));o=t.interpolateRgbColours(this.styleConfig.negMinRGB,this.styleConfig.negMaxRGB,i);Re(o)||(n=t.rgbToHex(o.r,o.g,o.b))}return{fill:n}},l.prototype.clear=function(){for(var t=0;t<this.boxes.length;++t)this.setBoxStyle(t,this.styleConfig.inactiveStyle)},l.prototype.draw=function(){for(var t=0;t<this.boxes.length;++t)this.boxes[t].draw()},l.prototype.setPlayAudio=function(t){this.isPlayAudio=t,this.playAudio(this.currentValue,this.currentMaxVal)},l.prototype.set=function(e,n){if(t.isNumeric(e)&&t.isNumeric(n))if(this.clear(),Re(this.zeroIndex)||this.activateBox(this.zeroIndex,!0),e>0){n<0&&(n*=-1);var i=1,o=n;o<i&&(o=i),e>o&&(e=o);for(var r=Math.floor(t.mapRange(e,i,o,this.positiveMinIndex,this.positiveMaxIndex)),a=this.positiveMinIndex;a<=r;a++)this.activateBox(a,!0);this.currentValue=e,this.currentMaxVal=o,this.playAudio(e,o)}else{n>0&&(n*=-1);i=-1,o=n;o>i&&(o=i),e<o&&(e=o);for(r=Math.ceil(t.mapRange(e,i,o,this.negativeMinIndex,this.negativeMaxIndex)),a=this.negativeMinIndex;a>=r;a--)this.activateBox(a,!0);this.currentValue=e,this.currentMaxVal=o,this.playAudio(e,o)}},l.prototype.activateBox=function(t,e){var n=this.boxes[t];Re(n)||n.setActive(e)},l.prototype.setBoxStyle=function(t,e){var n=this.boxes[t];Re(n)||n.setStyle(e)},l.prototype.playAudio=function(t,e){this.isPlayAudio&&C(t,e)},d.prototype.draw=function(){var e=me();if(!Re(e)){var i=n.createSvgRectangle(this.x,this.y,this.width,this.height,this.svgId);Ne(i,this.inactiveStyle),t.addChildToParent(e,i)}},d.prototype.setStyle=function(e){var n=t.getElement(this.svgId);Re(n)||Ne(n,e)},d.prototype.setActive=function(e){var n=t.getElement(this.svgId);Re(n)||Ne(n,e?this.activeStyle:this.inactiveStyle)},{load:function(){f()},onThumbsDownSelect:function(){Ce()},onThumbsUpSelect:function(){Ue()}}}(zsUtil,zsNet,zsSvg,zsAudio,zsMusic,zsSynth,window,document);