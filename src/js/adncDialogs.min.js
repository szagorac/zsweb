var zscore=function(t,e,i,n,o,s){"use strict";function r(t){this.message=t,this.name="ZScoreException"}function a(t,e,i,n,o,s,r,a,l,c,u){this.boxNo=t,this.midX=e,this.midY=i,this.boxWidth=n,this.boxHeight=o,this.boxIdPrefix=s,this.inactiveStyle=r,this.negMinCol=a,this.negMaxCol=l,this.posMinCol=c,this.posMaxCol=u,this.boxSvgIdPrefix=s+Q,this.boxes=[],this.isInitialised=!1,this.positiveMinIndex=0,this.positiveMaxIndex=0,this.negativeMinIndex=0,this.negativeMaxIndex=0,this.zeroIndex=null}function l(t,e,i,n,o,s,r,a){this.id=t,this.svgId=e,this.x=i,this.y=n,this.width=o,this.height=s,this.activeStyle=r,this.inactiveStyle=a}function c(){G("onLoad: "),u()}function u(){if(!(t&&e&&i&&n))throw new r("Invalid libraries. Required: zsUtil, zsNet, zsSvg and zsAudio");t.setRunMode(X),G("init: "),J=t.isTouchDevice(),K=t.isSafari(navigator),G("init: IsTouch Device: "+J+" isSafari: "+K),_.fontCanvas=s.createElement("canvas"),_.canvasCtx=_.fontCanvas.getContext("2d"),x(),v(),f(),m(),g(),d()}function h(){p()}function x(){e.init(tt.connectionPreference,tt.appUrlSse,tt.appUrlWebsockets,tt.appUrlHttp,z)}function d(){e.getServerState()}function f(){D(n)?Y("initAudio: invalid zsAudio lib"):n.init(q,0)}function p(){D(n)?Y("resetAudio: invalid zsAudio lib"):n.reset()}function v(){i.init()}function m(){var t=new a(tt.meterBoxNo,tt.centreX,tt.centreY,tt.meterBoxWidth,tt.meterBoxHeight,tt.meterBoxIdPrefix,tt.meterInactiveStyle,tt.negativeMinCol,tt.negativeMaxCol,tt.positiveMinCol,tt.positiveMaxCol);t.init(),_.meter=t,t.set(0,10)}function g(){var e=P();D(e)||($=e,t.listen("resize",o,S),t.listen("orientationchange",o,S),y("Welcome to","<span style='color:blueviolet;'>ZScore</span>","awaiting performance start ...",null,!0))}function y(t,e,i,n,o){if(!D($)){var s=!1;if(!D(t)){var r=t.trim();_.instructions.l1!=r&&(_.instructions.l1=r,s=!0)}if(!D(e)){r=e.trim();_.instructions.l2!=r&&(_.instructions.l2=r,s=!0)}if(!D(i)){r=i.trim();_.instructions.l3!=r&&(_.instructions.l3=r,s=!0)}D(n)||(_.instructions.bckgCol=n),o?s&&M():F()}}function b(e){D(e)||(t.isNumeric(e)||(e=t.toInt(e)),_.voteCount=e)}function S(e){if(!t.isObject(this))return null;M()}function I(t){y(t.line1,t.line2,t.line3,t.colour,t.isVisible)}function C(t){R(t.count)&&b(t.count)}function M(e){if(!D($)){$.innerHTML=Z;var i=_.instructions.l1,n=tt.textSpanPrefix+"1",o=_.instructions.l2,s=tt.textSpanPrefix+"2",r=_.instructions.l3,a=tt.textSpanPrefix+"3",l=Z;e||(e=Z,t.isEmptyString(i)||(l=w(i,l),i=t.wrapInSpanElement(i,n),e+=i),t.isEmptyString(o)||(G("displayInstructions: processing line2 "+o),l=w(o,l),o=t.wrapInSpanElement(o,s),e=t.addSuffixIfNotThere(e,tt.textLineBreak),e+=o),t.isEmptyString(r)||(G("displayInstructions: processing line3 "+r),l=w(r,l),r=t.wrapInSpanElement(r,a),e=t.addSuffixIfNotThere(e,tt.textLineBreak),e+=r));var c=tt.textFontSize,u=B(l,c,$);$.style.fontSize=Z+u+"px",$.style.fontFamily=tt.textFontFamily,$.innerHTML=e;var h=t.getChildElement($,t.toCssIdQuery(n));D(h)||(h.style.opacity=0);var x=t.getChildElement($,t.toCssIdQuery(s));D(x)||(x.style.opacity=0);var d=t.getChildElement($,t.toCssIdQuery(a));if(D(d)||(d.style.opacity=0),_.instructions.isVisible=!0,N($,_.instructions),tt.textSpanIsFadeIn){var f=tt.textSpanFadeTimeSec,p=tt.textSpanFadeStaggerTimeSec;D(h)||gsap.to(h,{duration:f,autoAlpha:1,ease:"power1.in"}),D(x)||gsap.to(x,{delay:p,duration:f,autoAlpha:1,ease:"power1.in"}),D(d)||gsap.to(d,{delay:2*p,duration:f,autoAlpha:1,ease:"power1.in"})}else D(h)||(h.style.opacity=1),D(x)||(x.style.opacity=1),D(d)||(d.style.opacity=1)}}function w(e,i){var n=t.removeMarkup(e);return n.length>i.length?n:i}function E(t){return tt.textFontType+O+t+"px "+tt.textFontFamily}function F(){D($)||($.innerHTML=Z,_.instructions.isVisible=!1,N($,_.instructions))}function N(e,i){var n=T(i);D(i.bckgCol)||(n.background=i.bckgCol),t.setElementStyleProperty(e,n)}function z(t,e){D(t)||(e||h(),R(t.actions)&&A(t.actions),R(t.instructions)&&I(t.instructions),R(t.counter)&&C(t.counter))}function T(t){return t.isVisible?tt.textStyleVisible:tt.textStyleInvisible}function A(e){var i=null,n=null,o=[],s={};if(t.isArray(e))for(var r=0;r<e.length;r++){var a=e[r];R(a.id)&&(i=a.id),R(a.actionType)&&(n=a.actionType),R(a.elementIds)&&(o=a.elementIds),R(a.params)&&(s=a.params),H(i,n,o,s)}}function H(t,e,i,n){G("doAction: "+t+" actionType: "+e),D(e)||D(i)||Y("doAction: Unknown actionType: "+e)}function P(){return t.getElement(tt.instructionTxtElementId)}function k(){return t.getElement(tt.meterGroupId)}function B(t,e,i){var n=1;o.innerWidth||s.documentElement.clientWidth||s.body.clientWidth;var r=o.innerHeight||s.documentElement.clientHeight||s.body.clientHeight,a=(E(n),i.clientWidth),l=a*tt.textWidthCompressor,c=r*tt.textAreaMax;n=L(t,e,l),n=W(a,n,c);var u=tt.textMaxFontSize;return n>u&&(n=u),n}function W(t,e,i){var n=E(e),o=e,s=V(n,t,i);if(s<0)return o;var r=s*tt.textNumberOfLines,a=i/r;return a<1&&(o*=a),o}function L(t,e,i){var n=E(e),o=U(n,t),s=o.width;if(s<=0||s>i||Math.abs(i-s)<1)return e;var r=i/s,a=e*r;return L(t,a,i)}function U(t,e){var i=_.fontCanvas,n=_.canvasCtx;return n.fillRect(0,0,i.width,i.height),n.textBaseline="top",n.fillStyle=j,n.font=t,n.measureText(e)}function V(t,e,i){var n=_.fontCanvas,o=_.canvasCtx;n.width=e,n.height=i,o.fillRect(0,0,n.width,n.height),o.textBaseline="top",o.fillStyle=j,o.font=t;var s="gM";o.fillText(s,0,0);for(var r=o.getImageData(0,0,n.width,n.height).data,a=-1,l=-1,c=0;c<n.height;c++)for(var u=0;u<n.width;u++){var h=4*(c*n.width+u);if(0!==r[h]){-1===a&&(a=c);break}if(u===n.width-1&&-1!==a){l=c,c=n.height;break}}var x=(l-a)*tt.textHeightCompressor;return x}function D(e){return t.isNull(e)}function R(e){return t.isNotNull(e)}function Y(e){t.logError(e)}function G(e){t.log(e)}const X="DEV",Z="",O=" ",Q="Rect",j="#FFFFFF";var q=["/audio/violin-tuning.mp3"],J=null,K=null,$=null,_={instructions:{isVisible:!1,l1:Z,l2:Z,l3:Z,bckgCol:"rgba(225, 225, 225, 0.85)"},voteCount:0,meter:null},tt={connectionPreference:"ws,sse,poll",appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",textSpanPrefix:"is",instructionTxtElementId:"instructionTxt",textLineBreak:"<br/>",textStyleInvisible:{visibility:"hidden"},textStyleVisible:{visibility:"visible"},textFontFamily:"Arial",textFontType:"normal",textFontSize:50,textMaxFontSize:70,textMaxLineLen:30,textHeightCompressor:1.1,textWidthCompressor:.9,textAreaMax:.4,textNumberOfLines:3,textSpanIsFadeIn:!0,textSpanFadeTimeSec:1,textSpanFadeStaggerTimeSec:.5,elementGroupSuffix:"Grp",meterGroupId:"meterGrp",meterBoxIdPrefix:"meterBox",thumbsUpPathId:"thumbUpPth",thumbsDownPathId:"thumbDownPth",meterBoxNo:11,meterInactiveStyle:{fill:"none",stroke:"black","stroke-width":"4px"},meterZeroStyle:{fill:"yellow"},centreX:450,centreY:800,meterBoxWidth:80,meterBoxHeight:40,negativeMinCol:{r:255,g:165,b:0},negativeMaxCol:{r:200,g:0,b:0},positiveMinCol:{r:255,g:255,b:0},positiveMaxCol:{r:0,g:125,b:0}};return a.prototype.init=function(){if(t.isNumeric(this.boxNo)&&t.isNumeric(this.midX)&&t.isNumeric(this.midY)){var e=t.isOddNumber(this.boxNo),i=Math.round(this.boxNo/2);this.positiveMaxIndex=this.boxNo-1,this.positiveMinIndex=i,this.negativeMinIndex=0,this.negativeMaxIndex=i-1,this.zeroIndex=null;var n=this.midY+i*this.boxHeight;e&&(this.negativeMaxIndex=i-2,this.zeroIndex=i-1,n=this.midY+this.boxHeight/2+this.zeroIndex*this.boxHeight);for(var o=n,s=this.midX-this.boxWidth/2,r=0;r<this.boxNo;++r){var a=this.boxIdPrefix+r,c=this.boxSvgIdPrefix+r,u=o-this.boxHeight,h=new l(a,c,s,u,this.boxWidth,this.boxHeight);this.boxes[r]=h,o=u}this.draw(),this.isInitialised=!0}else Y("ZScoreMeter.init: invalid inputs")},a.prototype.clear=function(){for(var t=0;t<this.boxes.length;++t)this.setBoxStyle(t,tt.meterInactiveStyle)},a.prototype.draw=function(){for(var t=0;t<this.boxes.length;++t)this.boxes[t].draw()},a.prototype.set=function(e,i){if(t.isNumeric(e)&&t.isNumeric(i))if(this.clear(),0!==e);else{if(D(this.zeroIndex))return;this.setBoxStyle(this.zeroIndex,tt.meterZeroStyle)}},a.prototype.setBoxStyle=function(t,e){var i=this.boxes[t];D(i)||i.setStyle(e)},l.prototype.draw=function(){var e=k();if(!D(e)){var n=i.createSvgRectangle(this.x,this.y,this.width,this.height,this.svgId);t.setElementAttributes(n,tt.meterInactiveStyle),t.addChildToParent(e,n)}},l.prototype.setStyle=function(e){var i=t.getElement(this.svgId);D(i)||t.setElementAttributes(i,e)},l.prototype.setActive=function(e){var i=t.getElement(this.svgId);D(i)||(e?t.setElementAttributes(i,this.activeStyle):t.setElementAttributes(i,this.inactiveStyle))},{load:function(){c()}}}(zsUtil,zsNet,zsSvg,zsAudio,window,document);