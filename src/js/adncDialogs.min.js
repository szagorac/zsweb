var zscore=function(t,e,i,n,r,o){"use strict";function s(t){this.message=t,this.name="ZScoreException"}function a(){this.boxes=[],this.isInitialised=!1}function l(t,e){this.id=t,this.svgRectId=e}function c(){O("onLoad: "),u()}function u(){if(!(t&&e&&i&&n))throw new s("Invalid libraries. Required: zsUtil, zsNet, zsSvg and zsAudio");t.setRunMode(Q),O("init: "),q=t.isTouchDevice(),J=t.isSafari(navigator),O("init: IsTouch Device: "+q+" isSafari: "+J),$.fontCanvas=o.createElement("canvas"),$.canvasCtx=$.fontCanvas.getContext("2d"),d(),h(),x(),v(),g(),p()}function f(){m()}function d(){e.init(_.connectionPreference,_.appUrlSse,_.appUrlWebsockets,_.appUrlHttp,z)}function p(){e.getServerState()}function x(){V(n)?G("initAudio: invalid zsAudio lib"):n.init(j,0)}function m(){V(n)?G("resetAudio: invalid zsAudio lib"):n.reset()}function h(){i.init()}function v(){var e=H(),n=60,r=20,o=_.centerX-n/2,s=_.centerY-r/2,a="meterLadderBox0",l=i.createSvgRectangle(o,s,n,r,a);t.setElementAttributes(l,_.meterInactiveStyle),t.addChildToParent(e,l)}function g(){var e=N();V(e)||(K=e,t.listen("resize",r,b),t.listen("orientationchange",r,b),y("Welcome to","<span style='color:blueviolet;'>ZScore</span>","awaiting performance start ...",null,!0))}function y(t,e,i,n,r){if(!V(K)){var o=!1;if(!V(t)){var s=t.trim();$.instructions.l1!=s&&($.instructions.l1=s,o=!0)}if(!V(e)){s=e.trim();$.instructions.l2!=s&&($.instructions.l2=s,o=!0)}if(!V(i)){s=i.trim();$.instructions.l3!=s&&($.instructions.l3=s,o=!0)}V(n)||($.instructions.bckgCol=n),r?o&&C():E()}}function S(e){V(e)||(t.isNumeric(e)||(e=t.toInt(e)),$.voteCount=e)}function b(e){if(!t.isObject(this))return null;C()}function I(t){y(t.line1,t.line2,t.line3,t.colour,t.isVisible)}function w(t){D(t.count)&&S(t.count)}function C(e){if(!V(K)){K.innerHTML=Z;var i=$.instructions.l1,n=_.textSpanPrefix+"1",r=$.instructions.l2,o=_.textSpanPrefix+"2",s=$.instructions.l3,a=_.textSpanPrefix+"3",l=Z;e||(e=Z,t.isEmptyString(i)||(l=F(i,l),i=t.wrapInSpanElement(i,n),e+=i),t.isEmptyString(r)||(O("displayInstructions: processing line2 "+r),l=F(r,l),r=t.wrapInSpanElement(r,o),e=t.addSuffixIfNotThere(e,_.textLineBreak),e+=r),t.isEmptyString(s)||(O("displayInstructions: processing line3 "+s),l=F(s,l),s=t.wrapInSpanElement(s,a),e=t.addSuffixIfNotThere(e,_.textLineBreak),e+=s));var c=_.textFontSize,u=M(l,c,K);K.style.fontSize=Z+u+"px",K.style.fontFamily=_.textFontFamily,K.innerHTML=e;var f=t.getChildElement(K,t.toCssIdQuery(n));V(f)||(f.style.opacity=0);var d=t.getChildElement(K,t.toCssIdQuery(o));V(d)||(d.style.opacity=0);var p=t.getChildElement(K,t.toCssIdQuery(a));if(V(p)||(p.style.opacity=0),$.instructions.isVisible=!0,B(K,$.instructions),_.textSpanIsFadeIn){var x=_.textSpanFadeTimeSec,m=_.textSpanFadeStaggerTimeSec;V(f)||gsap.to(f,{duration:x,autoAlpha:1,ease:"power1.in"}),V(d)||gsap.to(d,{delay:m,duration:x,autoAlpha:1,ease:"power1.in"}),V(p)||gsap.to(p,{delay:2*m,duration:x,autoAlpha:1,ease:"power1.in"})}else V(f)||(f.style.opacity=1),V(d)||(d.style.opacity=1),V(p)||(p.style.opacity=1)}}function F(e,i){var n=t.removeMarkup(e);return n.length>i.length?n:i}function T(t){return _.textFontType+X+t+"px "+_.textFontFamily}function E(){V(K)||(K.innerHTML=Z,$.instructions.isVisible=!1,B(K,$.instructions))}function B(e,i){var n=k(i);V(i.bckgCol)||(n.background=i.bckgCol),t.setElementStyleProperty(e,n)}function z(t,e){V(t)||(e||f(),D(t.actions)&&A(t.actions),D(t.instructions)&&I(t.instructions),D(t.counter)&&w(t.counter))}function k(t){return t.isVisible?_.textStyleVisible:_.textStyleInvisible}function A(e){var i=null,n=null,r=[],o={};if(t.isArray(e))for(var s=0;s<e.length;s++){var a=e[s];D(a.id)&&(i=a.id),D(a.actionType)&&(n=a.actionType),D(a.elementIds)&&(r=a.elementIds),D(a.params)&&(o=a.params),P(i,n,r,o)}}function P(t,e,i,n){O("doAction: "+t+" actionType: "+e),V(e)||V(i)||G("doAction: Unknown actionType: "+e)}function N(){return t.getElement(_.instructionTxtElementId)}function H(){return t.getElement(_.meterGroupId)}function M(t,e,i){var n=1;r.innerWidth||o.documentElement.clientWidth||o.body.clientWidth;var s=r.innerHeight||o.documentElement.clientHeight||o.body.clientHeight,a=(T(n),i.clientWidth),l=a*_.textWidthCompressor,c=s*_.textAreaMax;n=U(t,e,l),n=L(a,n,c);var u=_.textMaxFontSize;return n>u&&(n=u),n}function L(t,e,i){var n=T(e),r=e,o=R(n,t,i);if(o<0)return r;var s=o*_.textNumberOfLines,a=i/s;return a<1&&(r*=a),r}function U(t,e,i){var n=T(e),r=W(n,t),o=r.width;if(o<=0||o>i||Math.abs(i-o)<1)return e;var s=i/o,a=e*s;return U(t,a,i)}function W(t,e){var i=$.fontCanvas,n=$.canvasCtx;return n.fillRect(0,0,i.width,i.height),n.textBaseline="top",n.fillStyle=Y,n.font=t,n.measureText(e)}function R(t,e,i){var n=$.fontCanvas,r=$.canvasCtx;n.width=e,n.height=i,r.fillRect(0,0,n.width,n.height),r.textBaseline="top",r.fillStyle=Y,r.font=t;var o="gM";r.fillText(o,0,0);for(var s=r.getImageData(0,0,n.width,n.height).data,a=-1,l=-1,c=0;c<n.height;c++)for(var u=0;u<n.width;u++){var f=4*(c*n.width+u);if(0!==s[f]){-1===a&&(a=c);break}if(u===n.width-1&&-1!==a){l=c,c=n.height;break}}var d=(l-a)*_.textHeightCompressor;return d}function V(e){return t.isNull(e)}function D(e){return t.isNotNull(e)}function G(e){t.logError(e)}function O(e){t.log(e)}const Q="DEV",Z="",X=" ",Y="#FFFFFF";var j=["/audio/violin-tuning.mp3"],q=null,J=null,K=null,$={instructions:{isVisible:!1,l1:Z,l2:Z,l3:Z,bckgCol:"rgba(225, 225, 225, 0.85)"},voteCount:0},_={connectionPreference:"ws,sse,poll",appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",textSpanPrefix:"is",instructionTxtElementId:"instructionTxt",textLineBreak:"<br/>",textStyleInvisible:{visibility:"hidden"},textStyleVisible:{visibility:"visible"},textFontFamily:"Arial",textFontType:"normal",textFontSize:50,textMaxFontSize:70,textMaxLineLen:30,textHeightCompressor:1.1,textWidthCompressor:.9,textAreaMax:.4,textNumberOfLines:3,textSpanIsFadeIn:!0,textSpanFadeTimeSec:1,textSpanFadeStaggerTimeSec:.5,elementGroupSuffix:"Grp",meterGroupId:"meterGrp",meterBoxPrefix:"meterBox",meterBoxRectPrefix:"meterBoxRect",thumbsUpPathId:"thumbUpPth",thumbsDownPathId:"thumbDownPth",meterInactiveStyle:{fill:"none",stroke:"gray","stroke-width":"4px"},centerX:450,centerY:800,meterBoxWidth:80,meterBoxHeight:40,meterBoxNo:21};return a.prototype.init=function(e,i,n){if(isNumeric(e)&&isNumeric(i)&&isNumeric(n)){var r=t.isOddNumber(e),o=Math.round(e/2);_.meterBoxHeight;r&&n+_.meterBoxHeight/2+o*_.meterBoxHeight;for(var s=0;s<e;++s){var a=_.meterBoxPrefix+s,c=_.meterBoxRectPrefix+s;new l(a,c)}this.isInitialised=!0}else G("ZScoreMeter.init: invalid inputs")},{load:function(){c()}}}(zsUtil,zsNet,zsSvg,zsAudio,window,document);