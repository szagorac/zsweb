var zscore=function(e,t,n,i,o,r,a,s){"use strict";function u(e){this.message=e,this.name="ZScoreException"}function l(e,t,n,i,o,r,a){this.boxNo=e,this.midX=t,this.midY=n,this.boxWidth=i,this.boxHeight=o,this.boxIdPrefix=r,this.styleConfig=a,this.boxSvgIdPrefix=r+Qt,this.boxes=[],this.isInitialised=!1,this.positiveMinIndex=0,this.positiveMaxIndex=0,this.negativeMinIndex=0,this.negativeMaxIndex=0,this.zeroIndex=null,this.isPlayAudio=!1,this.currentValue=0,this.currentMaxVal=0}function c(e,t,n,i,o,r){this.inactiveStyle=e,this.zeroStyle=t,this.negMinRGB=n,this.negMaxRGB=i,this.posMinRGB=o,this.posMaxRGB=r}function d(e,t,n,i,o,r,a,s){this.id=e,this.svgId=t,this.x=n,this.y=i,this.width=o,this.height=r,this.inactiveStyle=a,this.activeStyle=s}function f(){zt("onLoad: "),h()}function h(){if(!(e&&t&&n&&i&&o&&r))throw new u("Invalid libraries. Required: zsUtil, zsNet, zsSvg, zsAudio, zsSynth and zsMusic");e.setRunMode(qt),zt("init: "),on=e.isTouchDevice(),rn=e.isSafari(navigator),zt("init: IsTouch Device: "+on+" isSafari: "+rn),sn.fontCanvas=s.createElement("canvas"),sn.canvasCtx=sn.fontCanvas.getContext("2d"),v(),I(),x(),S(),A(),M(),D(),p(),b()}function m(){y()}function p(){we(),Me(),Te()}function v(){t.init(un.connectionPreference,un.appUrlSse,un.appUrlWebsockets,un.appUrlHttp,it)}function b(){t.getServerState()}function g(){i.initNoise(),i.initPlayer(),i.initSynth(),i.initGranulator(sn.granulatorIndex),e.makeInVisible(un.loadingIconId),zt("onAudioLoaded: completed")}function x(){Rt(i)?Pt("initAudio: invalid zsAudio lib"):i.init(tn,g)}function y(){Rt(i)?Pt("resetAudio: invalid zsAudio lib"):i.reset()}function I(){n.init(),w()}function w(){var t=vt();Gt(t)&&(e.listen("touchend",t,Ft),e.listen("mouseup",t,Nt));var n=bt();Gt(n)&&(e.listen("touchend",n,Et),e.listen("mouseup",n,kt))}function S(){var e=new c(un.meterInactiveStyle,un.meterZeroStyle,un.negativeMinCol,un.negativeMaxCol,un.positiveMinCol,un.positiveMaxCol),t=new l(un.meterBoxNo,un.centreX,un.centreY,un.meterBoxWidth,un.meterBoxHeight,un.meterBoxIdPrefix,e);t.init(),sn.meter=t}function A(){var t=ht();Rt(t)||(an=t,e.listen("resize",a,te),e.listen("orientationchange",a,te),K("Welcome to","<span style='color:blueviolet;'>ZScore</span>","awaiting performance start ...",null,!0))}function M(){var t=un.voteTimeoutMs/1e3;sn.thumbUpTween=gsap.from(e.toCssIdQuery(un.thumbUpSymId),{duration:t,scaleY:.5,fill:"green",transformOrigin:"right bottom",paused:!0,ease:"slow(0.9, 0.4, false)",onComplete:q}),sn.thumbUpTween.progress(1),sn.thumbDownTween=gsap.from(e.toCssIdQuery(un.thumbDownSymId),{duration:t,scaleY:.5,fill:"red",transformOrigin:"left top",paused:!0,ease:"slow(0.9, 0.4, false)",onComplete:B}),sn.thumbDownTween.progress(1)}function D(){T(),U()}function T(){var t=e.getRandomIntFromRange(0,un.noteDurations.length-1),n=un.noteDurations[t],i=e.toCssIdQuery(un.noteSymbolsUp[t]),o=e.getElement(un.noteUpSymId);o.setAttribute("href",i),o.setAttribute("xlink:href",i);var r=R()*un.noteDurationMultipler;sn.noteUpDurationSec=n*r,sn.noteUpTween=G()}function U(){var t=e.getRandomIntFromRange(0,un.noteDurations.length-1),n=un.noteDurations[t],i=e.toCssIdQuery(un.noteSymbolsDown[t]),o=e.getElement(un.noteDownSymId);o.setAttribute("href",i),o.setAttribute("xlink:href",i);var r=R()*un.noteDurationMultipler;sn.noteDownDurationSec=n*r,sn.noteDownTween=P()}function C(t,n){var o=sn.meterAudioValue;if(sn.meterAudioValue=t,sn.isAudioEnabled){if(0===t)return i.stopNoise(),void i.setPlayerVolume(0,500);if(t>0){i.stopNoise();var r=e.mapRange(Math.abs(t),0,Math.abs(n),0,1);i.setPlayerVolume(r,un.audioFadeInMs)}else{i.setPlayerVolume(0,un.audioFadeInMs);r=e.mapRange(Math.abs(t),0,Math.abs(n),0,un.maxNoiseLevel);var a=sn.noiseFreq,s=un.maxNoiseFreq,u=(s-a)/10,l=a+u;o<t&&(l=a-u),l>un.maxNoiseFreq?l=un.maxNoiseFreq:l<un.minNoiseFreq&&(l=un.minNoiseFreq),i.setNoiseFilterFreq(l),sn.noiseFreq=l;var c=sn.noiseQ,d=un.maxNoiseQ,f=(d-c)/10,h=c+f;o>t&&(h=c-f),h>un.maxNoiseQ?h=un.maxNoiseQ:h<un.minNoiseQ&&(h=un.minNoiseQ),sn.noiseQ=h,i.setNoiseFilterQ(h),zt("playMeterAudio: newFreq: "+l+" prevFreq: "+a+" newQ: "+h+" prevQ: "+c+" "),i.playNoise(r)}}}function N(){k()}function F(){E()}function k(){var t=e.getRandomIntFromRange(0,sn.noteUpFreq.length-1),n=sn.noteUpFreq[t];zt("playing freq: "+n),i.playSynth(n,sn.noteUpDurationSec)}function E(){var t=e.getRandomIntFromRange(0,sn.noteDownFreq.length-1),n=sn.noteDownFreq[t];zt("playing freq: "+n),i.playSynth(n,sn.noteDownDurationSec)}function V(){var e=o.getBeatDurationSec(sn.bpm);return Rt(e)&&(e=1),e}function R(){var e=V();return 4*e}function G(){var e=sn.noteUpDurationSec,t={sign:-1,angleMin:0,angleMax:120,rMin:10,rMax:30,rotAngleMin:-360,rotAngleMax:360,xmod:20,ymod:30};return z(e,un.noteUpSymId,t,O)}function P(){var e=sn.noteDownDurationSec,t={sign:1,angleMin:0,angleMax:120,rMin:20,rMax:40,rotAngleMin:-360,rotAngleMax:360,xmod:0,ymod:0};return z(e,un.noteDownSymId,t,Q)}function z(t,n,i,o){var r=e.randomIntFromInterval(i.angleMin,i.angleMax),a=e.randomIntFromInterval(i.rMin,i.rMax),s=0,u=i.sign,l=u*a;if(r<90){var c=e.toRadians(r);s=u*a*Math.cos(c),l=u*a*Math.sin(c)}else if(r>90){c=e.toRadians(180-r);s=-1*u*a*Math.cos(c),l=u*a*Math.sin(c)}s+=i.xmod,l+=i.ymod;var d=e.randomIntFromInterval(i.rotAngleMin,i.rotAngleMax);return gsap.to(e.toCssIdQuery(n),{duration:t,scale:.1,autoAlpha:0,rotation:d,x:s,y:l,ease:"slow(0.9, 0.4, false)",paused:!0,onComplete:o})}function q(){e.setElementAttributes(pt(),un.filterGreenAttrib)}function B(){e.setElementAttributes(gt(),un.filterRedAttrib)}function O(){H(un.noteUpSymId),T(),L(un.noteUpSymId),L(un.noteDownSymId)}function Q(){H(un.noteDownSymId),U(),L(un.noteDownSymId),L(un.noteUpSymId)}function H(t){gsap.set(e.toCssIdQuery(t),{autoAlpha:0,scale:1,rotation:0,x:0,y:0})}function L(t){Rt(t)||gsap.to(e.toCssIdQuery(t),{duration:1,autoAlpha:1})}function W(t){Rt(t)||gsap.to(e.toCssIdQuery(t),{duration:1,autoAlpha:0,onComplete:j,onCompleteParams:[t]})}function j(t){e.makeInVisible(t)}function Y(e){sn.currentVote=e;var n={};n[Wt]=e,t.sendEvent(Lt,n)}function X(){return Gt(sn.thumbUpTween)&&sn.thumbUpTween.isActive()}function Z(){return Gt(sn.thumbDownTween)&&sn.thumbDownTween.isActive()}function _(){return Gt(sn.noteUpTween)&&sn.noteUpTween.isActive()}function J(){return Gt(sn.noteDownTween)&&sn.noteDownTween.isActive()}function K(e,t,n,i,o){if(!Rt(an)){var r=!1;if(!Rt(e)){var a=e.trim();sn.instructions.l1!=a&&(sn.instructions.l1=a,r=!0)}if(!Rt(t)){a=t.trim();sn.instructions.l2!=a&&(sn.instructions.l2=a,r=!0)}if(!Rt(n)){a=n.trim();sn.instructions.l3!=a&&(sn.instructions.l3=a,r=!0)}Rt(i)||(sn.instructions.bckgCol=i),o?r&&Je():tt()}}function $(t){Rt(t)||(e.isNumeric(t)||(t=e.toInt(t)),sn.voteCount=t)}function ee(t){Rt(t)||(e.isNumeric(t)||(t=e.toInt(t)),sn.userNo=t)}function te(t){if(!e.isObject(this))return null;Je()}function ne(t,n,i){if(e.isArray(n))for(var o=0;o<n.length;o++)ie(t,n[o],i);else ie(t,n,i)}function ie(e,t,n){if(!Rt(t))switch(zt("runActivate: "+e+Ot+t),t){case"view":oe(e,n)}}function oe(t,n){if(e.isString(t))switch(t){case"section":re(n);break;default:return void Pt("activateView: Unknown actionId: "+t)}}function re(t){if(e.isObject(t)){var n=null;Rt(t.id)||(n=t.id),de(n)}}function ae(t){if(!Rt(t)){var n=null,i=!1;if(Gt(t.isSectionActive)&&(i=t.isSectionActive),Gt(t.sectionName)&&(n=t.sectionName),se(n,i),Gt(t.activeViews)){for(var o=[],r=0;r<un.availableViews.length;r++)e.arrContains(t.activeViews,un.availableViews[r])||o.push(un.availableViews[r]);ue(o),le(t.activeViews)}}}function se(e,t){sn.currentSection=e,sn.isSectionActive=t}function ue(e){for(var t=0;t<e.length;t++)ce(e[t])}function le(e){for(var t=0;t<e.length;t++)oe(e[t])}function ce(e){switch(e){case _t:ge();break;case Jt:be();break;case Kt:xe();break;case $t:ye();break;case en:Ie();break;default:zt("deactivateView: unknown view: "+e)}}function oe(e){switch(e){case _t:he();break;case Jt:fe();break;case Kt:me();break;case $t:pe();break;case en:ve();break;default:zt("activateView: unknown view: "+e)}}function de(e){}function fe(){De()}function he(){Ae()}function me(){Ue()}function pe(){we()}function ve(){sn.isAudioEnabled=!0,Gt(sn.meter)&&sn.meter.setPlayAudio(!0)}function be(){Te()}function ge(){Me()}function xe(){Ce()}function ye(){Se()}function Ie(){sn.isAudioEnabled=!1,Gt(sn.meter)&&sn.meter.setPlayAudio(!1)}function we(){sn.isVotingEnabled=!0}function Se(){sn.isVotingEnabled=!1}function Ae(){e.makeVisible(un.thumbUpGroupId),e.makeVisible(un.thumbDownGroupId),L(un.thumbUpSymId),L(un.thumbDownSymId),sn.isThumbEnabled=!0}function Me(){W(un.thumbUpSymId),W(un.thumbDownSymId),sn.isThumbEnabled=!1}function De(){e.makeVisible(un.noteUpGroupId),e.makeVisible(un.noteDownGroupId),L(un.noteUpSymId),L(un.noteDownSymId),sn.isNoteEnabled=!0}function Te(){W(un.noteUpSymId),W(un.noteDownSymId),sn.isNoteEnabled=!1}function Ue(){e.makeVisible(un.meterGroupId),L(un.meterGroupId)}function Ce(){W(un.meterGroupId)}function Ne(t,n,i){if(e.isArray(n))for(var o=0;o<n.length;o++)Fe(t,n[o],i);else Fe(t,n,i)}function Fe(e,t,n){if(!Rt(t))switch(zt("runAudio: "+e+Ot+t),t){case"all":ke(e,n);break;case"player":Ve(e,n);break;case"granulator":ze(e,n)}}function ke(t,n){if(e.isString(t))switch(t){case"volume":Ee(n);break;default:return void Pt("runPlayer: Unknown actionId: "+t)}}function Ee(t){if(Rt(i))Pt("setAudioMasterVolume: Invalid zsAudio lib");else if(e.isObject(t)){var n=null,o=null;Rt(t.level)||(n=t.level),Rt(t.timeMs)||(o=t.timeMs),i.setMasterVolume(n,o)}}function Ve(t,n){if(e.isString(t))switch(t){case"play":Ge(n);break;case"volume":Pe(n);break;case"config":Re(n);break;default:return void Pt("runPlayer: Unknown actionId: "+t)}}function Re(t){if(Rt(i))Pt("updateAudioPlayerCofig: Invalid zsAudio lib");else if(e.isObject(t)){var n=!1;if(!Rt(t.audioFiles)){var o=t.audioFiles;e.isArray(o)?e.arrEquals(tn,o)?zt("updateAudioPlayerCofig: audioFiles array identical, ignoring update"):(tn=o,n=!0):Pt("updateAudioPlayerCofig: invalid audioFiles array")}if(!Rt(t.audioFilesIndexMap)){var r=t.audioFilesIndexMap;!e.isArray(r)||r.length<1?Pt("updateAudioPlayerCofig: invalid fileIndexMap array"):nn=r}n&&(zt("updateAudioPlayerCofig: laoding audioFiles"),e.makeVisible(un.loadingIconId),i.loadAudioBuffers(tn))}}function Ge(t){if(Rt(i))Pt("runPlayerPlay: Invalid zsAudio lib");else if(e.isObject(t)){var n=0;Rt(t.index)||(e.isString(t.index)?n=e.toInt(t.index):e.isNumeric(t.index)&&(n=t.index));var o=n;if(n>0&&n<nn.length){var r=nn[n];o=e.randomArrayElement(r)}var a=null,s=null,u=null;Rt(t.startTime)||(a=t.startTime),Rt(t.offset)||(s=t.offset),Rt(t.duration)||(u=t.duration),i.playAudio(o,a,s,u)}}function Pe(t){if(Rt(i))Pt("setAudioMasterVolume: Invalid zsAudio lib");else if(e.isObject(t)){var n=null,o=null;Rt(t.level)||(n=t.level),Rt(t.timeMs)||(o=t.timeMs),i.setPlayerVolume(n,o)}}function ze(t,n){if(e.isString(t))switch(t){case"play":qe(n);break;case"stop":Be(n);break;case"config":Le(n);break;case"rampLinear":Oe(n);break;case"rampSin":He(n);break;case"volume":Qe(n);break;default:return void Pt("runAudioGranulator: Unknown actionId: "+t)}}function qe(e){Rt(i)?Pt("runAudioPlayGranulator: Invalid zsAudio lib"):i.playGranulator()}function Be(e){Rt(i)?Pt("runAudioPlayGranulator: Invalid zsAudio lib"):i.stopGranulator()}function Oe(t){if(Rt(i))Pt("runAudioPlayGranulator: Invalid zsAudio lib");else if(e.isObject(t)){var n=null,o=null,r=null;Rt(t.paramName)||(n=t.paramName),Rt(t.endValue)||(o=t.endValue),Rt(t.duration)||(r=t.duration),i.setGranulatorRampLinear(n,o,r)}}function Qe(t){if(Rt(i))Pt("runAudioPlayGranulator: Invalid zsAudio lib");else if(e.isObject(t)){var n=null,o=null;Rt(t.level)||(n=t.level),Rt(t.timeMs)||(o=t.timeMs),i.setGranulatorGain(n,o)}}function He(t){if(Rt(i))Pt("runAudioPlayGranulator: Invalid zsAudio lib");else if(e.isObject(t)){var n=null,o=null,r=null,a=null;Rt(t.paramName)||(n=t.paramName),Rt(t.amplitude)||(o=t.amplitude),Rt(t.frequency)||(r=t.frequency),Rt(t.duration)||(a=t.duration),i.setGranulatorRampSin(n,o,r,a)}}function Le(t){Rt(i)?Pt("runAudioPlayGranulator: Invalid zsAudio lib"):e.isObject(t)&&(i.setGranulatorConfig(t),i.initGranulator(sn.granulatorIndex))}function We(e){K(e.line1,e.line2,e.line3,e.colour,e.isVisible)}function je(e){Gt(e.count)&&$(e.count),Gt(e.maxCount)&&ee(e.maxCount),_e()}function Ye(e){Re(e)}function Xe(e){Le(e)}function Ze(e){ae(e)}function _e(){if(!Rt(sn.meter)){var e=sn.userNo;e<=un.meterMaxVotes&&(e=un.meterMaxVotes),sn.meter.set(sn.voteCount,e)}}function Je(t){if(!Rt(an)){an.innerHTML=Bt;var n=sn.instructions.l1,i=un.textSpanPrefix+"1",o=sn.instructions.l2,r=un.textSpanPrefix+"2",a=sn.instructions.l3,s=un.textSpanPrefix+"3",u=Bt;t||(t=Bt,e.isEmptyString(n)||(u=$e(n,u),n=Ke(n,i),t+=n),e.isEmptyString(o)||(zt("displayInstructions: processing line2 "+o),u=$e(o,u),o=Ke(o,r),t=e.addSuffixIfNotThere(t,un.textLineBreak),t+=o),e.isEmptyString(a)||(zt("displayInstructions: processing line3 "+a),u=$e(a,u),a=Ke(a,s),t=e.addSuffixIfNotThere(t,un.textLineBreak),t+=a));var l=un.textFontSize,c=St(u,l,an);an.style.fontSize=Bt+c+"px",an.style.fontFamily=un.textFontFamily,an.innerHTML=t;var d=e.getChildElement(an,e.toCssIdQuery(i));Rt(d)||(d.style.opacity=0);var f=e.getChildElement(an,e.toCssIdQuery(r));Rt(f)||(f.style.opacity=0);var h=e.getChildElement(an,e.toCssIdQuery(s));if(Rt(h)||(h.style.opacity=0),sn.instructions.isVisible=!0,nt(an,sn.instructions),un.textSpanIsFadeIn){var m=un.textSpanFadeTimeSec,p=un.textSpanFadeStaggerTimeSec;Rt(d)||gsap.to(d,{duration:m,autoAlpha:1,ease:"power1.in"}),Rt(f)||gsap.to(f,{delay:p,duration:m,autoAlpha:1,ease:"power1.in"}),Rt(h)||gsap.to(h,{delay:2*p,duration:m,autoAlpha:1,ease:"power1.in"})}else Rt(d)||(d.style.opacity=1),Rt(f)||(f.style.opacity=1),Rt(h)||(h.style.opacity=1)}}function Ke(t,n){for(;e.contains(t,Xt);)t=e.replace(t,Xt,Zt);return t=e.wrapInSpanElement(t,n),t}function $e(t,n){var i=e.removeMarkup(t);return i.length>n.length?i:n}function et(e){return un.textFontType+Ot+e+"px "+un.textFontFamily}function tt(){Rt(an)||(an.innerHTML=Bt,sn.instructions.isVisible=!1,nt(an,sn.instructions))}function nt(t,n){var i=ot(n);Rt(n.bckgCol)||(i.background=n.bckgCol),e.setElementStyleProperty(t,i)}function it(e,t){Rt(e)||(t||m(),Gt(e.actions)&&rt(e.actions),Gt(e.instructions)&&We(e.instructions),Gt(e.counter)&&je(e.counter),Gt(e.playerConfig)&&Ye(e.playerConfig),Gt(e.granulatorConfig)&&Xe(e.granulatorConfig),Gt(e.viewState)&&Ze(e.viewState))}function ot(e){return e.isVisible?un.textStyleVisible:un.textStyleInvisible}function rt(t){var n=null,i=null,o=[],r={};if(e.isArray(t))for(var a=0;a<t.length;a++){var s=t[a];Gt(s.id)&&(n=s.id),Gt(s.actionType)&&(i=s.actionType),Gt(s.elementIds)&&(o=s.elementIds),Gt(s.params)&&(r=s.params),at(n,i,o,r)}}function at(e,t,n,i){if(zt("doAction: "+e+" actionType: "+t),!Rt(t)&&!Rt(n))switch(t){case"AUDIO":Ne(e,n,i);break;case"ACTIVATE":ne(e,n,i);break;case"STOP":st(e,n,i);break;default:Pt("doAction: Unknown actionType: "+t)}}function st(t,n,i){if(e.isArray(n))for(var o=0;o<n.length;o++)ut(t,n[o],i);else ut(t,n,i)}function ut(t,n,i){if(e.isString(t))switch(zt("stop: actionId: "+t+Ot+n),t){case"stop":lt(n,i);break;default:return void Pt("Unknown stop actionId: "+t)}}function lt(e,t){if(!Rt(e))switch(zt("runStopAction: target: "+e),e){case"all":ct(t);break;case"player":dt(t)}}function ct(e){zt("runStopAll: "),!Rt(i)&&i.isReady()&&(dt(e),ft(e))}function dt(e){Rt(i)?Pt("runAudioStopPlayer: Invalid zsAudio lib"):i.stopPlayer()}function ft(e){Rt(i)?Pt("runAudioStopNoise: Invalid zsAudio lib"):i.stopNoise()}function ht(){return e.getElement(un.instructionTxtElementId)}function mt(){return e.getElement(un.meterGroupId)}function pt(){return e.getElement(un.thumbUpGroupId)}function vt(){return e.getElement(un.thumbUpRectId)}function bt(){return e.getElement(un.thumbDownRectId)}function gt(){return e.getElement(un.thumbDownGroupId)}function xt(){return sn.thumbUpTween}function yt(){return sn.thumbDownTween}function It(){return sn.noteUpTween}function wt(){return sn.noteDownTween}function St(e,t,n){var i=1;a.innerWidth||s.documentElement.clientWidth||s.body.clientWidth;var o=a.innerHeight||s.documentElement.clientHeight||s.body.clientHeight,r=(et(i),n.clientWidth),u=r*un.textWidthCompressor,l=o*un.textAreaMax;i=Mt(e,t,u),i=At(r,i,l);var c=un.textMaxFontSize;return i>c&&(i=c),i}function At(e,t,n){var i=et(t),o=t,r=Tt(i,e,n);if(r<0)return o;var a=r*un.textNumberOfLines,s=n/a;return s<1&&(o*=s),o}function Mt(e,t,n){var i=et(t),o=Dt(i,e),r=o.width;if(r<=0||r>n||Math.abs(n-r)<1)return t;var a=n/r,s=t*a;return Mt(e,s,n)}function Dt(e,t){var n=sn.fontCanvas,i=sn.canvasCtx;return i.fillRect(0,0,n.width,n.height),i.textBaseline="top",i.fillStyle=Ht,i.font=e,i.measureText(t)}function Tt(e,t,n){var i=sn.fontCanvas,o=sn.canvasCtx;i.width=t,i.height=n,o.fillRect(0,0,i.width,i.height),o.textBaseline="top",o.fillStyle=Ht,o.font=e;var r="gM";o.fillText(r,0,0);for(var a=o.getImageData(0,0,i.width,i.height).data,s=-1,u=-1,l=0;l<i.height;l++)for(var c=0;c<i.width;c++){var d=4*(l*i.width+c);if(0!==a[d]){-1===s&&(s=l);break}if(c===i.width-1&&-1!==s){u=l,l=i.height;break}}var f=(u-s)*un.textHeightCompressor;return f}function Ut(){if(zt("onThumbsUp:"),sn.isThumbEnabled){if(X())return;e.setElementAttributes(pt(),un.filterInActiveAttrib),e.playOrRestartTween(xt())}if(sn.isNoteEnabled){if(_()||J())return;W(un.noteDownSymId),e.playOrRestartTween(It()),N()}sn.isVotingEnabled&&Y(jt)}function Ct(){if(zt("onThumbsDown:"),sn.isThumbEnabled){if(Z())return;e.setElementAttributes(gt(),un.filterInActiveAttrib),e.playOrRestartTween(yt())}if(sn.isNoteEnabled){if(_()||J())return;W(un.noteUpSymId),e.playOrRestartTween(wt()),F()}sn.isVotingEnabled&&Y(Yt)}function Nt(e){zt("onMouseUpThumbsUp:"),on||Ut()}function Ft(e){zt("onTouchEndThumbsUp:"),on&&Ut()}function kt(e){zt("onMouseUpThumbsDown:"),on||Ct()}function Et(e){zt("onTouchEndThumbsDown:"),on&&Ct()}function Vt(t,n){e.setElementAttributes(t,n)}function Rt(t){return e.isNull(t)}function Gt(t){return e.isNotNull(t)}function Pt(t){e.logError(t)}function zt(t){e.log(t)}const qt="DEV",Bt="",Ot=" ",Qt="Rect",Ht="#FFFFFF",Lt="VOTE",Wt="value",jt=1,Yt=-1,Xt="&#39;",Zt="'",_t="thumbs",Jt="notes",Kt="meter",$t="vote",en="audio";var tn=["/audio/DialogsRhythm7-1.wav"],nn=[[0]],on=null,rn=null,an=null,sn={bpm:80,instructions:{isVisible:!1,l1:Bt,l2:Bt,l3:Bt,bckgCol:"rgba(225, 225, 225, 0.85)"},voteCount:0,userNo:10,meter:null,currentVote:null,voteTimeMs:0,thumbUpTween:null,thumbDownTween:null,noteUpTween:null,noteUpDurationSec:1,noteDownTween:null,noteDownDurationSec:1,isVotingEnabled:!1,isThumbEnabled:!1,isNoteEnabled:!0,granulatorIndex:0,filterFreq:1,filterQ:0,noteUpFreq:[523.25,631.62,739.99],noteDownFreq:[261.63,315.81,369.99],isAudioEnabled:!0,currentSection:null,isSectionActive:!1,filterMod:null,meterAudioValue:0,noiseFreq:1e3,noiseQ:100},un={connectionPreference:"ws,sse,poll",appUrlHttp:"/htp",appUrlSse:"/sse",appUrlWebsockets:"/wsoc",textSpanPrefix:"is",instructionTxtElementId:"instructionTxt",textLineBreak:"<br/>",textStyleInvisible:{visibility:"hidden"},textStyleVisible:{visibility:"visible"},textFontFamily:"Arial",textFontType:"normal",textFontSize:50,textMaxFontSize:70,textMaxLineLen:30,textHeightCompressor:1.1,textWidthCompressor:.9,textAreaMax:.4,textNumberOfLines:3,textSpanIsFadeIn:!0,textSpanFadeTimeSec:1,textSpanFadeStaggerTimeSec:.5,voteTimeoutMs:5e3,noteDurationMultipler:8,loadingIconId:"loadingIcon",elementGroupSuffix:"Grp",meterGroupId:"meterGrp",thumbUpRectId:"thUpRect",thumbDownRectId:"thDownRect",thumbUpGroupId:"thumbUpGrp",thumbUpPathId:"thumbUpPth",thumbUpSymId:"thumbUpSym",thumbDownGroupId:"thumbDownGrp",thumbDownPathId:"thumbDownPth",thumbDownSymId:"thumbDownSym",noteUpGroupId:"noteUpGrp",noteUpSymId:"noteUpSym",noteDownGroupId:"noteDownGrp",noteDownSymId:"noteDownSym",meterBoxIdPrefix:"meterBox",meterBoxNo:20,meterMaxVotes:10,meterInactiveStyle:{fill:"none",stroke:"black","stroke-width":"4px"},meterZeroStyle:{fill:"yellow"},thumbsUpActiveStyle:{fill:"green"},thumbsUpInActiveStyle:{fill:"none"},thumbsDownActiveStyle:{fill:"red"},thumbsDownInActiveStyle:{fill:"none"},centreX:450,centreY:800,meterBoxWidth:80,meterBoxHeight:40,negativeMinCol:{r:255,g:165,b:0},negativeMaxCol:{r:255,g:0,b:0},positiveMinCol:{r:255,g:255,b:0},positiveMaxCol:{r:0,g:125,b:0},maxNoiseLevel:1,audioFadeInMs:1e3,filterGreenAttrib:{filter:"url(#dropshadowgreen)"},filterRedAttrib:{filter:"url(#dropshadowred)"},filterInActiveAttrib:{filter:"none"},noteUpConfig:{minAngle:0,maxAngle:360},noteDurations:[o.DURATION.MINIM,o.DURATION.CROTCHET,o.DURATION.QUAVER,o.DURATION.SEMI_QUAVER],noteSymbolsUp:["minimUp","crotchetUp","quaverUp","semiquaverUp"],noteSymbolsDown:["minimDown","crotchetDown","quaverDown","semiquaverDown"],availableViews:[_t,Jt,Kt,$t,en],maxNoiseFreq:1e4,minNoiseFreq:1e3,maxNoiseQ:3e3,minNoiseQ:30};return l.prototype.init=function(){if(!Rt(this.styleConfig)&&e.isNumeric(this.boxNo)&&e.isNumeric(this.midX)&&e.isNumeric(this.midY)){var t=e.isOddNumber(this.boxNo),n=Math.round(this.boxNo/2);this.positiveMaxIndex=this.boxNo-1,this.positiveMinIndex=n,this.negativeMinIndex=n-1,this.negativeMaxIndex=0,this.zeroIndex=null;var i=this.midY+n*this.boxHeight;t&&(this.negativeMinIndex=n-2,this.zeroIndex=n-1,i=this.midY+this.boxHeight/2+this.zeroIndex*this.boxHeight);for(var o=i,r=this.midX-this.boxWidth/2,a=0;a<this.boxNo;++a){var s=this.boxIdPrefix+a,u=this.boxSvgIdPrefix+a,l=o-this.boxHeight,c=this.getActiveStyle(a),f=new d(s,u,r,l,this.boxWidth,this.boxHeight,this.styleConfig.inactiveStyle,c);this.boxes[a]=f,o=l}this.draw(),this.isInitialised=!0}else Pt("ZScoreMeter.init: invalid inputs")},l.prototype.getActiveStyle=function(t){var n="yellow";if(!Rt(this.zeroIndex)&&t===this.zeroIndex)return this.styleConfig.zeroStyle;if(t>=this.positiveMinIndex&&t<=this.positiveMaxIndex){var i=0;this.positiveMaxIndex!=this.positiveMinIndex&&(i=(t-this.positiveMinIndex)/(this.positiveMaxIndex-this.positiveMinIndex));var o=e.interpolateRgbColours(this.styleConfig.posMinRGB,this.styleConfig.posMaxRGB,i);Rt(o)||(n=e.rgbToHex(o.r,o.g,o.b))}else if(t>=this.negativeMaxIndex&&t<=this.negativeMinIndex){i=0;this.negativeMinIndex!=this.negativeMaxIndex&&(i=(this.negativeMinIndex-t)/(this.negativeMinIndex-this.negativeMaxIndex));o=e.interpolateRgbColours(this.styleConfig.negMinRGB,this.styleConfig.negMaxRGB,i);Rt(o)||(n=e.rgbToHex(o.r,o.g,o.b))}return{fill:n}},l.prototype.clear=function(){for(var e=0;e<this.boxes.length;++e)this.setBoxStyle(e,this.styleConfig.inactiveStyle)},l.prototype.draw=function(){for(var e=0;e<this.boxes.length;++e)this.boxes[e].draw()},l.prototype.setPlayAudio=function(e){this.isPlayAudio=e,this.playAudio(this.currentValue,this.currentMaxVal)},l.prototype.set=function(t,n){if(e.isNumeric(t)&&e.isNumeric(n))if(this.clear(),Rt(this.zeroIndex)||this.activateBox(this.zeroIndex,!0),t>0){n<0&&(n*=-1);var i=1,o=n;o<i&&(o=i),t>o&&(t=o);for(var r=Math.floor(e.mapRange(t,i,o,this.positiveMinIndex,this.positiveMaxIndex)),a=this.positiveMinIndex;a<=r;a++)this.activateBox(a,!0);this.currentValue=t,this.currentMaxVal=o,this.playAudio(t,o)}else{n>0&&(n*=-1);i=-1,o=n;o>i&&(o=i),t<o&&(t=o);for(r=Math.ceil(e.mapRange(t,i,o,this.negativeMinIndex,this.negativeMaxIndex)),a=this.negativeMinIndex;a>=r;a--)this.activateBox(a,!0);this.currentValue=t,this.currentMaxVal=o,this.playAudio(t,o)}},l.prototype.activateBox=function(e,t){var n=this.boxes[e];Rt(n)||n.setActive(t)},l.prototype.setBoxStyle=function(e,t){var n=this.boxes[e];Rt(n)||n.setStyle(t)},l.prototype.playAudio=function(e,t){this.isPlayAudio&&C(e,t)},d.prototype.draw=function(){var t=mt();if(!Rt(t)){var i=n.createSvgRectangle(this.x,this.y,this.width,this.height,this.svgId);Vt(i,this.inactiveStyle),e.addChildToParent(t,i)}},d.prototype.setStyle=function(t){var n=e.getElement(this.svgId);Rt(n)||Vt(n,t)},d.prototype.setActive=function(t){var n=e.getElement(this.svgId);Rt(n)||Vt(n,t?this.activeStyle:this.inactiveStyle)},{load:function(){f()},onThumbsDownSelect:function(){Ct()},onThumbsUpSelect:function(){Ut()}}}(zsUtil,zsNet,zsSvg,zsAudio,zsMusic,zsSynth,window,document);