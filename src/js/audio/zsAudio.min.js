var zsAudio=function(n,t,i,o,e,a,r){"use strict";function u(n){this.message=n,this.name="ZsAudioException"}function l(n,t,i){this.context=n,this.urlList=t,this.onload=i,this.bufferList=new Array,this.loadCount=0}function s(e,a){if(!(n&&t&&i&&o))throw new u("Invalid libraries. Required: zsUtil, zsGranulator and zsSpeech");try{if($("initAudio: "),!en){var l=r.AudioContext||r.webkitAudioContext||r.mozAudioContext||r.oAudioContext;en=new l,$("initAudio:  created audio context")}if(n.isNotNull(a)&&(fn=a),"suspended"===en.state)return $("initAudio: Context suspended, resuming context : "+en.state),rn>=on?void $("initAudio: breached MAX Resume Retry Count, giving up ..."):(en.resume(),1===rn&&(en.onstatechange=function(){$("initAudio: on AudioContext state change to: "+en.state)}),r.hasOwnProperty("speechSynthesis")&&r.speechSynthesis.getVoices(),rn++,void setTimeout(function(){s(e,a)},1e3));f(e)}catch(n){an=!1,Y("Web Audio API is not supported in this browser")}}function f(t){if($("_initAudioBuffers: AudioContext state: "+en.state),"running"===en.state)if(n.isArray(t)&&(sn=t),n.isArray(sn)){an=!1;var i=new l(en,sn,c);i.load()}else Y("Invalid audio files to load array, ignoring load");else $("_initAudioBuffers: ignoring call. Invalid AudioContext state: "+en.state)}function c(t){un=t,n.isNotNull(fn)?fn():(h(),A(),R(0),T()),an=!0}function d(){return nn(en)?0:en.currentTime}function p(){}function y(t,i){if(en){n.isString(t)&&(t=n.toFloat(t));var o=ln;n.isNumeric(t)?(o=t,o<0?o=0:o>1&&(o=1),ln=o,G(ln,i)):Y("_setMasterVolume: Invalid gain level: "+t)}else Y("_setMasterVolume: invalid context")}function G(n,t){I(n),S(n,t),F(n),P(n,t),m(n,t),v(n,t)}function g(n){return Math.sqrt(Math.pow(2,n))/(Math.pow(2,n)-1)}function h(){if(nn(i))return Y("_initSpeech: Can not initialise speech"),void(i=null);i.init()}function v(n,t){i.setVolume(n)}function m(n,t){i.setMaxVolume(n)}function A(){nn(o)?Y("_playAudioBuffer: Invalid player"):o.init(en,un)}function C(n,t,i,e){!nn(o)&&an?o.play(n,t,i,e):Y("_playAudioBuffer: Invalid player")}function S(n,t){!nn(o)&&an?o.setGain(n,t):Y("_setPlayerVolume: Invalid player")}function I(n){!nn(o)&&an?o.setMaxGain(n):Y("_setPlayerMaxVolume: Invalid player")}function x(){!nn(o)&&an?o.stop():Y("_stopPlayer: Invalid player")}function R(n,i){if(nn(t))return Y("initGranulator: Can not initialise zsGranulator"),void(t=null);nn(un)||(nn(n)&&(n=0),nn(i)&&(i=en.destination),n<0||n>=un.length?Y("initGranulator: invalid buffer index"):t.init(en,un[n],i))}function F(n){nn(t)?Y("setGranulatorRampLinear: Invalid granulator"):t.setMaxGain(n)}function P(n,t){L("masterGainVal",n,t)}function L(n,i,o){nn(t)?Y("setGranulatorRampLinear: Invalid granulator"):t.addRampLinear(n,i,o)}function N(n,i,o,e){!nn(t)&&an?t.addRampSin(n,i,o,e):Y("setGranulatorRampSin: Invalid granulator")}function w(n,t){P(n,t)}function z(n){nn(t)?Y("setGranulatorEnvelope: Invalid granulator"):t.setGrainEnvelope(n)}function M(n,i){nn(t)?Y("_applyGranulatorGainEvelope: Invalid granulator"):t.applyGainEvelope(n,i)}function V(n){nn(t)?Y("setGranulatorConfig: Invalid granulator"):t.setGranulatorConfig(n)}function _(n){nn(t)?Y("setGranulatorGrainConfig: Invalid granulator"):t.setGrainConfig(n)}function b(n){nn(t)?Y("setGranulatorPlayDuration: Invalid granulator"):nn(n)?Y("setGranulatorPlayDuration: invalid duration"):t.setPlayDuration(n)}function B(){!nn(t)&&an?t.isReady()?t.play():$("playGranulator: Granulator is not initialised, can not play"):Y("playGranulator: Invalid granulator")}function E(){return!(nn(t)||!an)&&t.isPlaying()}function D(){!nn(t)&&an?t.isReady()?t.stop():$("stopGranulator: Granulator is not initialised, can not stop"):Y("stopGranulator: Invalid granulator")}function q(){!nn(t)&&an?t.reset():Y("stopGranulator: Invalid granulator")}function T(n){e&&(nn(e)?e=null:e.isReady()||e.isRunning()||e.init(en,n))}function Q(n){e.play(n)}function k(){e.stop()}function X(n){e.setFilterFreq(n)}function H(n){e.setFilterQ(n)}function U(n){e.setFilterDetune(n)}function O(n){e.setFilterType(n)}function W(n){a&&(nn(a)?a=null:a.init(en,n))}function Z(n,t){a.play(n,t)}function j(){a.stop()}function J(n){a.setFilterFreq(n)}function K(n){a.setFilterQ(n)}function Y(t){n.logError(t,tn)}function $(t){n.log(t,tn)}function nn(t){return n.isNull(t)}const tn="zsAudio: ",on=3;var en=null,an=!1,rn=1,un=null,ln=1,sn=["/audio/violin-tuning.mp3"],fn=null;return l.prototype.loadBuffer=function(n,t){var i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="arraybuffer";var o=this;$("loading file: "+n),i.onload=function(){o.context.decodeAudioData(i.response,function(i){i?(o.bufferList[t]=i,++o.loadCount==o.urlList.length&&o.onload(o.bufferList)):Y("error decoding file data: "+n)},function(n){Y("decodeAudioData error",n)})},i.onerror=function(){Y("BufferLoader: XHR error")},i.send()},l.prototype.load=function(){for(var n=0;n<this.urlList.length;++n)this.loadBuffer(this.urlList[n],n)},{init:function(n,t){s(n,t)},initSpeech:function(){h()},initPlayer:function(){A()},initGranulator:function(n){R(n)},initNoise:function(){T()},initSynth:function(){W()},setSynthFilterFreq:function(n){J(n)},setSynthFilterQ:function(n){K(n)},isReady:function(){return an},playAudio:function(n,t,i,o){C(n,t,i,o)},stopPlayer:function(){return x()},setGranulatorRampLinear:function(n,t,i){L(n,t,i)},setGranulatorRampSin:function(n,t,i,o){N(n,t,i,o)},setGranulatorGain:function(n,t){w(n,t)},setGranulatorEnvelope:function(n){z(n)},setGranulatorConfig:function(n){V(n)},setGranulatorGrainConfig:function(n){_(n)},setGranulatorPlayDuration:function(n){b(n)},playGranulator:function(){B()},isGranulatorPlaying:function(){return E()},stopGranulator:function(){D()},resetGranulator:function(){q()},isSpeachReady:function(){return i.isReady()},speak:function(n,t,o){return i.speak(n,t,o)},stopSpeach:function(){return i.stop()},setSpeechConfig:function(n){return i.setSpeechConfig(n)},playNoise:function(n){Q(n)},stopNoise:function(){k()},setNoiseFilterFreq:function(n){X(n)},setNoiseFilterQ:function(n){H(n)},setNoiseFilterDetune:function(n){U(n)},setNoiseFilterType:function(n){O(n)},playSynth:function(n,t){Z(n,t)},stopSynth:function(){j()},rumpLinearSpeechParam:function(n,t,o){return i.rampLinearConfigParam(n,t,o)},reset:function(){p()},getCurrentTime:function(){return d()},setMasterVolume:function(n,t){return y(n,t)},setPlayerVolume:function(n,t){return S(n,t)},setPlayerMaxVolume:function(n,t){return I(n,t)},loadAudioBuffers:function(n){return f(n)},setSpeechVolume:function(n,t){return v(n,t)},setGranulatorVolume:function(n,t){return P(n,t)},applyGranulatorGainEvelope:function(n,t){return M(n,t)},calcBandpassFilterQ:function(n){return g(n)}}}(zsUtil,zsGranulator,zsSpeech,zsPlayer,zsNoise,zsSynth,window);