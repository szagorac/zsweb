var zsAudio=function(n,t,i,o){"use strict";function r(n){this.message=n,this.name="ZsAudioException"}function e(n,t,i){this.context=n,this.urlList=t,this.onload=i,this.bufferList=new Array,this.loadCount=0}function a(l,s){if(!n||!t||!i)throw new r("Invalid libraries. Required: zsUtil, zsGranulator and zsSpeech");try{if(L("initAudio: "),!P){var f=o.AudioContext||o.webkitAudioContext||o.mozAudioContext||o.oAudioContext;P=new f,L("initAudio:  created audio context")}if("suspended"===P.state)return L("initAudio: Context suspended, resuming context : "+P.state),D>=B?void L("initAudio: breached MAX Resume Retry Count, giving up ..."):(P.resume(),1===D&&(P.onstatechange=function(){L("initAudio: on AudioContext state change to: "+P.state)}),o.hasOwnProperty("speechSynthesis")&&o.speechSynthesis.getVoices(),D++,void setTimeout(function(){a(l,s)},1e3));L("initAudio: AudioContext state: "+P.state),G(),n.isArray(l)?X=l:b("Invalid audio files to load array"),s<0||s>=X.length?b("Invalid granulator file index: "+s):k=s;var d=new e(P,X,u);d.load()}catch(n){T=!1,b("Web Audio API is not supported in this browser")}}function u(n){E=n,v(k),T=!0}function l(){return w(P)?0:P.currentTime}function s(n){if(!n)return b("createBufferAudioSource: invalid audio buffer"),null;if(!P)return b("createBufferAudioSource: Audio context is not initialised!!"),null;var t=P.createBufferSource();return t.buffer=n,t.connect(P.destination),t}function f(n,t,i,o){if(n<0||n>E.length)b("playAudioBuffer: Invalid buffer index: "+n);else{var r=E[n];if(r){var e=s(r);w(e)?b("playAudioBuffer: invalid audio source"):(e.start||(e.start=e.noteOn),t||(t=P.currentTime),i||(i=0),o||(o=r.duration),e.onended=function(n){d(e)},e.start(t,i,o))}else L("playAudioBuffer: invalid buffer")}}function d(n){L("onPlayComplete: "),c(n)}function c(n){L("stopAudioSource: time:"+P.currentTime),n&&(n.disconnect(),n=null)}function p(){}function G(){if(w(i))return b("_initSpeech: Can not initialise speech"),void(i=null);i.init()}function v(n,i){if(w(t))return b("initGranulator: Can not initialise zsGranulator"),void(t=null);w(n)&&(n=0),w(i)&&(i=P.destination),n<0||n>=E.length?b("initGranulator: invalid buffer index"):t.init(P,E[n],i)}function g(n,i,o){w(t)?b("setGranulatorRampLinear: Invalid granulator"):t.addRampLinear(n,i,o)}function h(n,i,o,r){!w(t)&&T?t.addRampSin(n,i,o,r):b("setGranulatorRampSin: Invalid granulator")}function y(n,i){!w(t)&&T?t.setGain(n,i):b("setGranulatorGain: Invalid granulator")}function A(n){!w(t)&&T?t.setGrainEnvelope(n):b("setGranulatorEnvelope: Invalid granulator")}function m(n){!w(t)&&T?t.setGranulatorConfig(n):b("setGranulatorConfig: Invalid granulator")}function C(n){!w(t)&&T?t.setGrainConfig(n):b("setGranulatorGrainConfig: Invalid granulator")}function S(n){!w(t)&&T?w(n)?b("setGranulatorPlayDuration: invalid duration"):t.setPlayDuration(n):b("setGranulatorPlayDuration: Invalid granulator")}function x(){!w(t)&&T?t.isReady()?t.play():L("playGranulator: Granulator is not initialised, can not play"):b("playGranulator: Invalid granulator")}function R(){!w(t)&&T?t.isReady()?t.stop():L("stopGranulator: Granulator is not initialised, can not stop"):b("stopGranulator: Invalid granulator")}function I(){!w(t)&&T?t.reset():b("stopGranulator: Invalid granulator")}function b(t){n.logError(t,z)}function L(t){n.log(t,z)}function w(t){return n.isNull(t)}const z="zsAudio: ",B=3;var P=null,T=!1,D=1,E=null,k=0,X=["/audio/violin-tuning.mp3"];return e.prototype.loadBuffer=function(n,t){var i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="arraybuffer";var o=this;i.onload=function(){o.context.decodeAudioData(i.response,function(i){i?(o.bufferList[t]=i,++o.loadCount==o.urlList.length&&o.onload(o.bufferList)):b("error decoding file data: "+n)},function(n){b("decodeAudioData error",n)})},i.onerror=function(){b("BufferLoader: XHR error")},i.send()},e.prototype.load=function(){for(var n=0;n<this.urlList.length;++n)this.loadBuffer(this.urlList[n],n)},{init:function(n,t){a(n,t)},isReady:function(){return T},playAudio:function(n,t,i,o){f(n,t,i,o)},setGranulatorRampLinear:function(n,t,i){g(n,t,i)},setGranulatorRampSin:function(n,t,i,o){h(n,t,i,o)},setGranulatorGain:function(n,t){y(n,t)},setGranulatorEnvelope:function(n){A(n)},setGranulatorConfig:function(n){m(n)},setGranulatorGrainConfig:function(n){C(n)},setGranulatorPlayDuration:function(n){S(n)},playGranulator:function(){x()},stopGranulator:function(){R()},resetGranulator:function(){I()},isSpeachReady:function(){return i.isReady()},speak:function(n,t,o){return i.speak(n,t,o)},stopSpeach:function(){return i.stop()},setSpeechConfig:function(n){return i.setSpeechConfig(n)},rumpLinearSpeechParam:function(n,t,o){return i.rampLinearConfigParam(n,t,o)},reset:function(){p()},getCurrentTime:function(){return l()}}}(zsUtil,zsGranulator,zsSpeech,window);