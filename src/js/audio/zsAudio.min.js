var zsAudio=function(n,t,i,o,e,a,r){"use strict";function u(n){this.message=n,this.name="ZsAudioException"}function l(n,t,i){this.context=n,this.urlList=t,this.onload=i,this.bufferList=new Array,this.loadCount=0}function s(e,a){if(!(n&&t&&i&&o))throw new u("Invalid libraries. Required: zsUtil, zsGranulator and zsSpeech");try{if(Z("initAudio: "),!Y){var l=r.AudioContext||r.webkitAudioContext||r.mozAudioContext||r.oAudioContext;Y=new l,Z("initAudio:  created audio context")}if(n.isNotNull(a)&&(an=a),"suspended"===Y.state)return Z("initAudio: Context suspended, resuming context : "+Y.state),nn>=K?void Z("initAudio: breached MAX Resume Retry Count, giving up ..."):(Y.resume(),1===nn&&(Y.onstatechange=function(){Z("initAudio: on AudioContext state change to: "+Y.state)}),r.hasOwnProperty("speechSynthesis")&&r.speechSynthesis.getVoices(),nn++,void setTimeout(function(){s(e,a)},1e3));f(e)}catch(n){$=!1,W("Web Audio API is not supported in this browser")}}function f(t){if(Z("_initAudioBuffers: AudioContext state: "+Y.state),"running"===Y.state)if(n.isArray(t)&&(en=t),n.isArray(en)){$=!1;var i=new l(Y,en,c);i.load()}else W("Invalid audio files to load array, ignoring load");else Z("_initAudioBuffers: ignoring call. Invalid AudioContext state: "+Y.state)}function c(t){tn=t,n.isNotNull(an)?an():(g(),m(),x(0),T()),$=!0}function d(){return j(Y)?0:Y.currentTime}function p(){}function y(t,i){if(Y){n.isString(t)&&(t=n.toFloat(t));var o=on;n.isNumeric(t)?(o=t,o<0?o=0:o>1&&(o=1),on=o,G(on,i)):W("_setMasterVolume: Invalid gain level: "+t)}else W("_setMasterVolume: invalid context")}function G(n,t){S(n),C(n,t),P(n),R(n,t),h(n,t),v(n,t)}function g(){if(j(i))return W("_initSpeech: Can not initialise speech"),void(i=null);i.init()}function v(n,t){i.setVolume(n)}function h(n,t){i.setMaxVolume(n)}function m(){j(o)?W("_playAudioBuffer: Invalid player"):o.init(Y,tn)}function A(n,t,i,e){!j(o)&&$?o.play(n,t,i,e):W("_playAudioBuffer: Invalid player")}function C(n,t){!j(o)&&$?o.setGain(n,t):W("_setPlayerVolume: Invalid player")}function S(n){!j(o)&&$?o.setMaxGain(n):W("_setPlayerMaxVolume: Invalid player")}function I(){!j(o)&&$?o.stop():W("_stopPlayer: Invalid player")}function x(n,i){if(j(t))return W("initGranulator: Can not initialise zsGranulator"),void(t=null);j(n)&&(n=0),j(i)&&(i=Y.destination),n<0||n>=tn.length?W("initGranulator: invalid buffer index"):t.init(Y,tn[n],i)}function P(n){j(t)?W("setGranulatorRampLinear: Invalid granulator"):t.setMaxGain(n)}function R(n,t){L("masterGainVal",n,t)}function L(n,i,o){j(t)?W("setGranulatorRampLinear: Invalid granulator"):t.addRampLinear(n,i,o)}function z(n,i,o,e){!j(t)&&$?t.addRampSin(n,i,o,e):W("setGranulatorRampSin: Invalid granulator")}function V(n,t){R(n,t)}function w(n){j(t)?W("setGranulatorEnvelope: Invalid granulator"):t.setGrainEnvelope(n)}function _(n,i){j(t)?W("_applyGranulatorGainEvelope: Invalid granulator"):t.applyGainEvelope(n,i)}function b(n){j(t)?W("setGranulatorConfig: Invalid granulator"):t.setGranulatorConfig(n)}function M(n){j(t)?W("setGranulatorGrainConfig: Invalid granulator"):t.setGrainConfig(n)}function N(n){j(t)?W("setGranulatorPlayDuration: Invalid granulator"):j(n)?W("setGranulatorPlayDuration: invalid duration"):t.setPlayDuration(n)}function E(){!j(t)&&$?t.isReady()?t.play():Z("playGranulator: Granulator is not initialised, can not play"):W("playGranulator: Invalid granulator")}function B(){return!(j(t)||!$)&&t.isPlaying()}function F(){!j(t)&&$?t.isReady()?t.stop():Z("stopGranulator: Granulator is not initialised, can not stop"):W("stopGranulator: Invalid granulator")}function D(){!j(t)&&$?t.reset():W("stopGranulator: Invalid granulator")}function T(n){e&&(j(e)?e=null:e.init(Y,n))}function q(n){e.play(n)}function k(){e.stop()}function X(n){a&&(j(a)?a=null:a.init(Y,n))}function H(n,t){a.play(n,t)}function Q(){a.stop()}function U(n){a.setFilterFreq(n)}function O(n){a.setFilterQ(n)}function W(t){n.logError(t,J)}function Z(t){n.log(t,J)}function j(t){return n.isNull(t)}const J="zsAudio: ",K=3;var Y=null,$=!1,nn=1,tn=null,on=1,en=["/audio/violin-tuning.mp3"],an=null;return l.prototype.loadBuffer=function(n,t){var i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="arraybuffer";var o=this;Z("loading file: "+n),i.onload=function(){o.context.decodeAudioData(i.response,function(i){i?(o.bufferList[t]=i,++o.loadCount==o.urlList.length&&o.onload(o.bufferList)):W("error decoding file data: "+n)},function(n){W("decodeAudioData error",n)})},i.onerror=function(){W("BufferLoader: XHR error")},i.send()},l.prototype.load=function(){for(var n=0;n<this.urlList.length;++n)this.loadBuffer(this.urlList[n],n)},{init:function(n,t){s(n,t)},initSpeech:function(){g()},initPlayer:function(){m()},initGranulator:function(n){x(n)},initNoise:function(){T()},initSynth:function(){X()},setSynthFilterFreq:function(n){U(n)},setSynthFilterQ:function(n){O(n)},isReady:function(){return $},playAudio:function(n,t,i,o){A(n,t,i,o)},stopPlayer:function(){return I()},setGranulatorRampLinear:function(n,t,i){L(n,t,i)},setGranulatorRampSin:function(n,t,i,o){z(n,t,i,o)},setGranulatorGain:function(n,t){V(n,t)},setGranulatorEnvelope:function(n){w(n)},setGranulatorConfig:function(n){b(n)},setGranulatorGrainConfig:function(n){M(n)},setGranulatorPlayDuration:function(n){N(n)},playGranulator:function(){E()},isGranulatorPlaying:function(){return B()},stopGranulator:function(){F()},resetGranulator:function(){D()},isSpeachReady:function(){return i.isReady()},speak:function(n,t,o){return i.speak(n,t,o)},stopSpeach:function(){return i.stop()},setSpeechConfig:function(n){return i.setSpeechConfig(n)},playNoise:function(n){q(n)},stopNoise:function(){k()},playSynth:function(n,t){H(n,t)},stopSynth:function(){Q()},rumpLinearSpeechParam:function(n,t,o){return i.rampLinearConfigParam(n,t,o)},reset:function(){p()},getCurrentTime:function(){return d()},setMasterVolume:function(n,t){return y(n,t)},setPlayerVolume:function(n,t){return C(n,t)},setPlayerMaxVolume:function(n,t){return S(n,t)},loadAudioBuffers:function(n){return f(n)},setSpeechVolume:function(n,t){return v(n,t)},setGranulatorVolume:function(n,t){return R(n,t)},applyGranulatorGainEvelope:function(n,t){return _(n,t)}}}(zsUtil,zsGranulator,zsSpeech,zsPlayer,zsNoise,zsSynth,window);