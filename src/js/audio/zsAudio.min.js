var zsAudio=function(n,t,i,o,e,r,a){"use strict";function u(n){this.message=n,this.name="ZsAudioException"}function l(n,t,i){this.context=n,this.urlList=t,this.onload=i,this.bufferList=new Array,this.loadCount=0}function s(e,r){if(!(n&&t&&i&&o))throw new u("Invalid libraries. Required: zsUtil, zsGranulator and zsSpeech");try{if(tn("initAudio: "),!an){var l=a.AudioContext||a.webkitAudioContext||a.mozAudioContext||a.oAudioContext;an=new l,tn("initAudio:  created audio context")}if(n.isNotNull(r)&&(dn=r),n.isNotNull(cn)&&(cn=e),"suspended"===an.state)return tn("initAudio: Context suspended, resuming context : "+an.state),ln>=rn?void tn("initAudio: breached MAX Resume Retry Count, giving up ..."):(an.resume(),1===ln&&(an.onstatechange=function(){tn("initAudio: on AudioContext state change to: "+an.state)}),a.hasOwnProperty("speechSynthesis")&&a.speechSynthesis.getVoices(),ln++,void setTimeout(function(){f()},1e3));c(e)}catch(n){un=!1,nn("Web Audio API is not supported in this browser")}}function f(){tn("_initAudioRetry: "),un?tn("_initAudioRetry: Audio has been initialised, ignnoring retry..."):s(cn,dn)}function c(t){if(tn("_initAudioBuffers: AudioContext state: "+an.state),"running"===an.state)if(n.isArray(t)&&(cn=t),n.isArray(cn)){un=!1;var i=new l(an,cn,d);i.load()}else nn("Invalid audio files to load array, ignoring load");else tn("_initAudioBuffers: ignoring call. Invalid AudioContext state: "+an.state)}function d(t){sn=t,n.isNotNull(dn)?dn():(v(),C(),F(0),Q()),un=!0}function p(){return on(an)?0:an.currentTime}function y(){}function G(t,i){if(an){n.isString(t)&&(t=n.toFloat(t));var o=fn;n.isNumeric(t)?(o=t,o<0?o=0:o>1&&(o=1),fn=o,g(fn,i)):nn("_setMasterVolume: Invalid gain level: "+t)}else nn("_setMasterVolume: invalid context")}function g(n,t){R(n),I(n,t),P(n),N(n,t),A(n,t),m(n,t),$(n,t)}function h(n){return Math.sqrt(Math.pow(2,n))/(Math.pow(2,n)-1)}function v(){if(on(i))return nn("_initSpeech: Can not initialise speech"),void(i=null);i.init()}function m(n,t){i.setVolume(n)}function A(n,t){i.setMaxVolume(n)}function C(){on(o)?nn("_playAudioBuffer: Invalid player"):o.init(an,sn)}function S(n,t,i,e){!on(o)&&un?o.play(n,t,i,e):nn("_playAudioBuffer: Invalid player")}function I(n,t){!on(o)&&un?o.setGain(n,t):nn("_setPlayerVolume: Invalid player")}function R(n){!on(o)&&un?o.setMaxGain(n):nn("_setPlayerMaxVolume: Invalid player")}function x(){!on(o)&&un?o.stop():nn("_stopPlayer: Invalid player")}function F(n,i){if(on(t))return nn("initGranulator: Can not initialise zsGranulator"),void(t=null);on(sn)||(on(n)&&(n=0),on(i)&&(i=an.destination),n<0||n>=sn.length?nn("initGranulator: invalid buffer index"):t.init(an,sn[n],i))}function P(n){on(t)?nn("setGranulatorRampLinear: Invalid granulator"):t.setMaxGain(n)}function N(n,t){L("masterGainVal",n,t)}function L(n,i,o){on(t)?nn("setGranulatorRampLinear: Invalid granulator"):t.addRampLinear(n,i,o)}function V(n,i,o,e){!on(t)&&un?t.addRampSin(n,i,o,e):nn("setGranulatorRampSin: Invalid granulator")}function w(n,t){N(n,t)}function z(n){on(t)?nn("setGranulatorEnvelope: Invalid granulator"):t.setGrainEnvelope(n)}function M(n,i){on(t)?nn("_applyGranulatorGainEvelope: Invalid granulator"):t.applyGainEvelope(n,i)}function _(n){on(t)?nn("setGranulatorConfig: Invalid granulator"):t.setGranulatorConfig(n)}function b(n){on(t)?nn("setGranulatorGrainConfig: Invalid granulator"):t.setGrainConfig(n)}function B(n){on(t)?nn("setGranulatorPlayDuration: Invalid granulator"):on(n)?nn("setGranulatorPlayDuration: invalid duration"):t.setPlayDuration(n)}function E(){!on(t)&&un?t.isReady()?t.play():tn("playGranulator: Granulator is not initialised, can not play"):nn("playGranulator: Invalid granulator")}function D(){return!(on(t)||!un)&&t.isPlaying()}function q(){!on(t)&&un?t.isReady()?t.stop():tn("stopGranulator: Granulator is not initialised, can not stop"):nn("stopGranulator: Invalid granulator")}function T(){!on(t)&&un?t.reset():nn("stopGranulator: Invalid granulator")}function Q(n){e&&(on(e)?e=null:e.isReady()||e.isRunning()||e.init(an,n))}function k(n){e.play(n)}function X(){e.stop()}function H(n){e.setFilterFreq(n)}function U(n){e.setFilterQ(n)}function O(n){e.setFilterDetune(n)}function W(n){e.setFilterType(n)}function Z(n){r&&(on(r)?r=null:r.init(an,n))}function j(n,t){r.play(n,t)}function J(){r.stop()}function K(n){r.setFilterFreq(n)}function Y(n){r.setFilterQ(n)}function $(n,t){r.setGain(n,t)}function nn(t){n.logError(t,en)}function tn(t){n.log(t,en)}function on(t){return n.isNull(t)}const en="zsAudio: ",rn=3;var an=null,un=!1,ln=1,sn=null,fn=1,cn=["/audio/violin-tuning.mp3"],dn=null;return l.prototype.loadBuffer=function(n,t){var i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="arraybuffer";var o=this;tn("loading file: "+n),i.onload=function(){o.context.decodeAudioData(i.response,function(i){i?(o.bufferList[t]=i,++o.loadCount==o.urlList.length&&o.onload(o.bufferList)):nn("error decoding file data: "+n)},function(n){nn("decodeAudioData error",n)})},i.onerror=function(){nn("BufferLoader: XHR error")},i.send()},l.prototype.load=function(){for(var n=0;n<this.urlList.length;++n)this.loadBuffer(this.urlList[n],n)},{init:function(n,t){s(n,t)},initSpeech:function(){v()},initPlayer:function(){C()},initGranulator:function(n){F(n)},initNoise:function(){Q()},initSynth:function(){Z()},setSynthFilterFreq:function(n){K(n)},setSynthFilterQ:function(n){Y(n)},isReady:function(){return un},playAudio:function(n,t,i,o){S(n,t,i,o)},stopPlayer:function(){return x()},setGranulatorRampLinear:function(n,t,i){L(n,t,i)},setGranulatorRampSin:function(n,t,i,o){V(n,t,i,o)},setGranulatorGain:function(n,t){w(n,t)},setGranulatorEnvelope:function(n){z(n)},setGranulatorConfig:function(n){_(n)},setGranulatorGrainConfig:function(n){b(n)},setGranulatorPlayDuration:function(n){B(n)},playGranulator:function(){E()},isGranulatorPlaying:function(){return D()},stopGranulator:function(){q()},resetGranulator:function(){T()},isSpeachReady:function(){return i.isReady()},speak:function(n,t,o){return i.speak(n,t,o)},stopSpeach:function(){return i.stop()},setSpeechConfig:function(n){return i.setSpeechConfig(n)},playNoise:function(n){k(n)},stopNoise:function(){X()},setNoiseFilterFreq:function(n){H(n)},setNoiseFilterQ:function(n){U(n)},setNoiseFilterDetune:function(n){O(n)},setNoiseFilterType:function(n){W(n)},playSynth:function(n,t){j(n,t)},stopSynth:function(){J()},setSynthVolume:function(n,t){return $(n,t)},rumpLinearSpeechParam:function(n,t,o){return i.rampLinearConfigParam(n,t,o)},reset:function(){y()},getCurrentTime:function(){return p()},setMasterVolume:function(n,t){return G(n,t)},setPlayerVolume:function(n,t){return I(n,t)},setPlayerMaxVolume:function(n,t){return R(n,t)},loadAudioBuffers:function(n){return c(n)},setSpeechVolume:function(n,t){return m(n,t)},setGranulatorVolume:function(n,t){return N(n,t)},applyGranulatorGainEvelope:function(n,t){return M(n,t)},calcBandpassFilterQ:function(n){return h(n)}}}(zsUtil,zsGranulator,zsSpeech,zsPlayer,zsNoise,zsSynth,window);