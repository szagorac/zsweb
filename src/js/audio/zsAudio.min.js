var zsAudio=function(n,t,i,o,a,e){"use strict";function r(n){this.message=n,this.name="ZsAudioException"}function u(n,t,i){this.context=n,this.urlList=t,this.onload=i,this.bufferList=new Array,this.loadCount=0}function s(a,c){if(!(n&&t&&i&&o))throw new r("Invalid libraries. Required: zsUtil, zsGranulator and zsSpeech");try{if(B("initAudio: "),!H){var f=e.AudioContext||e.webkitAudioContext||e.mozAudioContext||e.oAudioContext;H=new f,B("initAudio:  created audio context")}if(n.isNotNull(c)&&(j=c),"suspended"===H.state)return B("initAudio: Context suspended, resuming context : "+H.state),F>=q?void B("initAudio: breached MAX Resume Retry Count, giving up ..."):(H.resume(),1===F&&(H.onstatechange=function(){B("initAudio: on AudioContext state change to: "+H.state)}),e.hasOwnProperty("speechSynthesis")&&e.speechSynthesis.getVoices(),F++,void setTimeout(function(){s(a,c)},1e3));B("initAudio: AudioContext state: "+H.state),n.isArray(a)?Z=a:k("Invalid audio files to load array");var d=new u(H,Z,l);d.load()}catch(n){U=!1,k("Web Audio API is not supported in this browser")}}function l(t){O=t,n.isNotNull(j)?j():(G(),v(),C(0),D()),U=!0}function c(){return X(H)?0:H.currentTime}function f(){}function d(t,i){if(H){n.isString(t)&&(t=n.toFloat(t));var o=W;n.isNumeric(t)?(o=t,o<0?o=0:o>1&&(o=1),W=o,p(W,i)):k("_setMasterVolume: Invalid gain level: "+t)}else k("_setMasterVolume: invalid context")}function p(n,t){A(n),m(n,t),x(n),R(n,t),h(n,t),g(n,t)}function G(){if(X(i))return k("_initSpeech: Can not initialise speech"),void(i=null);i.init()}function g(n,t){i.setVolume(n)}function h(n,t){i.setMaxVolume(n)}function v(){o.init(H,O)}function y(n,t,i,a){o.play(n,t,i,a)}function m(n,t){o.setGain(n,t)}function A(n){o.setMaxGain(n)}function C(n,i){if(X(t))return k("initGranulator: Can not initialise zsGranulator"),void(t=null);X(n)&&(n=0),X(i)&&(i=H.destination),n<0||n>=O.length?k("initGranulator: invalid buffer index"):t.init(H,O[n],i)}function x(n){X(t)?k("setGranulatorRampLinear: Invalid granulator"):t.setMaxGain(n)}function R(n,t){S("masterGainVal",n,t)}function S(n,i,o){X(t)?k("setGranulatorRampLinear: Invalid granulator"):t.addRampLinear(n,i,o)}function L(n,i,o,a){!X(t)&&U?t.addRampSin(n,i,o,a):k("setGranulatorRampSin: Invalid granulator")}function I(n,t){R(n,t)}function z(n){!X(t)&&U?t.setGrainEnvelope(n):k("setGranulatorEnvelope: Invalid granulator")}function P(n){!X(t)&&U?t.setGranulatorConfig(n):k("setGranulatorConfig: Invalid granulator")}function w(n){!X(t)&&U?t.setGrainConfig(n):k("setGranulatorGrainConfig: Invalid granulator")}function V(n){!X(t)&&U?X(n)?k("setGranulatorPlayDuration: invalid duration"):t.setPlayDuration(n):k("setGranulatorPlayDuration: Invalid granulator")}function b(){!X(t)&&U?t.isReady()?t.play():B("playGranulator: Granulator is not initialised, can not play"):k("playGranulator: Invalid granulator")}function N(){!X(t)&&U?t.isReady()?t.stop():B("stopGranulator: Granulator is not initialised, can not stop"):k("stopGranulator: Invalid granulator")}function M(){!X(t)&&U?t.reset():k("stopGranulator: Invalid granulator")}function D(n){a&&(X(a)?a=null:a.init(H,n))}function E(n){a.play(n)}function T(){a.stop()}function k(t){n.logError(t,_)}function B(t){n.log(t,_)}function X(t){return n.isNull(t)}const _="zsAudio: ",q=3;var H=null,U=!1,F=1,O=null,W=1,Z=["/audio/violin-tuning.mp3"],j=null;return u.prototype.loadBuffer=function(n,t){var i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="arraybuffer";var o=this;i.onload=function(){o.context.decodeAudioData(i.response,function(i){i?(o.bufferList[t]=i,++o.loadCount==o.urlList.length&&o.onload(o.bufferList)):k("error decoding file data: "+n)},function(n){k("decodeAudioData error",n)})},i.onerror=function(){k("BufferLoader: XHR error")},i.send()},u.prototype.load=function(){for(var n=0;n<this.urlList.length;++n)this.loadBuffer(this.urlList[n],n)},{init:function(n,t){s(n,t)},initSpeech:function(){G()},initPlayer:function(){v()},initGranulator:function(n){C(n)},initNoise:function(){D()},isReady:function(){return U},playAudio:function(n,t,i,o){y(n,t,i,o)},setGranulatorRampLinear:function(n,t,i){S(n,t,i)},setGranulatorRampSin:function(n,t,i,o){L(n,t,i,o)},setGranulatorGain:function(n,t){I(n,t)},setGranulatorEnvelope:function(n){z(n)},setGranulatorConfig:function(n){P(n)},setGranulatorGrainConfig:function(n){w(n)},setGranulatorPlayDuration:function(n){V(n)},playGranulator:function(){b()},stopGranulator:function(){N()},resetGranulator:function(){M()},isSpeachReady:function(){return i.isReady()},speak:function(n,t,o){return i.speak(n,t,o)},stopSpeach:function(){return i.stop()},setSpeechConfig:function(n){return i.setSpeechConfig(n)},playNoise:function(n){E(n)},stopNoise:function(){T()},rumpLinearSpeechParam:function(n,t,o){return i.rampLinearConfigParam(n,t,o)},reset:function(){f()},getCurrentTime:function(){return c()},setMasterVolume:function(n,t){return d(n,t)},setPlayerVolume:function(n,t){return m(n,t)},setPlayerMaxVolume:function(n,t){return A(n,t)},setSpeechVolume:function(n,t){return g(n,t)},setGranulatorVolume:function(n,t){return R(n,t)}}}(zsUtil,zsGranulator,zsSpeech,zsPlayer,zsNoise,window);