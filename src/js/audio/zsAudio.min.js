var zsAudio=function(n,t,i,o,e,a,r){"use strict";function u(n){this.message=n,this.name="ZsAudioException"}function l(n,t,i){this.context=n,this.urlList=t,this.onload=i,this.bufferList=new Array,this.loadCount=0}function s(e,a){if(!(n&&t&&i&&o))throw new u("Invalid libraries. Required: zsUtil, zsGranulator and zsSpeech");try{if(K("initAudio: "),!tn){var l=r.AudioContext||r.webkitAudioContext||r.mozAudioContext||r.oAudioContext;tn=new l,K("initAudio:  created audio context")}if(n.isNotNull(a)&&(ln=a),"suspended"===tn.state)return K("initAudio: Context suspended, resuming context : "+tn.state),en>=nn?void K("initAudio: breached MAX Resume Retry Count, giving up ..."):(tn.resume(),1===en&&(tn.onstatechange=function(){K("initAudio: on AudioContext state change to: "+tn.state)}),r.hasOwnProperty("speechSynthesis")&&r.speechSynthesis.getVoices(),en++,void setTimeout(function(){s(e,a)},1e3));f(e)}catch(n){on=!1,J("Web Audio API is not supported in this browser")}}function f(t){if(K("_initAudioBuffers: AudioContext state: "+tn.state),"running"===tn.state)if(n.isArray(t)&&(un=t),n.isArray(un)){on=!1;var i=new l(tn,un,c);i.load()}else J("Invalid audio files to load array, ignoring load");else K("_initAudioBuffers: ignoring call. Invalid AudioContext state: "+tn.state)}function c(t){an=t,n.isNotNull(ln)?ln():(g(),m(),x(0),q()),on=!0}function d(){return Y(tn)?0:tn.currentTime}function p(){}function y(t,i){if(tn){n.isString(t)&&(t=n.toFloat(t));var o=rn;n.isNumeric(t)?(o=t,o<0?o=0:o>1&&(o=1),rn=o,G(rn,i)):J("_setMasterVolume: Invalid gain level: "+t)}else J("_setMasterVolume: invalid context")}function G(n,t){S(n),C(n,t),R(n),P(n,t),h(n,t),v(n,t)}function g(){if(Y(i))return J("_initSpeech: Can not initialise speech"),void(i=null);i.init()}function v(n,t){i.setVolume(n)}function h(n,t){i.setMaxVolume(n)}function m(){Y(o)?J("_playAudioBuffer: Invalid player"):o.init(tn,an)}function A(n,t,i,e){!Y(o)&&on?o.play(n,t,i,e):J("_playAudioBuffer: Invalid player")}function C(n,t){!Y(o)&&on?o.setGain(n,t):J("_setPlayerVolume: Invalid player")}function S(n){!Y(o)&&on?o.setMaxGain(n):J("_setPlayerMaxVolume: Invalid player")}function I(){!Y(o)&&on?o.stop():J("_stopPlayer: Invalid player")}function x(n,i){if(Y(t))return J("initGranulator: Can not initialise zsGranulator"),void(t=null);Y(n)&&(n=0),Y(i)&&(i=tn.destination),n<0||n>=an.length?J("initGranulator: invalid buffer index"):t.init(tn,an[n],i)}function R(n){Y(t)?J("setGranulatorRampLinear: Invalid granulator"):t.setMaxGain(n)}function P(n,t){F("masterGainVal",n,t)}function F(n,i,o){Y(t)?J("setGranulatorRampLinear: Invalid granulator"):t.addRampLinear(n,i,o)}function L(n,i,o,e){!Y(t)&&on?t.addRampSin(n,i,o,e):J("setGranulatorRampSin: Invalid granulator")}function z(n,t){P(n,t)}function N(n){Y(t)?J("setGranulatorEnvelope: Invalid granulator"):t.setGrainEnvelope(n)}function V(n,i){Y(t)?J("_applyGranulatorGainEvelope: Invalid granulator"):t.applyGainEvelope(n,i)}function w(n){Y(t)?J("setGranulatorConfig: Invalid granulator"):t.setGranulatorConfig(n)}function _(n){Y(t)?J("setGranulatorGrainConfig: Invalid granulator"):t.setGrainConfig(n)}function b(n){Y(t)?J("setGranulatorPlayDuration: Invalid granulator"):Y(n)?J("setGranulatorPlayDuration: invalid duration"):t.setPlayDuration(n)}function M(){!Y(t)&&on?t.isReady()?t.play():K("playGranulator: Granulator is not initialised, can not play"):J("playGranulator: Invalid granulator")}function E(){return!(Y(t)||!on)&&t.isPlaying()}function B(){!Y(t)&&on?t.isReady()?t.stop():K("stopGranulator: Granulator is not initialised, can not stop"):J("stopGranulator: Invalid granulator")}function T(){!Y(t)&&on?t.reset():J("stopGranulator: Invalid granulator")}function q(n){e&&(Y(e)?e=null:e.isReady()||e.isRunning()||e.init(tn,n))}function D(n){e.play(n)}function Q(){e.stop()}function k(n){e.setFilterFreq(n)}function X(n){e.setFilterQ(n)}function H(n){e.setFilterType(n)}function U(n){a&&(Y(a)?a=null:a.init(tn,n))}function O(n,t){a.play(n,t)}function W(){a.stop()}function Z(n){a.setFilterFreq(n)}function j(n){a.setFilterQ(n)}function J(t){n.logError(t,$)}function K(t){n.log(t,$)}function Y(t){return n.isNull(t)}const $="zsAudio: ",nn=3;var tn=null,on=!1,en=1,an=null,rn=1,un=["/audio/violin-tuning.mp3"],ln=null;return l.prototype.loadBuffer=function(n,t){var i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="arraybuffer";var o=this;K("loading file: "+n),i.onload=function(){o.context.decodeAudioData(i.response,function(i){i?(o.bufferList[t]=i,++o.loadCount==o.urlList.length&&o.onload(o.bufferList)):J("error decoding file data: "+n)},function(n){J("decodeAudioData error",n)})},i.onerror=function(){J("BufferLoader: XHR error")},i.send()},l.prototype.load=function(){for(var n=0;n<this.urlList.length;++n)this.loadBuffer(this.urlList[n],n)},{init:function(n,t){s(n,t)},initSpeech:function(){g()},initPlayer:function(){m()},initGranulator:function(n){x(n)},initNoise:function(){q()},initSynth:function(){U()},setSynthFilterFreq:function(n){Z(n)},setSynthFilterQ:function(n){j(n)},isReady:function(){return on},playAudio:function(n,t,i,o){A(n,t,i,o)},stopPlayer:function(){return I()},setGranulatorRampLinear:function(n,t,i){F(n,t,i)},setGranulatorRampSin:function(n,t,i,o){L(n,t,i,o)},setGranulatorGain:function(n,t){z(n,t)},setGranulatorEnvelope:function(n){N(n)},setGranulatorConfig:function(n){w(n)},setGranulatorGrainConfig:function(n){_(n)},setGranulatorPlayDuration:function(n){b(n)},playGranulator:function(){M()},isGranulatorPlaying:function(){return E()},stopGranulator:function(){B()},resetGranulator:function(){T()},isSpeachReady:function(){return i.isReady()},speak:function(n,t,o){return i.speak(n,t,o)},stopSpeach:function(){return i.stop()},setSpeechConfig:function(n){return i.setSpeechConfig(n)},playNoise:function(n){D(n)},stopNoise:function(){Q()},setNoiseFilterFreq:function(n){k(n)},setNoiseFilterQ:function(n){X(n)},setNoiseFilterType:function(n){H(n)},playSynth:function(n,t){O(n,t)},stopSynth:function(){W()},rumpLinearSpeechParam:function(n,t,o){return i.rampLinearConfigParam(n,t,o)},reset:function(){p()},getCurrentTime:function(){return d()},setMasterVolume:function(n,t){return y(n,t)},setPlayerVolume:function(n,t){return C(n,t)},setPlayerMaxVolume:function(n,t){return S(n,t)},loadAudioBuffers:function(n){return f(n)},setSpeechVolume:function(n,t){return v(n,t)},setGranulatorVolume:function(n,t){return P(n,t)},applyGranulatorGainEvelope:function(n,t){return V(n,t)}}}(zsUtil,zsGranulator,zsSpeech,zsPlayer,zsNoise,zsSynth,window);