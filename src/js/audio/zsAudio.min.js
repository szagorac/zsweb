var zsAudio=function(n,t,i,o,a){"use strict";function e(n){this.message=n,this.name="ZsAudioException"}function r(n,t,i){this.context=n,this.urlList=t,this.onload=i,this.bufferList=new Array,this.loadCount=0}function u(l,f){if(!(n&&t&&i&&o))throw new e("Invalid libraries. Required: zsUtil, zsGranulator and zsSpeech");try{if(E("initAudio: "),!X){var c=a.AudioContext||a.webkitAudioContext||a.mozAudioContext||a.oAudioContext;X=new c,E("initAudio:  created audio context")}if("suspended"===X.state)return E("initAudio: Context suspended, resuming context : "+X.state),q>=B?void E("initAudio: breached MAX Resume Retry Count, giving up ..."):(X.resume(),1===q&&(X.onstatechange=function(){E("initAudio: on AudioContext state change to: "+X.state)}),a.hasOwnProperty("speechSynthesis")&&a.speechSynthesis.getVoices(),q++,void setTimeout(function(){u(l,f)},1e3));E("initAudio: AudioContext state: "+X.state),p(),n.isArray(l)?F=l:D("Invalid audio files to load array"),f<0||f>=F.length?D("Invalid granulator file index: "+f):N=f;var d=new r(X,F,s);d.load()}catch(n){_=!1,D("Web Audio API is not supported in this browser")}}function s(n){H=n,h(n),A(N),_=!0}function l(){return T(X)?0:X.currentTime}function f(){}function c(t,i){if(X){n.isString(t)&&(t=n.toFloat(t));var o=U;n.isNumeric(t)?(o=t,o<0?o=0:o>1&&(o=1),U=o,d(U,i)):D("_setMasterVolume: Invalid gain level: "+t)}else D("_setMasterVolume: invalid context")}function d(n,t){y(n),m(n,t),C(n),x(n,t),g(n,t),G(n,t)}function p(){if(T(i))return D("_initSpeech: Can not initialise speech"),void(i=null);i.init()}function G(n,t){i.setVolume(n)}function g(n,t){i.setMaxVolume(n)}function h(n){o.init(X,n)}function v(n,t,i,a){o.play(n,t,i,a)}function m(n,t){o.setGain(n,t)}function y(n){o.setMaxGain(n)}function A(n,i){if(T(t))return D("initGranulator: Can not initialise zsGranulator"),void(t=null);T(n)&&(n=0),T(i)&&(i=X.destination),n<0||n>=H.length?D("initGranulator: invalid buffer index"):t.init(X,H[n],i)}function C(n){T(t)?D("setGranulatorRampLinear: Invalid granulator"):t.setMaxGain(n)}function x(n,t){R("masterGainVal",n,t)}function R(n,i,o){T(t)?D("setGranulatorRampLinear: Invalid granulator"):t.addRampLinear(n,i,o)}function I(n,i,o,a){!T(t)&&_?t.addRampSin(n,i,o,a):D("setGranulatorRampSin: Invalid granulator")}function L(n,t){x(n,t)}function S(n){!T(t)&&_?t.setGrainEnvelope(n):D("setGranulatorEnvelope: Invalid granulator")}function w(n){!T(t)&&_?t.setGranulatorConfig(n):D("setGranulatorConfig: Invalid granulator")}function z(n){!T(t)&&_?t.setGrainConfig(n):D("setGranulatorGrainConfig: Invalid granulator")}function P(n){!T(t)&&_?T(n)?D("setGranulatorPlayDuration: invalid duration"):t.setPlayDuration(n):D("setGranulatorPlayDuration: Invalid granulator")}function V(){!T(t)&&_?t.isReady()?t.play():E("playGranulator: Granulator is not initialised, can not play"):D("playGranulator: Invalid granulator")}function b(){!T(t)&&_?t.isReady()?t.stop():E("stopGranulator: Granulator is not initialised, can not stop"):D("stopGranulator: Invalid granulator")}function M(){!T(t)&&_?t.reset():D("stopGranulator: Invalid granulator")}function D(t){n.logError(t,k)}function E(t){n.log(t,k)}function T(t){return n.isNull(t)}const k="zsAudio: ",B=3;var X=null,_=!1,q=1,H=null,N=0,U=1,F=["/audio/violin-tuning.mp3"];return r.prototype.loadBuffer=function(n,t){var i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="arraybuffer";var o=this;i.onload=function(){o.context.decodeAudioData(i.response,function(i){i?(o.bufferList[t]=i,++o.loadCount==o.urlList.length&&o.onload(o.bufferList)):D("error decoding file data: "+n)},function(n){D("decodeAudioData error",n)})},i.onerror=function(){D("BufferLoader: XHR error")},i.send()},r.prototype.load=function(){for(var n=0;n<this.urlList.length;++n)this.loadBuffer(this.urlList[n],n)},{init:function(n,t){u(n,t)},isReady:function(){return _},playAudio:function(n,t,i,o){v(n,t,i,o)},setGranulatorRampLinear:function(n,t,i){R(n,t,i)},setGranulatorRampSin:function(n,t,i,o){I(n,t,i,o)},setGranulatorGain:function(n,t){L(n,t)},setGranulatorEnvelope:function(n){S(n)},setGranulatorConfig:function(n){w(n)},setGranulatorGrainConfig:function(n){z(n)},setGranulatorPlayDuration:function(n){P(n)},playGranulator:function(){V()},stopGranulator:function(){b()},resetGranulator:function(){M()},isSpeachReady:function(){return i.isReady()},speak:function(n,t,o){return i.speak(n,t,o)},stopSpeach:function(){return i.stop()},setSpeechConfig:function(n){return i.setSpeechConfig(n)},rumpLinearSpeechParam:function(n,t,o){return i.rampLinearConfigParam(n,t,o)},reset:function(){f()},getCurrentTime:function(){return l()},setMasterVolume:function(n,t){return c(n,t)},setPlayerVolume:function(n,t){return m(n,t)},setPlayerMaxVolume:function(n,t){return y(n,t)},setSpeechVolume:function(n,t){return G(n,t)},setGranulatorVolume:function(n,t){return x(n,t)}}}(zsUtil,zsGranulator,zsSpeech,zsPlayer,window);