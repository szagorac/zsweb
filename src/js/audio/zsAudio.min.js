var zsAudio=function(n,t,i,o,a,e){"use strict";function r(n){this.message=n,this.name="ZsAudioException"}function u(n,t,i){this.context=n,this.urlList=t,this.onload=i,this.bufferList=new Array,this.loadCount=0}function l(a,u){if(!(n&&t&&i&&o))throw new r("Invalid libraries. Required: zsUtil, zsGranulator and zsSpeech");try{if(H("initAudio: "),!W){var f=e.AudioContext||e.webkitAudioContext||e.mozAudioContext||e.oAudioContext;W=new f,H("initAudio:  created audio context")}if(n.isNotNull(u)&&(Y=u),"suspended"===W.state)return H("initAudio: Context suspended, resuming context : "+W.state),j>=O?void H("initAudio: breached MAX Resume Retry Count, giving up ..."):(W.resume(),1===j&&(W.onstatechange=function(){H("initAudio: on AudioContext state change to: "+W.state)}),e.hasOwnProperty("speechSynthesis")&&e.speechSynthesis.getVoices(),j++,void setTimeout(function(){l(a,u)},1e3));s(a)}catch(n){Z=!1,q("Web Audio API is not supported in this browser")}}function s(t){if(H("_initAudioBuffers: AudioContext state: "+W.state),"running"===W.state)if(n.isArray(t)&&(Q=t),n.isArray(Q)){Z=!1;var i=new u(W,Q,f);i.load()}else q("Invalid audio files to load array, ignoring load");else H("_initAudioBuffers: ignoring call. Invalid AudioContext state: "+W.state)}function f(t){J=t,n.isNotNull(Y)?Y():(G(),h(),x(0),T()),Z=!0}function c(){return U(W)?0:W.currentTime}function d(){}function p(t,i){if(W){n.isString(t)&&(t=n.toFloat(t));var o=K;n.isNumeric(t)?(o=t,o<0?o=0:o>1&&(o=1),K=o,y(K,i)):q("_setMasterVolume: Invalid gain level: "+t)}else q("_setMasterVolume: invalid context")}function y(n,t){C(n),A(n,t),P(n),R(n,t),v(n,t),g(n,t)}function G(){if(U(i))return q("_initSpeech: Can not initialise speech"),void(i=null);i.init()}function g(n,t){i.setVolume(n)}function v(n,t){i.setMaxVolume(n)}function h(){U(o)?q("_playAudioBuffer: Invalid player"):o.init(W,J)}function m(n,t,i,a){!U(o)&&Z?o.play(n,t,i,a):q("_playAudioBuffer: Invalid player")}function A(n,t){!U(o)&&Z?o.setGain(n,t):q("_setPlayerVolume: Invalid player")}function C(n){!U(o)&&Z?o.setMaxGain(n):q("_setPlayerMaxVolume: Invalid player")}function I(){!U(o)&&Z?o.stop():q("_stopPlayer: Invalid player")}function x(n,i){if(U(t))return q("initGranulator: Can not initialise zsGranulator"),void(t=null);U(n)&&(n=0),U(i)&&(i=W.destination),n<0||n>=J.length?q("initGranulator: invalid buffer index"):t.init(W,J[n],i)}function P(n){U(t)?q("setGranulatorRampLinear: Invalid granulator"):t.setMaxGain(n)}function R(n,t){S("masterGainVal",n,t)}function S(n,i,o){U(t)?q("setGranulatorRampLinear: Invalid granulator"):t.addRampLinear(n,i,o)}function L(n,i,o,a){!U(t)&&Z?t.addRampSin(n,i,o,a):q("setGranulatorRampSin: Invalid granulator")}function V(n,t){R(n,t)}function z(n){U(t)?q("setGranulatorEnvelope: Invalid granulator"):t.setGrainEnvelope(n)}function w(n,i){U(t)?q("_applyGranulatorGainEvelope: Invalid granulator"):t.applyGainEvelope(n,i)}function _(n){U(t)?q("setGranulatorConfig: Invalid granulator"):t.setGranulatorConfig(n)}function b(n){U(t)?q("setGranulatorGrainConfig: Invalid granulator"):t.setGrainConfig(n)}function M(n){U(t)?q("setGranulatorPlayDuration: Invalid granulator"):U(n)?q("setGranulatorPlayDuration: invalid duration"):t.setPlayDuration(n)}function N(){!U(t)&&Z?t.isReady()?t.play():H("playGranulator: Granulator is not initialised, can not play"):q("playGranulator: Invalid granulator")}function E(){return!(U(t)||!Z)&&t.isPlaying()}function B(){!U(t)&&Z?t.isReady()?t.stop():H("stopGranulator: Granulator is not initialised, can not stop"):q("stopGranulator: Invalid granulator")}function D(){!U(t)&&Z?t.reset():q("stopGranulator: Invalid granulator")}function T(n){a&&(U(a)?a=null:a.init(W,n))}function k(n){a.play(n)}function X(){a.stop()}function q(t){n.logError(t,F)}function H(t){n.log(t,F)}function U(t){return n.isNull(t)}const F="zsAudio: ",O=3;var W=null,Z=!1,j=1,J=null,K=1,Q=["/audio/violin-tuning.mp3"],Y=null;return u.prototype.loadBuffer=function(n,t){var i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="arraybuffer";var o=this;i.onload=function(){o.context.decodeAudioData(i.response,function(i){i?(o.bufferList[t]=i,++o.loadCount==o.urlList.length&&o.onload(o.bufferList)):q("error decoding file data: "+n)},function(n){q("decodeAudioData error",n)})},i.onerror=function(){q("BufferLoader: XHR error")},i.send()},u.prototype.load=function(){for(var n=0;n<this.urlList.length;++n)this.loadBuffer(this.urlList[n],n)},{init:function(n,t){l(n,t)},initSpeech:function(){G()},initPlayer:function(){h()},initGranulator:function(n){x(n)},initNoise:function(){T()},isReady:function(){return Z},playAudio:function(n,t,i,o){m(n,t,i,o)},stopPlayer:function(){return I()},setGranulatorRampLinear:function(n,t,i){S(n,t,i)},setGranulatorRampSin:function(n,t,i,o){L(n,t,i,o)},setGranulatorGain:function(n,t){V(n,t)},setGranulatorEnvelope:function(n){z(n)},setGranulatorConfig:function(n){_(n)},setGranulatorGrainConfig:function(n){b(n)},setGranulatorPlayDuration:function(n){M(n)},playGranulator:function(){N()},isGranulatorPlaying:function(){return E()},stopGranulator:function(){B()},resetGranulator:function(){D()},isSpeachReady:function(){return i.isReady()},speak:function(n,t,o){return i.speak(n,t,o)},stopSpeach:function(){return i.stop()},setSpeechConfig:function(n){return i.setSpeechConfig(n)},playNoise:function(n){k(n)},stopNoise:function(){X()},rumpLinearSpeechParam:function(n,t,o){return i.rampLinearConfigParam(n,t,o)},reset:function(){d()},getCurrentTime:function(){return c()},setMasterVolume:function(n,t){return p(n,t)},setPlayerVolume:function(n,t){return A(n,t)},setPlayerMaxVolume:function(n,t){return C(n,t)},loadAudioBuffers:function(n){return s(n)},setSpeechVolume:function(n,t){return g(n,t)},setGranulatorVolume:function(n,t){return R(n,t)},applyGranulatorGainEvelope:function(n,t){return w(n,t)}}}(zsUtil,zsGranulator,zsSpeech,zsPlayer,zsNoise,window);