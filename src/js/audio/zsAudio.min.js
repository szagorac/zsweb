var zsAudio=function(n,t,i,o,a){"use strict";function r(n){this.message=n,this.name="ZsAudioException"}function e(n,t,i){this.context=n,this.urlList=t,this.onload=i,this.bufferList=new Array,this.loadCount=0}function u(l,f){if(!(n&&t&&i&&o))throw new r("Invalid libraries. Required: zsUtil, zsGranulator and zsSpeech");try{if(V("initAudio: "),!T){var c=a.AudioContext||a.webkitAudioContext||a.mozAudioContext||a.oAudioContext;T=new c,V("initAudio:  created audio context")}if("suspended"===T.state)return V("initAudio: Context suspended, resuming context : "+T.state),k>=M?void V("initAudio: breached MAX Resume Retry Count, giving up ..."):(T.resume(),1===k&&(T.onstatechange=function(){V("initAudio: on AudioContext state change to: "+T.state)}),a.hasOwnProperty("speechSynthesis")&&a.speechSynthesis.getVoices(),k++,void setTimeout(function(){u(l,f)},1e3));V("initAudio: AudioContext state: "+T.state),p(),n.isArray(l)?q=l:P("Invalid audio files to load array"),f<0||f>=q.length?P("Invalid granulator file index: "+f):N=f;var d=new e(T,q,s);d.load()}catch(n){_=!1,P("Web Audio API is not supported in this browser")}}function s(n){B=n,g(n),m(N),_=!0}function l(){return E(T)?0:T.currentTime}function f(){}function c(t,i){if(T){n.isString(t)&&(t=n.toFloat(t));var o=X;n.isNumeric(t)?(o=t,o<0?o=0:o>1&&(o=1),X=o,d(X,i)):P("_setMasterVolume: Invalid gain level: "+t)}else P("_setMasterVolume: invalid context")}function d(n,t){h(n,t),y(n,t),G(n,t)}function p(){if(E(i))return P("_initSpeech: Can not initialise speech"),void(i=null);i.init()}function G(n,t){i.setVolume(n)}function g(n){o.init(T,n)}function v(n,t,i,a){o.play(n,t,i,a)}function h(n,t){o.setGain(n,t)}function m(n,i){if(E(t))return P("initGranulator: Can not initialise zsGranulator"),void(t=null);E(n)&&(n=0),E(i)&&(i=T.destination),n<0||n>=B.length?P("initGranulator: invalid buffer index"):t.init(T,B[n],i)}function y(n,t){A("masterGainVal",n,t)}function A(n,i,o){E(t)?P("setGranulatorRampLinear: Invalid granulator"):t.addRampLinear(n,i,o)}function C(n,i,o,a){!E(t)&&_?t.addRampSin(n,i,o,a):P("setGranulatorRampSin: Invalid granulator")}function I(i,o){if(!E(t)&&_){n.isString(i)&&(i=n.toFloat(i));var a=X;n.isNumeric(i)&&i<=X?(a=i,t.setGain(a,o)):_logError("_setGranulatorGain: Invalid gain level: "+i)}else P("setGranulatorGain: Invalid granulator")}function R(n){!E(t)&&_?t.setGrainEnvelope(n):P("setGranulatorEnvelope: Invalid granulator")}function S(n){!E(t)&&_?t.setGranulatorConfig(n):P("setGranulatorConfig: Invalid granulator")}function x(n){!E(t)&&_?t.setGrainConfig(n):P("setGranulatorGrainConfig: Invalid granulator")}function L(n){!E(t)&&_?E(n)?P("setGranulatorPlayDuration: invalid duration"):t.setPlayDuration(n):P("setGranulatorPlayDuration: Invalid granulator")}function w(){!E(t)&&_?t.isReady()?t.play():V("playGranulator: Granulator is not initialised, can not play"):P("playGranulator: Invalid granulator")}function z(){!E(t)&&_?t.isReady()?t.stop():V("stopGranulator: Granulator is not initialised, can not stop"):P("stopGranulator: Invalid granulator")}function b(){!E(t)&&_?t.reset():P("stopGranulator: Invalid granulator")}function P(t){n.logError(t,D)}function V(t){n.log(t,D)}function E(t){return n.isNull(t)}const D="zsAudio: ",M=3;var T=null,_=!1,k=1,B=null,N=0,X=1,q=["/audio/violin-tuning.mp3"];return e.prototype.loadBuffer=function(n,t){var i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="arraybuffer";var o=this;i.onload=function(){o.context.decodeAudioData(i.response,function(i){i?(o.bufferList[t]=i,++o.loadCount==o.urlList.length&&o.onload(o.bufferList)):P("error decoding file data: "+n)},function(n){P("decodeAudioData error",n)})},i.onerror=function(){P("BufferLoader: XHR error")},i.send()},e.prototype.load=function(){for(var n=0;n<this.urlList.length;++n)this.loadBuffer(this.urlList[n],n)},{init:function(n,t){u(n,t)},isReady:function(){return _},playAudio:function(n,t,i,o){v(n,t,i,o)},setGranulatorRampLinear:function(n,t,i){A(n,t,i)},setGranulatorRampSin:function(n,t,i,o){C(n,t,i,o)},setGranulatorGain:function(n,t){I(n,t)},setGranulatorEnvelope:function(n){R(n)},setGranulatorConfig:function(n){S(n)},setGranulatorGrainConfig:function(n){x(n)},setGranulatorPlayDuration:function(n){L(n)},playGranulator:function(){w()},stopGranulator:function(){z()},resetGranulator:function(){b()},isSpeachReady:function(){return i.isReady()},speak:function(n,t,o){return i.speak(n,t,o)},stopSpeach:function(){return i.stop()},setSpeechConfig:function(n){return i.setSpeechConfig(n)},rumpLinearSpeechParam:function(n,t,o){return i.rampLinearConfigParam(n,t,o)},reset:function(){f()},getCurrentTime:function(){return l()},setMasterVolume:function(n,t){return c(n,t)},setPlayerVolume:function(n,t){return h(n,t)},setSpeechVolume:function(n,t){return G(n,t)},setGranulatorVolume:function(n,t){return y(n,t)}}}(zsUtil,zsGranulator,zsSpeech,zsPlayer,window);