var zsAudio=function(n,t,i,o,e,a,r){"use strict";function u(n){this.message=n,this.name="ZsAudioException"}function l(n,t,i){this.context=n,this.urlList=t,this.onload=i,this.bufferList=new Array,this.loadCount=0}function s(e,a){if(!(n&&t&&i&&o))throw new u("Invalid libraries. Required: zsUtil, zsGranulator and zsSpeech");try{if(nn("initAudio: "),!an){var l=r.AudioContext||r.webkitAudioContext||r.mozAudioContext||r.oAudioContext;an=new l,nn("initAudio:  created audio context")}if(n.isNotNull(a)&&(cn=a),n.isNotNull(fn)&&(fn=e),"suspended"===an.state)return nn("initAudio: Context suspended, resuming context : "+an.state),un>=en?void nn("initAudio: breached MAX Resume Retry Count, giving up ..."):(an.resume(),1===un&&(an.onstatechange=function(){nn("initAudio: on AudioContext state change to: "+an.state)}),r.hasOwnProperty("speechSynthesis")&&r.speechSynthesis.getVoices(),un++,void setTimeout(function(){f()},1e3));c(e)}catch(n){rn=!1,$("Web Audio API is not supported in this browser")}}function f(){nn("_initAudioRetry: "),rn?nn("_initAudioRetry: Audio has been initialised, ignnoring retry..."):s(fn,cn)}function c(t){if(nn("_initAudioBuffers: AudioContext state: "+an.state),"running"===an.state)if(n.isArray(t)&&(fn=t),n.isArray(fn)){rn=!1;var i=new l(an,fn,d);i.load()}else $("Invalid audio files to load array, ignoring load");else nn("_initAudioBuffers: ignoring call. Invalid AudioContext state: "+an.state)}function d(t){ln=t,n.isNotNull(cn)?cn():(v(),C(),F(0),Q()),rn=!0}function p(){return tn(an)?0:an.currentTime}function y(){}function G(t,i){if(an){n.isString(t)&&(t=n.toFloat(t));var o=sn;n.isNumeric(t)?(o=t,o<0?o=0:o>1&&(o=1),sn=o,g(sn,i)):$("_setMasterVolume: Invalid gain level: "+t)}else $("_setMasterVolume: invalid context")}function g(n,t){R(n),I(n,t),P(n),N(n,t),A(n,t),m(n,t)}function h(n){return Math.sqrt(Math.pow(2,n))/(Math.pow(2,n)-1)}function v(){if(tn(i))return $("_initSpeech: Can not initialise speech"),void(i=null);i.init()}function m(n,t){i.setVolume(n)}function A(n,t){i.setMaxVolume(n)}function C(){tn(o)?$("_playAudioBuffer: Invalid player"):o.init(an,ln)}function S(n,t,i,e){!tn(o)&&rn?o.play(n,t,i,e):$("_playAudioBuffer: Invalid player")}function I(n,t){!tn(o)&&rn?o.setGain(n,t):$("_setPlayerVolume: Invalid player")}function R(n){!tn(o)&&rn?o.setMaxGain(n):$("_setPlayerMaxVolume: Invalid player")}function x(){!tn(o)&&rn?o.stop():$("_stopPlayer: Invalid player")}function F(n,i){if(tn(t))return $("initGranulator: Can not initialise zsGranulator"),void(t=null);tn(ln)||(tn(n)&&(n=0),tn(i)&&(i=an.destination),n<0||n>=ln.length?$("initGranulator: invalid buffer index"):t.init(an,ln[n],i))}function P(n){tn(t)?$("setGranulatorRampLinear: Invalid granulator"):t.setMaxGain(n)}function N(n,t){L("masterGainVal",n,t)}function L(n,i,o){tn(t)?$("setGranulatorRampLinear: Invalid granulator"):t.addRampLinear(n,i,o)}function w(n,i,o,e){!tn(t)&&rn?t.addRampSin(n,i,o,e):$("setGranulatorRampSin: Invalid granulator")}function z(n,t){N(n,t)}function M(n){tn(t)?$("setGranulatorEnvelope: Invalid granulator"):t.setGrainEnvelope(n)}function V(n,i){tn(t)?$("_applyGranulatorGainEvelope: Invalid granulator"):t.applyGainEvelope(n,i)}function _(n){tn(t)?$("setGranulatorConfig: Invalid granulator"):t.setGranulatorConfig(n)}function b(n){tn(t)?$("setGranulatorGrainConfig: Invalid granulator"):t.setGrainConfig(n)}function B(n){tn(t)?$("setGranulatorPlayDuration: Invalid granulator"):tn(n)?$("setGranulatorPlayDuration: invalid duration"):t.setPlayDuration(n)}function E(){!tn(t)&&rn?t.isReady()?t.play():nn("playGranulator: Granulator is not initialised, can not play"):$("playGranulator: Invalid granulator")}function D(){return!(tn(t)||!rn)&&t.isPlaying()}function q(){!tn(t)&&rn?t.isReady()?t.stop():nn("stopGranulator: Granulator is not initialised, can not stop"):$("stopGranulator: Invalid granulator")}function T(){!tn(t)&&rn?t.reset():$("stopGranulator: Invalid granulator")}function Q(n){e&&(tn(e)?e=null:e.isReady()||e.isRunning()||e.init(an,n))}function k(n){e.play(n)}function X(){e.stop()}function H(n){e.setFilterFreq(n)}function U(n){e.setFilterQ(n)}function O(n){e.setFilterDetune(n)}function W(n){e.setFilterType(n)}function Z(n){a&&(tn(a)?a=null:a.init(an,n))}function j(n,t){a.play(n,t)}function J(){a.stop()}function K(n){a.setFilterFreq(n)}function Y(n){a.setFilterQ(n)}function $(t){n.logError(t,on)}function nn(t){n.log(t,on)}function tn(t){return n.isNull(t)}const on="zsAudio: ",en=3;var an=null,rn=!1,un=1,ln=null,sn=1,fn=["/audio/violin-tuning.mp3"],cn=null;return l.prototype.loadBuffer=function(n,t){var i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="arraybuffer";var o=this;nn("loading file: "+n),i.onload=function(){o.context.decodeAudioData(i.response,function(i){i?(o.bufferList[t]=i,++o.loadCount==o.urlList.length&&o.onload(o.bufferList)):$("error decoding file data: "+n)},function(n){$("decodeAudioData error",n)})},i.onerror=function(){$("BufferLoader: XHR error")},i.send()},l.prototype.load=function(){for(var n=0;n<this.urlList.length;++n)this.loadBuffer(this.urlList[n],n)},{init:function(n,t){s(n,t)},initSpeech:function(){v()},initPlayer:function(){C()},initGranulator:function(n){F(n)},initNoise:function(){Q()},initSynth:function(){Z()},setSynthFilterFreq:function(n){K(n)},setSynthFilterQ:function(n){Y(n)},isReady:function(){return rn},playAudio:function(n,t,i,o){S(n,t,i,o)},stopPlayer:function(){return x()},setGranulatorRampLinear:function(n,t,i){L(n,t,i)},setGranulatorRampSin:function(n,t,i,o){w(n,t,i,o)},setGranulatorGain:function(n,t){z(n,t)},setGranulatorEnvelope:function(n){M(n)},setGranulatorConfig:function(n){_(n)},setGranulatorGrainConfig:function(n){b(n)},setGranulatorPlayDuration:function(n){B(n)},playGranulator:function(){E()},isGranulatorPlaying:function(){return D()},stopGranulator:function(){q()},resetGranulator:function(){T()},isSpeachReady:function(){return i.isReady()},speak:function(n,t,o){return i.speak(n,t,o)},stopSpeach:function(){return i.stop()},setSpeechConfig:function(n){return i.setSpeechConfig(n)},playNoise:function(n){k(n)},stopNoise:function(){X()},setNoiseFilterFreq:function(n){H(n)},setNoiseFilterQ:function(n){U(n)},setNoiseFilterDetune:function(n){O(n)},setNoiseFilterType:function(n){W(n)},playSynth:function(n,t){j(n,t)},stopSynth:function(){J()},rumpLinearSpeechParam:function(n,t,o){return i.rampLinearConfigParam(n,t,o)},reset:function(){y()},getCurrentTime:function(){return p()},setMasterVolume:function(n,t){return G(n,t)},setPlayerVolume:function(n,t){return I(n,t)},setPlayerMaxVolume:function(n,t){return R(n,t)},loadAudioBuffers:function(n){return c(n)},setSpeechVolume:function(n,t){return m(n,t)},setGranulatorVolume:function(n,t){return N(n,t)},applyGranulatorGainEvelope:function(n,t){return V(n,t)},calcBandpassFilterQ:function(n){return h(n)}}}(zsUtil,zsGranulator,zsSpeech,zsPlayer,zsNoise,zsSynth,window);