var zsAudio=function(n,t,i,o,e,a){"use strict";function r(n){this.message=n,this.name="ZsAudioException"}function u(n,t,i){this.context=n,this.urlList=t,this.onload=i,this.bufferList=new Array,this.loadCount=0}function l(e,u){if(!(n&&t&&i&&o))throw new r("Invalid libraries. Required: zsUtil, zsGranulator and zsSpeech");try{if(X("initAudio: "),!F){var f=a.AudioContext||a.webkitAudioContext||a.mozAudioContext||a.oAudioContext;F=new f,X("initAudio:  created audio context")}if(n.isNotNull(u)&&(K=u),"suspended"===F.state)return X("initAudio: Context suspended, resuming context : "+F.state),W>=U?void X("initAudio: breached MAX Resume Retry Count, giving up ..."):(F.resume(),1===W&&(F.onstatechange=function(){X("initAudio: on AudioContext state change to: "+F.state)}),a.hasOwnProperty("speechSynthesis")&&a.speechSynthesis.getVoices(),W++,void setTimeout(function(){l(e,u)},1e3));s(e)}catch(n){O=!1,k("Web Audio API is not supported in this browser")}}function s(t){if(X("_initAudioBuffers: AudioContext state: "+F.state),"running"===F.state)if(n.isArray(t)&&(J=t),n.isArray(J)){O=!1;var i=new u(F,J,f);i.load()}else k("Invalid audio files to load array, ignoring load");else X("_initAudioBuffers: ignoring call. Invalid AudioContext state: "+F.state)}function f(t){Z=t,n.isNotNull(K)?K():(G(),h(),I(0),D()),O=!0}function c(){return q(F)?0:F.currentTime}function d(){}function p(t,i){if(F){n.isString(t)&&(t=n.toFloat(t));var o=j;n.isNumeric(t)?(o=t,o<0?o=0:o>1&&(o=1),j=o,y(j,i)):k("_setMasterVolume: Invalid gain level: "+t)}else k("_setMasterVolume: invalid context")}function y(n,t){C(n),A(n,t),R(n),P(n,t),v(n,t),g(n,t)}function G(){if(q(i))return k("_initSpeech: Can not initialise speech"),void(i=null);i.init()}function g(n,t){i.setVolume(n)}function v(n,t){i.setMaxVolume(n)}function h(){q(o)?k("_playAudioBuffer: Invalid player"):o.init(F,Z)}function m(n,t,i,e){!q(o)&&O?o.play(n,t,i,e):k("_playAudioBuffer: Invalid player")}function A(n,t){!q(o)&&O?o.setGain(n,t):k("_setPlayerVolume: Invalid player")}function C(n){!q(o)&&O?o.setMaxGain(n):k("_setPlayerMaxVolume: Invalid player")}function x(){!q(o)&&O?o.stop():k("_stopPlayer: Invalid player")}function I(n,i){if(q(t))return k("initGranulator: Can not initialise zsGranulator"),void(t=null);q(n)&&(n=0),q(i)&&(i=F.destination),n<0||n>=Z.length?k("initGranulator: invalid buffer index"):t.init(F,Z[n],i)}function R(n){q(t)?k("setGranulatorRampLinear: Invalid granulator"):t.setMaxGain(n)}function P(n,t){S("masterGainVal",n,t)}function S(n,i,o){q(t)?k("setGranulatorRampLinear: Invalid granulator"):t.addRampLinear(n,i,o)}function L(n,i,o,e){!q(t)&&O?t.addRampSin(n,i,o,e):k("setGranulatorRampSin: Invalid granulator")}function V(n,t){P(n,t)}function z(n){!q(t)&&O?t.setGrainEnvelope(n):k("setGranulatorEnvelope: Invalid granulator")}function w(n){!q(t)&&O?t.setGranulatorConfig(n):k("setGranulatorConfig: Invalid granulator")}function b(n){!q(t)&&O?t.setGrainConfig(n):k("setGranulatorGrainConfig: Invalid granulator")}function M(n){!q(t)&&O?q(n)?k("setGranulatorPlayDuration: invalid duration"):t.setPlayDuration(n):k("setGranulatorPlayDuration: Invalid granulator")}function N(){!q(t)&&O?t.isReady()?t.play():X("playGranulator: Granulator is not initialised, can not play"):k("playGranulator: Invalid granulator")}function _(){!q(t)&&O?t.isReady()?t.stop():X("stopGranulator: Granulator is not initialised, can not stop"):k("stopGranulator: Invalid granulator")}function B(){!q(t)&&O?t.reset():k("stopGranulator: Invalid granulator")}function D(n){e&&(q(e)?e=null:e.init(F,n))}function E(n){e.play(n)}function T(){e.stop()}function k(t){n.logError(t,H)}function X(t){n.log(t,H)}function q(t){return n.isNull(t)}const H="zsAudio: ",U=3;var F=null,O=!1,W=1,Z=null,j=1,J=["/audio/violin-tuning.mp3"],K=null;return u.prototype.loadBuffer=function(n,t){var i=new XMLHttpRequest;i.open("GET",n,!0),i.responseType="arraybuffer";var o=this;i.onload=function(){o.context.decodeAudioData(i.response,function(i){i?(o.bufferList[t]=i,++o.loadCount==o.urlList.length&&o.onload(o.bufferList)):k("error decoding file data: "+n)},function(n){k("decodeAudioData error",n)})},i.onerror=function(){k("BufferLoader: XHR error")},i.send()},u.prototype.load=function(){for(var n=0;n<this.urlList.length;++n)this.loadBuffer(this.urlList[n],n)},{init:function(n,t){l(n,t)},initSpeech:function(){G()},initPlayer:function(){h()},initGranulator:function(n){I(n)},initNoise:function(){D()},isReady:function(){return O},playAudio:function(n,t,i,o){m(n,t,i,o)},stopPlayer:function(){return x()},setGranulatorRampLinear:function(n,t,i){S(n,t,i)},setGranulatorRampSin:function(n,t,i,o){L(n,t,i,o)},setGranulatorGain:function(n,t){V(n,t)},setGranulatorEnvelope:function(n){z(n)},setGranulatorConfig:function(n){w(n)},setGranulatorGrainConfig:function(n){b(n)},setGranulatorPlayDuration:function(n){M(n)},playGranulator:function(){N()},stopGranulator:function(){_()},resetGranulator:function(){B()},isSpeachReady:function(){return i.isReady()},speak:function(n,t,o){return i.speak(n,t,o)},stopSpeach:function(){return i.stop()},setSpeechConfig:function(n){return i.setSpeechConfig(n)},playNoise:function(n){E(n)},stopNoise:function(){T()},rumpLinearSpeechParam:function(n,t,o){return i.rampLinearConfigParam(n,t,o)},reset:function(){d()},getCurrentTime:function(){return c()},setMasterVolume:function(n,t){return p(n,t)},setPlayerVolume:function(n,t){return A(n,t)},setPlayerMaxVolume:function(n,t){return C(n,t)},loadAudioBuffers:function(n){return s(n)},setSpeechVolume:function(n,t){return g(n,t)},setGranulatorVolume:function(n,t){return P(n,t)}}}(zsUtil,zsGranulator,zsSpeech,zsPlayer,zsNoise,window);