var zsSpeech=function(e,t){"use strict";function n(e){this.message=e,this.name="ZsSpeechException"}function i(e){this.id=e,this.utterance=null,this.createdTime=0,this.finishedTime=0,this.isComplete=!1}function r(){I()?k("resetConfig: speech is playing, ignore reset config"):(G.volume=1,G.pitch=1,G.rate=1,G.lang="en-GB",G.maxVoiceLoadAttempts=10)}function o(){if(!e||!t)throw new n("Invalid libraries. Required: zsUtil and window");if(t.hasOwnProperty("speechSynthesis")){if(g(!0),P=t.speechSynthesis,!P)return R("_initSpeech: invalid context"),void h(!1);c(),a()}else k("_initSpeech:  speech not supported")}function a(){for(var e=0;e<G.maxUtterances;e++)B[e]=new i(e+1)}function c(){if(j){q++,k("InitVoices: attempt: "+q);var t=[],n=P.getVoices();if(e.isEmptyArray(n))q<G.maxVoiceLoadAttempts?setTimeout(()=>{c()},250):R("_initVoices: Failed to retrieve voices");else{for(var i=0;i<n.length;i++){var r=n[i],o=r.name,a=r.default,u=r.lang,s=r.localService;if(e.contains(u,V)&&(u=e.replace(u,V,b)),e.startsWith(u,z)&&s){t.push(r),_(N)&&u===G.lang&&d(r);var l=a?" Default":" ",f="voice: "+o+l+", lang: "+u+", localService: "+s+", voiceURI: "+r.voiceURI;k(f)}}Z=t,e.isEmptyArray(Z)||_(N)||(h(!0),k("Init Speech done, have: "+Z.length+" voices, default voice: "+N.name))}}}function u(t,n,i){if(U()&&!_(t)&&!e.isEmptyString(t)){if(_(n)&&(n=D),_(i)&&(i=G.isInterrupt),i&&P.speaking)return w(),void setTimeout(()=>{u(t,n,!1)},G.interruptTimeout);var r=null;switch(n){case L:r=N;break;case D:r=p();break;default:r=v(n)}if(_(r))k("speak: Could not find voice");else{var o=s(t,r,G.volume,G.pitch,G.rate);_(o)||_(o.utterance)||(k("_speak: utId: "+o.id+", voice: "+r.name+" text: "+t),P.speak(o.utterance))}}}function s(e,t,n,i,r){if(!U()||_(e))return null;var o=l();if(_(o))return k("Could not find available ZsUtterance"),null;_(t)&&(t=N),_(n)&&(n=1),_(i)&&(i=1),_(r)&&(r=1);var a=new SpeechSynthesisUtterance(e);return a.voice=t,a.lang=t.lang,a.pitch=i,a.rate=r,a.volume=n,a.onerror=function(e){var t=e.utterance,n=E;_(t)||(n=" voice : "+t.voice+" utterance.text: "+t.text);var i="Received Speech error "+e.error+" event: "+e.name+n;R(i)},a.onend=function(e){f(e,o)},o.utterance=a,o.createdTime=Date.now(),o.finishedTime=0,o.isComplete=!1,o}function l(){for(var t=Date.now(),n=t,i=null,r=0;r<B.length;r++){var o=B[r];if(o.createdTime<n&&(i=o,n=o.createdTime),_(o.utterance)||o.isComplete)return o}var a=e.msecToSec(t-n);return a>G.utteranceTimeoutSec?(k("_getNextUtterance: could not find any available utterances, re-using oldest: "+i.id),i):null}function f(t,n){_(n)||m(n);var i=n.utterance,r=_(i.voice)?E:i.voice.name,o=e.round(e.msecToSec(n.finishedTime-n.createdTime),2);k("_onUtteranceEnd: utId: "+n.id+", voice: "+r+", duration: "+o+"sec, text: "+i.text)}function m(e){_(e)||e.isComplete||(e.isComplete=!0,e.finishedTime=Date.now())}function p(){return e.isArray(Z)?e.randomArrayElement(Z):N}function v(t){if(_(t))return N;for(var n=0;n<Z.length;n++){var i=Z[n];if(e.contains(i.name,t))return i}return N}function d(t){e.isObject(t)&&(k("Default voice set to: "+t.name+", isDefault: "+t.default+", lang: "+t.lang+", localService: "+t.localService+", voiceURI: "+t.voiceURI),N=t)}function h(e){_(e)||(k("_setInitialised: "+e),O=e)}function g(e){_(e)||(k("setSupported: "+e),j=e)}function S(e){}function T(e){}function x(t,n,i){!e.isString(t)||_(G[t])||_(n)||_(i)||e.runGsapRampLinear(G,t,G[t],n,i,S,T)}function y(t){e.setConfig(G,t)}function w(){if(k("stop: "),U()){P.cancel();for(var e=0;e<G.maxUtterances;e++)m(B[e])}}function U(){return j&&O&&!_(P)}function I(){return!!U()&&P.speaking}function C(){return j}function R(t){e.logError(t,A)}function k(t){e.log(t,A)}function _(t){return e.isNull(t)}const A="ZsSpeech: ",E="",V="_",b="-",D="random",L="default",z="en";var G={volume:1,pitch:1,rate:.7,lang:"en-GB",maxVoiceLoadAttempts:10,maxUtterances:5,utteranceTimeoutSec:30,isInterrupt:!1,interruptTimeout:250},P=null,Z=[],B=[],N=null,O=!1,j=!1,q=0;return{init:function(){o()},speak:function(e,t,n){u(e,t,n)},stop:function(){w()},reset:function(){r()},isReady:function(){return U()},setVolume:function(e){G.volume=e},setPitch:function(e){G.pitch=e},setRate:function(e){G.rate=e},setLang:function(e){G.lang=e},isSupported:function(){return C()},setSpeechConfig:function(e){y(e)},rampLinearConfigParam:function(e,t,n){x(e,t,n)}}}(zsUtil,window);