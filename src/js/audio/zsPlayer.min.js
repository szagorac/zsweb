var zsPlayer=function(i,e){"use strict";function n(i){this.message=i,this.name="ZsBufferException"}function t(i){this.index=i,this.isInitialised=!1,this.isPlaying=!1,this.audioBuffer=null,this.audioSourceNode=null,this.gainNode=null}function o(t,o){if(!i||!e)throw new n("Invalid libraries. Required: zsUtil and window");m(t)||m(o)?p("_init: invalid buffer list"):(B=t,x=o,y=i.initArray(x.length,null),I=!0)}function u(){h(1)}function r(i,e,n,o){if(m(B))p("playAudioBuffer: Invalid audio context");else{m(i)&&(i=0);var u=y[i];if(m(u)){if(u=new t(i),u.init(),!u.isInitialised)return void p("failed to Initialise buffer: "+i);y[i]=u}m(u)?p("Invalid buffer: "+i):(e||(e=g()),n||(n=0),o||(o=u.audioBuffer.duration),u.play(e,n,o))}}function a(i){if(!i)return p("createBufferAudioSource: invalid audio buffer"),null;if(!B)return p("createBufferAudioSource: Audio context is not initialised!!"),null;var e=B.createBufferSource();return e.buffer=i,e}function s(){if(!B)return p("createBufferAudioSource: Audio context is not initialised!!"),null;var i=B.createGain();return i}function f(i){N("onPlayComplete: index:"+i);var e=y[i];m(e)?p("_onPlayComplete: Invalid buffer: "+i):e.onEnded()}function d(e){i.setConfig(b,e)}function l(i){if(N("stop: bufferIndex: "+i),v()){m(i)&&c();var e=y[i];m(e)?p("stop: invalid bufferIndex: "+i):e.stop()}}function c(){if(N("stopAll: "),v())for(var i=0;i<y.length;++i){var e=y[i];m(e)||e.stop()}}function h(e,n,t){if(m(B))p("setGain: invalid context of master gain");else{i.isString(e)&&(e=i.toFloat(e));var o=b.gain;if(i.isNumeric(e)){o=e,o<0?o=0:o>1&&(o=1);var u=b.gain;u!==o&&(b.gain=o);var r=b.modTimeSec;if(!m(n)&&i.isNumeric(n)&&(r=i.msecToSec(n)),m(t))for(var a=0;a<y.length;++a){var s=y[a];m(s)||s.setGain(o,r)}else{s=y[t];if(m(s))return void p("_setGain: invalid bufferIndex: "+t);s.setGain(o,r)}}else p("_setGain: Invalid gain level: "+e)}}function g(){return m(B)?0:B.currentTime}function v(){return I}function p(e){i.logError(e,S)}function N(e){i.log(e,S)}function m(e){return i.isNull(e)}const S="ZsBuffer: ";var x=null,y=null,B=null,I=!1,b={gain:1,modTimeSec:.2,stopToleranceSec:.1};return t.prototype.init=function(){if(this.index<0||this.index>x.length)p("initBuffer: Invalid buffer index: "+bufferIndex);else if(this.audioBuffer=x[this.index],this.audioBuffer)if(this.audioSourceNode=a(this.audioBuffer),m(this.audioSourceNode))p("initBuffer: invalid audio source");else{this.gainNode=s(),this.gainNode.gain.setValueAtTime(b.gain,g()),this.audioSourceNode.connect(this.gainNode),this.gainNode.connect(B.destination),this.audioSourceNode.start||(this.audioSourceNode.start=this.audioSourceNode.noteOn);var i=this.index;this.audioSourceNode.onended=function(e){f(i)},this.isInitialised=!0}else N("initBuffer: invalid buffer")},t.prototype.play=function(i,e,n){m(this.audioSourceNode)||(this.audioSourceNode.start(i,e,n),this.isPlaying=!0)},t.prototype.stop=function(){if(this.isPlaying&&!m(this.audioSourceNode)){var i=g();m(this.gainNode)||(i+=b.modTimeSec,this.gainNode.gain.linearRampToValueAtTime(0,i)),N("ZsBuffer stop: time:"+i+" index: "+this.index),this.audioSourceNode.stop(i+b.stopToleranceSec)}},t.prototype.onEnded=function(){m(this.audioSourceNode)||(N("ZsBuffer onComplete: time:"+g()+" index: "+this.index),this.audioSourceNode.disconnect(),this.gainNode.disconnect(),this.audioSourceNode=null,this.gainNode=null,this.isPlaying=!1)},t.prototype.setGain=function(e,n){if(!m(this.gainNode)&&i.isNumeric(e)&&i.isNumeric(n)){var t=this.gainNode.gain.value;if(t!==e){var o=g();o+=n,N("ZsBuffer setGain: time:"+g()+" index: "+this.index+" level: "+e+" duration: "+n),this.gainNode.gain.linearRampToValueAtTime(e,o)}}},{init:function(i,e){o(i,e)},play:function(i,e,n,t){r(i,e,n,t)},stop:function(i){l(i)},stopAll:function(){c(bufferIndex)},reset:function(){u()},isReady:function(){return v()},setPlayerConfig:function(i){d(i)},setGain:function(i,e,n){h(i,e,n)}}}(zsUtil,window);