var zsPlayer=function(i,e){"use strict";function n(i){this.message=i,this.name="ZsBufferException"}function t(i){this.index=i,this.isInitialised=!1,this.isPlaying=!1,this.audioBuffer=null,this.audioSourceNode=null,this.gainNode=null}function o(t,o){if(!i||!e)throw new n("Invalid libraries. Required: zsUtil and window");S(t)||S(o)?p("_init: invalid buffer list"):(I=t,y=o,B=i.initArray(y.length,null),T=!0)}function u(){g(1)}function a(i,e,n,o){if(S(I))p("playAudioBuffer: Invalid audio context");else{S(i)&&(i=0);var u=B[i];if(S(u)){if(u=new t(i),u.init(),!u.isInitialised)return void p("failed to Initialise buffer: "+i);B[i]=u}S(u)?p("Invalid buffer: "+i):(e||(e=v()),n||(n=0),o||(o=u.audioBuffer.duration),u.play(e,n,o))}}function r(i){if(!i)return p("createBufferAudioSource: invalid audio buffer"),null;if(!I)return p("createBufferAudioSource: Audio context is not initialised!!"),null;var e=I.createBufferSource();return e.buffer=i,e}function s(){if(!I)return p("createBufferAudioSource: Audio context is not initialised!!"),null;var i=I.createGain();return i}function f(i){m("onPlayComplete: index:"+i);var e=B[i];S(e)?p("_onPlayComplete: Invalid buffer: "+i):(e.onEnded(),B[i]=null)}function d(e){i.setConfig(A,e)}function l(i){if(m("stop: bufferIndex: "+i),N()){S(i)&&c();var e=B[i];S(e)||e.stop()}}function c(){if(m("stopAll: "),N())for(var i=0;i<B.length;++i){var e=B[i];S(e)||e.stop()}}function h(e){if(!S(e)){var n=e;i.isString(n)&&(n=i.toFloat(n)),i.isNumeric(n)?b=n:p("_setMaxGain: Invalid gain level: "+n)}}function g(e,n,t){if(S(I))p("setGain: invalid context of master gain");else{i.isString(e)&&(e=i.toFloat(e));var o=A.gain;if(i.isNumeric(e)){o=e,o<0?o=0:o>1&&(o=1),o>b&&(o=b);var u=A.gain;u!==o&&(A.gain=o);var a=A.modTimeSec;if(!S(n)&&i.isNumeric(n)&&(a=i.msecToSec(n)),S(t))for(var r=0;r<B.length;++r){var s=B[r];S(s)||s.setGain(o,a)}else{s=B[t];if(S(s))return void p("_setGain: invalid bufferIndex: "+t);s.setGain(o,a)}}else p("_setGain: Invalid gain level: "+e)}}function v(){return S(I)?0:I.currentTime}function N(){return T}function p(e){i.logError(e,x)}function m(e){i.log(e,x)}function S(e){return i.isNull(e)}const x="ZsBuffer: ";var y=null,B=null,I=null,T=!1,b=1,A={gain:1,modTimeSec:.2,stopToleranceSec:.1};return t.prototype.init=function(){if(this.index<0||this.index>y.length)p("initBuffer: Invalid buffer index: "+bufferIndex);else if(this.audioBuffer=y[this.index],this.audioBuffer)if(this.audioSourceNode=r(this.audioBuffer),S(this.audioSourceNode))p("initBuffer: invalid audio source");else{this.gainNode=s(),this.gainNode.gain.setValueAtTime(A.gain,v()),this.audioSourceNode.connect(this.gainNode),this.gainNode.connect(I.destination),this.audioSourceNode.start||(this.audioSourceNode.start=this.audioSourceNode.noteOn);var i=this.index;this.audioSourceNode.onended=function(e){f(i)},this.isInitialised=!0}else m("initBuffer: invalid buffer")},t.prototype.play=function(i,e,n){S(this.audioSourceNode)||this.isPlaying||(this.audioSourceNode.start(i,e,n),this.isPlaying=!0)},t.prototype.stop=function(){if(this.isPlaying&&!S(this.audioSourceNode)){var i=v();S(this.gainNode)||(i+=A.modTimeSec,this.gainNode.gain.linearRampToValueAtTime(0,i)),m("ZsBuffer stop: time:"+i+" index: "+this.index),this.audioSourceNode.stop(i+A.stopToleranceSec)}},t.prototype.onEnded=function(){S(this.audioSourceNode)||(m("ZsBuffer onComplete: time:"+v()+" index: "+this.index),this.audioSourceNode.disconnect(),this.gainNode.disconnect(),this.audioSourceNode=null,this.gainNode=null,this.isPlaying=!1)},t.prototype.setGain=function(e,n){if(!S(this.gainNode)&&i.isNumeric(e)&&i.isNumeric(n)){e>b&&(e=b);var t=this.gainNode.gain.value;if(t!==e){var o=v(),u=e/4,a=o+n/2,r=e,s=o+n;0===e?(u=0,r=0):u=e<t?e-u:e+u,m("ZsBuffer setGain: time:"+v()+" index: "+this.index+" level: "+e+" duration: "+n),this.gainNode.gain.linearRampToValueAtTime(u,a),this.gainNode.gain.linearRampToValueAtTime(r,s)}}},{init:function(i,e){o(i,e)},play:function(i,e,n,t){a(i,e,n,t)},stop:function(i){l(i)},stopAll:function(){c(bufferIndex)},reset:function(){u()},isReady:function(){return N()},setPlayerConfig:function(i){d(i)},setGain:function(i,e,n){g(i,e,n)},setMaxGain:function(i){h(i)}}}(zsUtil,window);