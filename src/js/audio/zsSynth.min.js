var zsSynth=function(e){"use strict";function t(e){this.message=e,this.name="ZsSynthException"}function n(){d("resetConfig: SYNTH"),R.masterGainVal=.5}function a(n,a){if(!e)throw new t("Invalid libraries. Required: zsUtil");if(d("Init Synth"),!n)return m("_initSynth: invalid context"),void s(!1);M=n,p(a)&&(a=M.destination),g=v(),g.gain.value=R.masterGainVal,q=v(),q.gain.value=1;var i=R.ampEnvelope;N=e.createEnvelope(i.attackTime,i.decayTime,i.sustainLevel,i.sustainTime,i.releaseTime),O=M.createOscillator(),O.frequency.value=R.detuneFreq,x=M.createGain(),x.gain.value=R.detuneMax,O.connect(x),O.start(),F=M.createOscillator(),F.type=R.freqModOscType,F.frequency.value=R.freqModFreq,A=M.createGain(),A.gain.value=R.freqModMax,F.connect(A),F.start(),R.isUseFilter?(R.filterMaxValue=M.sampleRate/2,R.filterNumberOfOctaves=Math.log(R.filterMaxValue/R.filterMinValue)/Math.LN2,V=M.createBiquadFilter(),V.type="string"==typeof V.type?"lowpass":0,V.frequency.value=1e4,V.Q.value=30,q.connect(V),V.connect(g)):q.connect(g),g.connect(a),s(!0)}function i(e){if(y&&!p(V)){var t=Math.pow(2,R.filterNumberOfOctaves*(e-1));V.frequency.value=R.filterMaxValue*t}}function r(e){y&&!p(V)&&(V.Q.value=e*R.filterQMultiplier)}function l(){if(d("_stop: "),h&&!p(G)){for(var e=0;e<G.length;++e)G[e].stop(f()),G[e].disconnect();G=[],h=!1}}function u(e,t){if(!y||p(g))return;p(e)&&(e=440);const n=M.createOscillator(),a=M.createOscillator();if(n.frequency.value=e,n.type="sine",n.detune.value=0,a.frequency.value=e,a.type="sine",a.detune.value=0,n.connect(q),a.connect(q),G.push(n),G.push(a),x.connect(a.detune),A.connect(n.frequency),p(t)){var i=f(),r=q.gain;r.setValueAtTime(1,i),n.start(i),a.start(i)}else{r=q.gain;r.cancelScheduledValues(0);i=f();var u=i;r.setValueAtTime(.001,u),n.start(i),a.start(i);var s=u+N.at*t;r.linearRampToValueAtTime(1,s);var c=s+N.dt*t;r.linearRampToValueAtTime(N.sl,c);var o=c+N.st*t;r.setValueAtTime(N.sl,o);var v=o+N.rt*t;r.linearRampToValueAtTime(1e-4,v);var m=1e3*(t+.05);d("gain: "+r.value+" t5: "+m),setTimeout(l,m)}h=!0}function s(e){p(e)||(d("setReady: "+e),y=e)}function c(){return y}function o(t,n){if(M&&g){e.isString(t)&&(t=e.toFloat(t));var a=R.masterGainVal;if(e.isNumeric(t)){a=t,a<0?a=0:a>1&&(a=1);var i=R.masterGainVal,r=g.gain.value;if(i!==a&&(R.masterGainVal=a),r!==a)if(!p(n)&&e.isNumeric(n)){var l=e.msecToSec(n),u=f(),s=a/4,c=u+l/2,o=a,v=u+l;0===a?(s=0,o=0):s=a<r?r-s:r+s,d("setMasterGain: v1: "+s+" v2: "+o+" t1: "+c+" t2: "+v+" g: "+a+" currentValue: "+r),g.gain.linearRampToValueAtTime(s,c),g.gain.linearRampToValueAtTime(o,v)}else g.gain.setValueAtTime(a,f())}else m("_setMasterGain: Invalid gain level: "+t)}else m("setMasterGain: invalid context of master gain")}function f(){return p(M)?0:M.currentTime}function v(){return M?M.createGain():(m("_createGainNode: Audio context is not initialised!!"),null)}function m(t){e.logError(t,T)}function d(t){e.log(t,T)}function p(t){return e.isNull(t)}const T="ZsSynth: ";var M=null,y=!1,g=null,V=null,q=null,h=!1,G=[],O=null,x=null,F=null,A=null,N=null,R={masterGainVal:.1,filterQMultiplier:30,filterMinValue:100,filterMaxValue:1e3,filterNumberOfOctaves:1,fadeInMs:500,fadeOutMs:500,isUseFilter:!0,ampEnvelope:{attackTime:.1,decayTime:0,sustainLevel:1,sustainTime:.5,releaseTime:.4},detuneFreq:.1,detuneMax:50,freqModFreq:.05,freqModMax:50,freqModOscType:"triangle"};return{init:function(e,t){a(e,t)},reset:function(){n()},setGain:function(e,t){o(e,t)},isReady:function(){return c()},play:function(e,t){return u(e,t)},stop:function(){return l()},setFilterFreq:function(e){i(e)},setFilterQ:function(e){r(e)}}}(zsUtil);