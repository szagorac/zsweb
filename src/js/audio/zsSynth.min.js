var zsSynth=function(e){"use strict";function t(e){this.message=e,this.name="ZsSynthException"}function n(){p("resetConfig: SYNTH"),x.masterGainVal=.5}function a(n,a){if(!e)throw new t("Invalid libraries. Required: zsUtil");if(p("Init Synth"),!n)return m("_initSynth: invalid context"),void s(!1);g=n,T(a)&&(a=g.destination),V=v(),V.gain.value=x.masterGainVal,h=v(),h.gain.value=1;var i=x.ampEnvelope;S=e.createEnvelope(i.attackTime,i.decayTime,i.sustainLevel,i.sustainTime,i.releaseTime),q=g.createOscillator(),q.frequency.value=.1,A=g.createGain(),A.gain.value=50,q.connect(A),q.start(),N=g.createOscillator(),N.type="triangle",N.frequency.value=.05,R=g.createGain(),R.gain.value=50,N.connect(R),N.start(),x.isUseFilter?(x.filterMaxValue=g.sampleRate/2,x.filterNumberOfOctaves=Math.log(x.filterMaxValue/x.filterMinValue)/Math.LN2,M=g.createBiquadFilter(),M.type="string"==typeof M.type?"lowpass":0,M.frequency.value=1e4,M.Q.value=30,h.connect(M),M.connect(V)):h.connect(V),V.connect(a),s(!0)}function i(e){if(y&&!T(M)){var t=Math.pow(2,x.filterNumberOfOctaves*(e-1));M.frequency.value=x.filterMaxValue*t}}function l(e){y&&!T(M)&&(M.Q.value=e*x.filterQMultiplier)}function r(){if(p("_stop: "),G&&!T(O)){for(var e=0;e<O.length;++e)O[e].stop(f()),O[e].disconnect();O=[],G=!1}}function u(e,t){if(!y||T(V))return;T(e)&&(e=440);const n=g.createOscillator(),a=g.createOscillator();if(n.frequency.value=e,n.type="sine",n.detune.value=0,a.frequency.value=e,a.type="sine",a.detune.value=0,n.connect(h),a.connect(h),O.push(n),O.push(a),A.connect(a.detune),R.connect(n.frequency),T(t)){var i=f(),l=h.gain;l.setValueAtTime(1,i),n.start(i),a.start(i)}else{l=h.gain;l.cancelScheduledValues(0);i=f();var u=i;l.setValueAtTime(.001,u),n.start(i),a.start(i);var s=u+S.at*t;l.linearRampToValueAtTime(1,s);var c=s+S.dt*t;l.linearRampToValueAtTime(S.sl,c);var o=c+S.st*t;l.setValueAtTime(S.sl,o);var v=o+S.rt*t;l.linearRampToValueAtTime(1e-4,v);var m=1e3*(t+.05);p("gain: "+l.value+" t5: "+m),setTimeout(r,m)}G=!0}function s(e){T(e)||(p("setReady: "+e),y=e)}function c(){return y}function o(t,n){if(g&&V){e.isString(t)&&(t=e.toFloat(t));var a=x.masterGainVal;if(e.isNumeric(t)){a=t,a<0?a=0:a>1&&(a=1);var i=x.masterGainVal,l=V.gain.value;if(i!==a&&(x.masterGainVal=a),l!==a)if(!T(n)&&e.isNumeric(n)){var r=e.msecToSec(n),u=f(),s=a/4,c=u+r/2,o=a,v=u+r;0===a?(s=0,o=0):s=a<l?l-s:l+s,p("setMasterGain: v1: "+s+" v2: "+o+" t1: "+c+" t2: "+v+" g: "+a+" currentValue: "+l),V.gain.linearRampToValueAtTime(s,c),V.gain.linearRampToValueAtTime(o,v)}else V.gain.setValueAtTime(a,f())}else m("_setMasterGain: Invalid gain level: "+t)}else m("setMasterGain: invalid context of master gain")}function f(){return T(g)?0:g.currentTime}function v(){return g?g.createGain():(m("_createGainNode: Audio context is not initialised!!"),null)}function m(t){e.logError(t,d)}function p(t){e.log(t,d)}function T(t){return e.isNull(t)}const d="ZsSynth: ";var g=null,y=!1,V=null,M=null,h=null,G=!1,O=[],q=null,A=null,N=null,R=null,S=null,x={masterGainVal:.1,filterQMultiplier:30,filterMinValue:100,filterMaxValue:1e3,filterNumberOfOctaves:1,fadeInMs:500,fadeOutMs:500,isUseFilter:!0,ampEnvelope:{attackTime:.1,decayTime:0,sustainLevel:1,sustainTime:.5,releaseTime:.4}};return{init:function(e,t){a(e,t)},reset:function(){n()},setGain:function(e,t){o(e,t)},isReady:function(){return c()},play:function(e,t){return u(e,t)},stop:function(){return r()},setFilterFreq:function(e){i(e)},setFilterQ:function(e){l(e)}}}(zsUtil);